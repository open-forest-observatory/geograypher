
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../derived_cameras/">
      
      
      <link rel="icon" href="../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Cameras Docstrings - Geograypher Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#geograypher.cameras.PhotogrammetryCamera" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Geograypher Documentation" class="md-header__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo-shaded.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Geograypher Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cameras Docstrings
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://openforestobservatory.org/" class="md-tabs__link">
        
  
  
    
  
  ← OFO home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting_started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples_and_applications/examples/" class="md-tabs__link">
          
  
  
    
  
  Examples and applications

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../software_design/" class="md-tabs__link">
        
  
  
    
  
  Software design

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../entrypoints/" class="md-tabs__link">
          
  
  
    
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Geograypher Documentation" class="md-nav__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo-shaded.png" alt="logo">

    </a>
    Geograypher Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://openforestobservatory.org/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ← OFO home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/conceptual_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptual workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples and applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples and applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples_and_applications/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples_and_applications/applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects using geograypher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../software_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software design
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../entrypoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrypoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../meshes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Meshes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Meshes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meshes/derived_meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meshes/meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cameras
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Cameras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Cameras Docstrings
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Cameras Docstrings
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PhotogrammetryCamera
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PhotogrammetryCamera">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.cast_rays" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;cast_rays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.check_projected_in_image" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;check_projected_in_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.extract_colors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;extract_colors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_hash" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_location" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_view_angle" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_view_angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_image_size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_image_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_local_to_epsg_4978_transform" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_local_to_epsg_4978_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_lon_lat" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_lon_lat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_pyvista_camera" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_pyvista_camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_vis_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vis_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.project_mesh_verts" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;project_mesh_verts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.vis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.vis_rays" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis_rays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PhotogrammetryCameraSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PhotogrammetryCameraSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.calc_line_segments" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calc_line_segments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.distortion_key" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;distortion_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_camera_locations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_camera_view_angles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_view_angles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_cameras_in_folder" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cameras_in_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_cameras_matching_filename_regex" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cameras_matching_filename_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_image_filename" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_image_filename
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_image_filename">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_image_filename--todo-update-to-support-lists-of-integer-indices-as-well" class="md-nav__link">
    <span class="md-ellipsis">
      TODO update to support lists of integer indices as well
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_local_to_epsg_4978_transform" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_local_to_epsg_4978_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_lon_lat_coords" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_lon_lat_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_subset_ROI" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subset_ROI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_vis_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vis_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.ideal_to_warped" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;ideal_to_warped
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.make_distortion_map" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_distortion_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.n_cameras" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;n_cameras
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.n_image_channels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;n_image_channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.triangulate_detections" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;triangulate_detections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.vis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_image" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;warp_dewarp_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;warp_dewarp_pixels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../derived_cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../predictors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Predictors
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_4" id="__nav_6_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Predictors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/derived_segmentors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Segmentors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/ortho_segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ortho segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_5" id="__nav_6_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/numeric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Numeric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Indexing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/geometric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geometric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/geospatial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geospatial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/parsing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parsing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/prediction_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prediction metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/example_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PhotogrammetryCamera
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PhotogrammetryCamera">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.cast_rays" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;cast_rays
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.check_projected_in_image" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;check_projected_in_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.extract_colors" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;extract_colors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_hash" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_location" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_properties" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_properties
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_view_angle" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_view_angle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_image_size" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_image_size
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_local_to_epsg_4978_transform" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_local_to_epsg_4978_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_lon_lat" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_lon_lat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_pyvista_camera" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_pyvista_camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.get_vis_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vis_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.project_mesh_verts" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;project_mesh_verts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.vis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCamera.vis_rays" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis_rays
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;PhotogrammetryCameraSet
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" PhotogrammetryCameraSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.calc_line_segments" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;calc_line_segments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.distortion_key" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;distortion_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_camera_locations" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_camera_view_angles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_camera_view_angles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_cameras_in_folder" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cameras_in_folder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_cameras_matching_filename_regex" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_cameras_matching_filename_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_image_filename" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_image_filename
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" get_image_filename">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_image_filename--todo-update-to-support-lists-of-integer-indices-as-well" class="md-nav__link">
    <span class="md-ellipsis">
      TODO update to support lists of integer indices as well
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_local_to_epsg_4978_transform" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_local_to_epsg_4978_transform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_lon_lat_coords" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_lon_lat_coords
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_subset_ROI" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_subset_ROI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.get_vis_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vis_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.ideal_to_warped" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;ideal_to_warped
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.make_distortion_map" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;make_distortion_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.n_cameras" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;n_cameras
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.n_image_channels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;n_image_channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.triangulate_detections" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;triangulate_detections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.vis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_image" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;warp_dewarp_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;warp_dewarp_pixels
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/open-forest-observatory/geograypher/edit/main/docs/API_reference/cameras/cameras.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


  <h1>Cameras Docstrings</h1>

<div class="doc doc-object doc-class">



<h2 id="geograypher.cameras.PhotogrammetryCamera" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>PhotogrammetryCamera</code>


<a href="#geograypher.cameras.PhotogrammetryCamera" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">









              <details class="quote">
                <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">class</span><span class="w"> </span><span class="nc">PhotogrammetryCamera</span><span class="p">:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">image_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">cam_to_world_transform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">cx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">cy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">distortion_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">lon_lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">local_to_epsg_4978_transform</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="p">):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Represents the information about one camera location/image as determined by photogrammetry</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            image_filename (PATH_TYPE): The image used for reconstruction</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            transform (np.ndarray): A 4x4 transform representing the camera-to-world transform</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            f (float): Focal length in pixels</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            cx (float): Principle point x (pixels) from center</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            cy (float): Principle point y (pixels) from center</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            image_width (int): Input image width pixels</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            image_height (int): Input image height pixels</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            distortion_params (dict, optional): Distortion parameters, currently unused</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            lon_lat (Union[None, Tuple[float, float]], optional): Location, defaults to None</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span> <span class="o">=</span> <span class="n">image_filename</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span> <span class="o">=</span> <span class="n">cam_to_world_transform</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_to_cam_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cam_to_world_transform</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cx</span> <span class="o">=</span> <span class="n">cx</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cy</span> <span class="o">=</span> <span class="n">cy</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">=</span> <span class="n">image_width</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">=</span> <span class="n">image_height</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">distortion_params</span> <span class="o">=</span> <span class="n">distortion_params</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span> <span class="o">=</span> <span class="n">local_to_epsg_4978_transform</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="n">lon_lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="n">lon_lat</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image_height</span><span class="p">,</span> <span class="n">image_width</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_image</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="kc">False</span>  <span class="c1"># Only set to true if you can hold all images in memory</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_image_hash</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a hash value for the camera&#39;s geometry and optionally includes the image</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            include_image_hash (bool, optional): Whether to include the image filename in the hash computation. Defaults to false.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            int: A hash value representing the current state of the camera</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="c1"># Geometric information of hash</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">transform_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">camera_settings</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform_hash</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="s2">&quot;cx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="s2">&quot;cy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="s2">&quot;image_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="s2">&quot;image_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="s2">&quot;distortion_params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="s2">&quot;lon_lat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="p">}</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="c1"># Include the image associated with the hash if specified</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="n">include_image_hash</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">camera_settings</span><span class="p">[</span><span class="s2">&quot;image_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">camera_settings_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">camera_settings</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">camera_settings_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the properties about a camera.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            dict: A dictionary containing the focal length, principal point coordinates,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">                image height, image width, distortion parameters, and world_to_cam_transform.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">camera_properties</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="s2">&quot;focal_length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="s2">&quot;principal_point_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="s2">&quot;principal_point_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="s2">&quot;image_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="s2">&quot;image_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="s2">&quot;distortion_params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="s2">&quot;world_to_cam_transform&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_to_cam_transform</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="p">}</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">return</span> <span class="n">camera_properties</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="c1"># Check if the image is cached</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">/</span> <span class="mf">255.0</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="c1"># Avoid unneccesary read if we have memory</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_image</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="c1"># Resizing is never cached, consider revisiting</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">if</span> <span class="n">image_scale</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>                <span class="n">image</span><span class="p">,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)),</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">return</span> <span class="n">image</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return image size, potentially scaled</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            image_scale (float, optional): How much to scale by. Defaults to 1.0.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            tuple[int]: (h, w) in pixels</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="c1"># We should never have to deal with other cases if the reported size is accurate</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="k">pass</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">negate_easting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the lon, lat tuple, reading from exif metadata if neccessary&quot;&quot;&quot;</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="n">get_GPS_exif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="k">if</span> <span class="n">negate_easting</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_z_coordinate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a tuple of camera coordinates from the camera-to-world transformation matrix.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">            get_z_coordinate (bool):</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">                Flag that user can set if they want z-coordinates. Defaults to False.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">            Tuple[float, float (, float)]: tuple containing internal mesh coordinates of the camera</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="k">if</span> <span class="n">get_z_coordinate</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_view_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the off-nadir pitch and yaw angles, computed geometrically from the photogrammtery result</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">            in_deg (bool, optional): Return the angles in degrees rather than radians. Defaults to True.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">            tuple: (pitch-from-nadir, yaw-from-nadir). Units are defined by in_deg parameter</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="c1"># This is the origin, a point at one unit along the principal axis, a point one unit</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="c1"># up (-Y), and a point one unit right (+X)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">points_in_camera_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="c1"># Transform the points first into the world frame and then into the earth-centered,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="c1"># earth-fixed frame</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="o">@</span> <span class="n">points_in_camera_frame</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="c1"># Remove the homogenous coordinate and transpose</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="n">points_in_ECEF</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="c1"># Convert to shapely points</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points_in_ECEF</span><span class="p">]</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="c1"># Convert to a dataframe</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">points_in_ECEF</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">EARTH_CENTERED_EARTH_FIXED_CRS</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="c1"># Convert to lat lon</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">points_in_lat_lon</span> <span class="o">=</span> <span class="n">points_in_ECEF</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">LAT_LON_CRS</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="c1"># Convert to a local projected CRS</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">points_in_projected_CRS</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">points_in_lat_lon</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="c1"># Extract the geometry</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">points_in_projected_CRS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>            <span class="p">[[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points_in_projected_CRS</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="c1"># Compute three vectors starting at the camera origin</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">view_vector</span> <span class="o">=</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">up_vector</span> <span class="o">=</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">right_vector</span> <span class="o">=</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="c1"># The nadir vector points straight down</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="n">NADIR_VEC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="c1"># For pitch, project the view vector onto the plane defined by the up vector and the nadir</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">pitch_projection_view_vec</span> <span class="o">=</span> <span class="n">projection_onto_plane</span><span class="p">(</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="n">view_vector</span><span class="p">,</span> <span class="n">up_vector</span><span class="p">,</span> <span class="n">NADIR_VEC</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="c1"># For yaw, project the view vector onto the plane defined by the right vector and the nadir</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="n">yaw_projection_view_vec</span> <span class="o">=</span> <span class="n">projection_onto_plane</span><span class="p">(</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="n">view_vector</span><span class="p">,</span> <span class="n">right_vector</span><span class="p">,</span> <span class="n">NADIR_VEC</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="c1"># Find the angle between these projected vectors and the nadir vector</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="n">pitch_angle</span> <span class="o">=</span> <span class="n">angle_between</span><span class="p">(</span><span class="n">pitch_projection_view_vec</span><span class="p">,</span> <span class="n">NADIR_VEC</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">yaw_angle</span> <span class="o">=</span> <span class="n">angle_between</span><span class="p">(</span><span class="n">yaw_projection_view_vec</span><span class="p">,</span> <span class="n">NADIR_VEC</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="c1"># Return in degrees if requested</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="k">if</span> <span class="n">in_deg</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">pitch_angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">yaw_angle</span><span class="p">))</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="c1"># Return in radians</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">pitch_angle</span><span class="p">,</span> <span class="n">yaw_angle</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_local_to_epsg_4978_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        Return the 4x4 homogenous transform mapping from the local coordinates used for</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        photogrammetry to the earth-centered, earth-fixed coordinate reference system defined by</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        EPSG:4978 (https://epsg.io/4978).</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">            np.ndarray:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">                The transform in the form:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                   [R | t]</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">                   [0 | 1]</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">                When a homogenous vector is multiplied on the right of this matrix, it is</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">                transformed from the local coordinate frame to EPSG:4978. Conversely, the inverse</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">                of this matrix can be used to map from EPSG:4879 to local coordinates.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_projected_in_image</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">homogenous_image_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if projected points are within the bound of the image and in front of camera</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">            homogenous_image_coords (np.ndarray): The points after the application of K[R|t]. (3, n_points)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">            image_size (Tuple[int, int]): The size of the image (width, height) in pixels</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">            np.ndarray: valid_points_bool, boolean array corresponding to which points were valid (n_points)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">            np.ndarray: valid_image_space_points, float array of image-space coordinates for only valid points, (n_valid_points, 2)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">img_width</span><span class="p">,</span> <span class="n">image_height</span> <span class="o">=</span> <span class="n">image_size</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="c1"># Divide by the z coord to project onto the image plane</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">image_space_points</span> <span class="o">=</span> <span class="n">homogenous_image_coords</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">homogenous_image_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="c1"># Transpose for convenience, (n_points, 3)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="n">image_space_points</span> <span class="o">=</span> <span class="n">image_space_points</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="c1"># We only want to consider points in front of the camera. Simple projection cannot tell</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="c1"># if a point is on the same ray behind the camera</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">in_front_of_cam</span> <span class="o">=</span> <span class="n">homogenous_image_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="c1"># Check that the point is projected within the image and is in front of the camera</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="c1"># Pytorch doesn&#39;t have a logical_and.reduce operator, so this is the equivilent using boolean multiplication</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">valid_points_bool</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="o">*</span> <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>            <span class="o">*</span> <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">img_width</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="o">*</span> <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">image_height</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="o">*</span> <span class="n">in_front_of_cam</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="c1"># Extract the points that are valid</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">valid_image_space_points</span> <span class="o">=</span> <span class="n">image_space_points</span><span class="p">[</span><span class="n">valid_points_bool</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">int</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="c1"># Return the boolean array</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">valid_points_bool</span> <span class="o">=</span> <span class="n">valid_points_bool</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="n">valid_image_space_points</span> <span class="o">=</span> <span class="n">valid_image_space_points</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="k">return</span> <span class="n">valid_points_bool</span><span class="p">,</span> <span class="n">valid_image_space_points</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_colors</span><span class="p">(</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">valid_bool</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">valid_locs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>    <span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">            valid_bool (np.ndarray): (n_points,) boolean array cooresponding to valid points</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">            valid_locs (np.ndarray): (n_valid, 2) float array of image-space locations (x,y)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">            img (np.ndarray): (h, w, n_channels) image to query from</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">            np.ma.array: (n_points, n_channels) One color per valid vertex. Points that were invalid are masked out</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="c1"># Set up the data arrays</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">colors_per_vertex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">valid_bool</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">valid_bool</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="c1"># Set the entries which are valid to false, meaning a valid entry in the masked array</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="c1"># TODO see if I can use valid_bool directly instead</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">valid_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">valid_bool</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">mask</span><span class="p">[</span><span class="n">valid_inds</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="c1"># Extract coordinates</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">i_locs</span> <span class="o">=</span> <span class="n">valid_locs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">j_locs</span> <span class="o">=</span> <span class="n">valid_locs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="c1"># Index based on the coordinates</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">valid_color_samples</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">i_locs</span><span class="p">,</span> <span class="n">j_locs</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="c1"># Insert the valid samples into the array at the valid locations</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">colors_per_vertex</span><span class="p">[</span><span class="n">valid_inds</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">valid_color_samples</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="c1"># Convert to a masked array</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">masked_color_per_vertex</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors_per_vertex</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">return</span> <span class="n">masked_color_per_vertex</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">project_mesh_verts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_verts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a color per vertex using only projective geometry, without considering occlusion or distortion</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">            np.ma.array: (n_points, n_channels) One color per valid vertex. Points that were invalid are masked out</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="c1"># [R|t] matrix</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="n">transform_3x4_world_to_cam</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">world_to_cam_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">K</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="p">[</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">],</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">],</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="p">],</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="c1"># K[R|t], (3,4). Premultiplying these two matrices avoids doing two steps of projections with all points</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">camera_matrix</span> <span class="o">=</span> <span class="n">K</span> <span class="o">@</span> <span class="n">transform_3x4_world_to_cam</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="c1"># Add the extra dimension of ones for matrix multiplication</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">homogenous_mesh_verts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>            <span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">mesh_verts</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">mesh_verts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>            <span class="p">),</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="c1"># TODO review terminology</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="n">homogenous_camera_points</span> <span class="o">=</span> <span class="n">camera_matrix</span> <span class="o">@</span> <span class="n">homogenous_mesh_verts</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="c1"># Determine what points project onto the image and at what locations</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="n">valid_bool</span><span class="p">,</span> <span class="n">valid_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_projected_in_image</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">projected_verts</span><span class="o">=</span><span class="n">homogenous_camera_points</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span><span class="p">),</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="c1"># Extract corresponding colors from the image</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">colors_per_vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_colors</span><span class="p">(</span><span class="n">valid_bool</span><span class="p">,</span> <span class="n">valid_locs</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">return</span> <span class="n">colors_per_vertex</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_pyvista_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focal_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">Camera</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">        Get a pyvista camera at the location specified by photogrammetry.</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">        Note that there is no principle point and only the vertical field of view is set</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">            focal_dist (float, optional): How far away from the camera the center point should be. Defaults to 10.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">            pv.Camera: The pyvista camera from that viewpoint.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="c1"># Instantiate a new camera</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="n">camera</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Camera</span><span class="p">()</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="c1"># Get the position as the translational part of the transform</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="n">camera_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>        <span class="c1"># Get the look point by transforming a ray along the camera&#39;s Z axis into world</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="c1"># coordinates and then adding this to the location</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>        <span class="n">camera_look</span> <span class="o">=</span> <span class="n">camera_position</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">focal_dist</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="c1"># Get the up direction of the camera by finding which direction the -Y (image up) vector is transformed to</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="n">camera_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="c1"># Compute the vertical field of view</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="n">vertical_FOV_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="c1"># Set the values</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span> <span class="o">=</span> <span class="n">camera_look</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="n">camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">camera_position</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">camera</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">camera_up</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="n">camera</span><span class="o">.</span><span class="n">view_angle</span> <span class="o">=</span> <span class="n">vertical_FOV_angle</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="n">camera</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_vis_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get this camera as a mesh representation.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">            frustum_scale (float, optional): Size of cameras in world units.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        Returns (PolyData): blue mesh of the camera as a frustum with a</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">            red face indicating the image top.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">scaled_halfwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="n">scaled_halfheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">scaled_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">scaled_cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">right</span> <span class="o">=</span> <span class="n">scaled_cx</span> <span class="o">+</span> <span class="n">scaled_halfwidth</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">left</span> <span class="o">=</span> <span class="n">scaled_cx</span> <span class="o">-</span> <span class="n">scaled_halfwidth</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="n">top</span> <span class="o">=</span> <span class="n">scaled_cy</span> <span class="o">+</span> <span class="n">scaled_halfheight</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">bottom</span> <span class="o">=</span> <span class="n">scaled_cy</span> <span class="o">-</span> <span class="n">scaled_halfheight</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="p">[</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                    <span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                    <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                    <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="p">]</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="o">*</span> <span class="n">frustum_scale</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="c1"># Make the coordinates homogenous</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))))</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="c1"># Project the vertices into the world cordinates</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">projected_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span> <span class="o">@</span> <span class="n">vertices</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="c1"># Deal with the case where there is a scale transform</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="n">projected_vertices</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="c1">## mesh faces</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="p">[</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># side</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># bottom</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>  <span class="c1"># side</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># top</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># endcap triangle #1</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># endcap triangle #2</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="p">]</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="c1"># All blue except the top (-Y) surface is red</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="n">face_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="p">[</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>                <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="p">]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>        <span class="c1"># Create a mesh for the camera frustum</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>        <span class="n">frustum</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">projected_vertices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>        <span class="c1"># Unsure exactly what&#39;s going on here, but it&#39;s required for it to be valid</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="n">frustum</span><span class="o">.</span><span class="n">triangulate</span><span class="p">()</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="c1"># Assign the face colors to the mesh</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="n">frustum</span><span class="p">[</span><span class="s2">&quot;RGB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">pyvista_ndarray</span><span class="p">(</span><span class="n">face_colors</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="k">return</span> <span class="n">frustum</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        Visualize the camera as a frustum, at the appropriate translation and</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">        rotation and with the given focal length and aspect ratio.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">            plotter (pv.Plotter): The plotter to add the visualization to</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">            frustum_scale (float, optional): The length of the frustum in world units.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vis_mesh</span><span class="p">(</span><span class="n">frustum_scale</span><span class="p">)</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="c1"># Show the mesh with the given face colors</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="n">mesh</span><span class="p">,</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="p">)</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cast_rays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixel_coords_ij</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">line_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute rays eminating from the camera</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">            image_coords (np.ndarray): (n,2) array of (i,j) pixel coordinates in the image</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">            line_length (float, optional): How long the lines are. Defaults to 10. #TODO allow an array of different values</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">            np.array: The projected vertices, TODO</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="c1"># Transform from i, j to x, y</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="n">pixel_coords_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">pixel_coords_ij</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="c1"># Cast a ray from the center of the mesh for vis</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="n">principal_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">]]</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">centered_pixel_coords</span> <span class="o">=</span> <span class="n">pixel_coords_xy</span> <span class="o">-</span> <span class="n">principal_point</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">scaled_pixel_coords</span> <span class="o">=</span> <span class="n">centered_pixel_coords</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaled_pixel_coords</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="k">if</span> <span class="n">n_points</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="k">return</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">scale_vector</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">line_length</span><span class="p">):</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">            Helper function to normalize the direction vector and scale it so</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">            the final vector magnitude is line_length.</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="c1"># Expand the (x, y) homogenous coordinates to (x, y, 1) and normalize</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="n">homogeneous</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">homogeneous</span><span class="p">)</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">homogeneous</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">line_length</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="n">line_verts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                <span class="p">[</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">scale_vector</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">line_length</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>                <span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">scaled_pixel_coords</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>        <span class="p">]</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="n">line_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">line_verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="n">projected_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span> <span class="o">@</span> <span class="n">line_verts</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="c1"># Handle scale in transform</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="n">projected_vertices</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="n">projected_vertices</span> <span class="o">=</span> <span class="n">projected_vertices</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">return</span> <span class="n">projected_vertices</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vis_rays</span><span class="p">(</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">pixel_coords_ij</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="n">line_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="p">):</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show rays eminating from the camera</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">            image_coords (np.ndarray): (n,2) array of (i,j) pixel coordinates in the image</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">            plotter (pv.Plotter): Plotter to use.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">            line_length (float, optional): How long the lines are. Defaults to 10. #TODO allow an array of different values</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="c1"># If there are no detections, just skip it</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pixel_coords_ij</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="k">return</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">projected_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cast_rays</span><span class="p">(</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="n">pixel_coords_ij</span><span class="o">=</span><span class="n">pixel_coords_ij</span><span class="p">,</span> <span class="n">line_length</span><span class="o">=</span><span class="n">line_length</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="n">n_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">projected_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>            <span class="p">(</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="n">mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">projected_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h3 id="geograypher.cameras.PhotogrammetryCamera-functions">Functions<a href="#geograypher.cameras.PhotogrammetryCamera-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">image_filename</span><span class="p">,</span> <span class="n">cam_to_world_transform</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">image_width</span><span class="p">,</span> <span class="n">image_height</span><span class="p">,</span> <span class="n">distortion_params</span><span class="o">=</span><span class="p">{},</span> <span class="n">lon_lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">local_to_epsg_4978_transform</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Represents the information about one camera location/image as determined by photogrammetry</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_filename</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The image used for reconstruction</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4x4 transform representing the camera-to-world transform</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>f</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Focal length in pixels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cx</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Principle point x (pixels) from center</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cy</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Principle point y (pixels) from center</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input image width pixels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_height</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input image height pixels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distortion_params</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distortion parameters, currently unused</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_lat</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Location, defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">image_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">cam_to_world_transform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">f</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">cx</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">cy</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">image_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">image_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">distortion_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">lon_lat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">local_to_epsg_4978_transform</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="p">):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the information about one camera location/image as determined by photogrammetry</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        image_filename (PATH_TYPE): The image used for reconstruction</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        transform (np.ndarray): A 4x4 transform representing the camera-to-world transform</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        f (float): Focal length in pixels</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        cx (float): Principle point x (pixels) from center</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        cy (float): Principle point y (pixels) from center</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        image_width (int): Input image width pixels</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        image_height (int): Input image height pixels</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        distortion_params (dict, optional): Distortion parameters, currently unused</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        lon_lat (Union[None, Tuple[float, float]], optional): Location, defaults to None</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span> <span class="o">=</span> <span class="n">image_filename</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span> <span class="o">=</span> <span class="n">cam_to_world_transform</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">world_to_cam_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cam_to_world_transform</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cx</span> <span class="o">=</span> <span class="n">cx</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cy</span> <span class="o">=</span> <span class="n">cy</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">=</span> <span class="n">image_width</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">=</span> <span class="n">image_height</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">distortion_params</span> <span class="o">=</span> <span class="n">distortion_params</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span> <span class="o">=</span> <span class="n">local_to_epsg_4978_transform</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="n">lon_lat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="n">lon_lat</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image_height</span><span class="p">,</span> <span class="n">image_width</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cache_image</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="kc">False</span>  <span class="c1"># Only set to true if you can hold all images in memory</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.cast_rays" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">cast_rays</span><span class="p">(</span><span class="n">pixel_coords_ij</span><span class="p">,</span> <span class="n">line_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.cast_rays" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Compute rays eminating from the camera</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n,2) array of (i,j) pixel coordinates in the image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_length</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How long the lines are. Defaults to 10. #TODO allow an array of different values</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.array: The projected vertices, TODO</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="k">def</span><span class="w"> </span><span class="nf">cast_rays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pixel_coords_ij</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">line_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute rays eminating from the camera</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a><span class="sd">        image_coords (np.ndarray): (n,2) array of (i,j) pixel coordinates in the image</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a><span class="sd">        line_length (float, optional): How long the lines are. Defaults to 10. #TODO allow an array of different values</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a><span class="sd">        np.array: The projected vertices, TODO</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="c1"># Transform from i, j to x, y</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="n">pixel_coords_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">pixel_coords_ij</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="c1"># Cast a ray from the center of the mesh for vis</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>    <span class="n">principal_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">]]</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">centered_pixel_coords</span> <span class="o">=</span> <span class="n">pixel_coords_xy</span> <span class="o">-</span> <span class="n">principal_point</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">scaled_pixel_coords</span> <span class="o">=</span> <span class="n">centered_pixel_coords</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaled_pixel_coords</span><span class="p">)</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="k">if</span> <span class="n">n_points</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="k">return</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">scale_vector</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">line_length</span><span class="p">):</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">        Helper function to normalize the direction vector and scale it so</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        the final vector magnitude is line_length.</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="c1"># Expand the (x, y) homogenous coordinates to (x, y, 1) and normalize</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">homogeneous</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">homogeneous</span><span class="p">)</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">homogeneous</span> <span class="o">/</span> <span class="n">norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">line_length</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>    <span class="n">line_verts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="p">[</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>                <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">scale_vector</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">line_length</span><span class="p">),</span> <span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="p">]</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="p">)</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">scaled_pixel_coords</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="p">]</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="n">line_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">line_verts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="n">projected_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span> <span class="o">@</span> <span class="n">line_verts</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="c1"># Handle scale in transform</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="n">projected_vertices</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">projected_vertices</span> <span class="o">=</span> <span class="n">projected_vertices</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="k">return</span> <span class="n">projected_vertices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.check_projected_in_image" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">check_projected_in_image</span><span class="p">(</span><span class="n">homogenous_image_coords</span><span class="p">,</span> <span class="n">image_size</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.check_projected_in_image" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if projected points are within the bound of the image and in front of camera</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>homogenous_image_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The points after the application of K[R|t]. (3, n_points)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_size</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the image (width, height) in pixels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: valid_points_bool, boolean array corresponding to which points were valid (n_points)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: valid_image_space_points, float array of image-space coordinates for only valid points, (n_valid_points, 2)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_projected_in_image</span><span class="p">(</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">homogenous_image_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="p">):</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if projected points are within the bound of the image and in front of camera</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        homogenous_image_coords (np.ndarray): The points after the application of K[R|t]. (3, n_points)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        image_size (Tuple[int, int]): The size of the image (width, height) in pixels</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        np.ndarray: valid_points_bool, boolean array corresponding to which points were valid (n_points)</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        np.ndarray: valid_image_space_points, float array of image-space coordinates for only valid points, (n_valid_points, 2)</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">img_width</span><span class="p">,</span> <span class="n">image_height</span> <span class="o">=</span> <span class="n">image_size</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="c1"># Divide by the z coord to project onto the image plane</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="n">image_space_points</span> <span class="o">=</span> <span class="n">homogenous_image_coords</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">homogenous_image_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="c1"># Transpose for convenience, (n_points, 3)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="n">image_space_points</span> <span class="o">=</span> <span class="n">image_space_points</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="c1"># We only want to consider points in front of the camera. Simple projection cannot tell</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="c1"># if a point is on the same ray behind the camera</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="n">in_front_of_cam</span> <span class="o">=</span> <span class="n">homogenous_image_coords</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="c1"># Check that the point is projected within the image and is in front of the camera</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="c1"># Pytorch doesn&#39;t have a logical_and.reduce operator, so this is the equivilent using boolean multiplication</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="n">valid_points_bool</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="o">*</span> <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="o">*</span> <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">img_width</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="o">*</span> <span class="p">(</span><span class="n">image_space_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">image_height</span><span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="o">*</span> <span class="n">in_front_of_cam</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="p">)</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="c1"># Extract the points that are valid</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="n">valid_image_space_points</span> <span class="o">=</span> <span class="n">image_space_points</span><span class="p">[</span><span class="n">valid_points_bool</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">int</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="c1"># Return the boolean array</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="n">valid_points_bool</span> <span class="o">=</span> <span class="n">valid_points_bool</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="n">valid_image_space_points</span> <span class="o">=</span> <span class="n">valid_image_space_points</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="k">return</span> <span class="n">valid_points_bool</span><span class="p">,</span> <span class="n">valid_image_space_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.extract_colors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">extract_colors</span><span class="p">(</span><span class="n">valid_bool</span><span class="p">,</span> <span class="n">valid_locs</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.extract_colors" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p><em>summary</em></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>valid_bool</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_points,) boolean array cooresponding to valid points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>valid_locs</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_valid, 2) float array of image-space locations (x,y)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>img</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(h, w, n_channels) image to query from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ma.array: (n_points, n_channels) One color per valid vertex. Points that were invalid are masked out</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_colors</span><span class="p">(</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">valid_bool</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">valid_locs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="p">):</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        valid_bool (np.ndarray): (n_points,) boolean array cooresponding to valid points</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        valid_locs (np.ndarray): (n_valid, 2) float array of image-space locations (x,y)</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        img (np.ndarray): (h, w, n_channels) image to query from</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">        np.ma.array: (n_points, n_channels) One color per valid vertex. Points that were invalid are masked out</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="c1"># Set up the data arrays</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="n">colors_per_vertex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">valid_bool</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">valid_bool</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="c1"># Set the entries which are valid to false, meaning a valid entry in the masked array</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>    <span class="c1"># TODO see if I can use valid_bool directly instead</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">valid_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">valid_bool</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="n">mask</span><span class="p">[</span><span class="n">valid_inds</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="c1"># Extract coordinates</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="n">i_locs</span> <span class="o">=</span> <span class="n">valid_locs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="n">j_locs</span> <span class="o">=</span> <span class="n">valid_locs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="c1"># Index based on the coordinates</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="n">valid_color_samples</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">i_locs</span><span class="p">,</span> <span class="n">j_locs</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="c1"># Insert the valid samples into the array at the valid locations</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="n">colors_per_vertex</span><span class="p">[</span><span class="n">valid_inds</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">valid_color_samples</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="c1"># Convert to a masked array</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">masked_color_per_vertex</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors_per_vertex</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="k">return</span> <span class="n">masked_color_per_vertex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_camera_hash" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_camera_hash</span><span class="p">(</span><span class="n">include_image_hash</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_hash" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Generates a hash value for the camera's geometry and optionally includes the image</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>include_image_hash</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the image filename in the hash computation. Defaults to false.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A hash value representing the current state of the camera</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_camera_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_image_hash</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a hash value for the camera&#39;s geometry and optionally includes the image</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        include_image_hash (bool, optional): Whether to include the image filename in the hash computation. Defaults to false.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        int: A hash value representing the current state of the camera</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="c1"># Geometric information of hash</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">transform_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">camera_settings</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform_hash</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="s2">&quot;cx&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="s2">&quot;cy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="s2">&quot;image_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="s2">&quot;image_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span><span class="p">,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="s2">&quot;distortion_params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="s2">&quot;lon_lat&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="p">}</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># Include the image associated with the hash if specified</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">include_image_hash</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">camera_settings</span><span class="p">[</span><span class="s2">&quot;image_filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">camera_settings_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">camera_settings</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">camera_settings_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_camera_location" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_camera_location</span><span class="p">(</span><span class="n">get_z_coordinate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_location" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns a tuple of camera coordinates from the camera-to-world transformation matrix.
Args:
    get_z_coordinate (bool):
        Flag that user can set if they want z-coordinates. Defaults to False.
Returns:
    Tuple[float, float (, float)]: tuple containing internal mesh coordinates of the camera</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_camera_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_z_coordinate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a tuple of camera coordinates from the camera-to-world transformation matrix.</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        get_z_coordinate (bool):</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            Flag that user can set if they want z-coordinates. Defaults to False.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        Tuple[float, float (, float)]: tuple containing internal mesh coordinates of the camera</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">if</span> <span class="n">get_z_coordinate</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_camera_properties" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_camera_properties</span><span class="p">()</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_properties" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the properties about a camera.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the focal length, principal point coordinates,
image height, image width, distortion parameters, and world_to_cam_transform.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_camera_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the properties about a camera.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        dict: A dictionary containing the focal length, principal point coordinates,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            image height, image width, distortion parameters, and world_to_cam_transform.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">camera_properties</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="s2">&quot;focal_length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="s2">&quot;principal_point_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="s2">&quot;principal_point_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="s2">&quot;image_height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="s2">&quot;image_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="s2">&quot;distortion_params&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="s2">&quot;world_to_cam_transform&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_to_cam_transform</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="p">}</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">return</span> <span class="n">camera_properties</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_camera_view_angle" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_camera_view_angle</span><span class="p">(</span><span class="n">in_deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_camera_view_angle" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the off-nadir pitch and yaw angles, computed geometrically from the photogrammtery result</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>in_deg</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the angles in degrees rather than radians. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(pitch-from-nadir, yaw-from-nadir). Units are defined by in_deg parameter</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_camera_view_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the off-nadir pitch and yaw angles, computed geometrically from the photogrammtery result</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        in_deg (bool, optional): Return the angles in degrees rather than radians. Defaults to True.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        tuple: (pitch-from-nadir, yaw-from-nadir). Units are defined by in_deg parameter</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="c1"># This is the origin, a point at one unit along the principal axis, a point one unit</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1"># up (-Y), and a point one unit right (+X)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="n">points_in_camera_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="c1"># Transform the points first into the world frame and then into the earth-centered,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="c1"># earth-fixed frame</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="o">@</span> <span class="n">points_in_camera_frame</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># Remove the homogenous coordinate and transpose</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="n">points_in_ECEF</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="c1"># Convert to shapely points</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points_in_ECEF</span><span class="p">]</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="c1"># Convert to a dataframe</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">points_in_ECEF</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">geometry</span><span class="o">=</span><span class="n">points_in_ECEF</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">EARTH_CENTERED_EARTH_FIXED_CRS</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="c1"># Convert to lat lon</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="n">points_in_lat_lon</span> <span class="o">=</span> <span class="n">points_in_ECEF</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">LAT_LON_CRS</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="c1"># Convert to a local projected CRS</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">points_in_projected_CRS</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">points_in_lat_lon</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="c1"># Extract the geometry</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">points_in_projected_CRS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="p">[[</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points_in_projected_CRS</span><span class="o">.</span><span class="n">geometry</span><span class="p">]</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="c1"># Compute three vectors starting at the camera origin</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="n">view_vector</span> <span class="o">=</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="n">up_vector</span> <span class="o">=</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="n">right_vector</span> <span class="o">=</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">points_in_projected_CRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="c1"># The nadir vector points straight down</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">NADIR_VEC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="c1"># For pitch, project the view vector onto the plane defined by the up vector and the nadir</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="n">pitch_projection_view_vec</span> <span class="o">=</span> <span class="n">projection_onto_plane</span><span class="p">(</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">view_vector</span><span class="p">,</span> <span class="n">up_vector</span><span class="p">,</span> <span class="n">NADIR_VEC</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="c1"># For yaw, project the view vector onto the plane defined by the right vector and the nadir</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">yaw_projection_view_vec</span> <span class="o">=</span> <span class="n">projection_onto_plane</span><span class="p">(</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>        <span class="n">view_vector</span><span class="p">,</span> <span class="n">right_vector</span><span class="p">,</span> <span class="n">NADIR_VEC</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="p">)</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="c1"># Find the angle between these projected vectors and the nadir vector</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">pitch_angle</span> <span class="o">=</span> <span class="n">angle_between</span><span class="p">(</span><span class="n">pitch_projection_view_vec</span><span class="p">,</span> <span class="n">NADIR_VEC</span><span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">yaw_angle</span> <span class="o">=</span> <span class="n">angle_between</span><span class="p">(</span><span class="n">yaw_projection_view_vec</span><span class="p">,</span> <span class="n">NADIR_VEC</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="c1"># Return in degrees if requested</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="k">if</span> <span class="n">in_deg</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">pitch_angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">yaw_angle</span><span class="p">))</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="c1"># Return in radians</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">pitch_angle</span><span class="p">,</span> <span class="n">yaw_angle</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_image_size" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_image_size</span><span class="p">(</span><span class="n">image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_image_size" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return image size, potentially scaled</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How much to scale by. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[int]: (h, w) in pixels</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_image_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return image size, potentially scaled</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        image_scale (float, optional): How much to scale by. Defaults to 1.0.</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        tuple[int]: (h, w) in pixels</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="c1"># We should never have to deal with other cases if the reported size is accurate</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">pass</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">()</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_local_to_epsg_4978_transform" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_local_to_epsg_4978_transform</span><span class="p">()</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_local_to_epsg_4978_transform" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the 4x4 homogenous transform mapping from the local coordinates used for
photogrammetry to the earth-centered, earth-fixed coordinate reference system defined by
EPSG:4978 (https://epsg.io/4978).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray:
The transform in the form:
   [R | t]
   [0 | 1]
When a homogenous vector is multiplied on the right of this matrix, it is
transformed from the local coordinate frame to EPSG:4978. Conversely, the inverse
of this matrix can be used to map from EPSG:4879 to local coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_local_to_epsg_4978_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    Return the 4x4 homogenous transform mapping from the local coordinates used for</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    photogrammetry to the earth-centered, earth-fixed coordinate reference system defined by</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    EPSG:4978 (https://epsg.io/4978).</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        np.ndarray:</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            The transform in the form:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">               [R | t]</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">               [0 | 1]</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">            When a homogenous vector is multiplied on the right of this matrix, it is</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">            transformed from the local coordinate frame to EPSG:4978. Conversely, the inverse</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">            of this matrix can be used to map from EPSG:4879 to local coordinates.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_lon_lat" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_lon_lat</span><span class="p">(</span><span class="n">negate_easting</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_lon_lat" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the lon, lat tuple, reading from exif metadata if neccessary</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_lon_lat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">negate_easting</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the lon, lat tuple, reading from exif metadata if neccessary&quot;&quot;&quot;</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="n">get_GPS_exif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">if</span> <span class="n">negate_easting</span><span class="p">:</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon_lat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_pyvista_camera" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_pyvista_camera</span><span class="p">(</span><span class="n">focal_dist</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_pyvista_camera" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a pyvista camera at the location specified by photogrammetry.
Note that there is no principle point and only the vertical field of view is set</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>focal_dist</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How far away from the camera the center point should be. Defaults to 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pyvista.Camera">Camera</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pv.Camera: The pyvista camera from that viewpoint.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_pyvista_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">focal_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">Camera</span><span class="p">:</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    Get a pyvista camera at the location specified by photogrammetry.</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    Note that there is no principle point and only the vertical field of view is set</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        focal_dist (float, optional): How far away from the camera the center point should be. Defaults to 10.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        pv.Camera: The pyvista camera from that viewpoint.</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="c1"># Instantiate a new camera</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>    <span class="n">camera</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Camera</span><span class="p">()</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="c1"># Get the position as the translational part of the transform</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="n">camera_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="c1"># Get the look point by transforming a ray along the camera&#39;s Z axis into world</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>    <span class="c1"># coordinates and then adding this to the location</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="n">camera_look</span> <span class="o">=</span> <span class="n">camera_position</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">focal_dist</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>    <span class="c1"># Get the up direction of the camera by finding which direction the -Y (image up) vector is transformed to</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="n">camera_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="c1"># Compute the vertical field of view</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="n">vertical_FOV_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">))</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="c1"># Set the values</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">focal_point</span> <span class="o">=</span> <span class="n">camera_look</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">camera_position</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="n">camera_up</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="n">camera</span><span class="o">.</span><span class="n">view_angle</span> <span class="o">=</span> <span class="n">vertical_FOV_angle</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="k">return</span> <span class="n">camera</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.get_vis_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_vis_mesh</span><span class="p">(</span><span class="n">frustum_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.get_vis_mesh" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get this camera as a mesh representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>frustum_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of cameras in world units.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns (PolyData): blue mesh of the camera as a frustum with a
    red face indicating the image top.</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_vis_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get this camera as a mesh representation.</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        frustum_scale (float, optional): Size of cameras in world units.</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">    Returns (PolyData): blue mesh of the camera as a frustum with a</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">        red face indicating the image top.</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">scaled_halfwidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">scaled_halfheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">scaled_cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">scaled_cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="n">right</span> <span class="o">=</span> <span class="n">scaled_cx</span> <span class="o">+</span> <span class="n">scaled_halfwidth</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="n">left</span> <span class="o">=</span> <span class="n">scaled_cx</span> <span class="o">-</span> <span class="n">scaled_halfwidth</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="n">top</span> <span class="o">=</span> <span class="n">scaled_cy</span> <span class="o">+</span> <span class="n">scaled_halfheight</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="n">bottom</span> <span class="o">=</span> <span class="n">scaled_cy</span> <span class="o">-</span> <span class="n">scaled_halfheight</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="p">[</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="p">[</span><span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="p">]</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="o">*</span> <span class="n">frustum_scale</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="c1"># Make the coordinates homogenous</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">vertices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))))</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="c1"># Project the vertices into the world cordinates</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">projected_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span> <span class="o">@</span> <span class="n">vertices</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="c1"># Deal with the case where there is a scale transform</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="n">projected_vertices</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transform</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="c1">## mesh faces</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="n">faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="p">[</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>  <span class="c1"># side</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># bottom</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>  <span class="c1"># side</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># top</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>  <span class="c1"># endcap triangle #1</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># endcap triangle #2</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="p">]</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="c1"># All blue except the top (-Y) surface is red</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="n">face_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="p">[</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">],</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>        <span class="p">]</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="c1"># Create a mesh for the camera frustum</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">frustum</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">projected_vertices</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="c1"># Unsure exactly what&#39;s going on here, but it&#39;s required for it to be valid</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="n">frustum</span><span class="o">.</span><span class="n">triangulate</span><span class="p">()</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="c1"># Assign the face colors to the mesh</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">frustum</span><span class="p">[</span><span class="s2">&quot;RGB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">pyvista_ndarray</span><span class="p">(</span><span class="n">face_colors</span><span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="k">return</span> <span class="n">frustum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.project_mesh_verts" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">project_mesh_verts</span><span class="p">(</span><span class="n">mesh_verts</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.project_mesh_verts" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a color per vertex using only projective geometry, without considering occlusion or distortion</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ma.array: (n_points, n_channels) One color per valid vertex. Points that were invalid are masked out</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="k">def</span><span class="w"> </span><span class="nf">project_mesh_verts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh_verts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a color per vertex using only projective geometry, without considering occlusion or distortion</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        np.ma.array: (n_points, n_channels) One color per valid vertex. Points that were invalid are masked out</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="c1"># [R|t] matrix</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">transform_3x4_world_to_cam</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">world_to_cam_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="n">K</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="p">[</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cx</span><span class="p">],</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cy</span><span class="p">],</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="p">],</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="c1"># K[R|t], (3,4). Premultiplying these two matrices avoids doing two steps of projections with all points</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="n">camera_matrix</span> <span class="o">=</span> <span class="n">K</span> <span class="o">@</span> <span class="n">transform_3x4_world_to_cam</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="c1"># Add the extra dimension of ones for matrix multiplication</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="n">homogenous_mesh_verts</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">mesh_verts</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">mesh_verts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="p">),</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="c1"># TODO review terminology</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="n">homogenous_camera_points</span> <span class="o">=</span> <span class="n">camera_matrix</span> <span class="o">@</span> <span class="n">homogenous_mesh_verts</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="c1"># Determine what points project onto the image and at what locations</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="n">valid_bool</span><span class="p">,</span> <span class="n">valid_locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_projected_in_image</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">projected_verts</span><span class="o">=</span><span class="n">homogenous_camera_points</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_height</span><span class="p">),</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="c1"># Extract corresponding colors from the image</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="n">colors_per_vertex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_colors</span><span class="p">(</span><span class="n">valid_bool</span><span class="p">,</span> <span class="n">valid_locs</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="k">return</span> <span class="n">colors_per_vertex</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.vis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">vis</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.vis" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Visualize the camera as a frustum, at the appropriate translation and
rotation and with the given focal length and aspect ratio.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>plotter</code>
            </td>
            <td>
                  <code><span title="pyvista.Plotter">Plotter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The plotter to add the visualization to</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frustum_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The length of the frustum in world units.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    Visualize the camera as a frustum, at the appropriate translation and</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">    rotation and with the given focal length and aspect ratio.</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">        plotter (pv.Plotter): The plotter to add the visualization to</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="sd">        frustum_scale (float, optional): The length of the frustum in world units.</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vis_mesh</span><span class="p">(</span><span class="n">frustum_scale</span><span class="p">)</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="c1"># Show the mesh with the given face colors</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="n">mesh</span><span class="p">,</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCamera.vis_rays" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">vis_rays</span><span class="p">(</span><span class="n">pixel_coords_ij</span><span class="p">,</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">line_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCamera.vis_rays" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Show rays eminating from the camera</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_coords</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n,2) array of (i,j) pixel coordinates in the image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plotter</code>
            </td>
            <td>
                  <code><span title="pyvista.Plotter">Plotter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotter to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_length</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How long the lines are. Defaults to 10. #TODO allow an array of different values</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="k">def</span><span class="w"> </span><span class="nf">vis_rays</span><span class="p">(</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">pixel_coords_ij</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">,</span> <span class="n">line_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="p">):</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Show rays eminating from the camera</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        image_coords (np.ndarray): (n,2) array of (i,j) pixel coordinates in the image</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">        plotter (pv.Plotter): Plotter to use.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        line_length (float, optional): How long the lines are. Defaults to 10. #TODO allow an array of different values</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="c1"># If there are no detections, just skip it</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pixel_coords_ij</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="k">return</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>    <span class="n">projected_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cast_rays</span><span class="p">(</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">pixel_coords_ij</span><span class="o">=</span><span class="n">pixel_coords_ij</span><span class="p">,</span> <span class="n">line_length</span><span class="o">=</span><span class="n">line_length</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="n">n_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">projected_vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="p">(</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="p">)</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">projected_vertices</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="geograypher.cameras.PhotogrammetryCameraSet" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>PhotogrammetryCameraSet</code>


<a href="#geograypher.cameras.PhotogrammetryCameraSet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">









              <details class="quote">
                <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="k">class</span><span class="w"> </span><span class="nc">PhotogrammetryCameraSet</span><span class="p">:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="n">cameras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>        <span class="n">cam_to_world_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="n">intrinsic_params_per_sensor_type</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>            <span class="mi">0</span><span class="p">:</span> <span class="n">EXAMPLE_INTRINSICS</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="p">},</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="n">image_filenames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">lon_lats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="n">image_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="n">sensor_IDs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">validate_images</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="n">local_to_epsg_4978_transform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="p">):</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a camera set, representing multiple cameras in a common global coordinate frame.</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">            cam_to_world_transforms (List[np.ndarray]): The list of 4x4 camera to world transforms</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">            intrinsic_params_per_sensor (Dict[int, Dict]): A dictionary mapping from an int camera ID to the intrinsic parameters</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">            image_filenames (List[PATH_TYPE]): The list of image filenames, ideally absolute paths</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">            lon_lats (Union[None, List[Union[None, Tuple[float, float]]]]): A list of lon,lat tuples, or list of Nones, or None</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">            image_folder (PATH_TYPE): The top level folder of the images</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">            sensor_IDs (List[int]): The list of sensor IDs, that index into the sensors_params_dict</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">            validate_images (bool, optional): Should the existance of the images be checked.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">                Any image_filenames that do not exist will be dropped, leaving a CameraSet only</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">                containing existing images. Defaults to False.</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">            local_to_epsg_4978_transform (np.ndarray):</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">                A 4x4 transform mapping coordinates from the local frame of the camera set into the</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">                global earth-centered, earth-fixed coordinate frame EPSG:4978.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">            ValueError: If the number of sensor IDs is different than the number of transforms.</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="c1"># Record the values</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span> <span class="o">=</span> <span class="n">local_to_epsg_4978_transform</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="c1"># Save parameters used for caching distortion products</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>        <span class="c1"># Create an object using the supplied cameras</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="k">if</span> <span class="n">cameras</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">):</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cameras</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>                <span class="n">cameras</span> <span class="o">=</span> <span class="p">[</span><span class="n">cameras</span><span class="p">]</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">cam</span> <span class="ow">in</span> <span class="n">cameras</span><span class="p">])</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>                <span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span> <span class="o">=</span> <span class="n">cameras</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="k">return</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="c1"># Standardization</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="n">n_transforms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cam_to_world_transforms</span><span class="p">)</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="c1"># Create list of Nones for image filenames if not set</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="k">if</span> <span class="n">image_filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="n">image_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_transforms</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="k">if</span> <span class="n">sensor_IDs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">intrinsic_params_per_sensor_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>            <span class="c1"># Create a list of the only index if not set</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>            <span class="n">sensor_IDs</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="nb">list</span><span class="p">(</span><span class="n">intrinsic_params_per_sensor_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>            <span class="p">]</span> <span class="o">*</span> <span class="n">n_transforms</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sensor_IDs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_transforms</span><span class="p">:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>                <span class="sa">f</span><span class="s2">&quot;Number of sensor_IDs (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sensor_IDs</span><span class="p">)</span><span class="si">}</span><span class="s2">) is different than the number of transforms (</span><span class="si">{</span><span class="n">n_transforms</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="c1"># If lon lats is None, set it to a list of Nones per transform</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="k">if</span> <span class="n">lon_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>            <span class="n">lon_lats</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_transforms</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="k">if</span> <span class="n">image_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="c1"># TODO set it to the least common ancestor of all filenames</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>            <span class="k">pass</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="c1"># Record values for the future</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span> <span class="o">=</span> <span class="n">cam_to_world_transforms</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_params_per_sensor_type</span> <span class="o">=</span> <span class="n">intrinsic_params_per_sensor_type</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span> <span class="o">=</span> <span class="n">image_filenames</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span> <span class="o">=</span> <span class="n">lon_lats</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span> <span class="o">=</span> <span class="n">sensor_IDs</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">image_folder</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="k">if</span> <span class="n">validate_images</span><span class="p">:</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="n">missing_images</span><span class="p">,</span> <span class="n">invalid_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_missing_images</span><span class="p">()</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_images</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_images</span><span class="p">)</span><span class="si">}</span><span class="s2"> missing images&quot;</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                <span class="n">valid_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">invalid_images</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span><span class="p">)[</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                    <span class="n">valid_images</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>                <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                <span class="c1"># Avoid calling .tolist() because this will recursively set all elements to lists</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                <span class="c1"># when this should be a list of np.arrays</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                    <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span><span class="p">)[</span><span class="n">valid_images</span><span class="p">]</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                <span class="p">]</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span><span class="p">)[</span><span class="n">valid_images</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span><span class="p">)[</span><span class="n">valid_images</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="k">for</span> <span class="n">image_filename</span><span class="p">,</span> <span class="n">cam_to_world_transform</span><span class="p">,</span> <span class="n">sensor_ID</span><span class="p">,</span> <span class="n">lon_lat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span><span class="p">,</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span><span class="p">,</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="p">):</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">sensor_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_params_per_sensor_type</span><span class="p">[</span><span class="n">sensor_ID</span><span class="p">]</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="c1"># This means the sensor did not have enough parameters to be valid</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="k">if</span> <span class="n">sensor_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                <span class="k">continue</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>            <span class="n">new_camera</span> <span class="o">=</span> <span class="n">PhotogrammetryCamera</span><span class="p">(</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>                <span class="n">image_filename</span><span class="p">,</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>                <span class="n">cam_to_world_transform</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>                <span class="n">lon_lat</span><span class="o">=</span><span class="n">lon_lat</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>                <span class="n">local_to_epsg_4978_transform</span><span class="o">=</span><span class="n">local_to_epsg_4978_transform</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                <span class="o">**</span><span class="n">sensor_params</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_camera</span><span class="p">)</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cameras</span><span class="p">()</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="n">subset_cameras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="nb">slice</span><span class="p">]</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subset_cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">):</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="c1"># this is just one item indexed</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>            <span class="k">return</span> <span class="n">subset_cameras</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="c1"># else, wrap the list of cameras in a CameraSet</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="k">return</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">(</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="n">subset_cameras</span><span class="p">,</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>            <span class="n">local_to_epsg_4978_transform</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span><span class="p">,</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="p">)</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_missing_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="n">invalid_mask</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="k">for</span> <span class="n">image_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span><span class="p">:</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">image_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>                <span class="n">invalid_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="n">invalid_mask</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="n">invalid_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">invalid_mask</span><span class="p">)]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="k">return</span> <span class="n">invalid_images</span><span class="p">,</span> <span class="n">invalid_mask</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">n_cameras</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of cameras&quot;&quot;&quot;</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">)</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">n_image_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of channels in the image&quot;&quot;&quot;</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="k">return</span> <span class="mi">3</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_cameras_in_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">):</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the camera set with cameras corresponding to images in that folder</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">            folder (PATH_TYPE): The folder location</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">            PhotogrammetryCameraSet: A copy of the camera set with only the cameras from that folder</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="c1"># Get the inds where that camera is in the folder</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="n">imgs_in_folder_inds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="n">i</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">))</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">image_filename</span><span class="o">.</span><span class="n">is_relative_to</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>        <span class="p">]</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>        <span class="c1"># Return the PhotogrammetryCameraSet with those subset of cameras</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>        <span class="n">subset_cameras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">imgs_in_folder_inds</span><span class="p">)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>        <span class="k">return</span> <span class="n">subset_cameras</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_cameras_matching_filename_regex</span><span class="p">(</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">filename_regex</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PhotogrammetryCameraSet&quot;</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the subset of cameras who&#39;s filenames match the provided regex</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">            filename_regex (str): Regular expression passed to &#39;re&#39; engine</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">            PhotogrammetryCameraSet: Subset of cameras matching the regex</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="c1"># Compute boolean array for which ones match</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">imgs_matching_regex</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>            <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filename_regex</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="p">]</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="c1"># Convert to integer indices within the set</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="n">imgs_matching_regex_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">imgs_matching_regex</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="c1"># Get the corresponding subset</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span class="n">subset_cameras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">imgs_matching_regex_inds</span><span class="p">)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="k">return</span> <span class="n">subset_cameras</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_subset_cameras</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inds</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="n">subset_camera_set</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">subset_camera_set</span><span class="o">.</span><span class="n">cameras</span> <span class="o">=</span> <span class="p">[</span><span class="n">subset_camera_set</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">]</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="k">return</span> <span class="n">subset_camera_set</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">image_scale</span><span class="o">=</span><span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_view_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the pitch and yaw off-nadir for all cameras in the set</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">            in_deg (bool, optional): Return the angles in degrees rather than radians. Defaults to True.</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">            List[Tuple[float]]: A list of (pitch, yaw) tuples for each camera.</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="n">camera</span><span class="o">.</span><span class="n">get_camera_view_angle</span><span class="p">(</span><span class="n">in_deg</span><span class="o">=</span><span class="n">in_deg</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing view angles&quot;</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="p">]</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the image filename(s) based on the index</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">            index (Union[int, None]):</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">                Return the filename of the camera at this index, or all filenames if None.</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">                #TODO update to support lists of integer indices as well</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">            absolute (bool, optional):</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">                Return the absolute filepath, as oposed to the path relative to the image folder.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="sd">                Defaults to True.</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">            typing.Union[PATH_TYPE, list[PATH_TYPE]]:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a><span class="sd">                If an integer index is provided, one path will be returned. If None, a list of paths</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">                will be returned.</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>            <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="n">absolute</span><span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">))</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>            <span class="p">]</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">()</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image_folder</span><span class="p">())</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_local_to_epsg_4978_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">        Return the 4x4 homogenous transform mapping from the local coordinates used for</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">        photogrammetry to the earth-centered, earth-fixed coordinate reference system defined by</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        EPSG:4978 (https://epsg.io/4978).</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">            np.ndarray:</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">                The transform in the form:</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">                   [R | t]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">                   [0 | 1]</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">                When a homogenous vector is multiplied on the right of this matrix, it is</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">                transformed from the local coordinate frame to EPSG:4978. Conversely, the inverse</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">                of this matrix can be used to map from EPSG:4879 to local coordinates.</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remove_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="k">if</span> <span class="n">remove_folder</span><span class="p">:</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_folder</span><span class="p">):</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;about to remove </span><span class="si">{</span><span class="n">output_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">)),</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;copying&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;linking&#39;</span><span class="si">}</span><span class="s2"> images to </span><span class="si">{</span><span class="n">output_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="p">):</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>                <span class="n">output_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>            <span class="p">)</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>            <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>            <span class="n">src_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find </span><span class="si">{</span><span class="n">src_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>                <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">src_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_lon_lat_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of GPS coords for each camera&quot;&quot;&quot;</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_lon_lat</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">]</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        Returns a list of camera locations for each camera.</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">            **kwargs: Keyword arguments to be passed to the PhotogrammetryCamera.get_camera_location method.</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">            List[Tuple[float, float] or Tuple[float, float, float]]:</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">                List of tuples containing the camera locations.</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_camera_location</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">]</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">distortion_key</span><span class="p">(</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">        Make a repeatable string key out of a distortion parameter dict</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">        so that we can cache results by distortion parameters. We are</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">        deciding that precision in the distortion parameters after 8</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">        decimal points will be ignored in the caching process.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">            parameters (dict): Distortion parameters are assumed to be stored</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">                &quot;name&quot;: float(value)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">            image_scale (float, optional): If we want to warp a downsampled</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">                version of an image, we need to track that mapping seperately</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">                because downsampling affects the pixel to pixel mapping.</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">                Include the image scale (0-1 float) along with the distortion</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">                parameters to make a key.</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">            A repeatable string key based on the distortion values.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>            <span class="sa">f</span><span class="s2">&quot;image_scale:</span><span class="si">{</span><span class="n">image_scale</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="p">]</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="k">return</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_distortion_map</span><span class="p">(</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="n">inversion_downsample</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">        Cache a map connecting locations in one image to locations in another.</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">        The basic construction is the pixel position of the map is the position</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">        in the destination image, and the value of the map is the position in</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">        the source image. Therefore if location [20, 30] has value [22.2, 28.4],</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">        it means that the destination image pixel [20, 30] will be sampled from</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        the source image at pixel [22.2, 28.4] (the sampler can choose to snap</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">        to the closest integer value or interpolate nearby pixels).</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">            camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">                define the warp process. These include image size, principal</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">                point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">            inversion_downsample (int): Downsample the inverse map process in</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">                order to reduce computation, at high res the resulting map</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">                trafeoffs should be minimal.</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">            image_scale: (float, optional) 0-1 fraction of the original image</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">                size, used when warping/dewarping downsampled images. See</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">                pix2face render_img_scale for an example.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">        Caches:</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">            In self._maps_ideal_to_warped, stores a map of the structure</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">                discussed above, keyed by self.distortion_key(params) so it can</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">                be accessed for cameras using the same params.</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">            In self._maps_warped_to_ideal, stores an inverted version</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="c1"># Sample over the ideal pixels, shape (H, W)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="n">im_h</span><span class="p">,</span> <span class="n">im_w</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">image_size</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">image_scale</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>            <span class="n">h_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">im_h</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="n">w_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">im_w</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="c1"># In order to get a distortion map for a downsampled image, you</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="c1"># need to run the ideal_to_warped equation over the same original</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>            <span class="c1"># range (0...im_h) because the radius of that range relates</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>            <span class="c1"># directly to the warping. However, do it in fewer steps (step</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>            <span class="c1"># size &gt; 1) to reflect the downsampling.</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">image_scale</span><span class="p">}</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>            <span class="n">h_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">im_h</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_h</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)]</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="n">w_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">im_w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_w</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)]</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">h_range</span><span class="p">,</span> <span class="n">w_range</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="c1"># Fill the (H, W) elements with the (i, j) distorted values at those locations</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="n">warp_cols</span><span class="p">,</span> <span class="n">warp_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_to_warped</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="c1"># If dealing with downsampled images, now that we ran the warp equation,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="c1"># rescale the results to be within the new scale. If the original im_h</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="c1"># is 1000 and image_scale is 0.5, we need to run ideal_to_warped on</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="c1"># 0-1000 (for radius reasons) and then scale those results to 0-500.</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">image_scale</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>            <span class="n">warp_cols</span> <span class="o">*=</span> <span class="n">image_scale</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>            <span class="n">warp_rows</span> <span class="o">*=</span> <span class="n">image_scale</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="c1"># Cache this mapping as (2, H, W)</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="n">dkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_key</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">warp_rows</span><span class="p">,</span> <span class="n">warp_cols</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>        <span class="c1"># Invert the warp map and cache as (2, H, W)</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">inverse_map_interpolation</span><span class="p">(</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="n">downsample</span><span class="o">=</span><span class="n">inversion_downsample</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>        <span class="p">)</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ideal_to_warped</span><span class="p">(</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">xpix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ypix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        Apply the given camera&#39;s distortion parameters to map pixels in an</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">        ideal pinhole camera to pixel locations in the warped/distorted</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">        image.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        NOTE: Some standards apparently can define their distortion models</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        from warped to ideal, if we end up handling cameras like that we can</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">        make the use-case more flexible.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">            camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">                define the warp process. These include image size, principal</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">                point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">            xpix (numpy array): Array of unknown shape, must match ypix</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">            ypix (numpy array): Array of unknown shape, must match xpix</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">            Tuple of numpy arrays of warped x pixels and y pixels</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">            [0] warped xpix</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">            [1] warped ypix</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>            <span class="sa">f</span><span class="s2">&quot;ideal_to_warped not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="p">)</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">warp_dewarp_image</span><span class="p">(</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>        <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>        <span class="n">input_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>        <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="n">inversion_downsample</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>        <span class="n">interpolation_order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="n">warped_to_ideal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">        Either apply a camera&#39;s distortion model to go from ideal→warped or</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">        undo the camera&#39;s distortion model to go from warped→ideal, depending</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">        on the warped_to_ideal flag.</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><span class="sd">        Pixels in the output image that do not correspond to any input pixel</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">        are set to the fill value.</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">        Note that the warp map is cached, so the first call will take longer</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a><span class="sd">        and subsequent calls should be much faster.</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="sd">            camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="sd">                define the warp process. These include image size, principal</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="sd">                point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="sd">            input_image (np.ndarray): (I, J, 3) Input image</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="sd">            fill_value (int, optional): Value to use for pixels in the</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="sd">                output image that are not mapped from the input. Defaults to 0.</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><span class="sd">            inversion_downsample (int, optional): The distortion map creation</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="sd">                process is too heavyweight for really high-res images,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><span class="sd">                downsampling the inversion process gets a similar result with</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="sd">                less computation.</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">            interpolation_order (int, optional):</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a><span class="sd">                The order of the interpolation. 0 is nearest neighbor and should be used for discrete</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">                textures like pix2face masks. 1 can be used for data representing continious</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">                quantities. Defaults to 1.</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">            warped_to_ideal (bool, optional): If true, take in a warped image</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">                and return an undistorted (dewarped/ideal) image. If false,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">                take in an undistorted image and return a warped image.</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">            image_scale: (float, optional) 0-1 fraction of the original image</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">                size, used when warping/dewarping downsampled images. See</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">                pix2face render_img_scale for an example.</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">            np.ndarray: (I, J, 3) output image</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="c1"># Ensure that there is a cached map for these distortion parameters</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="n">dkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_key</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="k">if</span> <span class="n">dkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">:</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">make_distortion_map</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>        <span class="c1"># Temporarily expand grayscale images to be (N, M, 1)</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span class="n">input_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>        <span class="k">if</span> <span class="n">warped_to_ideal</span><span class="p">:</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>            <span class="n">inverse_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>            <span class="n">inverse_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>        <span class="c1"># Compute the min and max of values, including both the inputs and the fill value</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>        <span class="n">input_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">input_image</span><span class="p">),</span> <span class="n">fill_value</span><span class="p">)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>        <span class="n">input_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">input_image</span><span class="p">),</span> <span class="n">fill_value</span><span class="p">)</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="c1"># Compute the range of values</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="n">min_max_range</span> <span class="o">=</span> <span class="n">input_max</span> <span class="o">-</span> <span class="n">input_min</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="c1"># If there&#39;s no variation, we can avoid division by 0 issues and save computation by just</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>        <span class="c1"># returning an array of one value</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>        <span class="k">if</span> <span class="n">min_max_range</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">input_image</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>        <span class="c1"># Record the original datatype</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="n">initial_dtype</span> <span class="o">=</span> <span class="n">input_image</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="c1"># Rescale to 0-1</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="n">input_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">-</span> <span class="n">input_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">min_max_range</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>        <span class="c1"># The fill value will be applied to the rescaled image, so it must be rescaled similarly</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>        <span class="n">rescaled_fill_value</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span> <span class="o">-</span> <span class="n">input_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">min_max_range</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>        <span class="c1"># For each color channel, do the dewarping</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>        <span class="n">output_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>            <span class="n">output_image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">warp</span><span class="p">(</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>                <span class="n">image</span><span class="o">=</span><span class="n">input_image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">],</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                <span class="n">inverse_map</span><span class="o">=</span><span class="n">inverse_map</span><span class="p">,</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>                <span class="n">order</span><span class="o">=</span><span class="n">interpolation_order</span><span class="p">,</span>  <span class="c1"># interpolation strategy for fractional pixels</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>  <span class="c1"># fill unseen areas with cval</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>                <span class="n">cval</span><span class="o">=</span><span class="n">rescaled_fill_value</span><span class="p">,</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>                <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># clip to [0,1]</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>                <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># keep original range without rescaling</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>            <span class="p">)</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="c1"># Convert to the original range and datatype</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="n">output_image</span> <span class="o">=</span> <span class="p">((</span><span class="n">output_image</span> <span class="o">*</span> <span class="n">min_max_range</span><span class="p">)</span> <span class="o">+</span> <span class="n">input_min</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="n">initial_dtype</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="c1"># Return grayscale if array is (N, M 1), else return RGB</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">output_image</span><span class="p">)</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">warp_dewarp_pixels</span><span class="p">(</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>        <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="n">pixels</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="n">inversion_downsample</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>        <span class="n">warped_to_ideal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="p">):</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="sd">        Either apply a camera&#39;s distortion model to go from ideal pixels→warped</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="sd">        or undo the camera&#39;s distortion model to go from warped pixels→ideal,</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="sd">        depending on the warped_to_ideal flag.</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">        Note that the warp map is cached, so the first call will take longer</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a><span class="sd">        and subsequent calls should be much faster.</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">        Arguments:</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">            camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">                define the warp process. These include image size, principal</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a><span class="sd">                point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><span class="sd">            pixels (np.ndarray): (N, 2) Pixels locations in (i, j) format.</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a><span class="sd">            inversion_downsample (int, optional): The distortion map creation</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><span class="sd">                process is too heavyweight for really high-res images,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a><span class="sd">                downsampling the inversion process gets a similar result with</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a><span class="sd">                less computation.</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a><span class="sd">            warped_to_ideal (bool, optional): If true, take in a warped image</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="sd">                and return an undistorted (dewarped/ideal) image. If false,</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="sd">                take in an undistorted image and return a warped image.</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><span class="sd">            np.ndarray: (N, 2) warped/dewarped output pixel locations (i, j)</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">                Note that the output is floating point (subpixel)</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>        <span class="c1"># Ensure that there is a cached map for these distortion parameters</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>        <span class="n">dkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_key</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">)</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>        <span class="k">if</span> <span class="n">dkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">:</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">make_distortion_map</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="p">)</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>        <span class="c1"># Get the right mapping array</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>        <span class="k">if</span> <span class="n">warped_to_ideal</span><span class="p">:</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>            <span class="n">rowmap</span><span class="p">,</span> <span class="n">colmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>            <span class="n">rowmap</span><span class="p">,</span> <span class="n">colmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>        <span class="c1"># Look up the pixel locations</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="n">rows</span> <span class="o">=</span> <span class="n">rowmap</span><span class="p">[</span><span class="n">pixels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pixels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>        <span class="n">cols</span> <span class="o">=</span> <span class="n">colmap</span><span class="p">[</span><span class="n">pixels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pixels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_subset_ROI</span><span class="p">(</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>        <span class="n">ROI</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">],</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>        <span class="n">buffer_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>        <span class="n">is_geospatial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>    <span class="p">):</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return cameras that are within a radius of the provided geometry</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">            geodata (Union[PATH_TYPE, gpd.GeoDataFrame, Polygon, MultiPolygon]):</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="sd">                This can be a Geopandas dataframe, path to a geofile readable by geopandas, or</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">                Shapely Polygon/MultiPolygon information that can be loaded into a geodataframe</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">            buffer_radius (float, optional):</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">                Return points within this buffer of the geometry. Defaults to 0. Represents</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">                meters if ROI is geospatial.</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">            is_geospatial (bool, optional):</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">                A flag for user to indicate if ROI is geospatial or not; if no flag is provided,</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">                the flag is set if the provided geodata has a CRS.</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="sd">            subset_camera_set (List[PhotogrammetryCamera]):</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">                List of cameras that fall within the provided ROI</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="c1"># construct GeoDataFrame if not provided</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="p">(</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">)):</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>            <span class="c1"># assume geodata is lat/lon if is_geospatial is True</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>            <span class="k">if</span> <span class="n">is_geospatial</span><span class="p">:</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>                <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">LAT_LON_CRS</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">ROI</span><span class="p">])</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>                <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">ROI</span><span class="p">])</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>            <span class="c1"># Read in the geofile</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>            <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">ROI</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>        <span class="k">if</span> <span class="n">is_geospatial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>            <span class="n">is_geospatial</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_geospatial</span><span class="p">:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>            <span class="c1"># get internal coordinate system camera locations</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>            <span class="n">image_locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera_locations</span><span class="p">()]</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>            <span class="n">image_locations_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">image_locations</span><span class="p">)</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>            <span class="c1"># Make sure it&#39;s a geometric (meters-based) CRS</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>            <span class="n">ROI</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">ROI</span><span class="p">)</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>            <span class="c1"># Read the locations of all the points</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>            <span class="n">image_locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lon_lat_coords</span><span class="p">()]</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>            <span class="c1"># Create a dataframe, assuming inputs are lat lon</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>            <span class="n">image_locations_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                <span class="n">geometry</span><span class="o">=</span><span class="n">image_locations</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">LAT_LON_CRS</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>            <span class="p">)</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="n">image_locations_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">ROI</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>        <span class="c1"># Drop all the fields except the geometry for computational reasons</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>        <span class="c1"># Buffer out by the requested distance</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_radius</span><span class="p">)</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>        <span class="c1"># Merge the potentially-individual polygons to one</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>        <span class="c1"># TODO Do experiments to see if this step should be before or after the buffer.</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>        <span class="c1"># Counterintuitively, it seems that after is faster</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">ROI</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>        <span class="c1"># Determine the binary mask for which cameras are within the ROI</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>        <span class="n">cameras_in_ROI</span> <span class="o">=</span> <span class="n">image_locations_df</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">ROI</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>        <span class="c1"># Convert to the integer indices</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>        <span class="n">cameras_in_ROI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cameras_in_ROI</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>        <span class="c1"># Get the corresponding subset of cameras</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>        <span class="n">subset_camera_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">cameras_in_ROI</span><span class="p">)</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>        <span class="k">return</span> <span class="n">subset_camera_set</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">triangulate_detections</span><span class="p">(</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>        <span class="n">detector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RegionDetectionSegmentor</span><span class="p">,</span> <span class="n">TabularRectangleSegmentor</span><span class="p">],</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>        <span class="n">ray_length_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>        <span class="n">boundaries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>        <span class="n">limit_ray_length_meters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="n">limit_angle_from_vert</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>        <span class="n">similarity_threshold_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>        <span class="n">transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>        <span class="n">louvain_resolution</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>        <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Take per-image detections and triangulate them to 3D locations.</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="sd">            detector (Union[RegionDetectionSegmentor, TabularRectangleSegmentor]):</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a><span class="sd">                Produces detections per image using the get_detection_centers method.</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="sd">            ray_length_meters (float, optional):</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a><span class="sd">                The length of the visualized rays in meters. Defaults to 1000.</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">            boundaries (Optional[Tuple[pv.PolyData, pv.PolyData]])</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">            limit_ray_length_meters (Optional[float])</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><span class="sd">            limit_angle_from_vert (Optional[float])</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">            similarity_threshold_meters (float, optional):</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">                Consider rays a potential match if the distance between them is less than this</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">                value. Defaults to 0.1.</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a><span class="sd">            transform (Optional[Callable[[np.ndarray], np.ndarray]]):</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a><span class="sd">            louvain_resolution (float, optional):</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a><span class="sd">                The resolution hyperparameter of the networkx.louvain_communities function.</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a><span class="sd">                Height value leads to more communities. Defaults to 1.0.</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a><span class="sd">            out_dir: Optional[PATH_TYPE]</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a><span class="sd">                Defaults to None.</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="sd">        Returns (np.ndarray):</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a><span class="sd">            (N unique objects, 3), the 3D locations of the identified objects.</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="sd">            If transform_to_epsg_4978 is None, then this is in the local coordinate</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="sd">            system of the mesh. If the transform is not None, (lat, lon, alt) is returned.</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>        <span class="c1"># Enforce Path type</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>        <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">check_exists</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Helper function to aid in caching and loading cached files.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>            <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>                <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="n">file</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>                <span class="n">path</span> <span class="o">=</span> <span class="n">file</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>            <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>        <span class="c1"># Determine scale factor relating meters to internal coordinates</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>        <span class="n">transform_to_epsg_4978</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_to_epsg_4978_transform</span><span class="p">()</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>        <span class="n">meters_to_local_scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">get_scale_from_transform</span><span class="p">(</span><span class="n">transform_to_epsg_4978</span><span class="p">)</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>        <span class="n">ray_length_local</span> <span class="o">=</span> <span class="n">ray_length_meters</span> <span class="o">*</span> <span class="n">meters_to_local_scale</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>        <span class="n">similarity_threshold_local</span> <span class="o">=</span> <span class="n">similarity_threshold_meters</span> <span class="o">*</span> <span class="n">meters_to_local_scale</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>        <span class="k">if</span> <span class="n">limit_ray_length_meters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>            <span class="n">limit_ray_length_local</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>            <span class="n">limit_ray_length_local</span> <span class="o">=</span> <span class="n">limit_ray_length_meters</span> <span class="o">*</span> <span class="n">meters_to_local_scale</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="c1"># Create line segments emanating from the cameras</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="s2">&quot;line_segments.npz&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>            <span class="n">line_results</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;line_segments.npz&quot;</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>            <span class="n">line_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_line_segments</span><span class="p">(</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>                <span class="n">detector</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>                <span class="n">ray_length_local</span><span class="o">=</span><span class="n">ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>                <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>                <span class="n">limit_ray_length_local</span><span class="o">=</span><span class="n">limit_ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>                <span class="n">limit_angle_from_vert</span><span class="o">=</span><span class="n">limit_angle_from_vert</span><span class="p">,</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>            <span class="p">)</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="c1"># Load the results into memory if they were saved to file</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="n">line_results</span><span class="p">):</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>            <span class="n">line_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">line_results</span><span class="p">)</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="c1"># Turn line segments into graph distances, where &quot;close enough&quot;</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>        <span class="c1"># lines are connected nodes in the graph.</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="s2">&quot;edge_weights.json&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>            <span class="n">weight_results</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;edge_weights.json&quot;</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">weight_results</span> <span class="o">=</span> <span class="n">calc_graph_weights</span><span class="p">(</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>                <span class="n">starts</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_starts&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>                <span class="n">ends</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_ends&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>                <span class="n">ray_IDs</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_IDs&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>                <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold_local</span><span class="p">,</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>                <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                <span class="n">step</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>            <span class="p">)</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="c1"># Load the results into memory if they were saved to file</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="n">weight_results</span><span class="p">):</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>            <span class="n">weight_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">weight_results</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>        <span class="c1"># Calculate community identities among the graph weights, where</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>        <span class="c1"># hopefully a preponderance of close line segments indicate a</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>        <span class="c1"># single object detected multiple times.</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>        <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="s2">&quot;communities.npz&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>            <span class="n">community_results</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;communities.npz&quot;</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>            <span class="n">community_results</span> <span class="o">=</span> <span class="n">calc_communities</span><span class="p">(</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                <span class="n">starts</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_starts&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                <span class="n">ends</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_ends&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                <span class="n">edge_weights</span><span class="o">=</span><span class="n">weight_results</span><span class="p">,</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>                <span class="n">louvain_resolution</span><span class="o">=</span><span class="n">louvain_resolution</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>                <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>                <span class="n">transform_to_epsg_4978</span><span class="o">=</span><span class="n">transform_to_epsg_4978</span><span class="p">,</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>            <span class="p">)</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>        <span class="c1"># Load the results into memory if they were saved to file</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="n">community_results</span><span class="p">):</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>            <span class="n">community_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">community_results</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>        <span class="c1"># Return the 3D locations of the community points, preferentially</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>        <span class="c1"># in lat/lon form if it exists.</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>        <span class="k">return</span> <span class="n">community_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>            <span class="s2">&quot;community_points_latlon&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>            <span class="n">community_results</span><span class="p">[</span><span class="s2">&quot;community_points&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>        <span class="p">)</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>        <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>        <span class="n">add_orientation_cube</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>        <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>        <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>        <span class="n">force_xvfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>        <span class="n">interactive_jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>    <span class="p">):</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualize all the cameras</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="sd">            plotter (pv.Plotter):</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="sd">                Plotter to add the cameras to. If None, will be created and then plotted</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">            add_orientation_cube (bool, optional):</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">                Add a cube to visualize the coordinate system. Defaults to False.</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">            show (bool, optional):</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">                Show the results instead of waiting for other content to be added</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">            frustum_scale (float, optional):</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">                Size of cameras in world units. If None, will set to 1/120th of the maximum distance</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">                between two cameras.</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">            force_xvfb (bool, optional):</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">                Force a headless rendering backend</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="sd">            interactive_jupyter (bool, optional):</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">                Will allow you to interact with the visualization in your notebook if supported by</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">                the notebook server. Otherwise will fail. Only applicable if `show=True`. Defaults</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><span class="sd">                to False.</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>        <span class="k">if</span> <span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>            <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>            <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>        <span class="c1"># Determine pairwise distance between each camera and set frustum_scale to 1/120th of the maximum distance found</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>        <span class="k">if</span> <span class="n">frustum_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cameras</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                <span class="n">camera_translation_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                    <span class="p">[</span><span class="n">transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span><span class="p">]</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                <span class="p">)</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                <span class="n">distances</span> <span class="o">=</span> <span class="n">pdist</span><span class="p">(</span><span class="n">camera_translation_matrices</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                <span class="n">max_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                <span class="n">frustum_scale</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                    <span class="p">(</span><span class="n">max_distance</span> <span class="o">/</span> <span class="mi">120</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_distance</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">DEFAULT_FRUSTUM_SCALE</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                <span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>            <span class="c1"># else, set it to a default</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>                <span class="n">frustum_scale</span> <span class="o">=</span> <span class="n">DEFAULT_FRUSTUM_SCALE</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">:</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="n">camera</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">plotter</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="n">frustum_scale</span><span class="p">)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>        <span class="k">if</span> <span class="n">add_orientation_cube</span><span class="p">:</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>            <span class="c1"># TODO Consider adding to a freestanding vis module</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>            <span class="n">ocube</span> <span class="o">=</span> <span class="n">demos</span><span class="o">.</span><span class="n">orientation_cube</span><span class="p">()</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;cube&quot;</span><span class="p">],</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;x_p&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;x_n&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;y_p&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;y_n&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;z_p&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;z_n&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">show_axes</span><span class="p">()</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>            <span class="k">if</span> <span class="n">force_xvfb</span><span class="p">:</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>                <span class="n">safe_start_xvfb</span><span class="p">()</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">jupyter_backend</span><span class="o">=</span><span class="s2">&quot;trame&quot;</span> <span class="k">if</span> <span class="n">interactive_jupyter</span> <span class="k">else</span> <span class="s2">&quot;static&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_vis_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">:</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all the cameras as a mesh representation.</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">            frustum_scale (float, optional): Size of cameras in world units.</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">        Returns: (PolyData) mesh representation of all cameras as frustums</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>        <span class="k">return</span> <span class="n">pv</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>            <span class="p">[</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>                <span class="n">camera</span><span class="o">.</span><span class="n">get_vis_mesh</span><span class="p">(</span><span class="n">frustum_scale</span><span class="o">=</span><span class="n">frustum_scale</span><span class="p">)</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>                <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>            <span class="p">]</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>        <span class="p">)</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_line_segments</span><span class="p">(</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>        <span class="n">detector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RegionDetectionSegmentor</span><span class="p">,</span> <span class="n">TabularRectangleSegmentor</span><span class="p">],</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>        <span class="n">boundaries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>        <span class="n">ray_length_local</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>        <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="n">limit_ray_length_local</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="n">limit_angle_from_vert</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Path</span><span class="p">]:</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a><span class="sd">        For each camera in the set, this method:</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a><span class="sd">        1. Gets detection centers from the provided detector</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a><span class="sd">        2. Projects rays from the camera through these detection points</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="sd">        3. Optionally filters rays by angle from vertical</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">        4. Optionally clips rays to intersection with boundary surfaces</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">        5. Returns resulting line segments or saves them to file</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a><span class="sd">            detector: Detector that provides detection centers for each image</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a><span class="sd">            boundaries: Optional tuple of (upper, lower) boundary surfaces as PyVista PolyData.</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a><span class="sd">                If provided, rays will be clipped to these surfaces.</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a><span class="sd">            ray_length_local: Length of the initial rays in local coordinate units. Default 1e3.</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a><span class="sd">            out_dir: Directory to save the output NPZ file containing ray data. If this is None,</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a><span class="sd">                the data will be returned as a dict. If this is a path, &quot;line_segments.npz&quot;</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a><span class="sd">                will be saved in that directory. Default is None.</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a><span class="sd">            limit_ray_length_local: Optional max ray length from origin to second boundary.</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a><span class="sd">                This is to mimic measuring from a camera (hypothetical ray source) to</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a><span class="sd">                the ground (assuming the boundaries are given as [ceiling, floor]).</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a><span class="sd">                Default is None, meaning no limit.</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a><span class="sd">            limit_angle_from_vert: Optional max angle (in radians) from vertical.</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a><span class="sd">                Default is None, meaning no limit.</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">            If out_dir is None, returns a dictionary with:</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">                - &quot;ray_starts&quot;: (N, 3) array of ray start points</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">                - &quot;ray_ends&quot;: (N, 3) array of ray end points</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a><span class="sd">                - &quot;ray_IDs&quot;: (N,) array of camera indices that generated each ray</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">            If out_dir is provided, saves this data to &quot;line_segments.npz&quot; in that directory</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>        <span class="c1"># Record the lines corresponding to each detection and the associated image ID</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>        <span class="n">all_line_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>        <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>        <span class="c1"># Iterate over the cameras</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>        <span class="k">for</span> <span class="n">camera_ind</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">)),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Building line segments per camera&quot;</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>        <span class="p">):</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>            <span class="c1"># Get the image filename</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="n">image_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">(</span><span class="n">camera_ind</span><span class="p">))</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>            <span class="c1"># Get the centers of associated detection from the detector</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>            <span class="c1"># TODO, this only works with &quot;detectors&quot; that can look up the detections based on the</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>            <span class="c1"># filename alone. In the future we might want to support real detectors that actually</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>            <span class="c1"># use the image.</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>            <span class="n">detection_centers_pixels</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">get_detection_centers</span><span class="p">(</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>            <span class="c1"># Project rays given the locations of the detections in pixel coordinates</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detection_centers_pixels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                <span class="c1"># Record the line segments, which will be ordered as alternating (start, end) rows</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>                <span class="n">line_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">camera_ind</span><span class="p">]</span><span class="o">.</span><span class="n">cast_rays</span><span class="p">(</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                    <span class="n">pixel_coords_ij</span><span class="o">=</span><span class="n">detection_centers_pixels</span><span class="p">,</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                    <span class="n">line_length</span><span class="o">=</span><span class="n">ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                <span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="n">all_line_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_segments</span><span class="p">)</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="c1"># Record which image ID generated each line</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>                <span class="n">all_image_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                        <span class="nb">int</span><span class="p">(</span><span class="n">line_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                        <span class="n">fill_value</span><span class="o">=</span><span class="n">camera_ind</span><span class="p">,</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                <span class="p">)</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_line_segments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>            <span class="c1"># Concatenate the lists of arrays into a single array</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>            <span class="n">all_line_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_line_segments</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>            <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_image_IDs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="c1"># Get the starts and ends, which are alternating rows</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>            <span class="n">ray_starts</span> <span class="o">=</span> <span class="n">all_line_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>            <span class="n">ray_ends</span> <span class="o">=</span> <span class="n">all_line_segments</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="c1"># Determine the direction</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>            <span class="n">ray_directions</span> <span class="o">=</span> <span class="n">ray_ends</span> <span class="o">-</span> <span class="n">ray_starts</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>            <span class="c1"># Make the ray directions unit length</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>            <span class="n">ray_directions</span> <span class="o">=</span> <span class="n">ray_directions</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                <span class="n">ray_directions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>            <span class="p">)</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>            <span class="c1"># Filter by angle from vertical if requested</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>            <span class="k">if</span> <span class="n">limit_angle_from_vert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                <span class="c1"># Angle from vertical (z-axis): arccos(|z component of unit vector|)</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="n">z_axis</span> <span class="o">=</span> <span class="n">ray_directions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z_axis</span><span class="p">))</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>                <span class="n">keep_mask</span> <span class="o">=</span> <span class="n">angles</span> <span class="o">&lt;=</span> <span class="n">limit_angle_from_vert</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="n">ray_starts</span> <span class="o">=</span> <span class="n">ray_starts</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                <span class="n">ray_ends</span> <span class="o">=</span> <span class="n">ray_ends</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                <span class="n">ray_directions</span> <span class="o">=</span> <span class="n">ray_directions</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="n">all_image_IDs</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>            <span class="k">if</span> <span class="n">boundaries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clipping all line segments to boundary surfaces&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>                <span class="n">ray_starts</span><span class="p">,</span> <span class="n">ray_ends</span><span class="p">,</span> <span class="n">ray_directions</span><span class="p">,</span> <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                    <span class="n">clip_line_segments</span><span class="p">(</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                        <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                        <span class="n">origins</span><span class="o">=</span><span class="n">ray_starts</span><span class="p">,</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                        <span class="n">directions</span><span class="o">=</span><span class="n">ray_directions</span><span class="p">,</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                        <span class="n">image_indices</span><span class="o">=</span><span class="n">all_image_IDs</span><span class="p">,</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                        <span class="n">ray_limit</span><span class="o">=</span><span class="n">limit_ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                <span class="p">)</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>            <span class="n">ray_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>            <span class="n">ray_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>            <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>        <span class="c1"># Return or save to file</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>            <span class="s2">&quot;ray_starts&quot;</span><span class="p">:</span> <span class="n">ray_starts</span><span class="p">,</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>            <span class="s2">&quot;ray_ends&quot;</span><span class="p">:</span> <span class="n">ray_ends</span><span class="p">,</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>            <span class="s2">&quot;ray_IDs&quot;</span><span class="p">:</span> <span class="n">all_image_IDs</span><span class="p">,</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="p">}</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>        <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>            <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;line_segments.npz&quot;</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>            <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">








<h3 id="geograypher.cameras.PhotogrammetryCameraSet-functions">Functions<a href="#geograypher.cameras.PhotogrammetryCameraSet-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cameras</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cam_to_world_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">intrinsic_params_per_sensor_type</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">EXAMPLE_INTRINSICS</span><span class="p">},</span> <span class="n">image_filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lon_lats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sensor_IDs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate_images</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">local_to_epsg_4978_transform</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a camera set, representing multiple cameras in a common global coordinate frame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cam_to_world_transforms</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of 4x4 camera to world transforms</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>intrinsic_params_per_sensor</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="int">int</span>, <span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping from an int camera ID to the intrinsic parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_filenames</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of image filenames, ideally absolute paths</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_lats</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="typing.List">List</span>[<span title="typing.Union">Union</span>[None, <span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of lon,lat tuples, or list of Nones, or None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The top level folder of the images</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sensor_IDs</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of sensor IDs, that index into the sensors_params_dict</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate_images</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should the existance of the images be checked.
Any image_filenames that do not exist will be dropped, leaving a CameraSet only
containing existing images. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_to_epsg_4978_transform</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 4x4 transform mapping coordinates from the local frame of the camera set into the
global earth-centered, earth-fixed coordinate frame EPSG:4978.</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.eye">eye</span>(4)</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the number of sensor IDs is different than the number of transforms.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="n">cameras</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="n">cam_to_world_transforms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="n">intrinsic_params_per_sensor_type</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="mi">0</span><span class="p">:</span> <span class="n">EXAMPLE_INTRINSICS</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="p">},</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="n">image_filenames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="n">lon_lats</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="n">image_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="n">sensor_IDs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">validate_images</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">local_to_epsg_4978_transform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a><span class="p">):</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a camera set, representing multiple cameras in a common global coordinate frame.</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        cam_to_world_transforms (List[np.ndarray]): The list of 4x4 camera to world transforms</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        intrinsic_params_per_sensor (Dict[int, Dict]): A dictionary mapping from an int camera ID to the intrinsic parameters</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        image_filenames (List[PATH_TYPE]): The list of image filenames, ideally absolute paths</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">        lon_lats (Union[None, List[Union[None, Tuple[float, float]]]]): A list of lon,lat tuples, or list of Nones, or None</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">        image_folder (PATH_TYPE): The top level folder of the images</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        sensor_IDs (List[int]): The list of sensor IDs, that index into the sensors_params_dict</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">        validate_images (bool, optional): Should the existance of the images be checked.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a><span class="sd">            Any image_filenames that do not exist will be dropped, leaving a CameraSet only</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">            containing existing images. Defaults to False.</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">        local_to_epsg_4978_transform (np.ndarray):</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">            A 4x4 transform mapping coordinates from the local frame of the camera set into the</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">            global earth-centered, earth-fixed coordinate frame EPSG:4978.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        ValueError: If the number of sensor IDs is different than the number of transforms.</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="c1"># Record the values</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span> <span class="o">=</span> <span class="n">local_to_epsg_4978_transform</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="c1"># Save parameters used for caching distortion products</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="c1"># Create an object using the supplied cameras</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>    <span class="k">if</span> <span class="n">cameras</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">):</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cameras</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>            <span class="n">cameras</span> <span class="o">=</span> <span class="p">[</span><span class="n">cameras</span><span class="p">]</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonpath</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">cam</span> <span class="ow">in</span> <span class="n">cameras</span><span class="p">])</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>            <span class="p">)</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span> <span class="o">=</span> <span class="n">cameras</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>        <span class="k">return</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="c1"># Standardization</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="n">n_transforms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cam_to_world_transforms</span><span class="p">)</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>    <span class="c1"># Create list of Nones for image filenames if not set</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="k">if</span> <span class="n">image_filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">image_filenames</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_transforms</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="k">if</span> <span class="n">sensor_IDs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">intrinsic_params_per_sensor_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="c1"># Create a list of the only index if not set</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="n">sensor_IDs</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>            <span class="nb">list</span><span class="p">(</span><span class="n">intrinsic_params_per_sensor_type</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="p">]</span> <span class="o">*</span> <span class="n">n_transforms</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sensor_IDs</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n_transforms</span><span class="p">:</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="sa">f</span><span class="s2">&quot;Number of sensor_IDs (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sensor_IDs</span><span class="p">)</span><span class="si">}</span><span class="s2">) is different than the number of transforms (</span><span class="si">{</span><span class="n">n_transforms</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="c1"># If lon lats is None, set it to a list of Nones per transform</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="k">if</span> <span class="n">lon_lats</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">lon_lats</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_transforms</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="k">if</span> <span class="n">image_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="c1"># TODO set it to the least common ancestor of all filenames</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="k">pass</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="c1"># Record values for the future</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span> <span class="o">=</span> <span class="n">cam_to_world_transforms</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_params_per_sensor_type</span> <span class="o">=</span> <span class="n">intrinsic_params_per_sensor_type</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span> <span class="o">=</span> <span class="n">image_filenames</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span> <span class="o">=</span> <span class="n">lon_lats</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span> <span class="o">=</span> <span class="n">sensor_IDs</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">image_folder</span> <span class="o">=</span> <span class="n">image_folder</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>    <span class="k">if</span> <span class="n">validate_images</span><span class="p">:</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="n">missing_images</span><span class="p">,</span> <span class="n">invalid_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_missing_images</span><span class="p">()</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_images</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing_images</span><span class="p">)</span><span class="si">}</span><span class="s2"> missing images&quot;</span><span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="n">valid_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">invalid_images</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span><span class="p">)[</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>                <span class="n">valid_images</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>            <span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>            <span class="c1"># Avoid calling .tolist() because this will recursively set all elements to lists</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>            <span class="c1"># when this should be a list of np.arrays</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span><span class="p">)[</span><span class="n">valid_images</span><span class="p">]</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="p">]</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span><span class="p">)[</span><span class="n">valid_images</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span><span class="p">)[</span><span class="n">valid_images</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="k">for</span> <span class="n">image_filename</span><span class="p">,</span> <span class="n">cam_to_world_transform</span><span class="p">,</span> <span class="n">sensor_ID</span><span class="p">,</span> <span class="n">lon_lat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_IDs</span><span class="p">,</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lon_lats</span><span class="p">,</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="p">):</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="n">sensor_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intrinsic_params_per_sensor_type</span><span class="p">[</span><span class="n">sensor_ID</span><span class="p">]</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="c1"># This means the sensor did not have enough parameters to be valid</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="k">if</span> <span class="n">sensor_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="k">continue</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="n">new_camera</span> <span class="o">=</span> <span class="n">PhotogrammetryCamera</span><span class="p">(</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>            <span class="n">image_filename</span><span class="p">,</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>            <span class="n">cam_to_world_transform</span><span class="p">,</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="n">lon_lat</span><span class="o">=</span><span class="n">lon_lat</span><span class="p">,</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>            <span class="n">local_to_epsg_4978_transform</span><span class="o">=</span><span class="n">local_to_epsg_4978_transform</span><span class="p">,</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>            <span class="o">**</span><span class="n">sensor_params</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_camera</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.calc_line_segments" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">calc_line_segments</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ray_length_local</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit_ray_length_local</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit_angle_from_vert</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.calc_line_segments" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>For each camera in the set, this method:
1. Gets detection centers from the provided detector
2. Projects rays from the camera through these detection points
3. Optionally filters rays by angle from vertical
4. Optionally clips rays to intersection with boundary surfaces
5. Returns resulting line segments or saves them to file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>detector</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.predictors.derived_segmentors.RegionDetectionSegmentor">RegionDetectionSegmentor</span>, <a class="autorefs autorefs-internal" title="            TabularRectangleSegmentor (geograypher.predictors.derived_segmentors.TabularRectangleSegmentor)" href="../../predictors/derived_segmentors/#geograypher.predictors.derived_segmentors.TabularRectangleSegmentor">TabularRectangleSegmentor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detector that provides detection centers for each image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>boundaries</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[<span title="pyvista.PolyData">PolyData</span>, <span title="pyvista.PolyData">PolyData</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tuple of (upper, lower) boundary surfaces as PyVista PolyData.
If provided, rays will be clipped to these surfaces.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ray_length_local</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Length of the initial rays in local coordinate units. Default 1e3.</p>
              </div>
            </td>
            <td>
                  <code>1000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the output NPZ file containing ray data. If this is None,
the data will be returned as a dict. If this is a path, "line_segments.npz"
will be saved in that directory. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit_ray_length_local</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional max ray length from origin to second boundary.
This is to mimic measuring from a camera (hypothetical ray source) to
the ground (assuming the boundaries are given as [ceiling, floor]).
Default is None, meaning no limit.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit_angle_from_vert</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional max angle (in radians) from vertical.
Default is None, meaning no limit.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>], <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If out_dir is None, returns a dictionary with:
- "ray_starts": (N, 3) array of ray start points
- "ray_ends": (N, 3) array of ray end points
- "ray_IDs": (N,) array of camera indices that generated each ray</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>], <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If out_dir is provided, saves this data to "line_segments.npz" in that directory</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_line_segments</span><span class="p">(</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>    <span class="n">detector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RegionDetectionSegmentor</span><span class="p">,</span> <span class="n">TabularRectangleSegmentor</span><span class="p">],</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>    <span class="n">boundaries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>    <span class="n">ray_length_local</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>    <span class="n">limit_ray_length_local</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>    <span class="n">limit_angle_from_vert</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Path</span><span class="p">]:</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a><span class="sd">    For each camera in the set, this method:</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a><span class="sd">    1. Gets detection centers from the provided detector</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a><span class="sd">    2. Projects rays from the camera through these detection points</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="sd">    3. Optionally filters rays by angle from vertical</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">    4. Optionally clips rays to intersection with boundary surfaces</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">    5. Returns resulting line segments or saves them to file</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a><span class="sd">        detector: Detector that provides detection centers for each image</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a><span class="sd">        boundaries: Optional tuple of (upper, lower) boundary surfaces as PyVista PolyData.</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a><span class="sd">            If provided, rays will be clipped to these surfaces.</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a><span class="sd">        ray_length_local: Length of the initial rays in local coordinate units. Default 1e3.</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a><span class="sd">        out_dir: Directory to save the output NPZ file containing ray data. If this is None,</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a><span class="sd">            the data will be returned as a dict. If this is a path, &quot;line_segments.npz&quot;</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a><span class="sd">            will be saved in that directory. Default is None.</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a><span class="sd">        limit_ray_length_local: Optional max ray length from origin to second boundary.</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a><span class="sd">            This is to mimic measuring from a camera (hypothetical ray source) to</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a><span class="sd">            the ground (assuming the boundaries are given as [ceiling, floor]).</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a><span class="sd">            Default is None, meaning no limit.</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a><span class="sd">        limit_angle_from_vert: Optional max angle (in radians) from vertical.</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a><span class="sd">            Default is None, meaning no limit.</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">        If out_dir is None, returns a dictionary with:</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">            - &quot;ray_starts&quot;: (N, 3) array of ray start points</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">            - &quot;ray_ends&quot;: (N, 3) array of ray end points</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a><span class="sd">            - &quot;ray_IDs&quot;: (N,) array of camera indices that generated each ray</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">        If out_dir is provided, saves this data to &quot;line_segments.npz&quot; in that directory</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>    <span class="c1"># Record the lines corresponding to each detection and the associated image ID</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>    <span class="n">all_line_segments</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>    <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>    <span class="c1"># Iterate over the cameras</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>    <span class="k">for</span> <span class="n">camera_ind</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>        <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">)),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Building line segments per camera&quot;</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>    <span class="p">):</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>        <span class="c1"># Get the image filename</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>        <span class="n">image_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">(</span><span class="n">camera_ind</span><span class="p">))</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>        <span class="c1"># Get the centers of associated detection from the detector</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>        <span class="c1"># TODO, this only works with &quot;detectors&quot; that can look up the detections based on the</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>        <span class="c1"># filename alone. In the future we might want to support real detectors that actually</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>        <span class="c1"># use the image.</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>        <span class="n">detection_centers_pixels</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">get_detection_centers</span><span class="p">(</span><span class="n">image_filename</span><span class="p">)</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>        <span class="c1"># Project rays given the locations of the detections in pixel coordinates</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detection_centers_pixels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>            <span class="c1"># Record the line segments, which will be ordered as alternating (start, end) rows</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>            <span class="n">line_segments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">camera_ind</span><span class="p">]</span><span class="o">.</span><span class="n">cast_rays</span><span class="p">(</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                <span class="n">pixel_coords_ij</span><span class="o">=</span><span class="n">detection_centers_pixels</span><span class="p">,</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                <span class="n">line_length</span><span class="o">=</span><span class="n">ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>            <span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>            <span class="n">all_line_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_segments</span><span class="p">)</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>            <span class="c1"># Record which image ID generated each line</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>            <span class="n">all_image_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>                <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">line_segments</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                    <span class="n">fill_value</span><span class="o">=</span><span class="n">camera_ind</span><span class="p">,</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                <span class="p">)</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>            <span class="p">)</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_line_segments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>        <span class="c1"># Concatenate the lists of arrays into a single array</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>        <span class="n">all_line_segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_line_segments</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>        <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_image_IDs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>        <span class="c1"># Get the starts and ends, which are alternating rows</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="n">ray_starts</span> <span class="o">=</span> <span class="n">all_line_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>        <span class="n">ray_ends</span> <span class="o">=</span> <span class="n">all_line_segments</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>        <span class="c1"># Determine the direction</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>        <span class="n">ray_directions</span> <span class="o">=</span> <span class="n">ray_ends</span> <span class="o">-</span> <span class="n">ray_starts</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>        <span class="c1"># Make the ray directions unit length</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>        <span class="n">ray_directions</span> <span class="o">=</span> <span class="n">ray_directions</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>            <span class="n">ray_directions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>        <span class="p">)</span>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>        <span class="c1"># Filter by angle from vertical if requested</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>        <span class="k">if</span> <span class="n">limit_angle_from_vert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>            <span class="c1"># Angle from vertical (z-axis): arccos(|z component of unit vector|)</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>            <span class="n">z_axis</span> <span class="o">=</span> <span class="n">ray_directions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>            <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">z_axis</span><span class="p">))</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>            <span class="n">keep_mask</span> <span class="o">=</span> <span class="n">angles</span> <span class="o">&lt;=</span> <span class="n">limit_angle_from_vert</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>            <span class="n">ray_starts</span> <span class="o">=</span> <span class="n">ray_starts</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>            <span class="n">ray_ends</span> <span class="o">=</span> <span class="n">ray_ends</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>            <span class="n">ray_directions</span> <span class="o">=</span> <span class="n">ray_directions</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>            <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="n">all_image_IDs</span><span class="p">[</span><span class="n">keep_mask</span><span class="p">]</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="k">if</span> <span class="n">boundaries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clipping all line segments to boundary surfaces&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>            <span class="n">ray_starts</span><span class="p">,</span> <span class="n">ray_ends</span><span class="p">,</span> <span class="n">ray_directions</span><span class="p">,</span> <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                <span class="n">clip_line_segments</span><span class="p">(</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                    <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                    <span class="n">origins</span><span class="o">=</span><span class="n">ray_starts</span><span class="p">,</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                    <span class="n">directions</span><span class="o">=</span><span class="n">ray_directions</span><span class="p">,</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                    <span class="n">image_indices</span><span class="o">=</span><span class="n">all_image_IDs</span><span class="p">,</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                    <span class="n">ray_limit</span><span class="o">=</span><span class="n">limit_ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                <span class="p">)</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>            <span class="p">)</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>        <span class="n">ray_starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="n">ray_ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>        <span class="n">all_image_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>    <span class="c1"># Return or save to file</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>        <span class="s2">&quot;ray_starts&quot;</span><span class="p">:</span> <span class="n">ray_starts</span><span class="p">,</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>        <span class="s2">&quot;ray_ends&quot;</span><span class="p">:</span> <span class="n">ray_ends</span><span class="p">,</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>        <span class="s2">&quot;ray_IDs&quot;</span><span class="p">:</span> <span class="n">all_image_IDs</span><span class="p">,</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>    <span class="p">}</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>        <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;line_segments.npz&quot;</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>        <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.distortion_key" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">distortion_key</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.distortion_key" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Make a repeatable string key out of a distortion parameter dict
so that we can cache results by distortion parameters. We are
deciding that precision in the distortion parameters after 8
decimal points will be ignored in the caching process.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distortion parameters are assumed to be stored
"name": float(value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If we want to warp a downsampled
version of an image, we need to track that mapping seperately
because downsampling affects the pixel to pixel mapping.
Include the image scale (0-1 float) along with the distortion
parameters to make a key.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A repeatable string key based on the distortion values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="k">def</span><span class="w"> </span><span class="nf">distortion_key</span><span class="p">(</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="sd">    Make a repeatable string key out of a distortion parameter dict</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a><span class="sd">    so that we can cache results by distortion parameters. We are</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="sd">    deciding that precision in the distortion parameters after 8</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">    decimal points will be ignored in the caching process.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">        parameters (dict): Distortion parameters are assumed to be stored</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">            &quot;name&quot;: float(value)</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">        image_scale (float, optional): If we want to warp a downsampled</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a><span class="sd">            version of an image, we need to track that mapping seperately</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">            because downsampling affects the pixel to pixel mapping.</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">            Include the image scale (0-1 float) along with the distortion</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a><span class="sd">            parameters to make a key.</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a><span class="sd">        A repeatable string key based on the distortion values.</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>    <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="sa">f</span><span class="s2">&quot;image_scale:</span><span class="si">{</span><span class="n">image_scale</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="p">]</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>    <span class="k">return</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_camera_locations" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_camera_locations</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_camera_locations" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns a list of camera locations for each camera.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to be passed to the PhotogrammetryCamera.get_camera_location method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[float, float] or Tuple[float, float, float]]:
List of tuples containing the camera locations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_camera_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">    Returns a list of camera locations for each camera.</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a><span class="sd">        **kwargs: Keyword arguments to be passed to the PhotogrammetryCamera.get_camera_location method.</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">        List[Tuple[float, float] or Tuple[float, float, float]]:</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">            List of tuples containing the camera locations.</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_camera_location</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_camera_view_angles" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_camera_view_angles</span><span class="p">(</span><span class="n">in_deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_camera_view_angles" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Compute the pitch and yaw off-nadir for all cameras in the set</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>in_deg</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the angles in degrees rather than radians. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[float]]: A list of (pitch, yaw) tuples for each camera.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_camera_view_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_deg</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the pitch and yaw off-nadir for all cameras in the set</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        in_deg (bool, optional): Return the angles in degrees rather than radians. Defaults to True.</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a><span class="sd">        List[Tuple[float]]: A list of (pitch, yaw) tuples for each camera.</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="n">camera</span><span class="o">.</span><span class="n">get_camera_view_angle</span><span class="p">(</span><span class="n">in_deg</span><span class="o">=</span><span class="n">in_deg</span><span class="p">)</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing view angles&quot;</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_cameras_in_folder" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_cameras_in_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_cameras_in_folder" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the camera set with cameras corresponding to images in that folder</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder location</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PhotogrammetryCameraSet</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A copy of the camera set with only the cameras from that folder</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_cameras_in_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">):</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the camera set with cameras corresponding to images in that folder</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">        folder (PATH_TYPE): The folder location</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        PhotogrammetryCameraSet: A copy of the camera set with only the cameras from that folder</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>    <span class="c1"># Get the inds where that camera is in the folder</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="n">imgs_in_folder_inds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>        <span class="n">i</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">))</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">image_filename</span><span class="o">.</span><span class="n">is_relative_to</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>    <span class="p">]</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>    <span class="c1"># Return the PhotogrammetryCameraSet with those subset of cameras</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="n">subset_cameras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">imgs_in_folder_inds</span><span class="p">)</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>    <span class="k">return</span> <span class="n">subset_cameras</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_cameras_matching_filename_regex" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_cameras_matching_filename_regex</span><span class="p">(</span><span class="n">filename_regex</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_cameras_matching_filename_regex" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the subset of cameras who's filenames match the provided regex</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename_regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regular expression passed to 're' engine</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PhotogrammetryCameraSet</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.cameras.PhotogrammetryCameraSet)" href="#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Subset of cameras matching the regex</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_cameras_matching_filename_regex</span><span class="p">(</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">filename_regex</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PhotogrammetryCameraSet&quot;</span><span class="p">:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the subset of cameras who&#39;s filenames match the provided regex</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">        filename_regex (str): Regular expression passed to &#39;re&#39; engine</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        PhotogrammetryCameraSet: Subset of cameras matching the regex</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>    <span class="c1"># Compute boolean array for which ones match</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>    <span class="n">imgs_matching_regex</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filename_regex</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_filenames</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>    <span class="p">]</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>    <span class="c1"># Convert to integer indices within the set</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>    <span class="n">imgs_matching_regex_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">imgs_matching_regex</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>    <span class="c1"># Get the corresponding subset</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="n">subset_cameras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">imgs_matching_regex_inds</span><span class="p">)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="k">return</span> <span class="n">subset_cameras</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_image_filename" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_image_filename</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_image_filename" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the image filename(s) based on the index</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>index</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the filename of the camera at this index, or all filenames if None.</p>
<h5 id="geograypher.cameras.PhotogrammetryCameraSet.get_image_filename--todo-update-to-support-lists-of-integer-indices-as-well">TODO update to support lists of integer indices as well<a class="headerlink" href="#geograypher.cameras.PhotogrammetryCameraSet.get_image_filename--todo-update-to-support-lists-of-integer-indices-as-well" title="Permanent link">&para;</a></h5>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>absolute</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the absolute filepath, as oposed to the path relative to the image folder.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>typing.Union[PATH_TYPE, list[PATH_TYPE]]:
If an integer index is provided, one path will be returned. If None, a list of paths
will be returned.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_image_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the image filename(s) based on the index</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">        index (Union[int, None]):</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a><span class="sd">            Return the filename of the camera at this index, or all filenames if None.</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a><span class="sd">            #TODO update to support lists of integer indices as well</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a><span class="sd">        absolute (bool, optional):</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="sd">            Return the absolute filepath, as oposed to the path relative to the image folder.</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="sd">            Defaults to True.</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">        typing.Union[PATH_TYPE, list[PATH_TYPE]]:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a><span class="sd">            If an integer index is provided, one path will be returned. If None, a list of paths</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">            will be returned.</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="n">absolute</span><span class="p">)</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">))</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="p">]</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">()</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>    <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_image_folder</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_local_to_epsg_4978_transform" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_local_to_epsg_4978_transform</span><span class="p">()</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_local_to_epsg_4978_transform" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the 4x4 homogenous transform mapping from the local coordinates used for
photogrammetry to the earth-centered, earth-fixed coordinate reference system defined by
EPSG:4978 (https://epsg.io/4978).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray:
The transform in the form:
   [R | t]
   [0 | 1]
When a homogenous vector is multiplied on the right of this matrix, it is
transformed from the local coordinate frame to EPSG:4978. Conversely, the inverse
of this matrix can be used to map from EPSG:4879 to local coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_local_to_epsg_4978_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">    Return the 4x4 homogenous transform mapping from the local coordinates used for</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">    photogrammetry to the earth-centered, earth-fixed coordinate reference system defined by</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">    EPSG:4978 (https://epsg.io/4978).</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">        np.ndarray:</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">            The transform in the form:</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a><span class="sd">               [R | t]</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a><span class="sd">               [0 | 1]</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a><span class="sd">            When a homogenous vector is multiplied on the right of this matrix, it is</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a><span class="sd">            transformed from the local coordinate frame to EPSG:4978. Conversely, the inverse</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a><span class="sd">            of this matrix can be used to map from EPSG:4879 to local coordinates.</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_to_epsg_4978_transform</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_lon_lat_coords" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_lon_lat_coords</span><span class="p">()</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_lon_lat_coords" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns a list of GPS coords for each camera</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_lon_lat_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of GPS coords for each camera&quot;&quot;&quot;</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_lon_lat</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_subset_ROI" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_subset_ROI</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">buffer_radius</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">is_geospatial</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_subset_ROI" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return cameras that are within a radius of the provided geometry</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>geodata</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="shapely.Polygon">Polygon</span>, <span title="shapely.MultiPolygon">MultiPolygon</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This can be a Geopandas dataframe, path to a geofile readable by geopandas, or
Shapely Polygon/MultiPolygon information that can be loaded into a geodataframe</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buffer_radius</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return points within this buffer of the geometry. Defaults to 0. Represents
meters if ROI is geospatial.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_geospatial</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A flag for user to indicate if ROI is geospatial or not; if no flag is provided,
the flag is set if the provided geodata has a CRS.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    subset_camera_set (List[PhotogrammetryCamera]):
        List of cameras that fall within the provided ROI</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_subset_ROI</span><span class="p">(</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>    <span class="n">ROI</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">],</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>    <span class="n">buffer_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>    <span class="n">is_geospatial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="p">):</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return cameras that are within a radius of the provided geometry</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a><span class="sd">        geodata (Union[PATH_TYPE, gpd.GeoDataFrame, Polygon, MultiPolygon]):</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a><span class="sd">            This can be a Geopandas dataframe, path to a geofile readable by geopandas, or</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a><span class="sd">            Shapely Polygon/MultiPolygon information that can be loaded into a geodataframe</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a><span class="sd">        buffer_radius (float, optional):</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a><span class="sd">            Return points within this buffer of the geometry. Defaults to 0. Represents</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a><span class="sd">            meters if ROI is geospatial.</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a><span class="sd">        is_geospatial (bool, optional):</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a><span class="sd">            A flag for user to indicate if ROI is geospatial or not; if no flag is provided,</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a><span class="sd">            the flag is set if the provided geodata has a CRS.</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="sd">        subset_camera_set (List[PhotogrammetryCamera]):</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">            List of cameras that fall within the provided ROI</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>    <span class="c1"># construct GeoDataFrame if not provided</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="p">(</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">)):</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="c1"># assume geodata is lat/lon if is_geospatial is True</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="k">if</span> <span class="n">is_geospatial</span><span class="p">:</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>            <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">LAT_LON_CRS</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">ROI</span><span class="p">])</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>            <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">ROI</span><span class="p">])</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="c1"># Read in the geofile</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">ROI</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>    <span class="k">if</span> <span class="n">is_geospatial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>        <span class="n">is_geospatial</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">crs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_geospatial</span><span class="p">:</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>        <span class="c1"># get internal coordinate system camera locations</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>        <span class="n">image_locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera_locations</span><span class="p">()]</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>        <span class="n">image_locations_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">image_locations</span><span class="p">)</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>        <span class="c1"># Make sure it&#39;s a geometric (meters-based) CRS</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">ROI</span><span class="p">)</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>        <span class="c1"># Read the locations of all the points</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>        <span class="n">image_locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lon_lat_coords</span><span class="p">()]</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>        <span class="c1"># Create a dataframe, assuming inputs are lat lon</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>        <span class="n">image_locations_df</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">image_locations</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">LAT_LON_CRS</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="p">)</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="n">image_locations_df</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">ROI</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>    <span class="c1"># Drop all the fields except the geometry for computational reasons</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>    <span class="n">ROI</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>    <span class="c1"># Buffer out by the requested distance</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>    <span class="n">ROI</span> <span class="o">=</span> <span class="n">ROI</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_radius</span><span class="p">)</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>    <span class="c1"># Merge the potentially-individual polygons to one</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>    <span class="c1"># TODO Do experiments to see if this step should be before or after the buffer.</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>    <span class="c1"># Counterintuitively, it seems that after is faster</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>    <span class="n">ROI</span> <span class="o">=</span> <span class="n">unary_union</span><span class="p">(</span><span class="n">ROI</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>    <span class="c1"># Determine the binary mask for which cameras are within the ROI</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>    <span class="n">cameras_in_ROI</span> <span class="o">=</span> <span class="n">image_locations_df</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">ROI</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>    <span class="c1"># Convert to the integer indices</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>    <span class="n">cameras_in_ROI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cameras_in_ROI</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>    <span class="c1"># Get the corresponding subset of cameras</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>    <span class="n">subset_camera_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">cameras_in_ROI</span><span class="p">)</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>    <span class="k">return</span> <span class="n">subset_camera_set</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.get_vis_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_vis_mesh</span><span class="p">(</span><span class="n">frustum_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.get_vis_mesh" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get all the cameras as a mesh representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>frustum_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of cameras in world units.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns: (PolyData) mesh representation of all cameras as frustums</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_vis_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">:</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all the cameras as a mesh representation.</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a><span class="sd">        frustum_scale (float, optional): Size of cameras in world units.</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a><span class="sd">    Returns: (PolyData) mesh representation of all cameras as frustums</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>    <span class="k">return</span> <span class="n">pv</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>        <span class="p">[</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>            <span class="n">camera</span><span class="o">.</span><span class="n">get_vis_mesh</span><span class="p">(</span><span class="n">frustum_scale</span><span class="o">=</span><span class="n">frustum_scale</span><span class="p">)</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>            <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="p">]</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.ideal_to_warped" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">ideal_to_warped</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">xpix</span><span class="p">,</span> <span class="n">ypix</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.ideal_to_warped" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Apply the given camera's distortion parameters to map pixels in an
ideal pinhole camera to pixel locations in the warped/distorted
image.</p>
<p>NOTE: Some standards apparently can define their distortion models
from warped to ideal, if we end up handling cameras like that we can
make the use-case more flexible.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>camera</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.cameras.PhotogrammetryCamera)" href="#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera with parameters that
define the warp process. These include image size, principal
point, focal length, and distortion parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xpix</code>
            </td>
            <td>
                  <code>numpy array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of unknown shape, must match ypix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ypix</code>
            </td>
            <td>
                  <code>numpy array</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of unknown shape, must match xpix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of numpy arrays of warped x pixels and y pixels</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[0] warped xpix</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[1] warped ypix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="k">def</span><span class="w"> </span><span class="nf">ideal_to_warped</span><span class="p">(</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">xpix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ypix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">    Apply the given camera&#39;s distortion parameters to map pixels in an</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">    ideal pinhole camera to pixel locations in the warped/distorted</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    image.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    NOTE: Some standards apparently can define their distortion models</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">    from warped to ideal, if we end up handling cameras like that we can</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">    make the use-case more flexible.</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">        camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">            define the warp process. These include image size, principal</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">            point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        xpix (numpy array): Array of unknown shape, must match ypix</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a><span class="sd">        ypix (numpy array): Array of unknown shape, must match xpix</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a><span class="sd">        Tuple of numpy arrays of warped x pixels and y pixels</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a><span class="sd">        [0] warped xpix</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a><span class="sd">        [1] warped ypix</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="sa">f</span><span class="s2">&quot;ideal_to_warped not implemented for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.make_distortion_map" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">make_distortion_map</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.make_distortion_map" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Cache a map connecting locations in one image to locations in another.
The basic construction is the pixel position of the map is the position
in the destination image, and the value of the map is the position in
the source image. Therefore if location [20, 30] has value [22.2, 28.4],
it means that the destination image pixel [20, 30] will be sampled from
the source image at pixel [22.2, 28.4] (the sampler can choose to snap
to the closest integer value or interpolate nearby pixels).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>camera</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.cameras.PhotogrammetryCamera)" href="#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera with parameters that
define the warp process. These include image size, principal
point, focal length, and distortion parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inversion_downsample</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample the inverse map process in
order to reduce computation, at high res the resulting map
trafeoffs should be minimal.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(float, optional) 0-1 fraction of the original image
size, used when warping/dewarping downsampled images. See
pix2face render_img_scale for an example.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="caches" open>
  <summary>Caches</summary>
  <p>In self._maps_ideal_to_warped, stores a map of the structure
    discussed above, keyed by self.distortion_key(params) so it can
    be accessed for cameras using the same params.
In self._maps_warped_to_ideal, stores an inverted version</p>
</details>

            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-976" name="__codelineno-0-976"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_distortion_map</span><span class="p">(</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>    <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>    <span class="n">inversion_downsample</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a><span class="sd">    Cache a map connecting locations in one image to locations in another.</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="sd">    The basic construction is the pixel position of the map is the position</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="sd">    in the destination image, and the value of the map is the position in</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="sd">    the source image. Therefore if location [20, 30] has value [22.2, 28.4],</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a><span class="sd">    it means that the destination image pixel [20, 30] will be sampled from</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">    the source image at pixel [22.2, 28.4] (the sampler can choose to snap</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">    to the closest integer value or interpolate nearby pixels).</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="sd">        camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">            define the warp process. These include image size, principal</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">            point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">        inversion_downsample (int): Downsample the inverse map process in</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">            order to reduce computation, at high res the resulting map</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">            trafeoffs should be minimal.</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a><span class="sd">        image_scale: (float, optional) 0-1 fraction of the original image</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">            size, used when warping/dewarping downsampled images. See</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">            pix2face render_img_scale for an example.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a><span class="sd">    Caches:</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a><span class="sd">        In self._maps_ideal_to_warped, stores a map of the structure</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a><span class="sd">            discussed above, keyed by self.distortion_key(params) so it can</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a><span class="sd">            be accessed for cameras using the same params.</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a><span class="sd">        In self._maps_warped_to_ideal, stores an inverted version</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>    <span class="c1"># Sample over the ideal pixels, shape (H, W)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>    <span class="n">im_h</span><span class="p">,</span> <span class="n">im_w</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">image_size</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">image_scale</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="n">h_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">im_h</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="n">w_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">im_w</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span class="c1"># In order to get a distortion map for a downsampled image, you</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>        <span class="c1"># need to run the ideal_to_warped equation over the same original</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>        <span class="c1"># range (0...im_h) because the radius of that range relates</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>        <span class="c1"># directly to the warping. However, do it in fewer steps (step</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="c1"># size &gt; 1) to reflect the downsampling.</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">),</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">image_scale</span><span class="p">}</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">h_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">im_h</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_h</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)]</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>        <span class="n">w_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="n">im_w</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_w</span> <span class="o">*</span> <span class="n">image_scale</span><span class="p">)]</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">h_range</span><span class="p">,</span> <span class="n">w_range</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="c1"># Fill the (H, W) elements with the (i, j) distorted values at those locations</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="n">warp_cols</span><span class="p">,</span> <span class="n">warp_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ideal_to_warped</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="c1"># If dealing with downsampled images, now that we ran the warp equation,</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="c1"># rescale the results to be within the new scale. If the original im_h</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>    <span class="c1"># is 1000 and image_scale is 0.5, we need to run ideal_to_warped on</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="c1"># 0-1000 (for radius reasons) and then scale those results to 0-500.</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">image_scale</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">):</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="n">warp_cols</span> <span class="o">*=</span> <span class="n">image_scale</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>        <span class="n">warp_rows</span> <span class="o">*=</span> <span class="n">image_scale</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>    <span class="c1"># Cache this mapping as (2, H, W)</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="n">dkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_key</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">warp_rows</span><span class="p">,</span> <span class="n">warp_cols</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>    <span class="c1"># Invert the warp map and cache as (2, H, W)</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">inverse_map_interpolation</span><span class="p">(</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">],</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>        <span class="n">downsample</span><span class="o">=</span><span class="n">inversion_downsample</span><span class="p">,</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.n_cameras" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">n_cameras</span><span class="p">()</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.n_cameras" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the number of cameras</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="k">def</span><span class="w"> </span><span class="nf">n_cameras</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of cameras&quot;&quot;&quot;</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.n_image_channels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">n_image_channels</span><span class="p">()</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.n_image_channels" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the number of channels in the image</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="k">def</span><span class="w"> </span><span class="nf">n_image_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the number of channels in the image&quot;&quot;&quot;</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>    <span class="k">return</span> <span class="mi">3</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.triangulate_detections" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">triangulate_detections</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span> <span class="n">ray_length_meters</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">boundaries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit_ray_length_meters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit_angle_from_vert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">similarity_threshold_meters</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">louvain_resolution</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.triangulate_detections" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Take per-image detections and triangulate them to 3D locations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>detector</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.predictors.derived_segmentors.RegionDetectionSegmentor">RegionDetectionSegmentor</span>, <a class="autorefs autorefs-internal" title="            TabularRectangleSegmentor (geograypher.predictors.derived_segmentors.TabularRectangleSegmentor)" href="../../predictors/derived_segmentors/#geograypher.predictors.derived_segmentors.TabularRectangleSegmentor">TabularRectangleSegmentor</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Produces detections per image using the get_detection_centers method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ray_length_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The length of the visualized rays in meters. Defaults to 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>similarity_threshold_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Consider rays a potential match if the distance between them is less than this
value. Defaults to 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="numpy.ndarray">ndarray</span>], <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>louvain_resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution hyperparameter of the networkx.louvain_communities function.
Height value leads to more communities. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[PATH_TYPE]
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns (np.ndarray):
    (N unique objects, 3), the 3D locations of the identified objects.
    If transform_to_epsg_4978 is None, then this is in the local coordinate
    system of the mesh. If the transform is not None, (lat, lon, alt) is returned.</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1289" name="__codelineno-0-1289"></a><span class="k">def</span><span class="w"> </span><span class="nf">triangulate_detections</span><span class="p">(</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>    <span class="n">detector</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">RegionDetectionSegmentor</span><span class="p">,</span> <span class="n">TabularRectangleSegmentor</span><span class="p">],</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>    <span class="n">ray_length_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>    <span class="n">boundaries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>    <span class="n">limit_ray_length_meters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>    <span class="n">limit_angle_from_vert</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>    <span class="n">similarity_threshold_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>    <span class="n">transform</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>    <span class="n">louvain_resolution</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Take per-image detections and triangulate them to 3D locations.</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a><span class="sd">        detector (Union[RegionDetectionSegmentor, TabularRectangleSegmentor]):</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a><span class="sd">            Produces detections per image using the get_detection_centers method.</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a><span class="sd">        ray_length_meters (float, optional):</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a><span class="sd">            The length of the visualized rays in meters. Defaults to 1000.</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a><span class="sd">        boundaries (Optional[Tuple[pv.PolyData, pv.PolyData]])</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a><span class="sd">        limit_ray_length_meters (Optional[float])</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a><span class="sd">        limit_angle_from_vert (Optional[float])</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a><span class="sd">        similarity_threshold_meters (float, optional):</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a><span class="sd">            Consider rays a potential match if the distance between them is less than this</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a><span class="sd">            value. Defaults to 0.1.</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a><span class="sd">        transform (Optional[Callable[[np.ndarray], np.ndarray]]):</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a><span class="sd">        louvain_resolution (float, optional):</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a><span class="sd">            The resolution hyperparameter of the networkx.louvain_communities function.</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a><span class="sd">            Height value leads to more communities. Defaults to 1.0.</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a><span class="sd">        out_dir: Optional[PATH_TYPE]</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a><span class="sd">    Returns (np.ndarray):</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a><span class="sd">        (N unique objects, 3), the 3D locations of the identified objects.</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a><span class="sd">        If transform_to_epsg_4978 is None, then this is in the local coordinate</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="sd">        system of the mesh. If the transform is not None, (lat, lon, alt) is returned.</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>    <span class="c1"># Enforce Path type</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_exists</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to aid in caching and loading cached files.&quot;&quot;&quot;</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>        <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="n">file</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">file</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>    <span class="c1"># Determine scale factor relating meters to internal coordinates</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>    <span class="n">transform_to_epsg_4978</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_to_epsg_4978_transform</span><span class="p">()</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>    <span class="n">meters_to_local_scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">get_scale_from_transform</span><span class="p">(</span><span class="n">transform_to_epsg_4978</span><span class="p">)</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>    <span class="n">ray_length_local</span> <span class="o">=</span> <span class="n">ray_length_meters</span> <span class="o">*</span> <span class="n">meters_to_local_scale</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>    <span class="n">similarity_threshold_local</span> <span class="o">=</span> <span class="n">similarity_threshold_meters</span> <span class="o">*</span> <span class="n">meters_to_local_scale</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>    <span class="k">if</span> <span class="n">limit_ray_length_meters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>        <span class="n">limit_ray_length_local</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="n">limit_ray_length_local</span> <span class="o">=</span> <span class="n">limit_ray_length_meters</span> <span class="o">*</span> <span class="n">meters_to_local_scale</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>    <span class="c1"># Create line segments emanating from the cameras</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>    <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="s2">&quot;line_segments.npz&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>        <span class="n">line_results</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;line_segments.npz&quot;</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>        <span class="n">line_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_line_segments</span><span class="p">(</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>            <span class="n">detector</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>            <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>            <span class="n">ray_length_local</span><span class="o">=</span><span class="n">ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>            <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>            <span class="n">limit_ray_length_local</span><span class="o">=</span><span class="n">limit_ray_length_local</span><span class="p">,</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>            <span class="n">limit_angle_from_vert</span><span class="o">=</span><span class="n">limit_angle_from_vert</span><span class="p">,</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="p">)</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>    <span class="c1"># Load the results into memory if they were saved to file</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>    <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="n">line_results</span><span class="p">):</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>        <span class="n">line_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">line_results</span><span class="p">)</span>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>    <span class="c1"># Turn line segments into graph distances, where &quot;close enough&quot;</span>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>    <span class="c1"># lines are connected nodes in the graph.</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>    <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="s2">&quot;edge_weights.json&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>        <span class="n">weight_results</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;edge_weights.json&quot;</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>        <span class="n">weight_results</span> <span class="o">=</span> <span class="n">calc_graph_weights</span><span class="p">(</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>            <span class="n">starts</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_starts&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>            <span class="n">ends</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_ends&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="n">ray_IDs</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_IDs&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>            <span class="n">similarity_threshold</span><span class="o">=</span><span class="n">similarity_threshold_local</span><span class="p">,</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="n">step</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>        <span class="p">)</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>    <span class="c1"># Load the results into memory if they were saved to file</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>    <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="n">weight_results</span><span class="p">):</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>        <span class="n">weight_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">weight_results</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>    <span class="c1"># Calculate community identities among the graph weights, where</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>    <span class="c1"># hopefully a preponderance of close line segments indicate a</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>    <span class="c1"># single object detected multiple times.</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>    <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="s2">&quot;communities.npz&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>        <span class="n">community_results</span> <span class="o">=</span> <span class="n">out_dir</span> <span class="o">/</span> <span class="s2">&quot;communities.npz&quot;</span>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="n">community_results</span> <span class="o">=</span> <span class="n">calc_communities</span><span class="p">(</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>            <span class="n">starts</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_starts&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>            <span class="n">ends</span><span class="o">=</span><span class="n">line_results</span><span class="p">[</span><span class="s2">&quot;ray_ends&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>            <span class="n">edge_weights</span><span class="o">=</span><span class="n">weight_results</span><span class="p">,</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>            <span class="n">louvain_resolution</span><span class="o">=</span><span class="n">louvain_resolution</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>            <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>            <span class="n">transform_to_epsg_4978</span><span class="o">=</span><span class="n">transform_to_epsg_4978</span><span class="p">,</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>        <span class="p">)</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>    <span class="c1"># Load the results into memory if they were saved to file</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>    <span class="k">if</span> <span class="n">check_exists</span><span class="p">(</span><span class="n">community_results</span><span class="p">):</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="n">community_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">community_results</span><span class="p">)</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>    <span class="c1"># Return the 3D locations of the community points, preferentially</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>    <span class="c1"># in lat/lon form if it exists.</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>    <span class="k">return</span> <span class="n">community_results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="s2">&quot;community_points_latlon&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>        <span class="n">community_results</span><span class="p">[</span><span class="s2">&quot;community_points&quot;</span><span class="p">],</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.vis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">vis</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_orientation_cube</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_xvfb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interactive_jupyter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.vis" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Visualize all the cameras</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>plotter</code>
            </td>
            <td>
                  <code><span title="pyvista.Plotter">Plotter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotter to add the cameras to. If None, will be created and then plotted</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>add_orientation_cube</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Add a cube to visualize the coordinate system. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show the results instead of waiting for other content to be added</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frustum_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of cameras in world units. If None, will set to 1/120th of the maximum distance
between two cameras.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_xvfb</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Force a headless rendering backend</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interactive_jupyter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Will allow you to interact with the visualization in your notebook if supported by
the notebook server. Otherwise will fail. Only applicable if <code>show=True</code>. Defaults
to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1414" name="__codelineno-0-1414"></a><span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>    <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>    <span class="n">add_orientation_cube</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>    <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>    <span class="n">force_xvfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>    <span class="n">interactive_jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a><span class="p">):</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize all the cameras</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="sd">        plotter (pv.Plotter):</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a><span class="sd">            Plotter to add the cameras to. If None, will be created and then plotted</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a><span class="sd">        add_orientation_cube (bool, optional):</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a><span class="sd">            Add a cube to visualize the coordinate system. Defaults to False.</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a><span class="sd">        show (bool, optional):</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a><span class="sd">            Show the results instead of waiting for other content to be added</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a><span class="sd">        frustum_scale (float, optional):</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a><span class="sd">            Size of cameras in world units. If None, will set to 1/120th of the maximum distance</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a><span class="sd">            between two cameras.</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a><span class="sd">        force_xvfb (bool, optional):</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a><span class="sd">            Force a headless rendering backend</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a><span class="sd">        interactive_jupyter (bool, optional):</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a><span class="sd">            Will allow you to interact with the visualization in your notebook if supported by</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a><span class="sd">            the notebook server. Otherwise will fail. Only applicable if `show=True`. Defaults</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a><span class="sd">            to False.</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>    <span class="k">if</span> <span class="n">plotter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>        <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>        <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>    <span class="c1"># Determine pairwise distance between each camera and set frustum_scale to 1/120th of the maximum distance found</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>    <span class="k">if</span> <span class="n">frustum_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cameras</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>            <span class="n">camera_translation_matrices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                <span class="p">[</span><span class="n">transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_to_world_transforms</span><span class="p">]</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>            <span class="p">)</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>            <span class="n">distances</span> <span class="o">=</span> <span class="n">pdist</span><span class="p">(</span><span class="n">camera_translation_matrices</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>            <span class="n">max_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>            <span class="n">frustum_scale</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                <span class="p">(</span><span class="n">max_distance</span> <span class="o">/</span> <span class="mi">120</span><span class="p">)</span> <span class="k">if</span> <span class="n">max_distance</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">DEFAULT_FRUSTUM_SCALE</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>            <span class="p">)</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>        <span class="c1"># else, set it to a default</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>            <span class="n">frustum_scale</span> <span class="o">=</span> <span class="n">DEFAULT_FRUSTUM_SCALE</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>    <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">:</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>        <span class="n">camera</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">plotter</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="n">frustum_scale</span><span class="p">)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>    <span class="k">if</span> <span class="n">add_orientation_cube</span><span class="p">:</span>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="c1"># TODO Consider adding to a freestanding vis module</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>        <span class="n">ocube</span> <span class="o">=</span> <span class="n">demos</span><span class="o">.</span><span class="n">orientation_cube</span><span class="p">()</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;cube&quot;</span><span class="p">],</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;x_p&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;x_n&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;y_p&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;y_n&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;z_p&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">ocube</span><span class="p">[</span><span class="s2">&quot;z_n&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">show_axes</span><span class="p">()</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>        <span class="k">if</span> <span class="n">force_xvfb</span><span class="p">:</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>            <span class="n">safe_start_xvfb</span><span class="p">()</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">jupyter_backend</span><span class="o">=</span><span class="s2">&quot;trame&quot;</span> <span class="k">if</span> <span class="n">interactive_jupyter</span> <span class="k">else</span> <span class="s2">&quot;static&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_image" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">warp_dewarp_image</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">interpolation_order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">warped_to_ideal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_image" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Either apply a camera's distortion model to go from ideal→warped or
undo the camera's distortion model to go from warped→ideal, depending
on the warped_to_ideal flag.</p>
<p>Pixels in the output image that do not correspond to any input pixel
are set to the fill value.</p>
<p>Note that the warp map is cached, so the first call will take longer
and subsequent calls should be much faster.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>camera</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.cameras.PhotogrammetryCamera)" href="#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera with parameters that
define the warp process. These include image size, principal
point, focal length, and distortion parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_image</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(I, J, 3) Input image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to use for pixels in the
output image that are not mapped from the input. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inversion_downsample</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distortion map creation
process is too heavyweight for really high-res images,
downsampling the inversion process gets a similar result with
less computation.</p>
              </div>
            </td>
            <td>
                  <code>8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interpolation_order</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The order of the interpolation. 0 is nearest neighbor and should be used for discrete
textures like pix2face masks. 1 can be used for data representing continious
quantities. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warped_to_ideal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, take in a warped image
and return an undistorted (dewarped/ideal) image. If false,
take in an undistorted image and return a warped image.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(float, optional) 0-1 fraction of the original image
size, used when warping/dewarping downsampled images. See
pix2face render_img_scale for an example.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: (I, J, 3) output image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a><span class="k">def</span><span class="w"> </span><span class="nf">warp_dewarp_image</span><span class="p">(</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="n">input_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>    <span class="n">fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>    <span class="n">inversion_downsample</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>    <span class="n">interpolation_order</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="n">warped_to_ideal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>    <span class="n">image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">    Either apply a camera&#39;s distortion model to go from ideal→warped or</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    undo the camera&#39;s distortion model to go from warped→ideal, depending</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">    on the warped_to_ideal flag.</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a><span class="sd">    Pixels in the output image that do not correspond to any input pixel</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a><span class="sd">    are set to the fill value.</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a><span class="sd">    Note that the warp map is cached, so the first call will take longer</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a><span class="sd">    and subsequent calls should be much faster.</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a><span class="sd">        camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="sd">            define the warp process. These include image size, principal</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="sd">            point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a><span class="sd">        input_image (np.ndarray): (I, J, 3) Input image</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="sd">        fill_value (int, optional): Value to use for pixels in the</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="sd">            output image that are not mapped from the input. Defaults to 0.</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a><span class="sd">        inversion_downsample (int, optional): The distortion map creation</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="sd">            process is too heavyweight for really high-res images,</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><span class="sd">            downsampling the inversion process gets a similar result with</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="sd">            less computation.</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">        interpolation_order (int, optional):</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a><span class="sd">            The order of the interpolation. 0 is nearest neighbor and should be used for discrete</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">            textures like pix2face masks. 1 can be used for data representing continious</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">            quantities. Defaults to 1.</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">        warped_to_ideal (bool, optional): If true, take in a warped image</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">            and return an undistorted (dewarped/ideal) image. If false,</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">            take in an undistorted image and return a warped image.</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">        image_scale: (float, optional) 0-1 fraction of the original image</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">            size, used when warping/dewarping downsampled images. See</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">            pix2face render_img_scale for an example.</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        np.ndarray: (I, J, 3) output image</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>    <span class="c1"># Ensure that there is a cached map for these distortion parameters</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="n">dkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_key</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="k">if</span> <span class="n">dkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">:</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">make_distortion_map</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">)</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>    <span class="c1"># Temporarily expand grayscale images to be (N, M, 1)</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>    <span class="n">input_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>    <span class="k">if</span> <span class="n">warped_to_ideal</span><span class="p">:</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>        <span class="n">inverse_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>        <span class="n">inverse_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>    <span class="c1"># Compute the min and max of values, including both the inputs and the fill value</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>    <span class="n">input_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">input_image</span><span class="p">),</span> <span class="n">fill_value</span><span class="p">)</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>    <span class="n">input_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">input_image</span><span class="p">),</span> <span class="n">fill_value</span><span class="p">)</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>    <span class="c1"># Compute the range of values</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="n">min_max_range</span> <span class="o">=</span> <span class="n">input_max</span> <span class="o">-</span> <span class="n">input_min</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>    <span class="c1"># If there&#39;s no variation, we can avoid division by 0 issues and save computation by just</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>    <span class="c1"># returning an array of one value</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>    <span class="k">if</span> <span class="n">min_max_range</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">input_image</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>    <span class="c1"># Record the original datatype</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>    <span class="n">initial_dtype</span> <span class="o">=</span> <span class="n">input_image</span><span class="o">.</span><span class="n">dtype</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>    <span class="c1"># Rescale to 0-1</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>    <span class="n">input_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">-</span> <span class="n">input_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">min_max_range</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>    <span class="c1"># The fill value will be applied to the rescaled image, so it must be rescaled similarly</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>    <span class="n">rescaled_fill_value</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fill_value</span><span class="p">)</span> <span class="o">-</span> <span class="n">input_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">min_max_range</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>    <span class="c1"># For each color channel, do the dewarping</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>    <span class="n">output_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>        <span class="n">output_image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">warp</span><span class="p">(</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>            <span class="n">image</span><span class="o">=</span><span class="n">input_image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">channel</span><span class="p">],</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>            <span class="n">inverse_map</span><span class="o">=</span><span class="n">inverse_map</span><span class="p">,</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>            <span class="n">order</span><span class="o">=</span><span class="n">interpolation_order</span><span class="p">,</span>  <span class="c1"># interpolation strategy for fractional pixels</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>  <span class="c1"># fill unseen areas with cval</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>            <span class="n">cval</span><span class="o">=</span><span class="n">rescaled_fill_value</span><span class="p">,</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>            <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># clip to [0,1]</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>            <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># keep original range without rescaling</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>        <span class="p">)</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>    <span class="c1"># Convert to the original range and datatype</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>    <span class="n">output_image</span> <span class="o">=</span> <span class="p">((</span><span class="n">output_image</span> <span class="o">*</span> <span class="n">min_max_range</span><span class="p">)</span> <span class="o">+</span> <span class="n">input_min</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>        <span class="n">initial_dtype</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>    <span class="c1"># Return grayscale if array is (N, M 1), else return RGB</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">output_image</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_pixels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">warp_dewarp_pixels</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">pixels</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">warped_to_ideal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.cameras.PhotogrammetryCameraSet.warp_dewarp_pixels" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Either apply a camera's distortion model to go from ideal pixels→warped
or undo the camera's distortion model to go from warped pixels→ideal,
depending on the warped_to_ideal flag.</p>
<p>Note that the warp map is cached, so the first call will take longer
and subsequent calls should be much faster.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>camera</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.cameras.PhotogrammetryCamera)" href="#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera with parameters that
define the warp process. These include image size, principal
point, focal length, and distortion parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixels</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 2) Pixels locations in (i, j) format.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inversion_downsample</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distortion map creation
process is too heavyweight for really high-res images,
downsampling the inversion process gets a similar result with
less computation.</p>
              </div>
            </td>
            <td>
                  <code>8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warped_to_ideal</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true, take in a warped image
and return an undistorted (dewarped/ideal) image. If false,
take in an undistorted image and return a warped image.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: (N, 2) warped/dewarped output pixel locations (i, j)
Note that the output is floating point (subpixel)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/cameras/cameras.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1172" name="__codelineno-0-1172"></a><span class="k">def</span><span class="w"> </span><span class="nf">warp_dewarp_pixels</span><span class="p">(</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>    <span class="n">camera</span><span class="p">:</span> <span class="n">PhotogrammetryCamera</span><span class="p">,</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>    <span class="n">pixels</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>    <span class="n">inversion_downsample</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>    <span class="n">warped_to_ideal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a><span class="p">):</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a><span class="sd">    Either apply a camera&#39;s distortion model to go from ideal pixels→warped</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a><span class="sd">    or undo the camera&#39;s distortion model to go from warped pixels→ideal,</span>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="sd">    depending on the warped_to_ideal flag.</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">    Note that the warp map is cached, so the first call will take longer</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a><span class="sd">    and subsequent calls should be much faster.</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">    Arguments:</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">        camera (PhotogrammetryCamera): Camera with parameters that</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">            define the warp process. These include image size, principal</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a><span class="sd">            point, focal length, and distortion parameters.</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><span class="sd">        pixels (np.ndarray): (N, 2) Pixels locations in (i, j) format.</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a><span class="sd">        inversion_downsample (int, optional): The distortion map creation</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><span class="sd">            process is too heavyweight for really high-res images,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a><span class="sd">            downsampling the inversion process gets a similar result with</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a><span class="sd">            less computation.</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a><span class="sd">        warped_to_ideal (bool, optional): If true, take in a warped image</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a><span class="sd">            and return an undistorted (dewarped/ideal) image. If false,</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a><span class="sd">            take in an undistorted image and return a warped image.</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a><span class="sd">        np.ndarray: (N, 2) warped/dewarped output pixel locations (i, j)</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">            Note that the output is floating point (subpixel)</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>    <span class="c1"># Ensure that there is a cached map for these distortion parameters</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>    <span class="n">dkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distortion_key</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">distortion_params</span><span class="p">)</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>    <span class="k">if</span> <span class="n">dkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">:</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">make_distortion_map</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">inversion_downsample</span><span class="p">)</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>    <span class="c1"># Get the right mapping array</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>    <span class="k">if</span> <span class="n">warped_to_ideal</span><span class="p">:</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>        <span class="n">rowmap</span><span class="p">,</span> <span class="n">colmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_warped_to_ideal</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>        <span class="n">rowmap</span><span class="p">,</span> <span class="n">colmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maps_ideal_to_warped</span><span class="p">[</span><span class="n">dkey</span><span class="p">]</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>    <span class="c1"># Look up the pixel locations</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">rowmap</span><span class="p">[</span><span class="n">pixels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pixels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">colmap</span><span class="p">[</span><span class="n">pixels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pixels</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 5, 2024 16:03:08 UTC">July 5, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 3, 2024 19:46:43 UTC">July 3, 2024</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/russelldj" class="md-author" title="@russelldj">
          
          <img src="https://avatars.githubusercontent.com/u/29384527?v=4&size=72" alt="russelldj">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>