
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../indexing/">
      
      
      <link rel="icon" href="../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Numeric - Geograypher Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#geograypher.utils.numeric" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Geograypher Documentation" class="md-header__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo-shaded.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Geograypher Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Numeric
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://openforestobservatory.org/" class="md-tabs__link">
        
  
  
    
  
  ← OFO home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting_started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples_and_applications/examples/" class="md-tabs__link">
          
  
  
    
  
  Examples and applications

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../software_design/" class="md-tabs__link">
        
  
  
    
  
  Software design

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../entrypoints/" class="md-tabs__link">
          
  
  
    
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Geograypher Documentation" class="md-nav__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo-shaded.png" alt="logo">

    </a>
    Geograypher Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://openforestobservatory.org/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ← OFO home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/conceptual_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptual workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples and applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples and applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples_and_applications/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples_and_applications/applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects using geograypher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../software_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software design
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../entrypoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrypoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../meshes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Meshes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Meshes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meshes/derived_meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../meshes/meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cameras/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cameras
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Cameras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cameras/cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cameras/derived_cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cameras/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../predictors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Predictors
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_4" id="__nav_6_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Predictors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/derived_segmentors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Segmentors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/ortho_segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ortho segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_5" id="__nav_6_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Numeric
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Numeric
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.utils.numeric" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;numeric
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" numeric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.calc_communities" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calc_communities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.calc_graph_weights" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calc_graph_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.chunk_slices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;chunk_slices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.compute_3D_triangle_area_vectorized" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;compute_3D_triangle_area_vectorized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.compute_approximate_ray_intersections" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;compute_approximate_ray_intersections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.create_ramped_weighting" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_ramped_weighting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.format_graph_edges" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;format_graph_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.intersection_average" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;intersection_average
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Indexing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geometric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geometric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geospatial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geospatial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parsing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parsing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prediction_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prediction metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../example_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.utils.numeric" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-module"></code>&nbsp;numeric
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" numeric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.calc_communities" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calc_communities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.calc_graph_weights" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;calc_graph_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.chunk_slices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;chunk_slices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.compute_3D_triangle_area_vectorized" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;compute_3D_triangle_area_vectorized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.compute_approximate_ray_intersections" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;compute_approximate_ray_intersections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.create_ramped_weighting" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;create_ramped_weighting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.format_graph_edges" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;format_graph_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.utils.numeric.intersection_average" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;intersection_average
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/open-forest-observatory/geograypher/edit/main/docs/API_reference/utils/numeric.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


  <h1>Numeric</h1>

<div class="doc doc-object doc-module">



<h2 id="geograypher.utils.numeric" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <code>numeric</code>


<a href="#geograypher.utils.numeric" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">









  <div class="doc doc-children">







<h3 id="geograypher.utils.numeric-functions">Functions<a href="#geograypher.utils.numeric-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.calc_communities" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">calc_communities</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">edge_weights</span><span class="p">,</span> <span class="n">louvain_resolution</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform_to_epsg_4978</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.calc_communities" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Build a networkx graph from adjacency information. Each node represents
a detection while the edges represent the quality of the matches between detections.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>starts</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array of ray start points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ends</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array of ray end points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edge_weights</code>
            </td>
            <td>
                  <code><span title="List">List</span>[<span title="Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of edges defining
the graph connectivity. Each edge is (start_idx, end_idx, weight_dict) where
weight_dict contains the edge weight information</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>louvain_resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution hyperparameter for the Louvain community
detection algorithm. Higher values lead to more communities</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_dir</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the output NPZ file containing
community information. If None, results are returned as a dictionary</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform_to_epsg_4978</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>4x4 transformation matrix to
convert points from local coordinates to EPSG:4978 (Earth-centered Earth-fixed)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[Path, Dict[str, np.ndarray]]: If out_dir is provided, returns the path to
the NPZ file containing the community information. Otherwise returns a
dictionary with keys:
- 'ray_IDs': (N,) array mapping each ray to its community ID
- 'community_points': (M, 3) array of 3D points representing each community
- 'community_points_latlon': (M, 3) array of lat/lon points (only if
   transform_to_epsg_4978 is provided)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_communities</span><span class="p">(</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="n">starts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">ends</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>    <span class="n">edge_weights</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="n">louvain_resolution</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="n">transform_to_epsg_4978</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a><span class="sd">    Build a networkx graph from adjacency information. Each node represents</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    a detection while the edges represent the quality of the matches between detections.</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        starts (np.ndarray): (N, 3) array of ray start points</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        ends (np.ndarray): (N, 3) array of ray end points</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        edge_weights (List[Tuple[int, int, Dict[str, float]]]): List of edges defining</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">            the graph connectivity. Each edge is (start_idx, end_idx, weight_dict) where</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">            weight_dict contains the edge weight information</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        louvain_resolution (float): Resolution hyperparameter for the Louvain community</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">            detection algorithm. Higher values lead to more communities</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        out_dir (PATH_TYPE, optional): Directory to save the output NPZ file containing</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">            community information. If None, results are returned as a dictionary</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        transform_to_epsg_4978 (np.ndarray, optional): 4x4 transformation matrix to</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">            convert points from local coordinates to EPSG:4978 (Earth-centered Earth-fixed)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        Union[Path, Dict[str, np.ndarray]]: If out_dir is provided, returns the path to</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">            the NPZ file containing the community information. Otherwise returns a</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">            dictionary with keys:</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">            - &#39;ray_IDs&#39;: (N,) array mapping each ray to its community ID</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a><span class="sd">            - &#39;community_points&#39;: (M, 3) array of 3D points representing each community</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a><span class="sd">            - &#39;community_points_latlon&#39;: (M, 3) array of lat/lon points (only if</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="sd">               transform_to_epsg_4978 is provided)</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="c1"># Build up the basic graph from edge weights</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>    <span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">edge_weights</span><span class="p">)</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="c1"># Check that the graph is non empty</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="c1"># Determine Louvain communities which are sets of nodes. Ideally, each</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="c1"># community represents a set of detections that correspond to one 3D object</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="n">communities</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">community</span><span class="o">.</span><span class="n">louvain_communities</span><span class="p">(</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="n">graph</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">louvain_resolution</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="c1"># Sort the communities by size</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="n">communities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">communities</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="c1"># Triangulate the rays for each community to identify the 3D location</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="n">community_points</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="c1"># Record the community IDs per ray</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">num_rays</span> <span class="o">=</span> <span class="n">starts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="n">ray_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">num_rays</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="c1"># Iterate over communities</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="k">for</span> <span class="n">community_ID</span><span class="p">,</span> <span class="n">community</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="n">tqdm</span><span class="p">(</span><span class="n">communities</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Build community points&quot;</span><span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="p">):</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="c1"># Get the ray indices that belong to that community</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">community_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">community</span><span class="p">))</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="c1"># Record the community ID for the corresponding rays</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>            <span class="n">ray_IDs</span><span class="p">[</span><span class="n">community_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_ID</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>            <span class="c1"># Use the average of the closest points between rays as the</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>            <span class="c1"># representative point for the community</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>            <span class="n">community_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="n">intersection_average</span><span class="p">(</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="n">starts</span><span class="o">=</span><span class="n">starts</span><span class="p">[</span><span class="n">community_indices</span><span class="p">],</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                    <span class="n">ends</span><span class="o">=</span><span class="n">ends</span><span class="p">[</span><span class="n">community_indices</span><span class="p">],</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>            <span class="p">)</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="c1"># Stack all of the points into one vector</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="n">community_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">community_points</span><span class="p">)</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="s2">&quot;ray_IDs&quot;</span><span class="p">:</span> <span class="n">ray_IDs</span><span class="p">,</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="s2">&quot;community_points&quot;</span><span class="p">:</span> <span class="n">community_points</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="p">}</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>        <span class="k">if</span> <span class="n">transform_to_epsg_4978</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="c1"># Append a column of all ones to make the homogenous coordinates</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="n">homogenous</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>                <span class="p">[</span><span class="n">community_points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">community_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])],</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="p">)</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="c1"># Use the transform matrix to transform the points into the earth</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="c1"># centered, earth fixed frame (EPSG:4978)</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">community_points_epsg_4978</span> <span class="o">=</span> <span class="p">(</span><span class="n">transform_to_epsg_4978</span> <span class="o">@</span> <span class="n">homogenous</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>            <span class="c1"># Convert the points from earth centered, earth fixed frame to lat lon</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>            <span class="n">community_points_lat_lon</span> <span class="o">=</span> <span class="n">convert_CRS_3D_points</span><span class="p">(</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="n">community_points_epsg_4978</span><span class="p">,</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>                <span class="n">input_CRS</span><span class="o">=</span><span class="n">EARTH_CENTERED_EARTH_FIXED_CRS</span><span class="p">,</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="n">output_CRS</span><span class="o">=</span><span class="n">LAT_LON_CRS</span><span class="p">,</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;community_points_latlon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_points_lat_lon</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="c1"># Handle the empty case</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="s2">&quot;ray_IDs&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="s2">&quot;community_points&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>        <span class="p">}</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="k">if</span> <span class="n">transform_to_epsg_4978</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;community_points_latlon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;communities.npz&quot;</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="k">return</span> <span class="n">path</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.calc_graph_weights" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">calc_graph_weights</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">ray_IDs</span><span class="p">,</span> <span class="n">similarity_threshold</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.calc_graph_weights" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>This function processes sets of ray segments to build a graph where edges represent
ray intersections. The weight of each edge is inversely proportional to the
intersection distance between rays. For memory efficiency with large numbers of
segments, the computation is done in chunks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>starts</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array of ray start points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ends</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array of ray end points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ray_IDs</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N,) array of integers identifying which image
each ray comes from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>similarity_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum intersection distance to consider when
creating graph edges. Greater distances will be dropped.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_dir</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the output JSON file containing
edge information. If None, no file is saved and a list of edge weights
is returned instead.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_dist</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum intersection distance to allow, used to
avoid division by zero when calculating weights. Defaults to 1e-6</p>
              </div>
            </td>
            <td>
                  <code>1e-06</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rays to process in each chunk to manage memory
usage. Defaults to 5000</p>
              </div>
            </td>
            <td>
                  <code>5000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="callable">callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function to apply to distances before inversion
for weight calculation. For example, if you want graph weights to be
distance^3, use lambda x: x**3. Defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[Path, List[Tuple]]: If out_dir is provided, returns the path to the JSON</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file containing the edge information. Otherwise returns a list of tuples, each</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>containing (start_idx, end_idx, weight_dict) where weight_dict contains the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>edge weight information</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="k">def</span><span class="w"> </span><span class="nf">calc_graph_weights</span><span class="p">(</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="n">starts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="n">ends</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>    <span class="n">ray_IDs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>    <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="n">transform</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">]]:</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    This function processes sets of ray segments to build a graph where edges represent</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">    ray intersections. The weight of each edge is inversely proportional to the</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    intersection distance between rays. For memory efficiency with large numbers of</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    segments, the computation is done in chunks.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        starts (np.ndarray): (N, 3) array of ray start points</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">        ends (np.ndarray): (N, 3) array of ray end points</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">        ray_IDs (np.ndarray): (N,) array of integers identifying which image</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            each ray comes from</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        similarity_threshold (float): Maximum intersection distance to consider when</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">            creating graph edges. Greater distances will be dropped.</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">        out_dir (PATH_TYPE, optional): Directory to save the output JSON file containing</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">            edge information. If None, no file is saved and a list of edge weights</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">            is returned instead.</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        min_dist (float, optional): Minimum intersection distance to allow, used to</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">            avoid division by zero when calculating weights. Defaults to 1e-6</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">        step (int, optional): Number of rays to process in each chunk to manage memory</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">            usage. Defaults to 5000</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        transform (callable, optional): Function to apply to distances before inversion</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">            for weight calculation. For example, if you want graph weights to be</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a><span class="sd">            distance^3, use lambda x: x**3. Defaults to None</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="sd">        Union[Path, List[Tuple]]: If out_dir is provided, returns the path to the JSON</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="sd">        file containing the edge information. Otherwise returns a list of tuples, each</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">        containing (start_idx, end_idx, weight_dict) where weight_dict contains the</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        edge weight information</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="c1"># Calculate and filter intersection distances</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="c1"># For memory reasons, we need to iterate over blocks. When the number of segments starts</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="c1"># getting very large, the matrices for calculating ray intersections take a great</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="c1"># deal of RAM</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">edge_weights</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">num_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">)</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="n">total</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_steps</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="k">for</span> <span class="n">islice</span><span class="p">,</span> <span class="n">jslice</span><span class="p">,</span> <span class="n">diagonal</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="n">chunk_slices</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">starts</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">),</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Calculating graph weights&quot;</span><span class="p">,</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="p">):</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">compute_approximate_ray_intersections</span><span class="p">(</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">a0</span><span class="o">=</span><span class="n">starts</span><span class="p">[</span><span class="n">islice</span><span class="p">],</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">a1</span><span class="o">=</span><span class="n">ends</span><span class="p">[</span><span class="n">islice</span><span class="p">],</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="n">b0</span><span class="o">=</span><span class="n">starts</span><span class="p">[</span><span class="n">jslice</span><span class="p">],</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">b1</span><span class="o">=</span><span class="n">ends</span><span class="p">[</span><span class="n">jslice</span><span class="p">],</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="n">clamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">if</span> <span class="n">diagonal</span><span class="p">:</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">dist</span><span class="p">[</span><span class="n">dist</span> <span class="o">&gt;</span> <span class="n">similarity_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="n">dist</span><span class="p">[</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_dist</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="c1"># Apply transform if provided</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">if</span> <span class="n">transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="n">dist</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="c1"># Create edge weights for valid intersections</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="n">edge_weights</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">format_graph_edges</span><span class="p">(</span><span class="n">islice</span><span class="p">,</span> <span class="n">jslice</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">ray_IDs</span><span class="p">))</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="k">return</span> <span class="n">edge_weights</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;edge_weights.json&quot;</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="k">with</span> <span class="n">path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">edge_weights</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="k">return</span> <span class="n">path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.chunk_slices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">chunk_slices</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.chunk_slices" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Yield slices for (step, step) chunks of the upper triangular area
of an (N, N) square matrix.</p>
<p>For example, if N=5 and step=2, the slices would grab:
    1 1 2 2 3
    1 1 2 2 3
    - - 4 4 5
    - - 4 4 5
    - - - - 6
And in the (1, 4, 6) cases, is_diag would be True</p>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="slice">slice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Each yielded value is (islice, jslice, is_diag), where:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="slice">slice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>islice: slice along the first axis</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>jslice: slice along the second axis</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="slice">slice</span>, <span title="slice">slice</span>, <span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>is_diag: True if the chunk is on the diagonal (i == j)</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="k">def</span><span class="w"> </span><span class="nf">chunk_slices</span><span class="p">(</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">    Yield slices for (step, step) chunks of the upper triangular area</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    of an (N, N) square matrix.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    For example, if N=5 and step=2, the slices would grab:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        1 1 2 2 3</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        1 1 2 2 3</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        - - 4 4 5</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        - - 4 4 5</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        - - - - 6</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    And in the (1, 4, 6) cases, is_diag would be True</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">        Each yielded value is (islice, jslice, is_diag), where:</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">        - islice: slice along the first axis</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">        - jslice: slice along the second axis</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        - is_diag: True if the chunk is on the diagonal (i == j)</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="n">ranges</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># upper triangle including diagonal</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>            <span class="n">islice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">jslice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="k">yield</span> <span class="n">islice</span><span class="p">,</span> <span class="n">jslice</span><span class="p">,</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.compute_3D_triangle_area_vectorized" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">compute_3D_triangle_area_vectorized</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">return_z_proj_area</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.compute_3D_triangle_area_vectorized" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p><em>summary</em></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>corners</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_faces, n)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_z_proj_area</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em>. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>_type_</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p><em>description</em></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_3D_triangle_area_vectorized</span><span class="p">(</span><span class="n">corners</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">return_z_proj_area</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        corners (np.ndarray): (n_faces, n)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        return_z_proj_area (bool, optional): _description_. Defaults to True.</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        _type_: _description_</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">corners</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="c1"># https://math.stackexchange.com/questions/2152754/calculate-3d-triangle-area-by-determinant</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">u</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="c1"># Save for future computation</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="n">u0v1_min_u1v0</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">area</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="mi">1</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">u0v1_min_u1v0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="k">if</span> <span class="n">return_z_proj_area</span><span class="p">:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="n">area_z_proj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u0v1_min_u1v0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">return</span> <span class="n">area</span><span class="p">,</span> <span class="n">area_z_proj</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="k">return</span> <span class="n">area</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.compute_approximate_ray_intersections" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">compute_approximate_ray_intersections</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.compute_approximate_ray_intersections" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Compute closest points and distances between N line segments a0-&gt;a1 and
b0-&gt;b1. Returns (N, N, 3), (N, N, 3), (N, N). If clamp is True, then respect
the line segment ends. If clamp is False, then use the infinite rays.</p>
<p>Based on https://stackoverflow.com/questions/2824478/shortest-distance-between-two-line-segments</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>a0</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start points of the first segments (N, 3).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>a1</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End points of the first segments (N, 3).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b0</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start points of the second segments (N, 3).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b1</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End points of the second segments (N, 3).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>clamp</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the closest points are clamped to the
segment endpoints. If False, the closest points may be anywhere
along the infinite rays.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pA</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Closest point on the A segments (axis 0) compared to
each of the B segments (axis 1) (N, N, 3). For example, the closest
point between A[5] and B[2] at pA[5, 2]</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>pB</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Closest point on the B segments (axis 1) compared to
each of the A segments (axis 1) (N, N, 3)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>dist</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum distance between the A (axis 0) and B
(axis 1) segments.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">compute_approximate_ray_intersections</span><span class="p">(</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">a0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">a1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">b0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">b1</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">clamp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Compute closest points and distances between N line segments a0-&gt;a1 and</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    b0-&gt;b1. Returns (N, N, 3), (N, N, 3), (N, N). If clamp is True, then respect</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    the line segment ends. If clamp is False, then use the infinite rays.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Based on https://stackoverflow.com/questions/2824478/shortest-distance-between-two-line-segments</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        a0 (np.ndarray): Start points of the first segments (N, 3).</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        a1 (np.ndarray): End points of the first segments (N, 3).</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        b0 (np.ndarray): Start points of the second segments (N, 3).</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        b1 (np.ndarray): End points of the second segments (N, 3).</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        clamp (bool, optional): If True, the closest points are clamped to the</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            segment endpoints. If False, the closest points may be anywhere</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            along the infinite rays.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        pA (np.ndarray): Closest point on the A segments (axis 0) compared to</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            each of the B segments (axis 1) (N, N, 3). For example, the closest</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            point between A[5] and B[2] at pA[5, 2]</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        pB (np.ndarray): Closest point on the B segments (axis 1) compared to</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            each of the A segments (axis 1) (N, N, 3)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        dist (np.ndarray): The minimum distance between the A (axis 0) and B</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            (axis 1) segments.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="c1"># (N, 3) vectors, representing the A and B line segments</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">A</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">-</span> <span class="n">a0</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">B</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">b0</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="c1"># (N,) distances, representing the length of each A and B vector</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">magA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">magB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="c1"># (N, 3) vectors, representing the A and B unit vectors</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">_A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">/</span> <span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">_B</span> <span class="o">=</span> <span class="n">B</span> <span class="o">/</span> <span class="n">magB</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="c1"># Expand the A vectors to (N, 1, 3) and the B vectors to (1, N, 3) so that</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="c1"># they project together to an (N, N, 3) matrix later</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">a0_exp</span> <span class="o">=</span> <span class="n">a0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">b0_exp</span> <span class="o">=</span> <span class="n">b0</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">_A_exp</span> <span class="o">=</span> <span class="n">_A</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">_B_exp</span> <span class="o">=</span> <span class="n">_B</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># (N, N, 3) cross product. The cross product of unit vectors calculates the</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1"># area of the parallelogram formed by the unit vectors, a larger value</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="c1"># indicates lines that are more orthogonal</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">cross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">_A_exp</span><span class="p">,</span> <span class="n">_B_exp</span><span class="p">)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="c1"># (N, N) representing the squared area of the unit vector parallelograms</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cross</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="c1"># (N, N, 3) matrix, representing the vector from the start of each A</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="c1"># segment to the start of each B segment</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">b0_exp</span> <span class="o">-</span> <span class="n">a0_exp</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="c1"># (N, N) matrix, calculate the determinant by multiplying all axes (ijk)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="c1"># and then sum across k, leaving only an ij matrix. The determinant</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="c1"># represents how a given transform scales space</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">detA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,ijk-&gt;ij&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_B_exp</span><span class="p">),</span> <span class="n">cross</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">detB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,ijk-&gt;ij&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_A_exp</span><span class="p">),</span> <span class="n">cross</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="c1"># Make the denom safe for division by replacing 0 values with 1. Later we</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="c1"># check for parallel locations and fix them</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">parallel</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">denom</span><span class="p">[</span><span class="n">parallel</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="c1"># t0 and t1 are (N, N) matrices representing how far along A the closest</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="c1"># point is (t0) where 0 is at a0 and 1 is at a1. B and t1 are the same.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">t0</span> <span class="o">=</span> <span class="n">detA</span> <span class="o">/</span> <span class="n">denom</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">t1</span> <span class="o">=</span> <span class="n">detB</span> <span class="o">/</span> <span class="n">denom</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">if</span> <span class="n">clamp</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># (N, N) matrix where t0 and t1 are clipped to the vector length</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">t0_clamped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">t1_clamped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">magB</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># (N, N, 3) matrix where we start at each vector starting point (a0</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="c1"># and b0 expanded) then travel along them to the closest clamped point</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">pA</span> <span class="o">=</span> <span class="n">a0_exp</span> <span class="o">+</span> <span class="n">t0_clamped</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_A_exp</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">pB</span> <span class="o">=</span> <span class="n">b0_exp</span> <span class="o">+</span> <span class="n">t1_clamped</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_B_exp</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="c1"># Check whether the original scale values where out of bounds</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">oob_A</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t0</span> <span class="o">&gt;</span> <span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">oob_B</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t1</span> <span class="o">&gt;</span> <span class="n">magB</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="c1"># Broadcast a0 and _A to (N, N, 3), similar for b0/_B</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">a0_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">a0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">pA</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">_A_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">_A</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">pA</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">b0_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">b0</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">pB</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">_B_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">_B</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">pB</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="c1"># If any of the scale vectors were clipped, we may have to adjust the</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="c1"># closest point on the opposite vector. For example if the closest</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="c1"># point on an A vector was clipped, the corresponding B point may need</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="c1"># to update</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">oob_A</span><span class="p">):</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="c1"># Get the projection of the new A point onto the B vectors</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="n">dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,ijk-&gt;ij&quot;</span><span class="p">,</span> <span class="n">pA</span> <span class="o">-</span> <span class="n">b0_bcast</span><span class="p">,</span> <span class="n">_B_bcast</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="c1"># Get a new B point matching that projection</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">dot_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">magB</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">pB</span><span class="p">[</span><span class="n">oob_A</span><span class="p">]</span> <span class="o">=</span> <span class="n">b0_bcast</span><span class="p">[</span><span class="n">oob_A</span><span class="p">]</span> <span class="o">+</span> <span class="n">dot_clipped</span><span class="p">[</span><span class="n">oob_A</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_B_bcast</span><span class="p">[</span><span class="n">oob_A</span><span class="p">]</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">oob_B</span><span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="c1"># Get the projection of the new B point onto the A vectors</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">dot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ijk,ijk-&gt;ij&quot;</span><span class="p">,</span> <span class="n">pB</span> <span class="o">-</span> <span class="n">a0_bcast</span><span class="p">,</span> <span class="n">_A_bcast</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="c1"># Get a new A point matching that projection</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">dot_clipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">pA</span><span class="p">[</span><span class="n">oob_B</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0_bcast</span><span class="p">[</span><span class="n">oob_B</span><span class="p">]</span> <span class="o">+</span> <span class="n">dot_clipped</span><span class="p">[</span><span class="n">oob_B</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_A_bcast</span><span class="p">[</span><span class="n">oob_B</span><span class="p">]</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="c1"># If there is no clamping, we use the scale value as-is to get the</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="c1"># closest points between the rays</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">pA</span> <span class="o">=</span> <span class="n">a0_exp</span> <span class="o">+</span> <span class="n">t0</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_A_exp</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">pB</span> <span class="o">=</span> <span class="n">b0_exp</span> <span class="o">+</span> <span class="n">t1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_B_exp</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="c1"># Handle parallel case</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">parallel</span><span class="p">):</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="c1"># Get the (N, N) projection of each point in b0 onto each unit vector</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="c1"># in A. Subtract the (N, 1) projection of each point in a0 along their</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="c1"># unit vector. By subtracting them, we calculating whether b0 falls</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="c1"># &quot;ahead&quot; or &quot;behind&quot; of a0, along the relevant axis (_A)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">d0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,kj-&gt;ik&quot;</span><span class="p">,</span> <span class="n">_A</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">_A</span><span class="p">,</span> <span class="n">a0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">if</span> <span class="n">clamp</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="c1"># Same logic as d0, but with a1 and b1</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,kj-&gt;ik&quot;</span><span class="p">,</span> <span class="n">_A</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">_A</span><span class="p">,</span> <span class="n">a0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="c1"># Check in which of the (N, N) combinations b0 and b1 fall before</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="c1"># a0, forming an (N, N) boolean mask</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">before</span> <span class="o">=</span> <span class="p">(</span><span class="n">d0</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d1</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">parallel</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="c1"># Same logic for after</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">after</span> <span class="o">=</span> <span class="p">(</span><span class="n">d0</span> <span class="o">&gt;=</span> <span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d1</span> <span class="o">&gt;=</span> <span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">parallel</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="c1"># If an A and B vector is parallel and partially overlapping,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="c1"># middle will be true (N, N) boolean mask</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">middle</span> <span class="o">=</span> <span class="n">parallel</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">before</span> <span class="o">|</span> <span class="n">after</span><span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">before</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>                <span class="c1"># Set pA to a0 where relevant</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="n">pA</span><span class="p">[</span><span class="n">before</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:][</span><span class="n">before</span><span class="p">]</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>                <span class="c1"># Set pB to whichever endpoint is closer to a0</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>                <span class="n">pB</span><span class="p">[</span><span class="n">before</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d0</span><span class="p">[</span><span class="n">before</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">before</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>                    <span class="n">b0</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">before</span><span class="p">],</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                    <span class="n">b1</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">before</span><span class="p">],</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">after</span><span class="p">):</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="c1"># Set pA to a1 where relevant</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>                <span class="n">pA</span><span class="p">[</span><span class="n">after</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:][</span><span class="n">after</span><span class="p">]</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="c1"># Set pB to whichever endpoint is closer to a1</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="n">pB</span><span class="p">[</span><span class="n">after</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d0</span><span class="p">[</span><span class="n">after</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">after</span><span class="p">])[:,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                    <span class="n">b0</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">after</span><span class="p">],</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>                    <span class="n">b1</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:][</span><span class="n">after</span><span class="p">],</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">middle</span><span class="p">):</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="c1"># Clip d0 along the A vectors (from 0 to the magnitude of A)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="n">t_mid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="n">d0</span><span class="p">[</span><span class="n">middle</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">magA</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">d0</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="n">middle</span><span class="p">]</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="c1"># Get the broadcast components that align with the state we</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="c1"># care about (middle)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">a0_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">a0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">pA</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="n">_A_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">_A</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">pA</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="n">a0_mid</span> <span class="o">=</span> <span class="n">a0_bcast</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                <span class="n">_A_mid</span> <span class="o">=</span> <span class="n">_A_bcast</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="c1"># Reproject onto the A vectors</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                <span class="n">pA</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">=</span> <span class="n">a0_mid</span> <span class="o">+</span> <span class="n">t_mid</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_A_mid</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="c1"># Get the vector from the new pA points to b0</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="n">b0_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">b0</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">pB</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">a2b</span> <span class="o">=</span> <span class="n">b0_bcast</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">-</span> <span class="n">pA</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="c1"># Then subtract the component that is along the A vectors, and</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="c1"># that gives us the final pB location</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">alongA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;i&quot;</span><span class="p">,</span> <span class="n">a2b</span><span class="p">,</span> <span class="n">_A_mid</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">_A_mid</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="n">pB</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">=</span> <span class="n">pA</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">a2b</span> <span class="o">-</span> <span class="n">alongA</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="c1"># If we&#39;re not clamping, arbitrarily set the parallel &quot;closest</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="c1"># points&quot; to b0 and the matching point on A</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">a0_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">a0</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">pA</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">b0_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">b0</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">pB</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">_A_bcast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">_A</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">pA</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">pA</span><span class="p">[</span><span class="n">parallel</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">a0_bcast</span><span class="p">[</span><span class="n">parallel</span><span class="p">]</span> <span class="o">+</span> <span class="n">d0</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">][</span><span class="n">parallel</span><span class="p">]</span> <span class="o">*</span> <span class="n">_A_bcast</span><span class="p">[</span><span class="n">parallel</span><span class="p">]</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="n">pB</span><span class="p">[</span><span class="n">parallel</span><span class="p">]</span> <span class="o">=</span> <span class="n">b0_bcast</span><span class="p">[</span><span class="n">parallel</span><span class="p">]</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="c1"># pA and pB are existing (N, N, 3) matrices. In addition, calculate the</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1"># (N, N) distances between each pair</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">return</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pA</span> <span class="o">-</span> <span class="n">pB</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.create_ramped_weighting" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">create_ramped_weighting</span><span class="p">(</span><span class="n">rectangle_shape</span><span class="p">,</span> <span class="n">ramp_dist_frac</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.create_ramped_weighting" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a ramped weighting that is higher toward the center with a max value of 1 at a fraction from the edge</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rectangle_shape</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of rectangle to create a mask for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ramp_dist_frac</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Portions at least this far from an edge will have full weight</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: An array representing the weighting from 0-1</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_ramped_weighting</span><span class="p">(</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">rectangle_shape</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">ramp_dist_frac</span><span class="p">:</span> <span class="nb">float</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a ramped weighting that is higher toward the center with a max value of 1 at a fraction from the edge</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        rectangle_shape (typing.Tuple[int, int]): Size of rectangle to create a mask for</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        ramp_dist_frac (float): Portions at least this far from an edge will have full weight</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        np.ndarray: An array representing the weighting from 0-1</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">i_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">ramp_dist_frac</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">rectangle_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">j_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">ramp_dist_frac</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">rectangle_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">i_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">i_ramp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">i_ramp</span><span class="p">))</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">j_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">j_ramp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">j_ramp</span><span class="p">))</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">i_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">i_ramp</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">j_ramp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">j_ramp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">ramped_weighting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">i_ramp</span><span class="p">,</span> <span class="n">j_ramp</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">return</span> <span class="n">ramped_weighting</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.format_graph_edges" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">format_graph_edges</span><span class="p">(</span><span class="n">islice</span><span class="p">,</span> <span class="n">jslice</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">ray_IDs</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.format_graph_edges" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>This function generates edge definitions for a graph where nodes represent rays and
edges represent valid intersections between rays. It applies three filtering criteria:
1. Only uses edges where (i, j) is finite (not NaN)
2. Only uses edges where i &lt; j (keeps it upper triangular)
3. Only uses edges between rays from different images (different ray_IDs)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>islice</code>
            </td>
            <td>
                  <code><span title="slice">slice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slice indicating the block of rows being processed in the
chunked computation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jslice</code>
            </td>
            <td>
                  <code><span title="slice">slice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Slice indicating the block of columns being processed in
the chunked computation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dist</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distance matrix containing distances between rays (chunked)
This is the [islice, jslice] section of a larger distance matrix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ray_IDs</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of identifiers indicating which image each ray comes
from (not chunked)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Tuple[int, int, Dict[str, float]]]: List of edge definitions, where each edge</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>is a tuple of</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>i index in the adjacency matrix</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>j index in the adjacency matrix</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>, <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>weight_dict of the form {"weight": value}</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="k">def</span><span class="w"> </span><span class="nf">format_graph_edges</span><span class="p">(</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="n">islice</span><span class="p">:</span> <span class="nb">slice</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="n">jslice</span><span class="p">:</span> <span class="nb">slice</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">dist</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">ray_IDs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">    This function generates edge definitions for a graph where nodes represent rays and</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    edges represent valid intersections between rays. It applies three filtering criteria:</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">    1. Only uses edges where (i, j) is finite (not NaN)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    2. Only uses edges where i &lt; j (keeps it upper triangular)</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    3. Only uses edges between rays from different images (different ray_IDs)</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        islice (slice): Slice indicating the block of rows being processed in the</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            chunked computation</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        jslice (slice): Slice indicating the block of columns being processed in</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            the chunked computation</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        dist (np.ndarray): Distance matrix containing distances between rays (chunked)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">            This is the [islice, jslice] section of a larger distance matrix.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        ray_IDs (np.ndarray): Array of identifiers indicating which image each ray comes</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">            from (not chunked)</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">        List[Tuple[int, int, Dict[str, float]]]: List of edge definitions, where each edge</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">        is a tuple of</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        - i index in the adjacency matrix</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        - j index in the adjacency matrix</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        - weight_dict of the form {&quot;weight&quot;: value}</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="c1"># The places where the array is finite are the valid graph distances</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="n">i_inds</span><span class="p">,</span> <span class="n">j_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="c1"># Pre-calculate the inverse distance</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dist</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="p">(</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">islice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">jslice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])},</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="p">)</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">i_inds</span><span class="p">,</span> <span class="n">j_inds</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">islice</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">+</span> <span class="n">jslice</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="ow">and</span> <span class="p">(</span><span class="n">ray_IDs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">islice</span><span class="o">.</span><span class="n">start</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ray_IDs</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="n">jslice</span><span class="o">.</span><span class="n">start</span><span class="p">])</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.utils.numeric.intersection_average" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">intersection_average</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span></code>

<a href="#geograypher.utils.numeric.intersection_average" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Given arrays of line segment start and end points, compute the average of the closest
intersection points between all pairs of segments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>starts</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array of segment start points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ends</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N, 3) array of segment end points</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: (3,) array, the average intersection point</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/utils/numeric.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="k">def</span><span class="w"> </span><span class="nf">intersection_average</span><span class="p">(</span><span class="n">starts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ends</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    Given arrays of line segment start and end points, compute the average of the closest</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    intersection points between all pairs of segments.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        starts (np.ndarray): (N, 3) array of segment start points</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        ends (np.ndarray): (N, 3) array of segment end points</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        np.ndarray: (3,) array, the average intersection point</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">closest_points</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_approximate_ray_intersections</span><span class="p">(</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">a0</span><span class="o">=</span><span class="n">starts</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="n">ends</span><span class="p">,</span> <span class="n">b0</span><span class="o">=</span><span class="n">starts</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="n">ends</span><span class="p">,</span> <span class="n">clamp</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">starts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">pA</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">pB</span><span class="p">[</span><span class="n">mask</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 8, 2024 15:21:39 UTC">July 8, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 22, 2023 19:10:05 UTC">May 22, 2023</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/russelldj" class="md-author" title="@russelldj">
          
          <img src="https://avatars.githubusercontent.com/u/29384527?v=4&size=72" alt="russelldj">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>