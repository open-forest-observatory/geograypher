
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../derived_meshes/">
      
      
        <link rel="next" href="../../cameras/">
      
      
      <link rel="icon" href="../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Mesh Docstrings - Geograypher Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#geograypher.meshes.TexturedPhotogrammetryMesh" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Geograypher Documentation" class="md-header__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo-shaded.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Geograypher Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Mesh Docstrings
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://openforestobservatory.org/" class="md-tabs__link">
        
  
  
    
  
  ‚Üê OFO home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../getting_started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../examples_and_applications/examples/" class="md-tabs__link">
          
  
  
    
  
  Examples and applications

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../software_design/" class="md-tabs__link">
        
  
  
    
  
  Software design

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../entrypoints/" class="md-tabs__link">
          
  
  
    
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Geograypher Documentation" class="md-nav__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../../assets/logo-shaded.png" alt="logo">

    </a>
    Geograypher Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://openforestobservatory.org/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‚Üê OFO home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/conceptual_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptual workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples and applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples and applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples_and_applications/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples_and_applications/applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects using geograypher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../software_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software design
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../entrypoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entrypoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Meshes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Meshes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../derived_meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Mesh Docstrings
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Mesh Docstrings
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TexturedPhotogrammetryMesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="¬†TexturedPhotogrammetryMesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.aggregate_projected_images" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;aggregate_projected_images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.export_face_labels_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;export_face_labels_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.face_to_vert_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;face_to_vert_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_faces_2d_gdf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_faces_2d_gdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_height_above_ground" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_height_above_ground
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_mesh_hash" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_mesh_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_transform_hash" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_transform_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_values_for_verts_from_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_values_for_verts_from_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_vert_values_from_raster_file" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vert_values_from_raster_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_vertices_in_CRS" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vertices_in_CRS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_verts_geodataframe" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_verts_geodataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.label_ground_class" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;label_ground_class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.label_polygons" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;label_polygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_transform_to_epsg_4326" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_transform_to_epsg_4326
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.pix2face" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;pix2face
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.project_images" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;project_images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.render_flat" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;render_flat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.save_IDs_to_labels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_IDs_to_labels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.save_renders" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_renders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.select_mesh_ROI" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select_mesh_ROI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.set_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.transfer_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;transfer_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.transform_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;transform_vertices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.vis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cameras/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cameras
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Cameras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cameras/cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cameras/derived_cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cameras/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../predictors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Predictors
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_4" id="__nav_6_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Predictors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/derived_segmentors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Segmentors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predictors/ortho_segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ortho segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_5" id="__nav_6_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/numeric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Numeric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Indexing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/geometric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geometric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/geospatial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geospatial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/parsing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parsing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/prediction_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prediction metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/example_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;TexturedPhotogrammetryMesh
    </span>
  </a>
  
    <nav class="md-nav" aria-label="¬†TexturedPhotogrammetryMesh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;__init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.aggregate_projected_images" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;aggregate_projected_images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.export_face_labels_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;export_face_labels_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.face_to_vert_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;face_to_vert_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_faces_2d_gdf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_faces_2d_gdf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_height_above_ground" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_height_above_ground
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_mesh_hash" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_mesh_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_transform_hash" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_transform_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_values_for_verts_from_vector" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_values_for_verts_from_vector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_vert_values_from_raster_file" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vert_values_from_raster_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_vertices_in_CRS" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_vertices_in_CRS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_verts_geodataframe" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_verts_geodataframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.label_ground_class" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;label_ground_class
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.label_polygons" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;label_polygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_mesh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_transform_to_epsg_4326" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_transform_to_epsg_4326
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.pix2face" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;pix2face
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.project_images" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;project_images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.render_flat" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;render_flat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.save_IDs_to_labels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_IDs_to_labels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.save_renders" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_renders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.select_mesh_ROI" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;select_mesh_ROI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.set_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.transfer_texture" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;transfer_texture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.transform_vertices" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;transform_vertices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geograypher.meshes.TexturedPhotogrammetryMesh.vis" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;vis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/open-forest-observatory/geograypher/edit/main/docs/API_reference/meshes/meshes.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


  <h1>Mesh Docstrings</h1>

<div class="doc doc-object doc-class">



<h2 id="geograypher.meshes.TexturedPhotogrammetryMesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code>TexturedPhotogrammetryMesh</code>


<a href="#geograypher.meshes.TexturedPhotogrammetryMesh" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">








              <details class="quote">
                <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">class</span><span class="w"> </span><span class="nc">TexturedPhotogrammetryMesh</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">mesh</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">],</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">downsample_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">transform_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">texture_column_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">ROI_buffer_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">require_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            mesh (typing.Union[PATH_TYPE, pv.PolyData]): Path to the mesh, in a format pyvista can read, or pyvista mesh</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            downsample_target (float, optional): Downsample to this fraction of vertices. Defaults to 1.0.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            texture (typing.Union[PATH_TYPE, np.ndarray, None]): Texture or path to one. See more details in `load_texture` documentation</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            texture_column_name: The name of the column to use for a vectorfile input</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            IDs_to_labels (typing.Union[PATH_TYPE, dict, None]): dictionary or JSON file containing the mapping from integer IDs to string class names</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">downsample_target</span> <span class="o">=</span> <span class="n">downsample_target</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="c1"># Create the plotter that will later be used to compute correspondences between pixels</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="c1"># and the mesh. Note that this is only done to prevent a memory leak from creating multiple</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="c1"># plotters. See https://github.com/pyvista/pyvista/issues/2252</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span> <span class="o">=</span> <span class="n">create_pv_plotter</span><span class="p">(</span><span class="n">off_screen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_polygons_cache</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_2d_3d_ratios_cache</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mesh_</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="c1"># Potentially necessary for Jupyter</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="c1"># https://stackoverflow.com/questions/35936086/jupyter-notebook-does-not-print-logs-to-the-output-cell</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="c1"># If you don&#39;t check that there&#39;s already a handler, you can have situations with duplicated</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># print outs if you have multiple mesh objects</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">))</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="c1"># Load the transform</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading transform to EPSG:4326&quot;</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_transform_to_epsg_4326</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">transform_filename</span><span class="p">,</span> <span class="n">require_transform</span><span class="o">=</span><span class="n">require_transform</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># Load the mesh with the pyvista loader</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_mesh</span><span class="p">(</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="n">downsample_target</span><span class="o">=</span><span class="n">downsample_target</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="n">ROI_buffer_meters</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="c1"># Load the texture</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading texture&quot;</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="c1"># load IDs_to_labels</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="c1"># if IDs_to_labels not provided, check the directory of the mesh and get the file if found</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="o">.</span><span class="n">__args__</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">possible_json</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_IDs_to_labels.json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">if</span> <span class="n">possible_json</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">possible_json</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="c1"># convert IDs_to_labels from file to dict</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="o">.</span><span class="n">__args__</span><span class="p">):</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span> <span class="n">label</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_texture</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">texture_column_name</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># Setup methods</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_mesh</span><span class="p">(</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">mesh</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">],</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">downsample_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">ROI_simplify_tol_meters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="p">):</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the pyvista mesh and create the texture</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            mesh (typing.Union[PATH_TYPE, pv.PolyData]):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">                Path to the mesh or actual mesh</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            downsample_target (float, optional):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">                What fraction of mesh vertices to downsample to. Defaults to 1.0, (does nothing).</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            ROI:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">                See select_mesh_ROI. Defaults to None</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            ROI_buffer_meters:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">                See select_mesh_ROI. Defaults to 0.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">            ROI_simplify_tol_meters:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">                See select_mesh_ROI. Defaults to 2.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="c1"># Load the mesh using pyvista</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="c1"># TODO see if pytorch3d has faster/more flexible readers. I&#39;d assume no, but it&#39;s good to check</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading the mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Selecting an ROI from mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="c1"># Select a region of interest if needed</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_mesh_ROI</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">region_of_interest</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">buffer_meters</span><span class="o">=</span><span class="n">ROI_buffer_meters</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">simplify_tol_meters</span><span class="o">=</span><span class="n">ROI_simplify_tol_meters</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="c1"># Downsample mesh and transfer active scalars from original mesh to downsampled mesh</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="k">if</span> <span class="n">downsample_target</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="c1"># TODO try decimate_pro and compare quality and runtime</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="c1"># TODO see if there&#39;s a way to preserve the mesh colors</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="c1"># TODO also see this decimation algorithm: https://pyvista.github.io/fast-simplification/</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downsampling the mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="c1"># Have a temporary mesh so we can use the original mesh to transfer the active scalars to the downsampled one</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">downsampled_mesh_without_textures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">decimate</span><span class="p">(</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>                <span class="n">target_reduction</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">downsample_target</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer_texture</span><span class="p">(</span><span class="n">downsampled_mesh_without_textures</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting faces from mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="c1"># See here for format: https://github.com/pyvista/pyvista-support/issues/96</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">transfer_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downsampled_mesh</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transfer texture from original mesh to a downsampled version using KDTree for nearest neighbor point searches</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">            downsampled_mesh (pv.PolyData): The downsampled version of the original mesh</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            pv.PolyData: The downsampled mesh with the transferred textures</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="c1"># Only transfer textures if there are point based scalars in the original mesh</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="c1"># Store original mesh points in KDTree for nearest neighbor search</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">kdtree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="c1"># For ecah point in the downsampled mesh find the nearest neighbor point in the original mesh</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">_</span><span class="p">,</span> <span class="n">nearest_neighbor_indices</span> <span class="o">=</span> <span class="n">kdtree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">downsampled_mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="c1"># Iterate over all the point based scalars</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">for</span> <span class="n">scalar_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="c1"># Retrieve scalar data of appropriate index using the nearest neighbor indices</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="n">transferred_scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">][</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                    <span class="n">nearest_neighbor_indices</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="p">]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="c1"># Set the corresponding scalar data in the downsampled mesh</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">downsampled_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">transferred_scalars</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="c1"># Set active mesh of downsampled mesh</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">downsampled_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="s2">&quot;Textures not transferred, active scalars data is assoicated with cell data not point data&quot;</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">return</span> <span class="n">downsampled_mesh</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_transform_to_epsg_4326</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">transform_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">require_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="p">):</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        Load the 4x4 transform projects points from their local coordnate system into EPSG:4326,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        the earth-centered, earth-fixed coordinate frame. This can either be from a CSV file specifying</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        it directly or extracted from a Metashape camera output</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Args</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            transform_filename (PATH_TYPE):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">            require_transform (bool): Does a local-to-global transform file need to be available&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">            FileNotFoundError: Cannot find texture file</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">            ValueError: Transform file doesn&#39;t have 4x4 matrix</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">if</span> <span class="n">transform_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="k">if</span> <span class="n">require_transform</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Transform is required but not provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="c1"># If not required, do nothing. TODO consider adding a warning</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">return</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">transform_filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.xml&quot;</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="o">=</span> <span class="n">parse_transform_metashape</span><span class="p">(</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">transform_filename</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>            <span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">transform_filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="n">transform_filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                    <span class="sa">f</span><span class="s2">&quot;Transform should be (4,4) but is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="k">if</span> <span class="n">require_transform</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                    <span class="sa">f</span><span class="s2">&quot;Transform could not be loaded from </span><span class="si">{</span><span class="n">transform_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="c1"># Not set</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="k">return</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">standardize_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texture_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="c1"># TODO consider coercing into a numpy array</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="c1"># Check the dimensions</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">if</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="n">texture_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">texture_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">elif</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>                <span class="sa">f</span><span class="s2">&quot;Input texture should have 1 or 2 dimensions but instead has </span><span class="si">{</span><span class="n">texture_array</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>            <span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">return</span> <span class="n">texture_array</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">request_vertex_texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">try_verts_faces_conversion</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="p">):</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>            <span class="k">return</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="c1"># If this is unset, try to infer it</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">if</span> <span class="n">request_vertex_texture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                    <span class="s2">&quot;Ambigious which texture is requested, set request_vertex_texture appropriately&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>                <span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="c1"># Assume that the only one available is being requested</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="n">request_vertex_texture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="k">if</span> <span class="n">request_vertex_texture</span><span class="p">:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize_texture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span><span class="p">)</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="k">elif</span> <span class="n">try_verts_faces_conversion</span><span class="p">:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_vert_texture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span><span class="p">))</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                    <span class="s2">&quot;Vertex texture not present and conversion was not requested&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="p">)</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize_texture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="k">elif</span> <span class="n">try_verts_faces_conversion</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">face_texture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vert_to_face_texture</span><span class="p">(</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_discrete_texture</span><span class="p">()</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                <span class="p">)</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span><span class="n">face_texture</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>                    <span class="s2">&quot;Face texture not present and conversion was not requested&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>                <span class="p">)</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_discrete_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">texture_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="n">all_discrete_texture_values</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">is_vertex_texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">use_derived_IDs_to_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">delete_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="p">):</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the internal texture representation</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">            texture_array (np.ndarray):</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">                The array of texture values. The first dimension must be the length of faces or verts. A second dimension is optional.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">            IDs_to_labels (typing.Union[None, dict], optional): Mapping from integer IDs to string names. Defaults to None.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">            all_discrete_texture_values (typing.Union[typing.List, None], optional):</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">                Are all the texture values known to be discrete, representing IDs. Computed from the data if not set. Defaults to None.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">            is_vertex_texture (typing.Union[bool, None], optional):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">                Are the texture values supposed to correspond to the vertices. Computed from the data if not set. Defaults to None.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">            use_derived_IDs_to_labels (bool, optional): Use IDs to labels derived from data if not explicitly provided. Defaults to False.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">            delete_existing (bool, optional): Delete the existing texture when the other one (face, vertex) is set. Defaults to True.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">            ValueError: If the size of the texture doesn&#39;t match the number of either faces or vertices</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">            ValueError: If the number of faces and vertices are the same and is_vertex_texture isn&#39;t set</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize_texture</span><span class="p">(</span><span class="n">texture_array</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="c1"># IDs_to_labels (typing.Union[None, dict]): Dictionary mapping from integer IDs to string class names</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="c1"># If it is not specified whether this is a vertex texture, attempt to infer it from the shape</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="c1"># TODO consider refactoring to check whether it matches the number of one of them,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="c1"># no matter whether is_vertex_texture is specified</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="k">if</span> <span class="n">is_vertex_texture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="c1"># Check that the number of matches face or verts</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="n">n_values</span> <span class="o">=</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="n">n_verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="k">if</span> <span class="n">n_verts</span> <span class="o">==</span> <span class="n">n_faces</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                    <span class="s2">&quot;Cannot infer whether texture should be applied to vertices of faces because the number is the same&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>                <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="k">elif</span> <span class="n">n_values</span> <span class="o">==</span> <span class="n">n_verts</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="n">is_vertex_texture</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="k">elif</span> <span class="n">n_values</span> <span class="o">==</span> <span class="n">n_faces</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="n">is_vertex_texture</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                    <span class="sa">f</span><span class="s2">&quot;The number of elements in the texture (</span><span class="si">{</span><span class="n">n_values</span><span class="si">}</span><span class="s2">) did not match the number of faces (</span><span class="si">{</span><span class="n">n_faces</span><span class="si">}</span><span class="s2">) or vertices (</span><span class="si">{</span><span class="n">n_verts</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="c1"># Ensure that the actual data type is float, and record label names</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="k">if</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>            <span class="c1"># If it is more than one column, it&#39;s assumed to be a real-valued</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="c1"># quantity and we try to cast it to a float</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">texture_array</span> <span class="o">=</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="n">derived_IDs_to_labels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="n">texture_array</span><span class="p">,</span> <span class="n">derived_IDs_to_labels</span> <span class="o">=</span> <span class="n">ensure_float_labels</span><span class="p">(</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="n">texture_array</span><span class="p">,</span> <span class="n">full_array</span><span class="o">=</span><span class="n">all_discrete_texture_values</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="c1"># If IDs to labels is explicitly provided, trust that</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="c1"># TODO should do some type checking here</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">IDs_to_labels</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="c1"># If not, but we can compute it, use that. Otherwise, we might want to force them to be set to None</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">elif</span> <span class="n">use_derived_IDs_to_labels</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">derived_IDs_to_labels</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="c1"># Set the appropriate texture and optionally delete the other one</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="k">if</span> <span class="n">is_vertex_texture</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="o">=</span> <span class="n">texture_array</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="o">=</span> <span class="n">texture_array</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>            <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_texture</span><span class="p">(</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">texture_column_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="p">):</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets either self.face_texture or self.vertex_texture to an (n_{faces, verts}, m channels) array. Note that the other</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">           one will be left as None</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            texture (typing.Union[PATH_TYPE, np.ndarray, None]): This is either a numpy array or a file to one of the following</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">                * A numpy array file in &quot;.npy&quot; format</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">                * A vector file readable by geopandas and a label(s) specifying which column to use.</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">                  This should be dataset of polygons/multipolygons. Ideally, there should be no overlap between</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">                  regions with different labels. These regions may be assigned based on the order of the rows.</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">                * A raster file readable by rasterio. We may want to support using a subset of bands</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">            texture_column_name: The column to use as the label for a vector data input</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">            IDs_to_labels (typing.Union[None, dict]): Dictionary mapping from integer IDs to string class names</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="c1"># The easy case, a texture is passed in directly</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="n">texture_array</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="c1"># If the texture is None, try to load it from the mesh</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="c1"># Note that this requires us to have not decimated yet</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">elif</span> <span class="n">texture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="c1"># See if the mesh has a texture, else this will be None</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>            <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>                <span class="c1"># Check if this was a really one channel that had to be tiled to</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>                <span class="c1"># three for saving</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">texture_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                    <span class="n">min_val_per_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">texture_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                    <span class="n">max_val_per_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">texture_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">min_val_per_row</span><span class="p">,</span> <span class="n">max_val_per_row</span><span class="p">):</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                        <span class="c1"># This is supposted to be one channel</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                        <span class="n">texture_array</span> <span class="o">=</span> <span class="n">texture_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                        <span class="c1"># Set any values that are the ignore int value to nan</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="n">texture_array</span> <span class="o">=</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="n">texture_array</span><span class="p">[</span><span class="n">texture_array</span> <span class="o">==</span> <span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                    <span class="n">texture_array</span><span class="p">,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                    <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                    <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>                <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">IDs_to_labels</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>                <span class="c1"># Assume that no texture will be needed, consider printing a warning</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No texture provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="c1"># Try handling all the other supported filetypes</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="n">texture_array</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">all_values</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="c1"># Name of scalar in the mesh</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                    <span class="s2">&quot;Trying to read texture as a scalar from the pyvista mesh:&quot;</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                <span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="p">[</span><span class="n">texture</span><span class="p">]</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="c1"># Numpy file</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Trying to read texture as a numpy file:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                    <span class="n">texture_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="c1"># Vector file</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Trying to read texture as vector file:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>                    <span class="c1"># TODO IDs to labels should be used here if set so the computed IDs are aligned with that mapping</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                    <span class="n">texture_array</span><span class="p">,</span> <span class="n">all_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values_for_verts_from_vector</span><span class="p">(</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                        <span class="n">column_names</span><span class="o">=</span><span class="n">texture_column_name</span><span class="p">,</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                        <span class="n">vector_source</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                    <span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">fiona</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DriverError</span><span class="p">):</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="c1"># Raster file</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="c1"># TODO</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Trying to read as texture as raster file: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                    <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vert_values_from_raster_file</span><span class="p">(</span><span class="n">texture</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>                <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="c1"># Error out if not set, since we assume the intent was to have a texture at this point</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load texture for </span><span class="si">{</span><span class="n">texture</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="c1"># This will error if something is wrong with the texture that was loaded</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="n">texture_array</span><span class="p">,</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="n">all_discrete_texture_values</span><span class="o">=</span><span class="n">all_values</span><span class="p">,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_mesh_ROI</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="n">region_of_interest</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="p">],</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="n">buffer_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="n">simplify_tol_meters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="n">default_CRS</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">return_original_IDs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="p">):</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a subset of the mesh based on geospatial data</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">            region_of_interest (typing.Union[gpd.GeoDataFrame, Polygon, MultiPolygon, PATH_TYPE]):</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">                Region of interest. Can be a</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">                * dataframe, where all columns will be colapsed</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">                * A shapely polygon/multipolygon</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">                * A file that can be loaded by geopandas</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">            buffer_meters (float, optional): Expand the geometry by this amount of meters. Defaults to 0.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">            simplify_tol_meters (float, optional): Simplify the geometry using this as the tolerance. Defaults to 0.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">            default_CRS (pyproj.CRS, optional): The CRS to use if one isn&#39;t provided. Defaults to pyproj.CRS.from_epsg(4326).</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">            return_original_IDs (bool, optional): Return the indices into the original mesh. Defaults to False.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">            pyvista.PolyData: The subset of the mesh</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">            np.ndarray: The indices of the points in the original mesh (only if return_original_IDs set)</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">            np.ndarray: The indices of the faces in the original mesh (only if return_original_IDs set)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="k">if</span> <span class="n">region_of_interest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="c1"># Get the ROI into a geopandas GeoDataFrame</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Standardizing ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">region_of_interest</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">,</span> <span class="p">(</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">)):</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">default_CRS</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">region_of_interest</span><span class="p">])</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dissolving ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="c1"># Disolve to ensure there is only one row</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting CRS and buffering ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="c1"># Make sure we&#39;re using a projected CRS so a buffer can be applied</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">ROI_gpd</span><span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="c1"># Apply the buffer, plus the tolerance, to ensure we keep at least the requested region</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="n">ROI_gpd</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_meters</span> <span class="o">+</span> <span class="n">simplify_tol_meters</span><span class="p">)</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="c1"># Simplify the geometry to reduce the computational load</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">simplify_tol_meters</span><span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dissolving buffered ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="c1"># Disolve again in case</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting verts for dataframe&quot;</span><span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="c1"># Get the vertices as a dataframe in the same CRS</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="n">verts_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_verts_geodataframe</span><span class="p">(</span><span class="n">ROI_gpd</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking intersection of verts with ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="c1"># Determine which vertices are within the ROI polygon</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="n">verts_in_ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">verts_df</span><span class="p">,</span> <span class="n">ROI_gpd</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;intersection&quot;</span><span class="p">)</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="c1"># Extract the IDs of the set within the polygon</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">vert_inds</span> <span class="o">=</span> <span class="n">verts_in_ROI</span><span class="p">[</span><span class="s2">&quot;vert_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting points from pyvista mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="c1"># Extract a submesh using these IDs, which is returned as an UnstructuredGrid</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">subset_unstructured_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">extract_points</span><span class="p">(</span><span class="n">vert_inds</span><span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extraction surface from subset mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="c1"># Convert the unstructured grid to a PolyData (mesh) again</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">subset_mesh</span> <span class="o">=</span> <span class="n">subset_unstructured_grid</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">()</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="c1"># If we need the indices into the original mesh, return those</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="k">if</span> <span class="n">return_original_IDs</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="n">point_IDs</span> <span class="o">=</span> <span class="n">subset_unstructured_grid</span><span class="p">[</span><span class="s2">&quot;vtkOriginalPointIds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>                <span class="n">face_IDs</span> <span class="o">=</span> <span class="n">subset_unstructured_grid</span><span class="p">[</span><span class="s2">&quot;vtkOriginalCellIds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>                <span class="n">point_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>                <span class="n">face_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>                <span class="n">subset_mesh</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>                <span class="n">point_IDs</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>                <span class="n">face_IDs</span><span class="p">,</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="p">)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="c1"># Else return just the mesh</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="k">return</span> <span class="n">subset_mesh</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_name</span><span class="p">,</span> <span class="n">label_ID</span><span class="p">):</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="k">if</span> <span class="n">label_ID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span><span class="p">[</span><span class="n">label_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_name</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_IDs_to_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_label_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="s2">&quot;This method will be deprecated in favor of get_IDs_to_labels since it doesn&#39;t handle non-sequential indices&quot;</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="p">)</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="c1"># Vertex methods</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">transform_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform_4x4</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a transform to the vertex coordinates</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">            transform_4x4 (np.ndarray): Transform to be applied</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">            in_place (bool): Should the vertices be updated for all member objects</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="n">homogenous_local_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">transformed_local_points</span> <span class="o">=</span> <span class="n">transform_4x4</span> <span class="o">@</span> <span class="n">homogenous_local_points</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="n">transformed_local_points</span> <span class="o">=</span> <span class="n">transformed_local_points</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>        <span class="c1"># Overwrite existing vertices in both pytorch3d and pyvista mesh</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">transformed_local_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="k">return</span> <span class="n">transformed_local_points</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_vertices_in_CRS</span><span class="p">(</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">output_CRS</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span> <span class="n">force_easting_northing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>    <span class="p">):</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the coordinates of the mesh vertices in a given CRS</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">            output_CRS (pyproj.CRS): The coordinate reference system to transform to</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">            force_easting_northing (bool, optional): Ensure that the returned points are east first, then north</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">            np.ndarray: (n_points, 3)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="c1"># If no CRS is requested, just return the points</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>        <span class="k">if</span> <span class="n">output_CRS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="c1"># The mesh points are defined in an arbitrary local coordinate system but we can transform them to EPGS:4978,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="c1"># the earth-centered, earth-fixed coordinate system, using an included transform</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">epgs4978_verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>        <span class="c1"># TODO figure out why this conversion was required. I think it was some typing issue</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="n">output_CRS</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">output_CRS</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="c1"># Build a pyproj transfrormer from EPGS:4978 to the desired CRS</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="n">transformer</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="n">EARTH_CENTERED_EARTH_FIXED_CRS</span><span class="p">,</span> <span class="n">output_CRS</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="p">)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>        <span class="c1"># Transform the coordinates</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="n">verts_in_output_CRS</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="n">xx</span><span class="o">=</span><span class="n">epgs4978_verts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="n">yy</span><span class="o">=</span><span class="n">epgs4978_verts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="n">zz</span><span class="o">=</span><span class="n">epgs4978_verts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="p">)</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="c1"># Stack and transpose</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="n">verts_in_output_CRS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">verts_in_output_CRS</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>        <span class="c1"># Pyproj respects the CRS axis ordering, which is northing/easting for most projected coordinate systems</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="c1"># This causes headaches because it&#39;s assumed by rasterio and geopandas to be easting/northing</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="c1"># https://rasterio.readthedocs.io/en/stable/api/rasterio.crs.html#rasterio.crs.epsg_treats_as_latlong</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>        <span class="k">if</span> <span class="n">force_easting_northing</span> <span class="ow">and</span> <span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">epsg_treats_as_latlong</span><span class="p">(</span><span class="n">output_CRS</span><span class="p">):</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>            <span class="c1"># Swap first two columns</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="n">verts_in_output_CRS</span> <span class="o">=</span> <span class="n">verts_in_output_CRS</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>        <span class="k">return</span> <span class="n">verts_in_output_CRS</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_verts_geodataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtain the vertices as a dataframe</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">            crs (pyproj.CRS): The CRS to use</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">            gpd.GeoDataFrame: A dataframe with all the vertices</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>        <span class="c1"># Get the vertices in the same CRS as the geofile</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="n">verts_in_geopolygon_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>            <span class="p">{</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>                <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="n">verts_in_geopolygon_crs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>                <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="n">verts_in_geopolygon_crs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>            <span class="p">}</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>        <span class="p">)</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="c1"># Create a column of Point objects to use as the geometry</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;north&quot;</span><span class="p">])</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>        <span class="n">points</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="c1"># Add an index column because the normal index will not be preserved in future operations</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>        <span class="n">points</span><span class="p">[</span><span class="n">VERT_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="k">return</span> <span class="n">points</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_faces_2d_gdf</span><span class="p">(</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="n">crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">include_3d_2d_ratio</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">data_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">faces_mask</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="n">cache_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a geodataframe of triangles for the 2D projection of each face of the mesh</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">            crs (pyproj.CRS):</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">                Coordinate reference system of the dataframe</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">            include_3d_2d_ratio (bool, optional):</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">                Compute the ratio of the 3D area of the face to the 2D area. This relates to the</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">                slope of the face relative to horizontal. The computed data will be stored in the</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">                column corresponding to the value of RATIO_3D_2D_KEY. Defaults to False.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">            data_dict (dict, optional):</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">                Additional information to add to the dataframe. It must be a dict where the keys</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">                are the names of the columns and the data is a np.ndarray of n_faces elemenets.</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">                Defaults to {}.</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">            faces_mask (typing.Union[np.ndarray, None], optional):</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">                A binary mask corresponding to which faces to return. Used to improve runtime of</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">                creating the dataframe or downstream steps. Defaults to None.</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">            cache_data (bool):</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">                Whether to cache expensive results in memory as object attributes. Defaults to False.</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">            geopandas.GeoDataFrame: A dataframe for each triangular face</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="c1"># Computing this data can be slow, and we might call it multiple times. This is especially</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="c1"># true for doing clustered polygon labeling</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>            <span class="n">mesh_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_hash</span><span class="p">()</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="n">transform_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform_hash</span><span class="p">()</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="n">faces_mask_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                <span class="n">faces_mask</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="k">if</span> <span class="n">faces_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="p">)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>            <span class="c1"># Create a key that uniquely identifies the relavant inputs</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>            <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">mesh_hash</span><span class="p">,</span> <span class="n">transform_hash</span><span class="p">,</span> <span class="n">faces_mask_hash</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>            <span class="c1"># See if the face polygons were in the cache. If not, None will be returned</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>            <span class="n">cached_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_polygons_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="n">cached_values</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="k">if</span> <span class="n">cached_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="n">face_polygons</span><span class="p">,</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">cached_values</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using cached face polygons&quot;</span><span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing faces in working CRS&quot;</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>            <span class="c1"># Get the mesh vertices in the desired export CRS</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>            <span class="n">verts_in_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>            <span class="c1"># Get a triangle in geospatial coords for each face</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>            <span class="c1"># (n_faces, 3 points, xyz)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>            <span class="n">faces</span> <span class="o">=</span> <span class="n">verts_in_crs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>            <span class="c1"># Select only the requested faces</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>            <span class="k">if</span> <span class="n">faces_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>                <span class="n">faces</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">faces_mask</span><span class="p">]</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="c1"># Extract the first two columns and convert them to a list of tuples of tuples</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="n">faces_2d_tuples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]]</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="n">face_polygons</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>                <span class="n">Polygon</span><span class="p">(</span><span class="n">face_tuple</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>                <span class="k">for</span> <span class="n">face_tuple</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                    <span class="n">faces_2d_tuples</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Converting faces to polygons&quot;</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>                <span class="p">)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>            <span class="p">]</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating dataframe of faces&quot;</span><span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>            <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>                <span class="c1"># Save computed data to the cache for the future</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">face_polygons_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">face_polygons</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="c1"># Remove data corresponding to masked faces</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>        <span class="k">if</span> <span class="n">faces_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">faces_mask</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="c1"># Compute the ratio between the 3D area and the projected top-down 2D area</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="k">if</span> <span class="n">include_3d_2d_ratio</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>                <span class="c1"># Check if ratios are cached</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>                <span class="n">ratios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_2d_3d_ratios_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>                <span class="n">ratios</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="c1"># Ratios need to be computed</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="k">if</span> <span class="n">ratios</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing ratio of 3d to 2d area&quot;</span><span class="p">):</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                    <span class="n">area</span><span class="p">,</span> <span class="n">area_2d</span> <span class="o">=</span> <span class="n">compute_3D_triangle_area</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span> <span class="o">/</span> <span class="n">area_2d</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>                <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">face_2d_3d_ratios_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="c1"># Add the ratios to the data dict</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="n">data_dict</span><span class="p">[</span><span class="n">RATIO_3D_2D_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>        <span class="c1"># Create the dataframe</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="n">faces_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>            <span class="n">data</span><span class="o">=</span><span class="n">data_dict</span><span class="p">,</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>            <span class="n">geometry</span><span class="o">=</span><span class="n">face_polygons</span><span class="p">,</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>        <span class="k">return</span> <span class="n">faces_gdf</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>    <span class="c1"># Transform labels face&lt;-&gt;vertex methods</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">face_to_vert_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_IDs</span><span class="p">):</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">            face_IDs (np.array): (n_faces,) The integer IDs of the faces</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>        <span class="c1"># TODO figure how to have a NaN class that</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="c1"># Find which faces are using this vertex</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="n">matching</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="c1"># matching_inds = np.where(matching)[0]</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>            <span class="c1"># matching_IDs = face_IDs[matching_inds]</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="c1"># most_common_ind = Counter(matching_IDs).most_common(1)</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vert_to_face_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vert_IDs</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="k">if</span> <span class="n">vert_IDs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">)</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="n">vert_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">vert_IDs</span><span class="p">)</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="k">if</span> <span class="n">vert_IDs</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">discrete</span><span class="p">:</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>                <span class="sa">f</span><span class="s2">&quot;Can only perform discrete conversion with one dimensional array but instead had </span><span class="si">{</span><span class="n">vert_IDs</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="p">)</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="c1"># Each row contains the IDs of each vertex</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="n">values_per_face</span> <span class="o">=</span> <span class="n">vert_IDs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">]</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="k">if</span> <span class="n">discrete</span><span class="p">:</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>            <span class="c1"># Now we need to &quot;vote&quot; for the best one</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>            <span class="n">max_ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vert_IDs</span><span class="p">)</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>            <span class="c1"># This means that all textures are nans</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">max_ID</span><span class="p">):</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>                    <span class="s2">&quot;In vertex to face texture conversion, all nans encountered&quot;</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>                <span class="p">)</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>                <span class="c1"># Return all nans</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">values_per_face</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>            <span class="n">max_ID</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_ID</span><span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>            <span class="c1"># TODO consider using unique if these indices are sparse</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>            <span class="n">counts_per_class_per_face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">values_per_face</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_ID</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="c1"># Check which entires had no classes reported and mask them out</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="c1"># TODO consider removing these rows beforehand</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="n">zeros_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">counts_per_class_per_face</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="c1"># We want to fairly tiebreak since np.argmax will always take th first index</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>            <span class="c1"># This is hard to do in a vectorized way, so we just add a small random value</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="c1"># independently to each element</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">counts_per_class_per_face</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>                <span class="n">counts_per_class_per_face</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">counts_per_class_per_face</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>            <span class="p">)</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>            <span class="n">most_common_class_per_face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>                <span class="n">counts_per_class_per_face</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="c1"># Set any faces with zero counts to nan</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="n">most_common_class_per_face</span><span class="p">[</span><span class="n">zeros_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>            <span class="k">return</span> <span class="n">most_common_class_per_face</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span class="n">average_value_per_face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values_per_face</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="k">return</span> <span class="n">average_value_per_face</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>    <span class="c1"># Operations on vector data</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_values_for_verts_from_vector</span><span class="p">(</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="n">vector_source</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">],</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="n">column_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the value from a dataframe for each vertex</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">            vector_source (typing.Union[gpd.GeoDataFrame, PATH_TYPE]): geo data frame or path to data that can be loaded by geopandas</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">            column_names (typing.Union[str, typing.List[str]]): Which columns to obtain data from</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">            np.ndarray: Array of values for each vertex if there is one column name or</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">            dict[np.ndarray]: A dict mapping from column names to numpy arrays</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="c1"># Lead the vector data if not already provided in memory</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_source</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="n">gdf</span> <span class="o">=</span> <span class="n">vector_source</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>            <span class="c1"># This will error if not readable</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vector_source</span><span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>        <span class="c1"># Infer or standardize the column names</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>            <span class="c1"># Check if there is only one real column</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>                <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>                <span class="c1"># Log as well since this may be caught by an exception handler,</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>                <span class="c1"># and it&#39;s a user error that can be corrected</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                    <span class="s2">&quot;No column name provided and ambigious which column to use&quot;</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                <span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                    <span class="s2">&quot;No column name provided and ambigious which column to use&quot;</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>                <span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>        <span class="c1"># If only one column is provided, make it a one-length list</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_names</span><span class="p">]</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>        <span class="c1"># Get a dataframe of vertices</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>        <span class="n">verts_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_verts_geodataframe</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>        <span class="c1"># See which vertices are in the geopolygons</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>        <span class="n">points_in_polygons_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">verts_df</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;intersection&quot;</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="c1"># Get the index array</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>        <span class="n">index_array</span> <span class="o">=</span> <span class="n">points_in_polygons_gdf</span><span class="p">[</span><span class="n">VERT_ID</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>        <span class="c1"># This is one entry per vertex</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="n">labeled_verts_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>        <span class="n">all_values_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="c1"># Extract the data from each</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>        <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>            <span class="c1"># Create an array corresponding to all the points and initialize to NaN</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="n">column_values</span> <span class="o">=</span> <span class="n">points_in_polygons_gdf</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>            <span class="c1"># TODO clean this up</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>            <span class="k">if</span> <span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">or</span> <span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">):</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>                <span class="c1"># TODO be set to the default value for the type of the column</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>                <span class="n">null_value</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>            <span class="k">elif</span> <span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>                <span class="n">null_value</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>                <span class="n">null_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>            <span class="c1"># Create an array, one per vertex, with the null value</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>                <span class="n">shape</span><span class="o">=</span><span class="n">verts_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>                <span class="n">dtype</span><span class="o">=</span><span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>                <span class="n">fill_value</span><span class="o">=</span><span class="n">null_value</span><span class="p">,</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="p">)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>            <span class="c1"># Assign the labeled values</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="n">values</span><span class="p">[</span><span class="n">index_array</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_values</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>            <span class="c1"># Record the results</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>            <span class="n">labeled_verts_dict</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>            <span class="n">all_values_dict</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="c1"># If only one name was requested, just return that</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="n">labeled_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labeled_verts_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>            <span class="n">all_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_values_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="k">return</span> <span class="n">labeled_verts</span><span class="p">,</span> <span class="n">all_values</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="c1"># Else return a dict of all requested values</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="k">return</span> <span class="n">labeled_verts_dict</span><span class="p">,</span> <span class="n">all_values_dict</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_IDs_to_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savepath</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">):</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;saves the contents of the IDs_to_labels to the file savepath provided</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">            savepath (PATH_TYPE): path to the file where the data must be saved</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="c1"># Save the classes filename</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete_texture</span><span class="p">():</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;discrete texture, saving classes&quot;</span><span class="p">)</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving IDs_to_labels to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile_h</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">(),</span> <span class="n">outfile_h</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>                <span class="p">)</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;non-discrete texture, not saving classes&quot;</span><span class="p">)</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savepath</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">save_vert_texture</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="c1"># TODO consider moving most of this functionality to a utils file</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="k">if</span> <span class="n">save_vert_texture</span><span class="p">:</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>            <span class="n">vert_texture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span><span class="n">request_vertex_texture</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>            <span class="n">n_channels</span> <span class="o">=</span> <span class="n">vert_texture</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>            <span class="k">if</span> <span class="n">n_channels</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>                <span class="n">vert_texture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">vert_texture</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">)</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>                <span class="n">vert_texture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">vert_texture</span><span class="p">,</span> <span class="n">reps</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>            <span class="k">if</span> <span class="n">n_channels</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                    <span class="s2">&quot;Too many channels to save, attempting to treat them as class probabilities and take the argmax&quot;</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                <span class="p">)</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                <span class="c1"># Take the argmax</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                <span class="n">vert_texture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">vert_texture</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                <span class="c1"># Replace nan with 255</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                <span class="n">vert_texture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">vert_texture</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">)</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                <span class="c1"># Expand to the right number of channels</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                <span class="n">vert_texture</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">vert_texture</span><span class="p">,</span> <span class="n">repeats</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="n">vert_texture</span> <span class="o">=</span> <span class="n">vert_texture</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="n">vert_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="c1"># Create folder if it doesn&#39;t exist</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="c1"># Actually save the mesh</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">texture</span><span class="o">=</span><span class="n">vert_texture</span><span class="p">)</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_IDs_to_labels</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_IDs_to_labels.json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_polygons</span><span class="p">(</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>        <span class="n">face_labels</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>        <span class="n">polygons</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">],</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>        <span class="n">face_weighting</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="n">sjoin_overlay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">return_class_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>        <span class="n">unknown_class_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="n">buffer_dist_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="p">):</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Assign a class label to polygons using labels per face</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">            face_labels (np.ndarray): (n_faces,) array of integer labels</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">            polygons (typing.Union[PATH_TYPE, gpd.GeoDataFrame]): Geospatial polygons to be labeled</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="sd">            face_weighting (typing.Union[None, np.ndarray], optional):</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">                (n_faces,) array of scalar weights for each face, to be multiplied with the</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">                contribution of this face. Defaults to None.</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">            sjoin_overlay (bool, optional):</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">                Whether to use `gpd.sjoin` or `gpd.overlay` to compute the overlay. Sjoin is</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">                substaintially faster, but only uses mesh faces that are entirely within the bounds</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">                of the polygon, rather than computing the intersecting region for</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">                partially-overlapping faces. Defaults to True.</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">            return_class_labels: (bool, optional):</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">                Return string representation of class labels rather than float. Defaults to True.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">            unknown_class_label (str, optional):</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">                Label for predicted class for polygons with no overlapping faces. Defaults to &quot;unknown&quot;.</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">            buffer_dist_meters: (Union[float, None], optional)</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">                Only applicable if sjoin_overlay=False. In that case, include faces entirely within</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">                the region that is this distance in meters from the polygons. Defaults to 2.0.</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="sd">            ValueError: if faces_labels or face_weighting is not 1D</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">            list(typing.Union[str, int]):</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">                (n_polygons,) list of labels. Either float values, represnting integer IDs or nan,</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">                or string values representing the class label</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>        <span class="c1"># Premptive error checking before expensive operations</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>        <span class="n">face_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>        <span class="k">if</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>                <span class="sa">f</span><span class="s2">&quot;Faces labels must be one-dimensional, but is </span><span class="si">{</span><span class="n">face_labels</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>            <span class="p">)</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="k">if</span> <span class="n">face_weighting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>            <span class="n">face_weighting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">face_weighting</span><span class="p">)</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>            <span class="k">if</span> <span class="n">face_weighting</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                    <span class="sa">f</span><span class="s2">&quot;Faces labels must be one-dimensional, but is </span><span class="si">{</span><span class="n">face_weighting</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                <span class="p">)</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="c1"># Ensure that the input is a geopandas dataframe</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>        <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">coerce_to_geoframe</span><span class="p">(</span><span class="n">polygons</span><span class="p">))</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="c1"># Extract just the geometry</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">polygons_gdf</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="c1"># Only get faces for which there is a non-nan label. Otherwise it is just additional compute</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="n">faces_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>        <span class="c1"># Get the faces of the mesh as a geopandas dataframe</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>        <span class="c1"># Include the predicted face labels as a column in the dataframe</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>        <span class="n">faces_2d_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_faces_2d_gdf</span><span class="p">(</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>            <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>            <span class="n">include_3d_2d_ratio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>            <span class="n">data_dict</span><span class="o">=</span><span class="p">{</span><span class="n">CLASS_ID_KEY</span><span class="p">:</span> <span class="n">face_labels</span><span class="p">},</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>            <span class="n">faces_mask</span><span class="o">=</span><span class="n">faces_mask</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>            <span class="n">cache_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>        <span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>        <span class="c1"># If a per-face weighting is provided, multiply that with the 3d to 2d ratio</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>        <span class="k">if</span> <span class="n">face_weighting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>            <span class="n">face_weighting</span> <span class="o">=</span> <span class="n">face_weighting</span><span class="p">[</span><span class="n">faces_mask</span><span class="p">]</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="s2">&quot;face_weighting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="n">RATIO_3D_2D_KEY</span><span class="p">]</span> <span class="o">*</span> <span class="n">face_weighting</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="p">)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="c1"># If not, just use the ratio</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="s2">&quot;face_weighting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="n">RATIO_3D_2D_KEY</span><span class="p">]</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="c1"># Set the precision to avoid approximate coliniearity errors</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>        <span class="n">faces_2d_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="n">faces_2d_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mf">1e-6</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>        <span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>        <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>            <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mf">1e-6</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>        <span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>        <span class="c1"># Set the ID field so it&#39;s available after the overlay operation</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="c1"># Note that polygons_gdf.index is a bad choice, because this df could be a subset of another</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>        <span class="c1"># one and the index would not start from 0</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>        <span class="n">polygons_gdf</span><span class="p">[</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">))</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>        <span class="c1"># Since overlay is expensive, we first discard faces that are not near the polygons</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>        <span class="c1"># Dissolve the polygons to form one ROI</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>        <span class="n">merged_polygons</span> <span class="o">=</span> <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>        <span class="c1"># Try to decrease the number of elements in the polygon by expanding</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>        <span class="c1"># and then simplifying the number of elements in the polygon</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>        <span class="n">merged_polygons</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">merged_polygons</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_dist_meters</span><span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>        <span class="n">merged_polygons</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">merged_polygons</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">buffer_dist_meters</span><span class="p">)</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>        <span class="c1"># Determine which face IDs intersect the ROI. This is slow</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to subset to ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>        <span class="c1"># Check which faces are fully within the buffered regions around the query polygons</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>        <span class="c1"># Note that using sjoin has been faster than any other approach I&#39;ve tried, despite seeming</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="c1"># to compute more information than something like gpd.within</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="n">contained_faces</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>            <span class="n">faces_2d_gdf</span><span class="p">,</span> <span class="n">merged_polygons</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;within&quot;</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span class="p">)[</span><span class="s2">&quot;index_right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>        <span class="n">faces_2d_gdf</span> <span class="o">=</span> <span class="n">faces_2d_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">contained_faces</span><span class="p">]</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subset to ROI in </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting `overlay`&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>        <span class="k">if</span> <span class="n">sjoin_overlay</span><span class="p">:</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>            <span class="n">overlay</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>                <span class="n">faces_2d_gdf</span><span class="p">,</span> <span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;within&quot;</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>            <span class="p">)</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlay time with gpd.sjoin: </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>            <span class="c1"># Drop faces not included</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>            <span class="n">overlay</span> <span class="o">=</span> <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>                <span class="n">faces_2d_gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">keep_geom_type</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>            <span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlay time with gpd.overlay: </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>        <span class="c1"># Drop nan, for geometries that don&#39;t intersect the polygons</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>        <span class="n">overlay</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>        <span class="c1"># Compute the weighted area for each face, which may have been broken up by the overlay</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>        <span class="n">overlay</span><span class="p">[</span><span class="s2">&quot;weighted_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">overlay</span><span class="p">[</span><span class="s2">&quot;face_weighting&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>        <span class="c1"># Extract only the neccessary columns</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>        <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">,</span> <span class="n">CLASS_ID_KEY</span><span class="p">,</span> <span class="s2">&quot;weighted_area&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>        <span class="n">aggregated_data</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">,</span> <span class="n">CLASS_ID_KEY</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>        <span class="c1"># Compute the highest weighted class prediction</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>        <span class="c1"># Modified from https://stackoverflow.com/questions/27914360/python-pandas-idxmax-for-multiple-indexes-in-a-dataframe</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>        <span class="n">max_rows</span> <span class="o">=</span> <span class="n">aggregated_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>            <span class="n">aggregated_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>                <span class="s2">&quot;weighted_area&quot;</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>            <span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>        <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>        <span class="c1"># Make the class predictions a list of IDs with nans where no information is available</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>        <span class="n">pred_subset_IDs</span> <span class="o">=</span> <span class="n">max_rows</span><span class="p">[</span><span class="n">CLASS_ID_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>        <span class="n">pred_subset_IDs</span><span class="p">[</span><span class="n">max_rows</span><span class="p">[</span><span class="s2">&quot;weighted_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="n">predicted_class_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="n">predicted_class_IDs</span><span class="p">[</span><span class="n">max_rows</span><span class="p">[</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>            <span class="n">pred_subset_IDs</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>        <span class="n">predicted_class_IDs</span> <span class="o">=</span> <span class="n">predicted_class_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="c1"># Post-process to string label names if requested and IDs_to_labels exists</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="k">if</span> <span class="n">return_class_labels</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="p">(</span><span class="n">IDs_to_labels</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>        <span class="p">):</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>            <span class="c1"># convert the IDs into labels</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>            <span class="c1"># Any label marked as nan is set to the unknown class label, since we had no predictions for it</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>            <span class="n">predicted_class_IDs</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>                <span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">unknown_class_label</span><span class="p">)</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>                <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">predicted_class_IDs</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>            <span class="p">]</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>        <span class="k">return</span> <span class="n">predicted_class_IDs</span>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">export_face_labels_vector</span><span class="p">(</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="n">face_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="n">export_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>        <span class="n">export_crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span> <span class="o">=</span> <span class="n">LAT_LON_CRS</span><span class="p">,</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>        <span class="n">label_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>        <span class="n">ensure_non_overlapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>        <span class="n">simplify_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="n">drop_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>        <span class="n">vis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="n">batched_unary_union_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>            <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">500000</span><span class="p">,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>            <span class="s2">&quot;sort_by_loc&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>            <span class="s2">&quot;grid_size&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            <span class="s2">&quot;simplify_tol&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>        <span class="p">},</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>        <span class="n">vis_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Export the labels for each face as a on-per-class multipolygon</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">            face_labels (np.ndarray):</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="sd">                This can either be a 1- or 2-D array. If 1-D, it is (n_faces,) where each element</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a><span class="sd">                is an integer class label for that face. If 2-D, it&#39;s (n_faces, n_classes) and a</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">                nonzero element at (i, j) represents a class prediction for the ith faces and jth</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="sd">                class</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">            export_file (PATH_TYPE, optional):</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">                Where to export. The extension must be a filetype that geopandas can write.</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><span class="sd">                Defaults to None, if unset, nothing will be written.</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">            export_crs (pyproj.CRS, optional): What CRS to export in.. Defaults to pyproj.CRS.from_epsg(4326), lat lon.</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">            label_names (typing.Tuple, optional): Optional names, that are indexed by the labels. Defaults to None.</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">            ensure_non_overlapping (bool, optional): Should regions where two classes are predicted at different z heights be assigned to one class</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">            simplify_tol: (float, optional): Tolerence in meters to use to simplify geometry</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">            drop_nan (bool, optional): Don&#39;t export the nan class, often used for background</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="sd">            vis: should the result be visualzed</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="sd">            batched_unary_union_kwargs (dict, optional): Keyword arguments for batched_unary_union_call</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="sd">            vis_kwargs: keyword argmument dict for visualization</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">            ValueError: If the wrong number of faces labels are provided</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">            gpd.GeoDataFrame: Merged data</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>        <span class="c1"># Compute the working projected CRS</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>        <span class="c1"># This is important because having things in meters makes things easier</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing working CRS&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">output_CRS</span><span class="o">=</span><span class="n">LAT_LON_CRS</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>        <span class="n">working_CRS</span> <span class="o">=</span> <span class="n">get_projected_CRS</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>        <span class="c1"># Try to extract face labels if not set</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>        <span class="k">if</span> <span class="n">face_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>            <span class="n">face_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span><span class="n">request_vertex_texture</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>        <span class="c1"># Check that the correct number of labels are provided</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>        <span class="k">if</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>        <span class="c1"># Get the geospatial faces dataframe</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>        <span class="n">faces_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_faces_2d_gdf</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">working_CRS</span><span class="p">)</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating dataframe of multipolygons&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>        <span class="c1"># Check how the data is represented, as a 1-D list of integers or one/many-hot encoding</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>        <span class="n">face_labels_is_2d</span> <span class="o">=</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="k">if</span> <span class="n">face_labels_is_2d</span><span class="p">:</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>            <span class="c1"># Non-null columns</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>            <span class="n">unique_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">face_labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>            <span class="n">face_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>            <span class="n">unique_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>        <span class="k">if</span> <span class="n">drop_nan</span><span class="p">:</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>            <span class="c1"># Drop nan from the list of IDs</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>            <span class="n">unique_IDs</span> <span class="o">=</span> <span class="n">unique_IDs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">unique_IDs</span><span class="p">)]</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>        <span class="n">multipolygon_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>        <span class="c1"># For each unique ID, aggregate all the faces together</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>        <span class="c1"># This is the same as geopandas.groupby, but that is slow and can out of memory easily</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>        <span class="c1"># due to the large number of polygons</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>        <span class="c1"># Instead, we replace the default shapely.unary_union with our batched implementation</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>        <span class="k">for</span> <span class="n">unique_ID</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">unique_IDs</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Merging faces for each class&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>            <span class="k">if</span> <span class="n">face_labels_is_2d</span><span class="p">:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>                <span class="c1"># Nonzero elements of the column</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>                <span class="n">matching_face_mask</span> <span class="o">=</span> <span class="n">face_labels</span><span class="p">[:,</span> <span class="n">unique_ID</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>                <span class="c1"># Elements that match the ID in question</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>                <span class="n">matching_face_mask</span> <span class="o">=</span> <span class="n">face_labels</span> <span class="o">==</span> <span class="n">unique_ID</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>            <span class="n">matching_face_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">matching_face_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="n">matching_face_polygons</span> <span class="o">=</span> <span class="n">faces_gdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">matching_face_inds</span><span class="p">]</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>            <span class="n">list_of_polygons</span> <span class="o">=</span> <span class="n">matching_face_polygons</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="n">multipolygon</span> <span class="o">=</span> <span class="n">batched_unary_union</span><span class="p">(</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>                <span class="n">list_of_polygons</span><span class="p">,</span> <span class="o">**</span><span class="n">batched_unary_union_kwargs</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>            <span class="p">)</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>            <span class="n">multipolygon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multipolygon</span><span class="p">)</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>        <span class="n">working_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>            <span class="p">{</span><span class="n">CLASS_ID_KEY</span><span class="p">:</span> <span class="n">unique_IDs</span><span class="p">},</span> <span class="n">geometry</span><span class="o">=</span><span class="n">multipolygon_list</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">working_CRS</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>        <span class="p">)</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>        <span class="k">if</span> <span class="n">label_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="p">(</span><span class="n">label_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ID</span><span class="p">)]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;nan&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">working_gdf</span><span class="p">[</span><span class="n">CLASS_ID_KEY</span><span class="p">]</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>            <span class="p">]</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>            <span class="n">working_gdf</span><span class="p">[</span><span class="n">CLASS_NAMES_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>        <span class="c1"># Simplify the output geometry</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>        <span class="k">if</span> <span class="n">simplify_tol</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running simplification&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>            <span class="n">working_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">working_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">simplify_tol</span><span class="p">)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>        <span class="c1"># Make sure that the polygons are non-overlapping</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>        <span class="k">if</span> <span class="n">ensure_non_overlapping</span><span class="p">:</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>            <span class="c1"># TODO create a version that tie-breaks based on the number of predicted faces for each</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>            <span class="c1"># class and optionally the ratios of 3D to top-down areas for the input triangles.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ensuring non-overlapping polygons&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>            <span class="n">working_gdf</span> <span class="o">=</span> <span class="n">ensure_non_overlapping_polygons</span><span class="p">(</span><span class="n">working_gdf</span><span class="p">)</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>        <span class="c1"># Transform from the working crs to export crs</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>        <span class="n">export_gdf</span> <span class="o">=</span> <span class="n">working_gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">export_crs</span><span class="p">)</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="c1"># Export if a file is provided</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>        <span class="k">if</span> <span class="n">export_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>            <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">export_file</span><span class="p">)</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>            <span class="n">export_gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">export_file</span><span class="p">)</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>        <span class="c1"># Vis if requested</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>        <span class="k">if</span> <span class="n">vis</span><span class="p">:</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>            <span class="n">export_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>                <span class="n">column</span><span class="o">=</span><span class="n">CLASS_NAMES_KEY</span> <span class="k">if</span> <span class="n">label_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">CLASS_ID_KEY</span><span class="p">,</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>                <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>                <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>                <span class="o">**</span><span class="n">vis_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>            <span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>        <span class="k">return</span> <span class="n">export_gdf</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>    <span class="c1"># Operations on raster files</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_vert_values_from_raster_file</span><span class="p">(</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>        <span class="n">raster_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>        <span class="n">return_verts_in_CRS</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>        <span class="n">nodata_fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>    <span class="p">):</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the height above groun for each point on the mesh</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a><span class="sd">            raster_file (PATH_TYPE, optional): The path to the geospatial raster file.</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a><span class="sd">            return_verts_in_CRS (bool, optional): Return the vertices transformed into the raster CRS</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a><span class="sd">            nodata_fill_value (float, optional): Set data defined by the opened file as NODATAVAL to this value</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">            np.ndarray: samples from raster. Either (n_verts,) or (n_verts, n_raster_channels)</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">            np.ndarray (optional): (n_verts, 3) the vertices in the raster CRS</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>        <span class="c1"># Open the DTM file</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>        <span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_file</span><span class="p">)</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>        <span class="c1"># Get the mesh points in the coordinate reference system of the DTM</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>        <span class="n">verts_in_raster_CRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>            <span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">force_easting_northing</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>        <span class="p">)</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>        <span class="c1"># Get the points as a list</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>        <span class="n">easting_points</span> <span class="o">=</span> <span class="n">verts_in_raster_CRS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>        <span class="n">northing_points</span> <span class="o">=</span> <span class="n">verts_in_raster_CRS</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>        <span class="c1"># Zip them together</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>        <span class="n">zipped_locations</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">easting_points</span><span class="p">,</span> <span class="n">northing_points</span><span class="p">)</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="n">sampling_iter</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>            <span class="n">zipped_locations</span><span class="p">,</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>            <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sampling values from raster </span><span class="si">{</span><span class="n">raster_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>            <span class="n">total</span><span class="o">=</span><span class="n">verts_in_raster_CRS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>        <span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>        <span class="c1"># Sample the raster file and squeeze if single channel</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>        <span class="n">sampled_raster_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sampling_iter</span><span class="p">))))</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>        <span class="c1"># Set nodata locations to nan</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>        <span class="c1"># TODO figure out if it will ever be a problem to take the first value</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>        <span class="n">sampled_raster_values</span><span class="p">[</span><span class="n">sampled_raster_values</span> <span class="o">==</span> <span class="n">raster</span><span class="o">.</span><span class="n">nodatavals</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>            <span class="n">nodata_fill_value</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>        <span class="p">)</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="k">if</span> <span class="n">return_verts_in_CRS</span><span class="p">:</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>            <span class="k">return</span> <span class="n">sampled_raster_values</span><span class="p">,</span> <span class="n">verts_in_raster_CRS</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>        <span class="k">return</span> <span class="n">sampled_raster_values</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_height_above_ground</span><span class="p">(</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">DTM_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return height above ground for a points in the mesh and a given DTM</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">            DTM_file (PATH_TYPE): Path to the digital terrain model raster</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">            threshold (float, optional):</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">                If not None, return a boolean mask for points under this height. Defaults to None.</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">            np.ndarray: Either the height above ground or a boolean mask for ground points</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="c1"># Get the height from the DTM and the points in the same CRS</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>        <span class="n">DTM_heights</span><span class="p">,</span> <span class="n">verts_in_raster_CRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vert_values_from_raster_file</span><span class="p">(</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>            <span class="n">DTM_file</span><span class="p">,</span> <span class="n">return_verts_in_CRS</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>        <span class="p">)</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>        <span class="c1"># Extract the vertex height as the third channel</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>        <span class="n">verts_height</span> <span class="o">=</span> <span class="n">verts_in_raster_CRS</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>        <span class="c1"># Subtract the two to get the height above ground</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>        <span class="n">height_above_ground</span> <span class="o">=</span> <span class="n">verts_height</span> <span class="o">-</span> <span class="n">DTM_heights</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>        <span class="c1"># If the threshold is not None, return a boolean mask that is true for ground points</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>            <span class="c1"># Return boolean mask</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>            <span class="c1"># TODO see if this will break for nan values</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>            <span class="k">return</span> <span class="n">height_above_ground</span> <span class="o">&lt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>        <span class="c1"># Return height above ground</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>        <span class="k">return</span> <span class="n">height_above_ground</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">label_ground_class</span><span class="p">(</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="n">DTM_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="n">height_above_ground_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>        <span class="n">labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>        <span class="n">only_label_existing_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>        <span class="n">ground_class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ground&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>        <span class="n">ground_ID</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="n">set_mesh_texture</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a><span class="sd">        Set vertices to a potentially-new class with a thresholded height above the DTM.</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a><span class="sd">        TODO, consider handling face textures as well</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a><span class="sd">            DTM_file (PATH_TYPE): Path to the DTM file</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a><span class="sd">            height_above_ground_threshold (float): Height (meters) above that DTM that points below are considered ground</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a><span class="sd">            labels (typing.Union[None, np.ndarray], optional): Vertex texture, otherwise will be queried from mesh. Defaults to None.</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a><span class="sd">            only_label_existing_labels (bool, optional): Only label points that already have non-null labels. Defaults to True.</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a><span class="sd">            ground_class_name (str, optional): The potentially-new ground class name. Defaults to &quot;ground&quot;.</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a><span class="sd">            ground_ID (typing.Union[None, int], optional): What value to use for the ground class. Will be set inteligently if not provided. Defaults to None.</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="sd">            np.ndarray: The updated labels</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>            <span class="c1"># Default to using vertex labels since it&#39;s the native way to check height above the DTM</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>            <span class="n">use_vertex_labels</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>        <span class="k">elif</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>            <span class="c1"># Check the size of the input labels and set what type they are. Note this could override existing value</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>            <span class="k">if</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>                <span class="n">use_vertex_labels</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>            <span class="k">elif</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                <span class="n">use_vertex_labels</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                    <span class="s2">&quot;Labels were provided but didn&#39;t match the shape of vertices or faces&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>                <span class="p">)</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="c1"># if a labels are not provided, get it from the mesh</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>            <span class="c1"># Get the vertex textures from the mesh</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>                <span class="n">request_vertex_texture</span><span class="o">=</span><span class="n">use_vertex_labels</span><span class="p">,</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>            <span class="p">)</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>        <span class="c1"># Compute which vertices are part of the ground by thresholding the height above the DTM</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>        <span class="n">ground_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_height_above_ground</span><span class="p">(</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>            <span class="n">DTM_file</span><span class="o">=</span><span class="n">DTM_file</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">height_above_ground_threshold</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>        <span class="p">)</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>        <span class="c1"># If we needed a mask for the faces, compute that instead</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_vertex_labels</span><span class="p">:</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>            <span class="n">ground_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vert_to_face_texture</span><span class="p">(</span><span class="n">ground_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                <span class="nb">bool</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>            <span class="p">)</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>        <span class="c1"># Replace only vertices that were previously labeled as something else, to avoid class imbalance</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>        <span class="k">if</span> <span class="n">only_label_existing_labels</span><span class="p">:</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>            <span class="c1"># Find which vertices are labeled</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>            <span class="n">is_labeled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>            <span class="c1"># Find which points are ground that were previously labeled as something else</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="n">ground_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">is_labeled</span><span class="p">,</span> <span class="n">ground_mask</span><span class="p">)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>        <span class="c1"># Get the existing label names</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>        <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">()</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>        <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ground_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>            <span class="c1"># This means that the label is continous, so the concept of ID is meaningless</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>            <span class="n">ground_ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>        <span class="k">elif</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ground_class_name</span> <span class="ow">in</span> <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>            <span class="c1"># If the ground class name is already in the list, set newly-predicted vertices to that class</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>            <span class="c1"># Get the dictionary mapping in the reverse direction</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>            <span class="n">labels_to_IDs</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>            <span class="c1"># Determine the ID corresponding to the ground class name</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>            <span class="n">ground_ID</span> <span class="o">=</span> <span class="n">labels_to_IDs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ground_class_name</span><span class="p">)</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>        <span class="k">elif</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>            <span class="c1"># If the label names are present, and the class is not already included, add it as the last element</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>            <span class="k">if</span> <span class="n">ground_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>                <span class="c1"># Set it to the first unused ID</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>                <span class="c1"># TODO improve this since it should be the max plus one</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>                <span class="n">ground_ID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">)</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">label_name</span><span class="o">=</span><span class="n">ground_class_name</span><span class="p">,</span> <span class="n">label_ID</span><span class="o">=</span><span class="n">ground_ID</span><span class="p">)</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>        <span class="c1"># Replace mask for ground_vertices</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>        <span class="n">labels</span><span class="p">[</span><span class="n">ground_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ground_ID</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>        <span class="c1"># Optionally apply the texture to the mesh</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>        <span class="k">if</span> <span class="n">set_mesh_texture</span><span class="p">:</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="k">return</span> <span class="n">labels</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_transform_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a hash value for the transform to geospatial coordinates</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><span class="sd">            int: A hash value representing transformation.</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>        <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>        <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>            <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>        <span class="p">)</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>        <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a hash value for the mesh based on its points and faces</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">            int: A hash value representing the current mesh.</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>        <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>        <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>        <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">pix2face</span><span class="p">(</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>        <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>        <span class="n">render_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>        <span class="n">save_to_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>        <span class="n">cache_folder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">CACHE_FOLDER</span><span class="p">,</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the face that a ray from each pixel would intersect for each camera</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">            cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">                A single camera or set of cameras. For each camera, the correspondences between</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">                pixels and the face IDs of the mesh will be computed. The images of all cameras</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">                are assumed to be the same size.</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a><span class="sd">            render_img_scale (float, optional):</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">                Create a pix2face map that is this fraction of the original image scale. Defaults</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">                to 1.</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a><span class="sd">            save_to_cache (bool, optional):</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a><span class="sd">                Should newly-computed values be saved to the cache. This may speed up future operations</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a><span class="sd">                but can take up 100s of GBs of space. Defaults to False.</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a><span class="sd">            cache_folder ((PATH_TYPE, None), optional):</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a><span class="sd">                Where to check for and save to cached data. Only applicable if use_cache=True.</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a><span class="sd">                Defaults to CACHE_FOLDER</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a><span class="sd">            np.ndarray: For each camera, there is an array that is the shape of an image and</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a><span class="sd">            contains the integer face index for the ray originating at that pixel. Any pixel for</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a><span class="sd">            which the given ray does not intersect a face is given a value of -1. If the input is</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a><span class="sd">            a single PhotogrammetryCamera, the shape is (h, w). If it&#39;s a camera set, then it is</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a><span class="sd">            (n_cameras, h, w). Note that a one-length camera set will have a leading singleton dim.</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>        <span class="c1"># If a set of cameras is passed in, call this method on each camera and concatenate</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>        <span class="c1"># Other derived methods might be able to compute a batch of renders and once, but pyvista</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>        <span class="c1"># cannot as far as I can tell</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">):</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>            <span class="n">pix2face_list</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pix2face</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">render_img_scale</span><span class="o">=</span><span class="n">render_img_scale</span><span class="p">)</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">cameras</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>            <span class="p">]</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>            <span class="n">pix2face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">pix2face_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>            <span class="k">return</span> <span class="n">pix2face</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>        <span class="c1">## Single camera case</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>        <span class="c1"># Check if the cache contains a valid pix2face for the camera based on the dependencies</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>        <span class="c1"># Compute hashes for the mesh and camera to unique identify mesh+camera pair</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>        <span class="c1"># The cache will generate a unique key for each combination of the dependencies</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>        <span class="c1"># If the cache generated key matches a cache file on disk, pix2face will be filled with the correct correspondance</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>        <span class="c1"># If no match is found, recompute pix2face</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>        <span class="c1"># If there‚Äôs an error loading the cached data, then clear the cache&#39;s contents, signified by on_error=&#39;clear&#39;</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>        <span class="n">mesh_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_hash</span><span class="p">()</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>        <span class="n">camera_hash</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_camera_hash</span><span class="p">()</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>        <span class="n">cacher</span> <span class="o">=</span> <span class="n">ub</span><span class="o">.</span><span class="n">Cacher</span><span class="p">(</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>            <span class="s2">&quot;pix2face&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="n">depends</span><span class="o">=</span><span class="p">[</span><span class="n">mesh_hash</span><span class="p">,</span> <span class="n">camera_hash</span><span class="p">,</span> <span class="n">render_img_scale</span><span class="p">],</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>            <span class="n">dpath</span><span class="o">=</span><span class="n">cache_folder</span><span class="p">,</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>        <span class="p">)</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>        <span class="n">pix2face</span> <span class="o">=</span> <span class="n">cacher</span><span class="o">.</span><span class="n">tryload</span><span class="p">(</span><span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;clear&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>        <span class="c1">## Cache is valid</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>        <span class="k">if</span> <span class="n">pix2face</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>            <span class="k">return</span> <span class="n">pix2face</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>        <span class="c1"># This needs to be an attribute of the class because creating a large number of plotters</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>        <span class="c1"># results in an un-fixable memory leak.</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>        <span class="c1"># See https://github.com/pyvista/pyvista/issues/2252</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>        <span class="c1"># The first step is to clear it</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>        <span class="c1"># This is important so there aren&#39;t intermediate values</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">disable_anti_aliasing</span><span class="p">()</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>        <span class="c1"># Set the camera to the corresponding viewpoint</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_pyvista_camera</span><span class="p">()</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>        <span class="c1">## Compute the base 256 encoding of the face ID</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>        <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>        <span class="n">ID_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_faces</span><span class="p">)</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>        <span class="c1"># determine how many channels will be required to represent the number of faces</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>        <span class="n">n_channels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">emath</span><span class="o">.</span><span class="n">logn</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_faces</span><span class="p">)))</span> <span class="k">if</span> <span class="n">n_faces</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>        <span class="n">channel_multipliers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">)]</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>        <span class="c1"># Compute the encoding of each value, least significant value first</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>        <span class="n">base_256_encoding</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>            <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ID_values</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">channel_multipliers</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>        <span class="p">]</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="c1"># ensure that there&#39;s a multiple of three channels</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>        <span class="n">n_padding</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_channels</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">n_channels</span><span class="p">)</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="n">base_256_encoding</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_faces</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n_padding</span><span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>        <span class="c1"># Assume that all images are the same size</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>        <span class="n">image_size</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_image_size</span><span class="p">(</span><span class="n">image_scale</span><span class="o">=</span><span class="n">render_img_scale</span><span class="p">)</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>        <span class="c1"># Initialize pix2face</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>        <span class="n">pix2face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>        <span class="c1"># Iterate over three-channel chunks. Each will be encoded as RGB and rendered</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="k">for</span> <span class="n">chunk_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base_256_encoding</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)):</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>            <span class="n">chunk_scalars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                <span class="n">base_256_encoding</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">chunk_ind</span> <span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">chunk_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>            <span class="c1"># Add the mesh with the associated scalars</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                <span class="n">scalars</span><span class="o">=</span><span class="n">chunk_scalars</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                <span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                <span class="n">diffuse</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                <span class="n">ambient</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>            <span class="p">)</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="c1"># Perform rendering, this is the slow step</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>            <span class="n">rendered_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                <span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>            <span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>            <span class="c1"># Take the rendered values and interpret them as the encoded value</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>            <span class="c1"># Make sure to not try to interpret channels that are not used in the encoding</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>            <span class="n">channels_to_decode</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_multipliers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">chunk_ind</span><span class="p">)</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels_to_decode</span><span class="p">):</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="n">channel_multiplier</span> <span class="o">=</span> <span class="n">channel_multipliers</span><span class="p">[</span><span class="n">chunk_ind</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                <span class="n">channel_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">rendered_img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">channel_multiplier</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                <span class="n">pix2face</span> <span class="o">+=</span> <span class="n">channel_value</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>        <span class="c1"># Mask out pixels for which the mesh was not visible</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>        <span class="c1"># This is because the background will render as white</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>        <span class="c1"># If there happen to be an exact power of (256^3) number of faces, the last one may get</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>        <span class="c1"># erronously masked. This seems like a minimal concern but it could be addressed by adding</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>        <span class="c1"># another channel or something like that</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>        <span class="n">pix2face</span><span class="p">[</span><span class="n">pix2face</span> <span class="o">&gt;</span> <span class="n">n_faces</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>        <span class="k">if</span> <span class="n">save_to_cache</span><span class="p">:</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>            <span class="c1"># Save the most recently computed pix2face correspondance in the cache</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>            <span class="n">cacher</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pix2face</span><span class="p">)</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>        <span class="k">return</span> <span class="n">pix2face</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">render_flat</span><span class="p">(</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>        <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>        <span class="n">render_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>        <span class="n">return_camera</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>        <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>    <span class="p">):</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">        Render the texture from the viewpoint of each camera in cameras. Note that this is a</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">        generator so if you want to actually execute the computation, call list(*) on the output</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a><span class="sd">            cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">                Either a single camera or a camera set. The texture will be rendered from the</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><span class="sd">                perspective of each one</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><span class="sd">            batch_size (int, optional):</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><span class="sd">                The batch size for pix2face. Defaults to 1.</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">            render_img_scale (float, optional):</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><span class="sd">                The rendered image will be this fraction of the original image corresponding to the</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">                virtual camera. Defaults to 1.</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><span class="sd">            return_camera (bool, optional):</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><span class="sd">                Should the camera be yielded as the second value</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a><span class="sd">            TypeError: If cameras is not the correct type</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a><span class="sd">            np.ndarray:</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><span class="sd">               The pix2face array for the next camera. The shape is</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a><span class="sd">               (int(img_h*render_img_scale), int(img_w*render_img_scale)).</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">):</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>            <span class="c1"># Construct a camera set of length one</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>            <span class="n">cameras</span> <span class="o">=</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">([</span><span class="n">cameras</span><span class="p">])</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">):</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">()</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>        <span class="c1"># Get the face texture from the mesh</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>        <span class="c1"># TODO consider whether the user should be able to pass a texture to this method. It could</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>        <span class="c1"># make the user&#39;s life easier but makes this method more complex</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>        <span class="n">face_texture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>            <span class="n">request_vertex_texture</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">try_verts_faces_conversion</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>        <span class="p">)</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>        <span class="n">texture_dim</span> <span class="o">=</span> <span class="n">face_texture</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>        <span class="c1"># Iterate over batch of the cameras</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>        <span class="n">batch_stop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cameras</span><span class="p">)</span> <span class="o">-</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>        <span class="k">for</span> <span class="n">batch_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_stop</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>            <span class="n">batch_end</span> <span class="o">=</span> <span class="n">batch_start</span> <span class="o">+</span> <span class="n">batch_size</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>            <span class="n">batch_cameras</span> <span class="o">=</span> <span class="n">cameras</span><span class="p">[</span><span class="n">batch_start</span><span class="p">:</span><span class="n">batch_end</span><span class="p">]</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>            <span class="c1"># Compute a batch of pix2face correspondences. This is likely the slowest step</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>            <span class="n">batch_pix2face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix2face</span><span class="p">(</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                <span class="n">cameras</span><span class="o">=</span><span class="n">batch_cameras</span><span class="p">,</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                <span class="n">render_img_scale</span><span class="o">=</span><span class="n">render_img_scale</span><span class="p">,</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>                <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>            <span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>            <span class="c1"># Iterate over the batch dimension</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pix2face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch_pix2face</span><span class="p">):</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                <span class="c1"># Record the original shape of the image</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>                <span class="n">img_shape</span> <span class="o">=</span> <span class="n">pix2face</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                <span class="c1"># Flatten for indexing</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                <span class="n">pix2face</span> <span class="o">=</span> <span class="n">pix2face</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                <span class="c1"># Compute which pixels intersected the mesh</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                <span class="n">mesh_pixel_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pix2face</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                <span class="c1"># Initialize and all-nan array</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                <span class="n">rendered_flattened</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                    <span class="p">(</span><span class="n">pix2face</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">texture_dim</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>                <span class="p">)</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>                <span class="c1"># Fill the values for which correspondences exist</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>                <span class="n">rendered_flattened</span><span class="p">[</span><span class="n">mesh_pixel_inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_texture</span><span class="p">[</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                    <span class="n">pix2face</span><span class="p">[</span><span class="n">mesh_pixel_inds</span><span class="p">]</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>                <span class="p">]</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>                <span class="c1"># reshape to an image, where the last dimension is the texture dimension</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>                <span class="n">rendered_img</span> <span class="o">=</span> <span class="n">rendered_flattened</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">texture_dim</span><span class="p">,))</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>                <span class="k">if</span> <span class="n">return_camera</span><span class="p">:</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>                    <span class="k">yield</span> <span class="p">(</span><span class="n">rendered_img</span><span class="p">,</span> <span class="n">batch_cameras</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                    <span class="k">yield</span> <span class="n">rendered_img</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">project_images</span><span class="p">(</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>        <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>        <span class="n">aggregate_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>        <span class="n">check_null_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>        <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>    <span class="p">):</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the per-face projection for each of a set of images and associated camera</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a><span class="sd">            cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a><span class="sd">                The cameras to project images from. cam.get_image() will be called on each one</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><span class="sd">            batch_size (int, optional):</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><span class="sd">                The number of cameras to compute correspondences for at once. Defaults to 1.</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a><span class="sd">            aggregate_img_scale (float, optional):</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><span class="sd">                The scale of pixel-to-face correspondences image, as a fraction of the original</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><span class="sd">                image. Lower values lead to better runtimes but decreased precision at content</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><span class="sd">                boundaries in the images. Defaults to 1.</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="sd">            check_null_image (bool, optional):</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">                Only do indexing if there are non-null image values. This adds additional overhead,</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a><span class="sd">                but can save the expensive operation of indexing in cases where it would be a no-op.</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">        Yields:</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a><span class="sd">            np.ndarray: The per-face projection of an image in the camera set</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>        <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>        <span class="c1"># Iterate over batch of the cameras</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>        <span class="n">batch_stop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cameras</span><span class="p">)</span> <span class="o">-</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>        <span class="k">for</span> <span class="n">batch_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_stop</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>            <span class="n">batch_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batch_start</span><span class="p">,</span> <span class="n">batch_start</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">))</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>            <span class="n">batch_cameras</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">batch_inds</span><span class="p">)</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>            <span class="c1"># Compute a batch of pix2face correspondences. This is likely the slowest step</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>            <span class="n">batch_pix2face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix2face</span><span class="p">(</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>                <span class="n">cameras</span><span class="o">=</span><span class="n">batch_cameras</span><span class="p">,</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>                <span class="n">render_img_scale</span><span class="o">=</span><span class="n">aggregate_img_scale</span><span class="p">,</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>                <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>            <span class="p">)</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pix2face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch_pix2face</span><span class="p">):</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_image_by_index</span><span class="p">(</span><span class="n">batch_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">aggregate_img_scale</span><span class="p">)</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>                <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>                <span class="n">textured_faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_faces</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                <span class="c1"># Only do the expensive indexing step if there are finite values in the image. This is most</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                <span class="c1"># significant for sparse detection tasks where some images may have no real data</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">check_null_image</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">img</span><span class="p">)):</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                    <span class="n">flat_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                    <span class="n">flat_pix2face</span> <span class="o">=</span> <span class="n">pix2face</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>                    <span class="c1"># TODO this creates ill-defined behavior if multiple pixels map to the same face</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                    <span class="c1"># my guess is the later pixel in the flattened array will override the former</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>                    <span class="c1"># TODO make sure that null pix2face values are handled properly</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                    <span class="n">textured_faces</span><span class="p">[</span><span class="n">flat_pix2face</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_img</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                <span class="k">yield</span> <span class="n">textured_faces</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_projected_images</span><span class="p">(</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>        <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>        <span class="n">aggregate_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>        <span class="n">return_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>    <span class="p">):</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate the imagery from multiple cameras into per-face averges</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="sd">            cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><span class="sd">                The cameras to aggregate the images from. cam.get_image() will be called on each</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a><span class="sd">                element.</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a><span class="sd">            batch_size (int, optional):</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a><span class="sd">                The number of cameras to compute correspondences for at once. Defaults to 1.</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="sd">            aggregate_img_scale (float, optional):</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a><span class="sd">                The scale of pixel-to-face correspondences image, as a fraction of the original</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><span class="sd">                image. Lower values lead to better runtimes but decreased precision at content</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a><span class="sd">                boundaries in the images. Defaults to 1.</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a><span class="sd">            return_all (bool, optional):</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="sd">                Return the projection of each individual image, rather than just the aggregates.</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="sd">                Defaults to False.</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a><span class="sd">            np.ndarray: (n_faces, n_image_channels) The average projected image per face</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a><span class="sd">            dict: Additional information, including the summed projections, observations per face,</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a><span class="sd">                  and potentially each individual projection</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>        <span class="n">project_images_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_images</span><span class="p">(</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>            <span class="n">cameras</span><span class="o">=</span><span class="n">cameras</span><span class="p">,</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>            <span class="n">aggregate_img_scale</span><span class="o">=</span><span class="n">aggregate_img_scale</span><span class="p">,</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>        <span class="p">)</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>        <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>            <span class="n">all_projections</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>        <span class="c1"># TODO this should be a convenience method</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>        <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>        <span class="n">projection_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_faces</span><span class="p">)</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>        <span class="n">summed_projection</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>        <span class="k">for</span> <span class="n">projection_for_image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>            <span class="n">project_images_generator</span><span class="p">,</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cameras</span><span class="p">),</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Aggregating projected viewpoints&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>        <span class="p">):</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>            <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>                <span class="n">all_projections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">projection_for_image</span><span class="p">)</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>            <span class="k">if</span> <span class="n">summed_projection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>                <span class="n">summed_projection</span> <span class="o">=</span> <span class="n">projection_for_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>                <span class="n">summed_projection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>                    <span class="p">[</span><span class="n">summed_projection</span><span class="p">,</span> <span class="n">projection_for_image</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>                <span class="p">)</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>            <span class="n">projected_faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">projection_for_image</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>                <span class="nb">int</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>            <span class="p">)</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>            <span class="n">projection_counts</span> <span class="o">+=</span> <span class="n">projected_faces</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>        <span class="n">no_projections</span> <span class="o">=</span> <span class="n">projection_counts</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>        <span class="n">summed_projection</span><span class="p">[</span><span class="n">no_projections</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>        <span class="n">additional_information</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>            <span class="s2">&quot;projection_counts&quot;</span><span class="p">:</span> <span class="n">projection_counts</span><span class="p">,</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>            <span class="s2">&quot;summed_projections&quot;</span><span class="p">:</span> <span class="n">summed_projection</span><span class="p">,</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>        <span class="p">}</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>        <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>            <span class="n">additional_information</span><span class="p">[</span><span class="s2">&quot;all_projections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_projections</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="n">average_projections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>            <span class="n">summed_projection</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">projection_counts</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>        <span class="p">)</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>        <span class="k">return</span> <span class="n">average_projections</span><span class="p">,</span> <span class="n">additional_information</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>    <span class="c1"># Visualization and saving methods</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>        <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>        <span class="n">camera_set</span><span class="p">:</span> <span class="n">PhotogrammetryCameraSet</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>        <span class="n">screenshot_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>        <span class="n">vis_scalars</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>        <span class="n">mesh_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>        <span class="n">interactive_jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>        <span class="n">plotter_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>        <span class="n">enable_ssao</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>        <span class="n">force_xvfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>        <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>        <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a>    <span class="p">):</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the mesh and cameras</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="sd">            plotter (pyvista.Plotter, optional):</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">                Plotter to use, else one will be created</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><span class="sd">            off_screen (bool, optional):</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">                Show offscreen</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><span class="sd">            camera_set (PhotogrammetryCameraSet, optional):</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="sd">                Cameras to visualize. Defaults to None.</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">            screenshot_filename (PATH_TYPE, optional):</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a><span class="sd">                Filepath to save to, will show interactively if None. Defaults to None.</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">            vis_scalars (None, np.ndarray):</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">                Scalars to show</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><span class="sd">            mesh_kwargs:</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">                dict of keyword arguments for the mesh</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="sd">            interactive_jupyter (bool):</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">                Should jupyter windows be interactive. This doesn&#39;t always work, especially on VSCode.</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">            plotter_kwargs:</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">                dict of keyword arguments for the plotter</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">            frustum_scale (float, optional):</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">                Size of cameras in world units. Defaults to None.</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">            IDs_to_labels ([None, dict], optional):</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">                Mapping from IDs to human readable labels for discrete classes. Defaults to the mesh</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="sd">                IDs_to_labels if unset.</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>        <span class="n">off_screen</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">interactive</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">screenshot_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>        <span class="c1"># If the IDs to labels is not set, use the default ones for this mesh</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>        <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>            <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">()</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>        <span class="c1"># Set the mesh kwargs if not set</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>        <span class="k">if</span> <span class="n">mesh_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>            <span class="c1"># This needs to be a dict, even if it&#39;s empty</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>            <span class="n">mesh_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>            <span class="c1"># If there are discrete labels, set the colormap and limits inteligently</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>            <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>                <span class="c1"># Compute the largest ID</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>                <span class="n">max_ID</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>                <span class="k">if</span> <span class="n">max_ID</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>                    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>                        <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>                            <span class="p">(</span><span class="s2">&quot;tab10&quot;</span> <span class="k">if</span> <span class="n">max_ID</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="s2">&quot;tab20&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>                        <span class="p">)</span><span class="o">.</span><span class="n">colors</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>                    <span class="p">]</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>                    <span class="n">mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">max_ID</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>                    <span class="n">mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;clim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_ID</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>        <span class="c1"># Create the plotter if it&#39;s None</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>        <span class="n">plotter</span> <span class="o">=</span> <span class="n">create_pv_plotter</span><span class="p">(</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>            <span class="n">off_screen</span><span class="o">=</span><span class="n">off_screen</span><span class="p">,</span> <span class="n">force_xvfb</span><span class="o">=</span><span class="n">force_xvfb</span><span class="p">,</span> <span class="n">plotter</span><span class="o">=</span><span class="n">plotter</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>        <span class="p">)</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>        <span class="c1"># If the vis scalars are None, use the saved texture</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>        <span class="k">if</span> <span class="n">vis_scalars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>            <span class="n">vis_scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>                <span class="c1"># Request vertex texture if both are available</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>                <span class="n">request_vertex_texture</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>                    <span class="kc">True</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>                    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>                        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>                    <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>                <span class="p">)</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>            <span class="p">)</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>        <span class="n">is_rgb</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span> <span class="o">==</span> <span class="s2">&quot;RGB&quot;</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>            <span class="k">if</span> <span class="n">vis_scalars</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>            <span class="k">else</span> <span class="p">(</span><span class="n">vis_scalars</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">vis_scalars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>        <span class="p">)</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>        <span class="c1"># Data in the range [0, 255] must be uint8 type</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>        <span class="k">if</span> <span class="n">is_rgb</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vis_scalars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>            <span class="n">vis_scalars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">vis_scalars</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>        <span class="n">scalar_bar_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vertical&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>        <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;annotations&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mesh_kwargs</span><span class="p">:</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>            <span class="n">mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IDs_to_labels</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>            <span class="n">scalar_bar_args</span><span class="p">[</span><span class="s2">&quot;n_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>        <span class="c1"># Add the mesh</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="p">,</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>            <span class="n">scalars</span><span class="o">=</span><span class="n">vis_scalars</span><span class="p">,</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>            <span class="n">rgb</span><span class="o">=</span><span class="n">is_rgb</span><span class="p">,</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>            <span class="n">scalar_bar_args</span><span class="o">=</span><span class="n">scalar_bar_args</span><span class="p">,</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>            <span class="o">**</span><span class="n">mesh_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>        <span class="p">)</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>        <span class="c1"># If the camera set is provided, show this too</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>        <span class="k">if</span> <span class="n">camera_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>            <span class="c1"># Adjust the frustum scale if the mesh came from metashape</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>            <span class="c1"># Find the cube root of the determinant of the upper-left 3x3 submatrix to find the scaling factor</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>            <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>                <span class="ow">and</span> <span class="n">frustum_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>            <span class="p">):</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>                <span class="n">transform_determinant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>                <span class="p">)</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>                <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">transform_determinant</span><span class="p">)</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>                <span class="n">frustum_scale</span> <span class="o">=</span> <span class="n">frustum_scale</span> <span class="o">/</span> <span class="n">scale_factor</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>            <span class="n">camera_set</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>                <span class="n">plotter</span><span class="p">,</span> <span class="n">add_orientation_cube</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="n">frustum_scale</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>            <span class="p">)</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>        <span class="c1"># Enable screen space shading</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>        <span class="k">if</span> <span class="n">enable_ssao</span><span class="p">:</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>            <span class="n">plotter</span><span class="o">.</span><span class="n">enable_ssao</span><span class="p">()</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>        <span class="c1"># Create parent folder if none exists</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>        <span class="k">if</span> <span class="n">screenshot_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>            <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">screenshot_filename</span><span class="p">)</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>        <span class="k">if</span> <span class="s2">&quot;jupyter_backend&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotter_kwargs</span><span class="p">:</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>            <span class="k">if</span> <span class="n">interactive_jupyter</span><span class="p">:</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>                <span class="n">plotter_kwargs</span><span class="p">[</span><span class="s2">&quot;jupyter_backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;trame&quot;</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>                <span class="n">plotter_kwargs</span><span class="p">[</span><span class="s2">&quot;jupyter_backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;static&quot;</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>        <span class="k">if</span> <span class="s2">&quot;title&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotter_kwargs</span><span class="p">:</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>            <span class="n">plotter_kwargs</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Geograypher mesh viewer&quot;</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>        <span class="c1"># Show</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>        <span class="k">return</span> <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>            <span class="n">screenshot</span><span class="o">=</span><span class="n">screenshot_filename</span><span class="p">,</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>            <span class="o">**</span><span class="n">plotter_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>        <span class="p">)</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_renders</span><span class="p">(</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>        <span class="n">camera_set</span><span class="p">:</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">,</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>        <span class="n">render_image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>        <span class="n">output_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">VIS_FOLDER</span><span class="p">,</span> <span class="s2">&quot;renders&quot;</span><span class="p">),</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>        <span class="n">make_composites</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>        <span class="n">save_native_resolution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>        <span class="n">cast_to_uint8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>        <span class="n">uint8_value_for_null_texture</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">,</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>        <span class="o">**</span><span class="n">render_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>    <span class="p">):</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Render an image from the viewpoint of each specified camera and save a composite</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a><span class="sd">            camera_set (PhotogrammetryCameraSet):</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a><span class="sd">                Camera set to use for rendering</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a><span class="sd">            render_image_scale (float, optional):</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a><span class="sd">                Multiplier on the real image scale to obtain size for rendering. Lower values</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a><span class="sd">                yield a lower-resolution render but the runtime is quiker. Defaults to 1.0.</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a><span class="sd">            render_folder (PATH_TYPE, optional):</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a><span class="sd">                Save images to this folder. Defaults to Path(VIS_FOLDER, &quot;renders&quot;)</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a><span class="sd">            make_composites (bool, optional):</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a><span class="sd">                Should a triple pane composite with the original image be saved rather than the</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a><span class="sd">                raw label</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a><span class="sd">            cast_to_uint8: (bool, optional):</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a><span class="sd">                cast the float valued data to unit8 for saving efficiency. May dramatically increase</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a><span class="sd">                efficiency due to png compression</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a><span class="sd">            uint8_value_for_null_texture (np.uint8, optional):</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a><span class="sd">                What value to assign for values that can&#39;t be represented as unsigned 8-bit data.</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a><span class="sd">                Defaults to NULL_TEXTURE_INT_VALUE</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a><span class="sd">            render_kwargs:</span>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a><span class="sd">                keyword arguments passed to the render.</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="n">ensure_folder</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving renders to </span><span class="si">{</span><span class="n">output_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>        <span class="c1"># Save the classes filename</span>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_IDs_to_labels</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;IDs_to_labels.json&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>        <span class="c1"># Create the generator object to render the images</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>        <span class="c1"># Since this is a generator, this will be fast</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>        <span class="n">render_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_flat</span><span class="p">(</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>            <span class="n">camera_set</span><span class="p">,</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>            <span class="n">render_img_scale</span><span class="o">=</span><span class="n">render_image_scale</span><span class="p">,</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>            <span class="n">return_camera</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>            <span class="o">**</span><span class="n">render_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>        <span class="p">)</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>        <span class="c1"># The computation only happens when items are requested from the generator</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>        <span class="k">for</span> <span class="n">rendered</span><span class="p">,</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>            <span class="n">render_gen</span><span class="p">,</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">camera_set</span><span class="p">),</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing and saving renders&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>        <span class="p">):</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>            <span class="c1">## All this is post-processing to visualize the rendered label.</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>            <span class="c1"># rendered could either be a one channel image of integer IDs,</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>            <span class="c1"># a one-channel image of scalars, or a three-channel image of</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>            <span class="c1"># RGB. It could also be multi-channel image corresponding to anything,</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a>            <span class="c1"># but we don&#39;t expect that yet</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a>            <span class="k">if</span> <span class="n">save_native_resolution</span> <span class="ow">and</span> <span class="n">render_image_scale</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>                <span class="n">native_size</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image_size</span><span class="p">()</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>                <span class="c1"># Upsample using nearest neighbor interpolation for discrete labels and</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>                <span class="c1"># bilinear for non-discrete</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>                <span class="c1"># TODO this will need to be fixed for multi-channel images since I don&#39;t think resize works</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>                <span class="n">rendered</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                    <span class="n">rendered</span><span class="p">,</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>                    <span class="n">native_size</span><span class="p">,</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>                    <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete_texture</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>                <span class="p">)</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>            <span class="k">if</span> <span class="n">cast_to_uint8</span><span class="p">:</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>                <span class="c1"># Deterimine values that cannot be represented as uint8</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>                    <span class="p">[</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>                        <span class="n">rendered</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>                        <span class="n">rendered</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">rendered</span><span class="p">)),</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>                    <span class="p">]</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>                <span class="p">)</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>                <span class="n">rendered</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">uint8_value_for_null_texture</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>                <span class="c1"># Cast and squeeze since you can&#39;t save a one-channel image</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>                <span class="n">rendered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>            <span class="k">if</span> <span class="n">make_composites</span><span class="p">:</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>                <span class="n">RGB_image</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>                    <span class="n">image_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">save_native_resolution</span> <span class="k">else</span> <span class="n">render_image_scale</span><span class="p">)</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>                <span class="p">)</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>                <span class="n">rendered</span> <span class="o">=</span> <span class="n">create_composite</span><span class="p">(</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>                    <span class="n">RGB_image</span><span class="o">=</span><span class="n">RGB_image</span><span class="p">,</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>                    <span class="n">label_image</span><span class="o">=</span><span class="n">rendered</span><span class="p">,</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>                    <span class="n">IDs_to_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">(),</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>                <span class="p">)</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>                <span class="c1"># Clip channels if needed</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>                <span class="k">if</span> <span class="n">rendered</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>                    <span class="n">rendered</span> <span class="o">=</span> <span class="n">rendered</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>            <span class="c1"># Saving</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>            <span class="n">camera_filename</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">()</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>                <span class="n">camera_set</span><span class="o">.</span><span class="n">image_folder</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>            <span class="p">)</span>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>            <span class="n">output_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">camera_filename</span><span class="p">)</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>            <span class="c1"># This may create nested folders in the output dir</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>            <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>            <span class="k">if</span> <span class="n">rendered</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>                <span class="n">output_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>                <span class="c1"># Save the image</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>                <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">rendered</span><span class="p">,</span> <span class="n">check_contrast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>                <span class="n">output_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.npy&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>                <span class="c1"># Save the image</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">rendered</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h3 id="geograypher.meshes.TexturedPhotogrammetryMesh-functions">Functions<a href="#geograypher.meshes.TexturedPhotogrammetryMesh-functions" class="headerlink" title="Permanent link">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.__init__" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">downsample_target</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">transform_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">texture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">texture_column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">require_transform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p><em>summary</em></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="pyvista.PolyData">PolyData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the mesh, in a format pyvista can read, or pyvista mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>downsample_target</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample to this fraction of vertices. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>texture</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="numpy.ndarray">ndarray</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texture or path to one. See more details in <code>load_texture</code> documentation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>texture_column_name</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column to use for a vectorfile input</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="dict">dict</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary or JSON file containing the mapping from integer IDs to string class names</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">mesh</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">],</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">downsample_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">transform_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">texture_column_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">ROI_buffer_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">require_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">log_level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        mesh (typing.Union[PATH_TYPE, pv.PolyData]): Path to the mesh, in a format pyvista can read, or pyvista mesh</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        downsample_target (float, optional): Downsample to this fraction of vertices. Defaults to 1.0.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        texture (typing.Union[PATH_TYPE, np.ndarray, None]): Texture or path to one. See more details in `load_texture` documentation</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        texture_column_name: The name of the column to use for a vectorfile input</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        IDs_to_labels (typing.Union[PATH_TYPE, dict, None]): dictionary or JSON file containing the mapping from integer IDs to string class names</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">downsample_target</span> <span class="o">=</span> <span class="n">downsample_target</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="c1"># Create the plotter that will later be used to compute correspondences between pixels</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="c1"># and the mesh. Note that this is only done to prevent a memory leak from creating multiple</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="c1"># plotters. See https://github.com/pyvista/pyvista/issues/2252</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span> <span class="o">=</span> <span class="n">create_pv_plotter</span><span class="p">(</span><span class="n">off_screen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">face_polygons_cache</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">face_2d_3d_ratios_cache</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mesh_</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="c1"># Potentially necessary for Jupyter</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="c1"># https://stackoverflow.com/questions/35936086/jupyter-notebook-does-not-print-logs-to-the-output-cell</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="c1"># If you don&#39;t check that there&#39;s already a handler, you can have situations with duplicated</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="c1"># print outs if you have multiple mesh objects</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">hasHandlers</span><span class="p">():</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">))</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1"># Load the transform</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading transform to EPSG:4326&quot;</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">load_transform_to_epsg_4326</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">transform_filename</span><span class="p">,</span> <span class="n">require_transform</span><span class="o">=</span><span class="n">require_transform</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># Load the mesh with the pyvista loader</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">load_mesh</span><span class="p">(</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">downsample_target</span><span class="o">=</span><span class="n">downsample_target</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="n">ROI_buffer_meters</span><span class="p">,</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="c1"># Load the texture</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading texture&quot;</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># load IDs_to_labels</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># if IDs_to_labels not provided, check the directory of the mesh and get the file if found</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="o">.</span><span class="n">__args__</span><span class="p">):</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">possible_json</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_IDs_to_labels.json&quot;</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">if</span> <span class="n">possible_json</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">possible_json</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="c1"># convert IDs_to_labels from file to dict</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="o">.</span><span class="n">__args__</span><span class="p">):</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span> <span class="n">label</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">load_texture</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">texture_column_name</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.aggregate_projected_images" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">aggregate_projected_images</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aggregate_img_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.aggregate_projected_images" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Aggregate the imagery from multiple cameras into per-face averges</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cameras</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.PhotogrammetryCamera)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a>, <a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.PhotogrammetryCameraSet)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cameras to aggregate the images from. cam.get_image() will be called on each
element.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of cameras to compute correspondences for at once. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_img_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scale of pixel-to-face correspondences image, as a fraction of the original
image. Lower values lead to better runtimes but decreased precision at content
boundaries in the images. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_all</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the projection of each individual image, rather than just the aggregates.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: (n_faces, n_image_channels) The average projected image per face</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional information, including the summed projections, observations per face,
  and potentially each individual projection</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1792" name="__codelineno-0-1792"></a><span class="k">def</span><span class="w"> </span><span class="nf">aggregate_projected_images</span><span class="p">(</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>    <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>    <span class="n">aggregate_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>    <span class="n">return_all</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a><span class="p">):</span>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate the imagery from multiple cameras into per-face averges</span>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a><span class="sd">        cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a><span class="sd">            The cameras to aggregate the images from. cam.get_image() will be called on each</span>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a><span class="sd">            element.</span>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a><span class="sd">        batch_size (int, optional):</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a><span class="sd">            The number of cameras to compute correspondences for at once. Defaults to 1.</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="sd">        aggregate_img_scale (float, optional):</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a><span class="sd">            The scale of pixel-to-face correspondences image, as a fraction of the original</span>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><span class="sd">            image. Lower values lead to better runtimes but decreased precision at content</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a><span class="sd">            boundaries in the images. Defaults to 1.</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a><span class="sd">        return_all (bool, optional):</span>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="sd">            Return the projection of each individual image, rather than just the aggregates.</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a><span class="sd">        np.ndarray: (n_faces, n_image_channels) The average projected image per face</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a><span class="sd">        dict: Additional information, including the summed projections, observations per face,</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a><span class="sd">              and potentially each individual projection</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>    <span class="n">project_images_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_images</span><span class="p">(</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>        <span class="n">cameras</span><span class="o">=</span><span class="n">cameras</span><span class="p">,</span>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>        <span class="n">aggregate_img_scale</span><span class="o">=</span><span class="n">aggregate_img_scale</span><span class="p">,</span>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>    <span class="p">)</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>    <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>        <span class="n">all_projections</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>    <span class="c1"># TODO this should be a convenience method</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>    <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>    <span class="n">projection_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_faces</span><span class="p">)</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>    <span class="n">summed_projection</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>    <span class="k">for</span> <span class="n">projection_for_image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>        <span class="n">project_images_generator</span><span class="p">,</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cameras</span><span class="p">),</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Aggregating projected viewpoints&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>    <span class="p">):</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>        <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>            <span class="n">all_projections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">projection_for_image</span><span class="p">)</span>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>        <span class="k">if</span> <span class="n">summed_projection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>            <span class="n">summed_projection</span> <span class="o">=</span> <span class="n">projection_for_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>            <span class="n">summed_projection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>                <span class="p">[</span><span class="n">summed_projection</span><span class="p">,</span> <span class="n">projection_for_image</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>            <span class="p">)</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>        <span class="n">projected_faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">projection_for_image</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>            <span class="nb">int</span>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>        <span class="p">)</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>        <span class="n">projection_counts</span> <span class="o">+=</span> <span class="n">projected_faces</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>    <span class="n">no_projections</span> <span class="o">=</span> <span class="n">projection_counts</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>    <span class="n">summed_projection</span><span class="p">[</span><span class="n">no_projections</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>    <span class="n">additional_information</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>        <span class="s2">&quot;projection_counts&quot;</span><span class="p">:</span> <span class="n">projection_counts</span><span class="p">,</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>        <span class="s2">&quot;summed_projections&quot;</span><span class="p">:</span> <span class="n">summed_projection</span><span class="p">,</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>    <span class="p">}</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>    <span class="k">if</span> <span class="n">return_all</span><span class="p">:</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>        <span class="n">additional_information</span><span class="p">[</span><span class="s2">&quot;all_projections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_projections</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>    <span class="n">average_projections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>        <span class="n">summed_projection</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">projection_counts</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>    <span class="p">)</span>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>    <span class="k">return</span> <span class="n">average_projections</span><span class="p">,</span> <span class="n">additional_information</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.export_face_labels_vector" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">export_face_labels_vector</span><span class="p">(</span><span class="n">face_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">export_crs</span><span class="o">=</span><span class="n">LAT_LON_CRS</span><span class="p">,</span> <span class="n">label_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ensure_non_overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">simplify_tol</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">drop_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batched_unary_union_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">500000</span><span class="p">,</span> <span class="s1">&#39;sort_by_loc&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;grid_size&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;simplify_tol&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">},</span> <span class="n">vis_kwargs</span><span class="o">=</span><span class="p">{})</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.export_face_labels_vector" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Export the labels for each face as a on-per-class multipolygon</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>face_labels</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This can either be a 1- or 2-D array. If 1-D, it is (n_faces,) where each element
is an integer class label for that face. If 2-D, it's (n_faces, n_classes) and a
nonzero element at (i, j) represents a class prediction for the ith faces and jth
class</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>export_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to export. The extension must be a filetype that geopandas can write.
Defaults to None, if unset, nothing will be written.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>export_crs</code>
            </td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What CRS to export in.. Defaults to pyproj.CRS.from_epsg(4326), lat lon.</p>
              </div>
            </td>
            <td>
                  <code><span title="geograypher.constants.LAT_LON_CRS">LAT_LON_CRS</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_names</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional names, that are indexed by the labels. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ensure_non_overlapping</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should regions where two classes are predicted at different z heights be assigned to one class</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>simplify_tol</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(float, optional): Tolerence in meters to use to simplify geometry</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>drop_nan</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Don't export the nan class, often used for background</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vis</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>should the result be visualzed</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batched_unary_union_kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments for batched_unary_union_call</p>
              </div>
            </td>
            <td>
                  <code>{&#39;batch_size&#39;: 500000, &#39;sort_by_loc&#39;: True, &#39;grid_size&#39;: 0.05, &#39;simplify_tol&#39;: 0.05}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vis_kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword argmument dict for visualization</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the wrong number of faces labels are provided</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>gpd.GeoDataFrame: Merged data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="k">def</span><span class="w"> </span><span class="nf">export_face_labels_vector</span><span class="p">(</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>    <span class="n">face_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>    <span class="n">export_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>    <span class="n">export_crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span> <span class="o">=</span> <span class="n">LAT_LON_CRS</span><span class="p">,</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>    <span class="n">label_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>    <span class="n">ensure_non_overlapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>    <span class="n">simplify_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>    <span class="n">drop_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>    <span class="n">vis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>    <span class="n">batched_unary_union_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>        <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">500000</span><span class="p">,</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="s2">&quot;sort_by_loc&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="s2">&quot;grid_size&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>        <span class="s2">&quot;simplify_tol&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>    <span class="p">},</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>    <span class="n">vis_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Export the labels for each face as a on-per-class multipolygon</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="sd">        face_labels (np.ndarray):</span>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="sd">            This can either be a 1- or 2-D array. If 1-D, it is (n_faces,) where each element</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a><span class="sd">            is an integer class label for that face. If 2-D, it&#39;s (n_faces, n_classes) and a</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">            nonzero element at (i, j) represents a class prediction for the ith faces and jth</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="sd">            class</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">        export_file (PATH_TYPE, optional):</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">            Where to export. The extension must be a filetype that geopandas can write.</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a><span class="sd">            Defaults to None, if unset, nothing will be written.</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">        export_crs (pyproj.CRS, optional): What CRS to export in.. Defaults to pyproj.CRS.from_epsg(4326), lat lon.</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">        label_names (typing.Tuple, optional): Optional names, that are indexed by the labels. Defaults to None.</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">        ensure_non_overlapping (bool, optional): Should regions where two classes are predicted at different z heights be assigned to one class</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">        simplify_tol: (float, optional): Tolerence in meters to use to simplify geometry</span>
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">        drop_nan (bool, optional): Don&#39;t export the nan class, often used for background</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a><span class="sd">        vis: should the result be visualzed</span>
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a><span class="sd">        batched_unary_union_kwargs (dict, optional): Keyword arguments for batched_unary_union_call</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a><span class="sd">        vis_kwargs: keyword argmument dict for visualization</span>
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="sd">        ValueError: If the wrong number of faces labels are provided</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">        gpd.GeoDataFrame: Merged data</span>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>    <span class="c1"># Compute the working projected CRS</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>    <span class="c1"># This is important because having things in meters makes things easier</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing working CRS&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">output_CRS</span><span class="o">=</span><span class="n">LAT_LON_CRS</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>    <span class="n">working_CRS</span> <span class="o">=</span> <span class="n">get_projected_CRS</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">)</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>    <span class="c1"># Try to extract face labels if not set</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>    <span class="k">if</span> <span class="n">face_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>        <span class="n">face_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span><span class="n">request_vertex_texture</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>    <span class="c1"># Check that the correct number of labels are provided</span>
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>    <span class="k">if</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>    <span class="c1"># Get the geospatial faces dataframe</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>    <span class="n">faces_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_faces_2d_gdf</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">working_CRS</span><span class="p">)</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating dataframe of multipolygons&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a>    <span class="c1"># Check how the data is represented, as a 1-D list of integers or one/many-hot encoding</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>    <span class="n">face_labels_is_2d</span> <span class="o">=</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>    <span class="k">if</span> <span class="n">face_labels_is_2d</span><span class="p">:</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="c1"># Non-null columns</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="n">unique_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">face_labels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="n">face_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>        <span class="n">unique_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>    <span class="k">if</span> <span class="n">drop_nan</span><span class="p">:</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>        <span class="c1"># Drop nan from the list of IDs</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>        <span class="n">unique_IDs</span> <span class="o">=</span> <span class="n">unique_IDs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">unique_IDs</span><span class="p">)]</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>    <span class="n">multipolygon_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>    <span class="c1"># For each unique ID, aggregate all the faces together</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>    <span class="c1"># This is the same as geopandas.groupby, but that is slow and can out of memory easily</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>    <span class="c1"># due to the large number of polygons</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>    <span class="c1"># Instead, we replace the default shapely.unary_union with our batched implementation</span>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>    <span class="k">for</span> <span class="n">unique_ID</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">unique_IDs</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Merging faces for each class&quot;</span><span class="p">):</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="k">if</span> <span class="n">face_labels_is_2d</span><span class="p">:</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>            <span class="c1"># Nonzero elements of the column</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>            <span class="n">matching_face_mask</span> <span class="o">=</span> <span class="n">face_labels</span><span class="p">[:,</span> <span class="n">unique_ID</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>            <span class="c1"># Elements that match the ID in question</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>            <span class="n">matching_face_mask</span> <span class="o">=</span> <span class="n">face_labels</span> <span class="o">==</span> <span class="n">unique_ID</span>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="n">matching_face_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">matching_face_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="n">matching_face_polygons</span> <span class="o">=</span> <span class="n">faces_gdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">matching_face_inds</span><span class="p">]</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>        <span class="n">list_of_polygons</span> <span class="o">=</span> <span class="n">matching_face_polygons</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>        <span class="n">multipolygon</span> <span class="o">=</span> <span class="n">batched_unary_union</span><span class="p">(</span>
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>            <span class="n">list_of_polygons</span><span class="p">,</span> <span class="o">**</span><span class="n">batched_unary_union_kwargs</span>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>        <span class="p">)</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>        <span class="n">multipolygon_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multipolygon</span><span class="p">)</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>    <span class="n">working_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>        <span class="p">{</span><span class="n">CLASS_ID_KEY</span><span class="p">:</span> <span class="n">unique_IDs</span><span class="p">},</span> <span class="n">geometry</span><span class="o">=</span><span class="n">multipolygon_list</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">working_CRS</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>    <span class="p">)</span>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>    <span class="k">if</span> <span class="n">label_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>            <span class="p">(</span><span class="n">label_names</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ID</span><span class="p">)]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ID</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;nan&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>            <span class="k">for</span> <span class="n">ID</span> <span class="ow">in</span> <span class="n">working_gdf</span><span class="p">[</span><span class="n">CLASS_ID_KEY</span><span class="p">]</span>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>        <span class="p">]</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>        <span class="n">working_gdf</span><span class="p">[</span><span class="n">CLASS_NAMES_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>    <span class="c1"># Simplify the output geometry</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>    <span class="k">if</span> <span class="n">simplify_tol</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running simplification&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>        <span class="n">working_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">working_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">simplify_tol</span><span class="p">)</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>    <span class="c1"># Make sure that the polygons are non-overlapping</span>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>    <span class="k">if</span> <span class="n">ensure_non_overlapping</span><span class="p">:</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="c1"># TODO create a version that tie-breaks based on the number of predicted faces for each</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>        <span class="c1"># class and optionally the ratios of 3D to top-down areas for the input triangles.</span>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Ensuring non-overlapping polygons&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>        <span class="n">working_gdf</span> <span class="o">=</span> <span class="n">ensure_non_overlapping_polygons</span><span class="p">(</span><span class="n">working_gdf</span><span class="p">)</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>    <span class="c1"># Transform from the working crs to export crs</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>    <span class="n">export_gdf</span> <span class="o">=</span> <span class="n">working_gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">export_crs</span><span class="p">)</span>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>    <span class="c1"># Export if a file is provided</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>    <span class="k">if</span> <span class="n">export_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">export_file</span><span class="p">)</span>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>        <span class="n">export_gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">export_file</span><span class="p">)</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>    <span class="c1"># Vis if requested</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>    <span class="k">if</span> <span class="n">vis</span><span class="p">:</span>
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Plotting&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>        <span class="n">export_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>            <span class="n">column</span><span class="o">=</span><span class="n">CLASS_NAMES_KEY</span> <span class="k">if</span> <span class="n">label_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">CLASS_ID_KEY</span><span class="p">,</span>
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>            <span class="n">aspect</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>            <span class="o">**</span><span class="n">vis_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>        <span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>    <span class="k">return</span> <span class="n">export_gdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.face_to_vert_texture" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">face_to_vert_texture</span><span class="p">(</span><span class="n">face_IDs</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.face_to_vert_texture" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p><em>summary</em></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>face_IDs</code>
            </td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_faces,) The integer IDs of the faces</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="k">def</span><span class="w"> </span><span class="nf">face_to_vert_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_IDs</span><span class="p">):</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">        face_IDs (np.array): (n_faces,) The integer IDs of the faces</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>    <span class="c1"># TODO figure how to have a NaN class that</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="c1"># Find which faces are using this vertex</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>        <span class="n">matching</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_faces_2d_gdf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_faces_2d_gdf</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">include_3d_2d_ratio</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_dict</span><span class="o">=</span><span class="p">{},</span> <span class="n">faces_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_faces_2d_gdf" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a geodataframe of triangles for the 2D projection of each face of the mesh</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>crs</code>
            </td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Coordinate reference system of the dataframe</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_3d_2d_ratio</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Compute the ratio of the 3D area of the face to the 2D area. This relates to the
slope of the face relative to horizontal. The computed data will be stored in the
column corresponding to the value of RATIO_3D_2D_KEY. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional information to add to the dataframe. It must be a dict where the keys
are the names of the columns and the data is a np.ndarray of n_faces elemenets.
Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>faces_mask</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="numpy.ndarray">ndarray</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A binary mask corresponding to which faces to return. Used to improve runtime of
creating the dataframe or downstream steps. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_data</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to cache expensive results in memory as object attributes. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>geopandas.GeoDataFrame: A dataframe for each triangular face</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_faces_2d_gdf</span><span class="p">(</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="n">crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>    <span class="n">include_3d_2d_ratio</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="n">data_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="n">faces_mask</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>    <span class="n">cache_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a geodataframe of triangles for the 2D projection of each face of the mesh</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">        crs (pyproj.CRS):</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">            Coordinate reference system of the dataframe</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">        include_3d_2d_ratio (bool, optional):</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">            Compute the ratio of the 3D area of the face to the 2D area. This relates to the</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">            slope of the face relative to horizontal. The computed data will be stored in the</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">            column corresponding to the value of RATIO_3D_2D_KEY. Defaults to False.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        data_dict (dict, optional):</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">            Additional information to add to the dataframe. It must be a dict where the keys</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">            are the names of the columns and the data is a np.ndarray of n_faces elemenets.</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">            Defaults to {}.</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">        faces_mask (typing.Union[np.ndarray, None], optional):</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">            A binary mask corresponding to which faces to return. Used to improve runtime of</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">            creating the dataframe or downstream steps. Defaults to None.</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">        cache_data (bool):</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">            Whether to cache expensive results in memory as object attributes. Defaults to False.</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">        geopandas.GeoDataFrame: A dataframe for each triangular face</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>    <span class="c1"># Computing this data can be slow, and we might call it multiple times. This is especially</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>    <span class="c1"># true for doing clustered polygon labeling</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>    <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">mesh_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_hash</span><span class="p">()</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="n">transform_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform_hash</span><span class="p">()</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>        <span class="n">faces_mask_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">faces_mask</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="k">if</span> <span class="n">faces_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="p">)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>        <span class="c1"># Create a key that uniquely identifies the relavant inputs</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">mesh_hash</span><span class="p">,</span> <span class="n">transform_hash</span><span class="p">,</span> <span class="n">faces_mask_hash</span><span class="p">,</span> <span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="c1"># See if the face polygons were in the cache. If not, None will be returned</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="n">cached_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_polygons_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="n">cached_values</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>    <span class="k">if</span> <span class="n">cached_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="n">face_polygons</span><span class="p">,</span> <span class="n">faces</span> <span class="o">=</span> <span class="n">cached_values</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using cached face polygons&quot;</span><span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing faces in working CRS&quot;</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="c1"># Get the mesh vertices in the desired export CRS</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="n">verts_in_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="c1"># Get a triangle in geospatial coords for each face</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="c1"># (n_faces, 3 points, xyz)</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">faces</span> <span class="o">=</span> <span class="n">verts_in_crs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="c1"># Select only the requested faces</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="k">if</span> <span class="n">faces_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="n">faces</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">faces_mask</span><span class="p">]</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="c1"># Extract the first two columns and convert them to a list of tuples of tuples</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="n">faces_2d_tuples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]]</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>        <span class="n">face_polygons</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="n">Polygon</span><span class="p">(</span><span class="n">face_tuple</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="k">for</span> <span class="n">face_tuple</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>                <span class="n">faces_2d_tuples</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Converting faces to polygons&quot;</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>            <span class="p">)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="p">]</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating dataframe of faces&quot;</span><span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="c1"># Save computed data to the cache for the future</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">face_polygons_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">face_polygons</span><span class="p">,</span> <span class="n">faces</span><span class="p">)</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>    <span class="c1"># Remove data corresponding to masked faces</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="k">if</span> <span class="n">faces_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">faces_mask</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>    <span class="c1"># Compute the ratio between the 3D area and the projected top-down 2D area</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>    <span class="k">if</span> <span class="n">include_3d_2d_ratio</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>            <span class="c1"># Check if ratios are cached</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_2d_3d_ratios_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="c1"># Ratios need to be computed</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="k">if</span> <span class="n">ratios</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing ratio of 3d to 2d area&quot;</span><span class="p">):</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>                <span class="n">area</span><span class="p">,</span> <span class="n">area_2d</span> <span class="o">=</span> <span class="n">compute_3D_triangle_area</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">area</span> <span class="o">/</span> <span class="n">area_2d</span><span class="p">)</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="k">if</span> <span class="n">cache_data</span><span class="p">:</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">face_2d_3d_ratios_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="c1"># Add the ratios to the data dict</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="n">data_dict</span><span class="p">[</span><span class="n">RATIO_3D_2D_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>    <span class="c1"># Create the dataframe</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="n">faces_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="n">data</span><span class="o">=</span><span class="n">data_dict</span><span class="p">,</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>        <span class="n">geometry</span><span class="o">=</span><span class="n">face_polygons</span><span class="p">,</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="p">)</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="k">return</span> <span class="n">faces_gdf</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_height_above_ground" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_height_above_ground</span><span class="p">(</span><span class="n">DTM_file</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_height_above_ground" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return height above ground for a points in the mesh and a given DTM</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>DTM_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the digital terrain model raster</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not None, return a boolean mask for points under this height. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Either the height above ground or a boolean mask for ground points</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1372" name="__codelineno-0-1372"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_height_above_ground</span><span class="p">(</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">DTM_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return height above ground for a points in the mesh and a given DTM</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a><span class="sd">        DTM_file (PATH_TYPE): Path to the digital terrain model raster</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a><span class="sd">        threshold (float, optional):</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a><span class="sd">            If not None, return a boolean mask for points under this height. Defaults to None.</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a><span class="sd">        np.ndarray: Either the height above ground or a boolean mask for ground points</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>    <span class="c1"># Get the height from the DTM and the points in the same CRS</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>    <span class="n">DTM_heights</span><span class="p">,</span> <span class="n">verts_in_raster_CRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vert_values_from_raster_file</span><span class="p">(</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>        <span class="n">DTM_file</span><span class="p">,</span> <span class="n">return_verts_in_CRS</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>    <span class="p">)</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>    <span class="c1"># Extract the vertex height as the third channel</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>    <span class="n">verts_height</span> <span class="o">=</span> <span class="n">verts_in_raster_CRS</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>    <span class="c1"># Subtract the two to get the height above ground</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>    <span class="n">height_above_ground</span> <span class="o">=</span> <span class="n">verts_height</span> <span class="o">-</span> <span class="n">DTM_heights</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>    <span class="c1"># If the threshold is not None, return a boolean mask that is true for ground points</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>        <span class="c1"># Return boolean mask</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>        <span class="c1"># TODO see if this will break for nan values</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>        <span class="k">return</span> <span class="n">height_above_ground</span> <span class="o">&lt;</span> <span class="n">threshold</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>    <span class="c1"># Return height above ground</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>    <span class="k">return</span> <span class="n">height_above_ground</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_mesh_hash" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_mesh_hash</span><span class="p">()</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_mesh_hash" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Generates a hash value for the mesh based on its points and faces
Returns:
    int: A hash value representing the current mesh.</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1509" name="__codelineno-0-1509"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a hash value for the mesh based on its points and faces</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a><span class="sd">        int: A hash value representing the current mesh.</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>    <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>    <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>    <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>    <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_transform_hash" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_transform_hash</span><span class="p">()</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_transform_hash" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Generates a hash value for the transform to geospatial coordinates
Returns:
    int: A hash value representing transformation.</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1496" name="__codelineno-0-1496"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_transform_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a hash value for the transform to geospatial coordinates</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a><span class="sd">        int: A hash value representing transformation.</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>    <span class="n">hasher</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>    <span class="n">hasher</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>        <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>    <span class="p">)</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>    <span class="k">return</span> <span class="n">hasher</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_values_for_verts_from_vector" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_values_for_verts_from_vector</span><span class="p">(</span><span class="n">vector_source</span><span class="p">,</span> <span class="n">column_names</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_values_for_verts_from_vector" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the value from a dataframe for each vertex</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vector_source</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>geo data frame or path to data that can be loaded by geopandas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>column_names</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which columns to obtain data from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Array of values for each vertex if there is one column name or</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[np.ndarray]: A dict mapping from column names to numpy arrays</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span>
<span class="normal"><a href="#__codelineno-0-917">917</a></span>
<span class="normal"><a href="#__codelineno-0-918">918</a></span>
<span class="normal"><a href="#__codelineno-0-919">919</a></span>
<span class="normal"><a href="#__codelineno-0-920">920</a></span>
<span class="normal"><a href="#__codelineno-0-921">921</a></span>
<span class="normal"><a href="#__codelineno-0-922">922</a></span>
<span class="normal"><a href="#__codelineno-0-923">923</a></span>
<span class="normal"><a href="#__codelineno-0-924">924</a></span>
<span class="normal"><a href="#__codelineno-0-925">925</a></span>
<span class="normal"><a href="#__codelineno-0-926">926</a></span>
<span class="normal"><a href="#__codelineno-0-927">927</a></span>
<span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_values_for_verts_from_vector</span><span class="p">(</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="n">vector_source</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">],</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>    <span class="n">column_names</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the value from a dataframe for each vertex</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">        vector_source (typing.Union[gpd.GeoDataFrame, PATH_TYPE]): geo data frame or path to data that can be loaded by geopandas</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a><span class="sd">        column_names (typing.Union[str, typing.List[str]]): Which columns to obtain data from</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">        np.ndarray: Array of values for each vertex if there is one column name or</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="sd">        dict[np.ndarray]: A dict mapping from column names to numpy arrays</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>    <span class="c1"># Lead the vector data if not already provided in memory</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_source</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">vector_source</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>        <span class="c1"># This will error if not readable</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">vector_source</span><span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="c1"># Infer or standardize the column names</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="c1"># Check if there is only one real column</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="n">column_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>            <span class="c1"># Log as well since this may be caught by an exception handler,</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>            <span class="c1"># and it&#39;s a user error that can be corrected</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                <span class="s2">&quot;No column name provided and ambigious which column to use&quot;</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>            <span class="p">)</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>                <span class="s2">&quot;No column name provided and ambigious which column to use&quot;</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>            <span class="p">)</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="c1"># If only one column is provided, make it a one-length list</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>        <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_names</span><span class="p">]</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>    <span class="c1"># Get a dataframe of vertices</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>    <span class="n">verts_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_verts_geodataframe</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="c1"># See which vertices are in the geopolygons</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span class="n">points_in_polygons_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">verts_df</span><span class="p">,</span> <span class="n">gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;intersection&quot;</span><span class="p">)</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span class="c1"># Get the index array</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>    <span class="n">index_array</span> <span class="o">=</span> <span class="n">points_in_polygons_gdf</span><span class="p">[</span><span class="n">VERT_ID</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>    <span class="c1"># This is one entry per vertex</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>    <span class="n">labeled_verts_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>    <span class="n">all_values_dict</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>    <span class="c1"># Extract the data from each</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>    <span class="k">for</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">column_names</span><span class="p">:</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="c1"># Create an array corresponding to all the points and initialize to NaN</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>        <span class="n">column_values</span> <span class="o">=</span> <span class="n">points_in_polygons_gdf</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="c1"># TODO clean this up</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>        <span class="k">if</span> <span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">or</span> <span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">):</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>            <span class="c1"># TODO be set to the default value for the type of the column</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>            <span class="n">null_value</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="k">elif</span> <span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>            <span class="n">null_value</span> <span class="o">=</span> <span class="mi">255</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>            <span class="n">null_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="c1"># Create an array, one per vertex, with the null value</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>            <span class="n">shape</span><span class="o">=</span><span class="n">verts_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>            <span class="n">dtype</span><span class="o">=</span><span class="n">column_values</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>            <span class="n">fill_value</span><span class="o">=</span><span class="n">null_value</span><span class="p">,</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="p">)</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="c1"># Assign the labeled values</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="n">values</span><span class="p">[</span><span class="n">index_array</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_values</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="c1"># Record the results</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="n">labeled_verts_dict</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span class="n">all_values_dict</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="c1"># If only one name was requested, just return that</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>        <span class="n">labeled_verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">labeled_verts_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="n">all_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">all_values_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="k">return</span> <span class="n">labeled_verts</span><span class="p">,</span> <span class="n">all_values</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>    <span class="c1"># Else return a dict of all requested values</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>    <span class="k">return</span> <span class="n">labeled_verts_dict</span><span class="p">,</span> <span class="n">all_values_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_vert_values_from_raster_file" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_vert_values_from_raster_file</span><span class="p">(</span><span class="n">raster_file</span><span class="p">,</span> <span class="n">return_verts_in_CRS</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nodata_fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_vert_values_from_raster_file" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Compute the height above groun for each point on the mesh</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raster_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the geospatial raster file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_verts_in_CRS</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the vertices transformed into the raster CRS</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodata_fill_value</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set data defined by the opened file as NODATAVAL to this value</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.nan">nan</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: samples from raster. Either (n_verts,) or (n_verts, n_raster_channels)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray (optional): (n_verts, 3) the vertices in the raster CRS</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1323" name="__codelineno-0-1323"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_vert_values_from_raster_file</span><span class="p">(</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>    <span class="n">raster_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>    <span class="n">return_verts_in_CRS</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>    <span class="n">nodata_fill_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a><span class="p">):</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the height above groun for each point on the mesh</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a><span class="sd">        raster_file (PATH_TYPE, optional): The path to the geospatial raster file.</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a><span class="sd">        return_verts_in_CRS (bool, optional): Return the vertices transformed into the raster CRS</span>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a><span class="sd">        nodata_fill_value (float, optional): Set data defined by the opened file as NODATAVAL to this value</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a><span class="sd">        np.ndarray: samples from raster. Either (n_verts,) or (n_verts, n_raster_channels)</span>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a><span class="sd">        np.ndarray (optional): (n_verts, 3) the vertices in the raster CRS</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>    <span class="c1"># Open the DTM file</span>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>    <span class="n">raster</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">raster_file</span><span class="p">)</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>    <span class="c1"># Get the mesh points in the coordinate reference system of the DTM</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>    <span class="n">verts_in_raster_CRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>        <span class="n">raster</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">force_easting_northing</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>    <span class="p">)</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>    <span class="c1"># Get the points as a list</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>    <span class="n">easting_points</span> <span class="o">=</span> <span class="n">verts_in_raster_CRS</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>    <span class="n">northing_points</span> <span class="o">=</span> <span class="n">verts_in_raster_CRS</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>    <span class="c1"># Zip them together</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>    <span class="n">zipped_locations</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">easting_points</span><span class="p">,</span> <span class="n">northing_points</span><span class="p">)</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>    <span class="n">sampling_iter</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>        <span class="n">zipped_locations</span><span class="p">,</span>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sampling values from raster </span><span class="si">{</span><span class="n">raster_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span class="n">total</span><span class="o">=</span><span class="n">verts_in_raster_CRS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>    <span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>    <span class="c1"># Sample the raster file and squeeze if single channel</span>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>    <span class="n">sampled_raster_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">sampling_iter</span><span class="p">))))</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>    <span class="c1"># Set nodata locations to nan</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>    <span class="c1"># TODO figure out if it will ever be a problem to take the first value</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>    <span class="n">sampled_raster_values</span><span class="p">[</span><span class="n">sampled_raster_values</span> <span class="o">==</span> <span class="n">raster</span><span class="o">.</span><span class="n">nodatavals</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>        <span class="n">nodata_fill_value</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>    <span class="p">)</span>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>    <span class="k">if</span> <span class="n">return_verts_in_CRS</span><span class="p">:</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="k">return</span> <span class="n">sampled_raster_values</span><span class="p">,</span> <span class="n">verts_in_raster_CRS</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>    <span class="k">return</span> <span class="n">sampled_raster_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_vertices_in_CRS" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">output_CRS</span><span class="p">,</span> <span class="n">force_easting_northing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_vertices_in_CRS" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the coordinates of the mesh vertices in a given CRS</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_CRS</code>
            </td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The coordinate reference system to transform to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_easting_northing</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ensure that the returned points are east first, then north</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: (n_points, 3)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_vertices_in_CRS</span><span class="p">(</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">output_CRS</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span> <span class="n">force_easting_northing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="p">):</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the coordinates of the mesh vertices in a given CRS</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">        output_CRS (pyproj.CRS): The coordinate reference system to transform to</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">        force_easting_northing (bool, optional): Ensure that the returned points are east first, then north</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        np.ndarray: (n_points, 3)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="c1"># If no CRS is requested, just return the points</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="k">if</span> <span class="n">output_CRS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="c1"># The mesh points are defined in an arbitrary local coordinate system but we can transform them to EPGS:4978,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="c1"># the earth-centered, earth-fixed coordinate system, using an included transform</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="n">epgs4978_verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_vertices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="p">)</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="c1"># TODO figure out why this conversion was required. I think it was some typing issue</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">output_CRS</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="n">output_CRS</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">())</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="c1"># Build a pyproj transfrormer from EPGS:4978 to the desired CRS</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">transformer</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="n">EARTH_CENTERED_EARTH_FIXED_CRS</span><span class="p">,</span> <span class="n">output_CRS</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="p">)</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="c1"># Transform the coordinates</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="n">verts_in_output_CRS</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="n">xx</span><span class="o">=</span><span class="n">epgs4978_verts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="n">yy</span><span class="o">=</span><span class="n">epgs4978_verts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>        <span class="n">zz</span><span class="o">=</span><span class="n">epgs4978_verts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="p">)</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>    <span class="c1"># Stack and transpose</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>    <span class="n">verts_in_output_CRS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">verts_in_output_CRS</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="c1"># Pyproj respects the CRS axis ordering, which is northing/easting for most projected coordinate systems</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="c1"># This causes headaches because it&#39;s assumed by rasterio and geopandas to be easting/northing</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="c1"># https://rasterio.readthedocs.io/en/stable/api/rasterio.crs.html#rasterio.crs.epsg_treats_as_latlong</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="k">if</span> <span class="n">force_easting_northing</span> <span class="ow">and</span> <span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">epsg_treats_as_latlong</span><span class="p">(</span><span class="n">output_CRS</span><span class="p">):</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="c1"># Swap first two columns</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="n">verts_in_output_CRS</span> <span class="o">=</span> <span class="n">verts_in_output_CRS</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="k">return</span> <span class="n">verts_in_output_CRS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.get_verts_geodataframe" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">get_verts_geodataframe</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.get_verts_geodataframe" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Obtain the vertices as a dataframe</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>crs</code>
            </td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The CRS to use</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="geopandas.GeoDataFrame">GeoDataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>gpd.GeoDataFrame: A dataframe with all the vertices</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_verts_geodataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">:</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Obtain the vertices as a dataframe</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        crs (pyproj.CRS): The CRS to use</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        gpd.GeoDataFrame: A dataframe with all the vertices</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="c1"># Get the vertices in the same CRS as the geofile</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>    <span class="n">verts_in_geopolygon_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_in_CRS</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="p">{</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>            <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="n">verts_in_geopolygon_crs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>            <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="n">verts_in_geopolygon_crs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="p">}</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="p">)</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="c1"># Create a column of Point objects to use as the geometry</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;north&quot;</span><span class="p">])</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="n">points</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="c1"># Add an index column because the normal index will not be preserved in future operations</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="n">points</span><span class="p">[</span><span class="n">VERT_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="k">return</span> <span class="n">points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.label_ground_class" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">label_ground_class</span><span class="p">(</span><span class="n">DTM_file</span><span class="p">,</span> <span class="n">height_above_ground_threshold</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_label_existing_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ground_class_name</span><span class="o">=</span><span class="s1">&#39;ground&#39;</span><span class="p">,</span> <span class="n">ground_ID</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">set_mesh_texture</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.label_ground_class" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Set vertices to a potentially-new class with a thresholded height above the DTM.
TODO, consider handling face textures as well</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>DTM_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the DTM file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_above_ground_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height (meters) above that DTM that points below are considered ground</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vertex texture, otherwise will be queried from mesh. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>only_label_existing_labels</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only label points that already have non-null labels. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_class_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The potentially-new ground class name. Defaults to "ground".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ground&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_ID</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What value to use for the ground class. Will be set inteligently if not provided. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: The updated labels</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1402" name="__codelineno-0-1402"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_ground_class</span><span class="p">(</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>    <span class="n">DTM_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>    <span class="n">height_above_ground_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>    <span class="n">labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>    <span class="n">only_label_existing_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>    <span class="n">ground_class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ground&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>    <span class="n">ground_ID</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>    <span class="n">set_mesh_texture</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a><span class="sd">    Set vertices to a potentially-new class with a thresholded height above the DTM.</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a><span class="sd">    TODO, consider handling face textures as well</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a><span class="sd">        DTM_file (PATH_TYPE): Path to the DTM file</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a><span class="sd">        height_above_ground_threshold (float): Height (meters) above that DTM that points below are considered ground</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a><span class="sd">        labels (typing.Union[None, np.ndarray], optional): Vertex texture, otherwise will be queried from mesh. Defaults to None.</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a><span class="sd">        only_label_existing_labels (bool, optional): Only label points that already have non-null labels. Defaults to True.</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a><span class="sd">        ground_class_name (str, optional): The potentially-new ground class name. Defaults to &quot;ground&quot;.</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a><span class="sd">        ground_ID (typing.Union[None, int], optional): What value to use for the ground class. Will be set inteligently if not provided. Defaults to None.</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a><span class="sd">        np.ndarray: The updated labels</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>        <span class="c1"># Default to using vertex labels since it&#39;s the native way to check height above the DTM</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>        <span class="n">use_vertex_labels</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>    <span class="k">elif</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>        <span class="c1"># Check the size of the input labels and set what type they are. Note this could override existing value</span>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>        <span class="k">if</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>            <span class="n">use_vertex_labels</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>        <span class="k">elif</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>            <span class="n">use_vertex_labels</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                <span class="s2">&quot;Labels were provided but didn&#39;t match the shape of vertices or faces&quot;</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>            <span class="p">)</span>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>    <span class="c1"># if a labels are not provided, get it from the mesh</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>        <span class="c1"># Get the vertex textures from the mesh</span>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>        <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>            <span class="n">request_vertex_texture</span><span class="o">=</span><span class="n">use_vertex_labels</span><span class="p">,</span>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>        <span class="p">)</span>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>    <span class="c1"># Compute which vertices are part of the ground by thresholding the height above the DTM</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>    <span class="n">ground_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_height_above_ground</span><span class="p">(</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>        <span class="n">DTM_file</span><span class="o">=</span><span class="n">DTM_file</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">height_above_ground_threshold</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>    <span class="p">)</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>    <span class="c1"># If we needed a mask for the faces, compute that instead</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_vertex_labels</span><span class="p">:</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>        <span class="n">ground_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vert_to_face_texture</span><span class="p">(</span><span class="n">ground_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>            <span class="nb">bool</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>        <span class="p">)</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>    <span class="c1"># Replace only vertices that were previously labeled as something else, to avoid class imbalance</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>    <span class="k">if</span> <span class="n">only_label_existing_labels</span><span class="p">:</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>        <span class="c1"># Find which vertices are labeled</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>        <span class="n">is_labeled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">labels</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="c1"># Find which points are ground that were previously labeled as something else</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>        <span class="n">ground_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">is_labeled</span><span class="p">,</span> <span class="n">ground_mask</span><span class="p">)</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>    <span class="c1"># Get the existing label names</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>    <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">()</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>    <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ground_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>        <span class="c1"># This means that the label is continous, so the concept of ID is meaningless</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>        <span class="n">ground_ID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>    <span class="k">elif</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ground_class_name</span> <span class="ow">in</span> <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>        <span class="c1"># If the ground class name is already in the list, set newly-predicted vertices to that class</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>        <span class="c1"># Get the dictionary mapping in the reverse direction</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>        <span class="n">labels_to_IDs</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>        <span class="c1"># Determine the ID corresponding to the ground class name</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>        <span class="n">ground_ID</span> <span class="o">=</span> <span class="n">labels_to_IDs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ground_class_name</span><span class="p">)</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>    <span class="k">elif</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>        <span class="c1"># If the label names are present, and the class is not already included, add it as the last element</span>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>        <span class="k">if</span> <span class="n">ground_ID</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>            <span class="c1"># Set it to the first unused ID</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>            <span class="c1"># TODO improve this since it should be the max plus one</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>            <span class="n">ground_ID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">)</span>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">label_name</span><span class="o">=</span><span class="n">ground_class_name</span><span class="p">,</span> <span class="n">label_ID</span><span class="o">=</span><span class="n">ground_ID</span><span class="p">)</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>    <span class="c1"># Replace mask for ground_vertices</span>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>    <span class="n">labels</span><span class="p">[</span><span class="n">ground_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ground_ID</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>    <span class="c1"># Optionally apply the texture to the mesh</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>    <span class="k">if</span> <span class="n">set_mesh_texture</span><span class="p">:</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.label_polygons" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">label_polygons</span><span class="p">(</span><span class="n">face_labels</span><span class="p">,</span> <span class="n">polygons</span><span class="p">,</span> <span class="n">face_weighting</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sjoin_overlay</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_class_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unknown_class_label</span><span class="o">=</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">buffer_dist_meters</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.label_polygons" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Assign a class label to polygons using labels per face</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>face_labels</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_faces,) array of integer labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polygons</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="geopandas.GeoDataFrame">GeoDataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geospatial polygons to be labeled</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>face_weighting</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_faces,) array of scalar weights for each face, to be multiplied with the
contribution of this face. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sjoin_overlay</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use <code>gpd.sjoin</code> or <code>gpd.overlay</code> to compute the overlay. Sjoin is
substaintially faster, but only uses mesh faces that are entirely within the bounds
of the polygon, rather than computing the intersecting region for
partially-overlapping faces. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_class_labels</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(bool, optional):
Return string representation of class labels rather than float. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unknown_class_label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Label for predicted class for polygons with no overlapping faces. Defaults to "unknown".</p>
              </div>
            </td>
            <td>
                  <code>&#39;unknown&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buffer_dist_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(Union[float, None], optional)
Only applicable if sjoin_overlay=False. In that case, include faces entirely within
the region that is this distance in meters from the polygons. Defaults to 2.0.</p>
              </div>
            </td>
            <td>
                  <code>2.0</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if faces_labels or face_weighting is not 1D</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_polygons,) list of labels. Either float values, represnting integer IDs or nan,
or string values representing the class label</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_polygons</span><span class="p">(</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>    <span class="n">face_labels</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>    <span class="n">polygons</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">],</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>    <span class="n">face_weighting</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="n">sjoin_overlay</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>    <span class="n">return_class_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>    <span class="n">unknown_class_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="n">buffer_dist_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="p">):</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Assign a class label to polygons using labels per face</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a><span class="sd">        face_labels (np.ndarray): (n_faces,) array of integer labels</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="sd">        polygons (typing.Union[PATH_TYPE, gpd.GeoDataFrame]): Geospatial polygons to be labeled</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="sd">        face_weighting (typing.Union[None, np.ndarray], optional):</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">            (n_faces,) array of scalar weights for each face, to be multiplied with the</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">            contribution of this face. Defaults to None.</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">        sjoin_overlay (bool, optional):</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">            Whether to use `gpd.sjoin` or `gpd.overlay` to compute the overlay. Sjoin is</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">            substaintially faster, but only uses mesh faces that are entirely within the bounds</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">            of the polygon, rather than computing the intersecting region for</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">            partially-overlapping faces. Defaults to True.</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">        return_class_labels: (bool, optional):</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">            Return string representation of class labels rather than float. Defaults to True.</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">        unknown_class_label (str, optional):</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">            Label for predicted class for polygons with no overlapping faces. Defaults to &quot;unknown&quot;.</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        buffer_dist_meters: (Union[float, None], optional)</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">            Only applicable if sjoin_overlay=False. In that case, include faces entirely within</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">            the region that is this distance in meters from the polygons. Defaults to 2.0.</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a><span class="sd">        ValueError: if faces_labels or face_weighting is not 1D</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">        list(typing.Union[str, int]):</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">            (n_polygons,) list of labels. Either float values, represnting integer IDs or nan,</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">            or string values representing the class label</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>    <span class="c1"># Premptive error checking before expensive operations</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="n">face_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>    <span class="k">if</span> <span class="n">face_labels</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>            <span class="sa">f</span><span class="s2">&quot;Faces labels must be one-dimensional, but is </span><span class="si">{</span><span class="n">face_labels</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>        <span class="p">)</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>    <span class="k">if</span> <span class="n">face_weighting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="n">face_weighting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">face_weighting</span><span class="p">)</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="k">if</span> <span class="n">face_weighting</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>                <span class="sa">f</span><span class="s2">&quot;Faces labels must be one-dimensional, but is </span><span class="si">{</span><span class="n">face_weighting</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="p">)</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>    <span class="c1"># Ensure that the input is a geopandas dataframe</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">coerce_to_geoframe</span><span class="p">(</span><span class="n">polygons</span><span class="p">))</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>    <span class="c1"># Extract just the geometry</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>    <span class="n">polygons_gdf</span> <span class="o">=</span> <span class="n">polygons_gdf</span><span class="p">[[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>    <span class="c1"># Only get faces for which there is a non-nan label. Otherwise it is just additional compute</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="n">faces_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">face_labels</span><span class="p">)</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="c1"># Get the faces of the mesh as a geopandas dataframe</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="c1"># Include the predicted face labels as a column in the dataframe</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>    <span class="n">faces_2d_gdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_faces_2d_gdf</span><span class="p">(</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>        <span class="n">include_3d_2d_ratio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>        <span class="n">data_dict</span><span class="o">=</span><span class="p">{</span><span class="n">CLASS_ID_KEY</span><span class="p">:</span> <span class="n">face_labels</span><span class="p">},</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        <span class="n">faces_mask</span><span class="o">=</span><span class="n">faces_mask</span><span class="p">,</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="n">cache_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>    <span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>    <span class="c1"># If a per-face weighting is provided, multiply that with the 3d to 2d ratio</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>    <span class="k">if</span> <span class="n">face_weighting</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>        <span class="n">face_weighting</span> <span class="o">=</span> <span class="n">face_weighting</span><span class="p">[</span><span class="n">faces_mask</span><span class="p">]</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="s2">&quot;face_weighting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="n">RATIO_3D_2D_KEY</span><span class="p">]</span> <span class="o">*</span> <span class="n">face_weighting</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>        <span class="p">)</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>    <span class="c1"># If not, just use the ratio</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>        <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="s2">&quot;face_weighting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">faces_2d_gdf</span><span class="p">[</span><span class="n">RATIO_3D_2D_KEY</span><span class="p">]</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>    <span class="c1"># Set the precision to avoid approximate coliniearity errors</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>    <span class="n">faces_2d_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>        <span class="n">faces_2d_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mf">1e-6</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>    <span class="p">)</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>    <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">set_precision</span><span class="p">(</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>        <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mf">1e-6</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>    <span class="p">)</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>    <span class="c1"># Set the ID field so it&#39;s available after the overlay operation</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>    <span class="c1"># Note that polygons_gdf.index is a bad choice, because this df could be a subset of another</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>    <span class="c1"># one and the index would not start from 0</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>    <span class="n">polygons_gdf</span><span class="p">[</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">))</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>    <span class="c1"># Since overlay is expensive, we first discard faces that are not near the polygons</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>    <span class="c1"># Dissolve the polygons to form one ROI</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>    <span class="n">merged_polygons</span> <span class="o">=</span> <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>    <span class="c1"># Try to decrease the number of elements in the polygon by expanding</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>    <span class="c1"># and then simplifying the number of elements in the polygon</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>    <span class="n">merged_polygons</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">merged_polygons</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_dist_meters</span><span class="p">)</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>    <span class="n">merged_polygons</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">merged_polygons</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">buffer_dist_meters</span><span class="p">)</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>    <span class="c1"># Determine which face IDs intersect the ROI. This is slow</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting to subset to ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>    <span class="c1"># Check which faces are fully within the buffered regions around the query polygons</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>    <span class="c1"># Note that using sjoin has been faster than any other approach I&#39;ve tried, despite seeming</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>    <span class="c1"># to compute more information than something like gpd.within</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    <span class="n">contained_faces</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>        <span class="n">faces_2d_gdf</span><span class="p">,</span> <span class="n">merged_polygons</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;within&quot;</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>    <span class="p">)[</span><span class="s2">&quot;index_right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>    <span class="n">faces_2d_gdf</span> <span class="o">=</span> <span class="n">faces_2d_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">contained_faces</span><span class="p">]</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subset to ROI in </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting `overlay`&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>    <span class="k">if</span> <span class="n">sjoin_overlay</span><span class="p">:</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>        <span class="n">overlay</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>            <span class="n">faces_2d_gdf</span><span class="p">,</span> <span class="n">polygons_gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="s2">&quot;within&quot;</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>        <span class="p">)</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlay time with gpd.sjoin: </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>        <span class="c1"># Drop faces not included</span>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>        <span class="n">overlay</span> <span class="o">=</span> <span class="n">polygons_gdf</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span class="n">faces_2d_gdf</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">keep_geom_type</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>        <span class="p">)</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlay time with gpd.overlay: </span><span class="si">{</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>    <span class="c1"># Drop nan, for geometries that don&#39;t intersect the polygons</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>    <span class="n">overlay</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>    <span class="c1"># Compute the weighted area for each face, which may have been broken up by the overlay</span>
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>    <span class="n">overlay</span><span class="p">[</span><span class="s2">&quot;weighted_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">overlay</span><span class="p">[</span><span class="s2">&quot;face_weighting&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>    <span class="c1"># Extract only the neccessary columns</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>    <span class="n">overlay</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">,</span> <span class="n">CLASS_ID_KEY</span><span class="p">,</span> <span class="s2">&quot;weighted_area&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a>    <span class="n">aggregated_data</span> <span class="o">=</span> <span class="n">overlay</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">,</span> <span class="n">CLASS_ID_KEY</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a>    <span class="c1"># Compute the highest weighted class prediction</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>    <span class="c1"># Modified from https://stackoverflow.com/questions/27914360/python-pandas-idxmax-for-multiple-indexes-in-a-dataframe</span>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>    <span class="n">max_rows</span> <span class="o">=</span> <span class="n">aggregated_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a>        <span class="n">aggregated_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a>            <span class="s2">&quot;weighted_area&quot;</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a>        <span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a>    <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>    <span class="c1"># Make the class predictions a list of IDs with nans where no information is available</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>    <span class="n">pred_subset_IDs</span> <span class="o">=</span> <span class="n">max_rows</span><span class="p">[</span><span class="n">CLASS_ID_KEY</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>    <span class="n">pred_subset_IDs</span><span class="p">[</span><span class="n">max_rows</span><span class="p">[</span><span class="s2">&quot;weighted_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>    <span class="n">predicted_class_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polygons_gdf</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>    <span class="n">predicted_class_IDs</span><span class="p">[</span><span class="n">max_rows</span><span class="p">[</span><span class="s2">&quot;polygon_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>        <span class="n">pred_subset_IDs</span>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>    <span class="n">predicted_class_IDs</span> <span class="o">=</span> <span class="n">predicted_class_IDs</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="c1"># Post-process to string label names if requested and IDs_to_labels exists</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>    <span class="k">if</span> <span class="n">return_class_labels</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="p">(</span><span class="n">IDs_to_labels</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">())</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>    <span class="p">):</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>        <span class="c1"># convert the IDs into labels</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="c1"># Any label marked as nan is set to the unknown class label, since we had no predictions for it</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="n">predicted_class_IDs</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pi</span><span class="p">)]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="k">else</span> <span class="n">unknown_class_label</span><span class="p">)</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>            <span class="k">for</span> <span class="n">pi</span> <span class="ow">in</span> <span class="n">predicted_class_IDs</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>        <span class="p">]</span>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="k">return</span> <span class="n">predicted_class_IDs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.load_mesh" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">load_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">downsample_target</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ROI_simplify_tol_meters</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_mesh" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Load the pyvista mesh and create the texture</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="pyvista.PolyData">PolyData</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the mesh or actual mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>downsample_target</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What fraction of mesh vertices to downsample to. Defaults to 1.0, (does nothing).</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>See select_mesh_ROI. Defaults to None</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI_buffer_meters</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>See select_mesh_ROI. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI_simplify_tol_meters</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>See select_mesh_ROI. Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_mesh</span><span class="p">(</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">mesh</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">],</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">downsample_target</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">ROI_simplify_tol_meters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="p">):</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the pyvista mesh and create the texture</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        mesh (typing.Union[PATH_TYPE, pv.PolyData]):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            Path to the mesh or actual mesh</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        downsample_target (float, optional):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            What fraction of mesh vertices to downsample to. Defaults to 1.0, (does nothing).</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        ROI:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            See select_mesh_ROI. Defaults to None</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        ROI_buffer_meters:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">            See select_mesh_ROI. Defaults to 0.</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        ROI_simplify_tol_meters:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">            See select_mesh_ROI. Defaults to 2.</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">pv</span><span class="o">.</span><span class="n">PolyData</span><span class="p">):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="n">mesh</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="c1"># Load the mesh using pyvista</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="c1"># TODO see if pytorch3d has faster/more flexible readers. I&#39;d assume no, but it&#39;s good to check</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading the mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Selecting an ROI from mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="c1"># Select a region of interest if needed</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_mesh_ROI</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">region_of_interest</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">buffer_meters</span><span class="o">=</span><span class="n">ROI_buffer_meters</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">simplify_tol_meters</span><span class="o">=</span><span class="n">ROI_simplify_tol_meters</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="c1"># Downsample mesh and transfer active scalars from original mesh to downsampled mesh</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">if</span> <span class="n">downsample_target</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="c1"># TODO try decimate_pro and compare quality and runtime</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="c1"># TODO see if there&#39;s a way to preserve the mesh colors</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="c1"># TODO also see this decimation algorithm: https://pyvista.github.io/fast-simplification/</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Downsampling the mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="c1"># Have a temporary mesh so we can use the original mesh to transfer the active scalars to the downsampled one</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">downsampled_mesh_without_textures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">decimate</span><span class="p">(</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">target_reduction</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">downsample_target</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer_texture</span><span class="p">(</span><span class="n">downsampled_mesh_without_textures</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting faces from mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="c1"># See here for format: https://github.com/pyvista/pyvista-support/issues/96</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.load_texture" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">load_texture</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">texture_column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_texture" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Sets either self.face_texture or self.vertex_texture to an (n_{faces, verts}, m channels) array. Note that the other
   one will be left as None</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>texture</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="numpy.ndarray">ndarray</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This is either a numpy array or a file to one of the following
* A numpy array file in ".npy" format
* A vector file readable by geopandas and a label(s) specifying which column to use.
  This should be dataset of polygons/multipolygons. Ideally, there should be no overlap between
  regions with different labels. These regions may be assigned based on the order of the rows.
* A raster file readable by rasterio. We may want to support using a subset of bands</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>texture_column_name</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The column to use as the label for a vector data input</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping from integer IDs to string class names</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_texture</span><span class="p">(</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>    <span class="n">texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="n">texture_column_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="p">):</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets either self.face_texture or self.vertex_texture to an (n_{faces, verts}, m channels) array. Note that the other</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">       one will be left as None</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        texture (typing.Union[PATH_TYPE, np.ndarray, None]): This is either a numpy array or a file to one of the following</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            * A numpy array file in &quot;.npy&quot; format</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            * A vector file readable by geopandas and a label(s) specifying which column to use.</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">              This should be dataset of polygons/multipolygons. Ideally, there should be no overlap between</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">              regions with different labels. These regions may be assigned based on the order of the rows.</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">            * A raster file readable by rasterio. We may want to support using a subset of bands</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">        texture_column_name: The column to use as the label for a vector data input</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">        IDs_to_labels (typing.Union[None, dict]): Dictionary mapping from integer IDs to string class names</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="c1"># The easy case, a texture is passed in directly</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="n">texture_array</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="c1"># If the texture is None, try to load it from the mesh</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="c1"># Note that this requires us to have not decimated yet</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="k">elif</span> <span class="n">texture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="c1"># See if the mesh has a texture, else this will be None</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="c1"># Check if this was a really one channel that had to be tiled to</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="c1"># three for saving</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">texture_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="n">min_val_per_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">texture_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="n">max_val_per_row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">texture_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">min_val_per_row</span><span class="p">,</span> <span class="n">max_val_per_row</span><span class="p">):</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                    <span class="c1"># This is supposted to be one channel</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                    <span class="n">texture_array</span> <span class="o">=</span> <span class="n">texture_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                    <span class="c1"># Set any values that are the ignore int value to nan</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">texture_array</span> <span class="o">=</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">texture_array</span><span class="p">[</span><span class="n">texture_array</span> <span class="o">==</span> <span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="n">texture_array</span><span class="p">,</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="p">)</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">IDs_to_labels</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="c1"># Assume that no texture will be needed, consider printing a warning</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No texture provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="c1"># Try handling all the other supported filetypes</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="n">texture_array</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">all_values</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="c1"># Name of scalar in the mesh</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="s2">&quot;Trying to read texture as a scalar from the pyvista mesh:&quot;</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="p">[</span><span class="n">texture</span><span class="p">]</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="c1"># Numpy file</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Trying to read texture as a numpy file:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                <span class="n">texture_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="c1"># Vector file</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Trying to read texture as vector file:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>                <span class="c1"># TODO IDs to labels should be used here if set so the computed IDs are aligned with that mapping</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                <span class="n">texture_array</span><span class="p">,</span> <span class="n">all_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values_for_verts_from_vector</span><span class="p">(</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                    <span class="n">column_names</span><span class="o">=</span><span class="n">texture_column_name</span><span class="p">,</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                    <span class="n">vector_source</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">fiona</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DriverError</span><span class="p">):</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="c1"># Raster file</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="c1"># TODO</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Trying to read as texture as raster file: &quot;</span><span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vert_values_from_raster_file</span><span class="p">(</span><span class="n">texture</span><span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- success&quot;</span><span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;- failed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="c1"># Error out if not set, since we assume the intent was to have a texture at this point</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="k">if</span> <span class="n">texture_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not load texture for </span><span class="si">{</span><span class="n">texture</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="c1"># This will error if something is wrong with the texture that was loaded</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="n">texture_array</span><span class="p">,</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="n">all_discrete_texture_values</span><span class="o">=</span><span class="n">all_values</span><span class="p">,</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.load_transform_to_epsg_4326" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">load_transform_to_epsg_4326</span><span class="p">(</span><span class="n">transform_filename</span><span class="p">,</span> <span class="n">require_transform</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.load_transform_to_epsg_4326" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Load the 4x4 transform projects points from their local coordnate system into EPSG:4326,
the earth-centered, earth-fixed coordinate frame. This can either be from a CSV file specifying
it directly or extracted from a Metashape camera output</p>
<p>Args
    transform_filename (PATH_TYPE):
    require_transform (bool): Does a local-to-global transform file need to be available"
Raises:
    FileNotFoundError: Cannot find texture file
    ValueError: Transform file doesn't have 4x4 matrix</p>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_transform_to_epsg_4326</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">transform_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">require_transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="p">):</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    Load the 4x4 transform projects points from their local coordnate system into EPSG:4326,</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    the earth-centered, earth-fixed coordinate frame. This can either be from a CSV file specifying</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">    it directly or extracted from a Metashape camera output</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">    Args</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        transform_filename (PATH_TYPE):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        require_transform (bool): Does a local-to-global transform file need to be available&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        FileNotFoundError: Cannot find texture file</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        ValueError: Transform file doesn&#39;t have 4x4 matrix</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">if</span> <span class="n">transform_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="k">if</span> <span class="n">require_transform</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Transform is required but not provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="c1"># If not required, do nothing. TODO consider adding a warning</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="k">return</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">transform_filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.xml&quot;</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="o">=</span> <span class="n">parse_transform_metashape</span><span class="p">(</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="n">transform_filename</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">transform_filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">transform_filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="p">)</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="sa">f</span><span class="s2">&quot;Transform should be (4,4) but is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">if</span> <span class="n">require_transform</span><span class="p">:</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="sa">f</span><span class="s2">&quot;Transform could not be loaded from </span><span class="si">{</span><span class="n">transform_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="c1"># Not set</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.pix2face" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">pix2face</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">render_img_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_to_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cache_folder</span><span class="o">=</span><span class="n">CACHE_FOLDER</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.pix2face" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Compute the face that a ray from each pixel would intersect for each camera</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cameras</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.PhotogrammetryCamera)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a>, <a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.PhotogrammetryCameraSet)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single camera or set of cameras. For each camera, the correspondences between
pixels and the face IDs of the mesh will be computed. The images of all cameras
are assumed to be the same size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_img_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Create a pix2face map that is this fraction of the original image scale. Defaults
to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_to_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should newly-computed values be saved to the cache. This may speed up future operations
but can take up 100s of GBs of space. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_folder</code>
            </td>
            <td>
                  <code>PATH_TYPE, None)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to check for and save to cached data. Only applicable if use_cache=True.
Defaults to CACHE_FOLDER</p>
              </div>
            </td>
            <td>
                  <code><span title="geograypher.constants.CACHE_FOLDER">CACHE_FOLDER</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: For each camera, there is an array that is the shape of an image and</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>contains the integer face index for the ray originating at that pixel. Any pixel for</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>which the given ray does not intersect a face is given a value of -1. If the input is</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a single PhotogrammetryCamera, the shape is (h, w). If it's a camera set, then it is</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(n_cameras, h, w). Note that a one-length camera set will have a leading singleton dim.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1519" name="__codelineno-0-1519"></a><span class="k">def</span><span class="w"> </span><span class="nf">pix2face</span><span class="p">(</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>    <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>    <span class="n">render_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>    <span class="n">save_to_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>    <span class="n">cache_folder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">CACHE_FOLDER</span><span class="p">,</span>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the face that a ray from each pixel would intersect for each camera</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a><span class="sd">        cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a><span class="sd">            A single camera or set of cameras. For each camera, the correspondences between</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a><span class="sd">            pixels and the face IDs of the mesh will be computed. The images of all cameras</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a><span class="sd">            are assumed to be the same size.</span>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a><span class="sd">        render_img_scale (float, optional):</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a><span class="sd">            Create a pix2face map that is this fraction of the original image scale. Defaults</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a><span class="sd">            to 1.</span>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a><span class="sd">        save_to_cache (bool, optional):</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a><span class="sd">            Should newly-computed values be saved to the cache. This may speed up future operations</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a><span class="sd">            but can take up 100s of GBs of space. Defaults to False.</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a><span class="sd">        cache_folder ((PATH_TYPE, None), optional):</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a><span class="sd">            Where to check for and save to cached data. Only applicable if use_cache=True.</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a><span class="sd">            Defaults to CACHE_FOLDER</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a><span class="sd">        np.ndarray: For each camera, there is an array that is the shape of an image and</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a><span class="sd">        contains the integer face index for the ray originating at that pixel. Any pixel for</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a><span class="sd">        which the given ray does not intersect a face is given a value of -1. If the input is</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a><span class="sd">        a single PhotogrammetryCamera, the shape is (h, w). If it&#39;s a camera set, then it is</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a><span class="sd">        (n_cameras, h, w). Note that a one-length camera set will have a leading singleton dim.</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>    <span class="c1"># If a set of cameras is passed in, call this method on each camera and concatenate</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>    <span class="c1"># Other derived methods might be able to compute a batch of renders and once, but pyvista</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>    <span class="c1"># cannot as far as I can tell</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">):</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>        <span class="n">pix2face_list</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pix2face</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">render_img_scale</span><span class="o">=</span><span class="n">render_img_scale</span><span class="p">)</span>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>            <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">cameras</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>        <span class="p">]</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>        <span class="n">pix2face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">pix2face_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>        <span class="k">return</span> <span class="n">pix2face</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>    <span class="c1">## Single camera case</span>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>    <span class="c1"># Check if the cache contains a valid pix2face for the camera based on the dependencies</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>    <span class="c1"># Compute hashes for the mesh and camera to unique identify mesh+camera pair</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>    <span class="c1"># The cache will generate a unique key for each combination of the dependencies</span>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>    <span class="c1"># If the cache generated key matches a cache file on disk, pix2face will be filled with the correct correspondance</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>    <span class="c1"># If no match is found, recompute pix2face</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>    <span class="c1"># If there‚Äôs an error loading the cached data, then clear the cache&#39;s contents, signified by on_error=&#39;clear&#39;</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>    <span class="n">mesh_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_hash</span><span class="p">()</span>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>    <span class="n">camera_hash</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_camera_hash</span><span class="p">()</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>    <span class="n">cacher</span> <span class="o">=</span> <span class="n">ub</span><span class="o">.</span><span class="n">Cacher</span><span class="p">(</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>        <span class="s2">&quot;pix2face&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>        <span class="n">depends</span><span class="o">=</span><span class="p">[</span><span class="n">mesh_hash</span><span class="p">,</span> <span class="n">camera_hash</span><span class="p">,</span> <span class="n">render_img_scale</span><span class="p">],</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="n">dpath</span><span class="o">=</span><span class="n">cache_folder</span><span class="p">,</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>    <span class="p">)</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>    <span class="n">pix2face</span> <span class="o">=</span> <span class="n">cacher</span><span class="o">.</span><span class="n">tryload</span><span class="p">(</span><span class="n">on_error</span><span class="o">=</span><span class="s2">&quot;clear&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>    <span class="c1">## Cache is valid</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>    <span class="k">if</span> <span class="n">pix2face</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>        <span class="k">return</span> <span class="n">pix2face</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>    <span class="c1"># This needs to be an attribute of the class because creating a large number of plotters</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>    <span class="c1"># results in an un-fixable memory leak.</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>    <span class="c1"># See https://github.com/pyvista/pyvista/issues/2252</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>    <span class="c1"># The first step is to clear it</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>    <span class="c1"># This is important so there aren&#39;t intermediate values</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">disable_anti_aliasing</span><span class="p">()</span>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>    <span class="c1"># Set the camera to the corresponding viewpoint</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_pyvista_camera</span><span class="p">()</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>    <span class="c1">## Compute the base 256 encoding of the face ID</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>    <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>    <span class="n">ID_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_faces</span><span class="p">)</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>    <span class="c1"># determine how many channels will be required to represent the number of faces</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>    <span class="n">n_channels</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">emath</span><span class="o">.</span><span class="n">logn</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_faces</span><span class="p">)))</span> <span class="k">if</span> <span class="n">n_faces</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>    <span class="n">channel_multipliers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">)]</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>    <span class="c1"># Compute the encoding of each value, least significant value first</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>    <span class="n">base_256_encoding</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ID_values</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">channel_multipliers</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>    <span class="p">]</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>    <span class="c1"># ensure that there&#39;s a multiple of three channels</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>    <span class="n">n_padding</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_channels</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">n_channels</span><span class="p">)</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>    <span class="n">base_256_encoding</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_faces</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n_padding</span><span class="p">)</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>    <span class="c1"># Assume that all images are the same size</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>    <span class="n">image_size</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_image_size</span><span class="p">(</span><span class="n">image_scale</span><span class="o">=</span><span class="n">render_img_scale</span><span class="p">)</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>    <span class="c1"># Initialize pix2face</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>    <span class="n">pix2face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>    <span class="c1"># Iterate over three-channel chunks. Each will be encoded as RGB and rendered</span>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>    <span class="k">for</span> <span class="n">chunk_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">base_256_encoding</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)):</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>        <span class="n">chunk_scalars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>            <span class="n">base_256_encoding</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">chunk_ind</span> <span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">chunk_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>        <span class="c1"># Add the mesh with the associated scalars</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>            <span class="n">scalars</span><span class="o">=</span><span class="n">chunk_scalars</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>            <span class="n">rgb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>            <span class="n">diffuse</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>            <span class="n">ambient</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>        <span class="p">)</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>        <span class="c1"># Perform rendering, this is the slow step</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>        <span class="n">rendered_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix2face_plotter</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>            <span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>        <span class="p">)</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="c1"># Take the rendered values and interpret them as the encoded value</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>        <span class="c1"># Make sure to not try to interpret channels that are not used in the encoding</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>        <span class="n">channels_to_decode</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_multipliers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">chunk_ind</span><span class="p">)</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">channels_to_decode</span><span class="p">):</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>            <span class="n">channel_multiplier</span> <span class="o">=</span> <span class="n">channel_multipliers</span><span class="p">[</span><span class="n">chunk_ind</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="n">channel_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">rendered_img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">channel_multiplier</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="n">pix2face</span> <span class="o">+=</span> <span class="n">channel_value</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>    <span class="c1"># Mask out pixels for which the mesh was not visible</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>    <span class="c1"># This is because the background will render as white</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>    <span class="c1"># If there happen to be an exact power of (256^3) number of faces, the last one may get</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>    <span class="c1"># erronously masked. This seems like a minimal concern but it could be addressed by adding</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>    <span class="c1"># another channel or something like that</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>    <span class="n">pix2face</span><span class="p">[</span><span class="n">pix2face</span> <span class="o">&gt;</span> <span class="n">n_faces</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>    <span class="k">if</span> <span class="n">save_to_cache</span><span class="p">:</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>        <span class="c1"># Save the most recently computed pix2face correspondance in the cache</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>        <span class="n">cacher</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pix2face</span><span class="p">)</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>    <span class="k">return</span> <span class="n">pix2face</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.project_images" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">project_images</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">aggregate_img_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">check_null_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.project_images" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Find the per-face projection for each of a set of images and associated camera</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cameras</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.PhotogrammetryCamera)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a>, <a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.PhotogrammetryCameraSet)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cameras to project images from. cam.get_image() will be called on each one</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of cameras to compute correspondences for at once. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_img_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scale of pixel-to-face correspondences image, as a fraction of the original
image. Lower values lead to better runtimes but decreased precision at content
boundaries in the images. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>check_null_image</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only do indexing if there are non-null image values. This adds additional overhead,
but can save the expensive operation of indexing in cases where it would be a no-op.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: The per-face projection of an image in the camera set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a><span class="k">def</span><span class="w"> </span><span class="nf">project_images</span><span class="p">(</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>    <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>    <span class="n">aggregate_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>    <span class="n">check_null_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>    <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a><span class="p">):</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the per-face projection for each of a set of images and associated camera</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a><span class="sd">        cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a><span class="sd">            The cameras to project images from. cam.get_image() will be called on each one</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a><span class="sd">        batch_size (int, optional):</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a><span class="sd">            The number of cameras to compute correspondences for at once. Defaults to 1.</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a><span class="sd">        aggregate_img_scale (float, optional):</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a><span class="sd">            The scale of pixel-to-face correspondences image, as a fraction of the original</span>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a><span class="sd">            image. Lower values lead to better runtimes but decreased precision at content</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a><span class="sd">            boundaries in the images. Defaults to 1.</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a><span class="sd">        check_null_image (bool, optional):</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a><span class="sd">            Only do indexing if there are non-null image values. This adds additional overhead,</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a><span class="sd">            but can save the expensive operation of indexing in cases where it would be a no-op.</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a><span class="sd">        np.ndarray: The per-face projection of an image in the camera set</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>    <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>    <span class="c1"># Iterate over batch of the cameras</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>    <span class="n">batch_stop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cameras</span><span class="p">)</span> <span class="o">-</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>    <span class="k">for</span> <span class="n">batch_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_stop</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>        <span class="n">batch_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">batch_start</span><span class="p">,</span> <span class="n">batch_start</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">))</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>        <span class="n">batch_cameras</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span><span class="n">batch_inds</span><span class="p">)</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>        <span class="c1"># Compute a batch of pix2face correspondences. This is likely the slowest step</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>        <span class="n">batch_pix2face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix2face</span><span class="p">(</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>            <span class="n">cameras</span><span class="o">=</span><span class="n">batch_cameras</span><span class="p">,</span>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>            <span class="n">render_img_scale</span><span class="o">=</span><span class="n">aggregate_img_scale</span><span class="p">,</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>            <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>        <span class="p">)</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pix2face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch_pix2face</span><span class="p">):</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cameras</span><span class="o">.</span><span class="n">get_image_by_index</span><span class="p">(</span><span class="n">batch_start</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">aggregate_img_scale</span><span class="p">)</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>            <span class="n">n_channels</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>            <span class="n">textured_faces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">n_faces</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>            <span class="c1"># Only do the expensive indexing step if there are finite values in the image. This is most</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>            <span class="c1"># significant for sparse detection tasks where some images may have no real data</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">check_null_image</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">img</span><span class="p">)):</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>                <span class="n">flat_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                <span class="n">flat_pix2face</span> <span class="o">=</span> <span class="n">pix2face</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>                <span class="c1"># TODO this creates ill-defined behavior if multiple pixels map to the same face</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                <span class="c1"># my guess is the later pixel in the flattened array will override the former</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>                <span class="c1"># TODO make sure that null pix2face values are handled properly</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                <span class="n">textured_faces</span><span class="p">[</span><span class="n">flat_pix2face</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_img</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>            <span class="k">yield</span> <span class="n">textured_faces</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.render_flat" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">render_flat</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">render_img_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">return_camera</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.render_flat" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Render the texture from the viewpoint of each camera in cameras. Note that this is a
generator so if you want to actually execute the computation, call list(*) on the output</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cameras</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="            PhotogrammetryCamera (geograypher.cameras.PhotogrammetryCamera)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCamera">PhotogrammetryCamera</a>, <a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.PhotogrammetryCameraSet)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either a single camera or a camera set. The texture will be rendered from the
perspective of each one</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The batch size for pix2face. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_img_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rendered image will be this fraction of the original image corresponding to the
virtual camera. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_camera</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should the camera be yielded as the second value</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If cameras is not the correct type</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray:
The pix2face array for the next camera. The shape is
(int(img_h<em>render_img_scale), int(img_w</em>render_img_scale)).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a><span class="k">def</span><span class="w"> </span><span class="nf">render_flat</span><span class="p">(</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>    <span class="n">cameras</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PhotogrammetryCamera</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">],</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>    <span class="n">render_img_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>    <span class="n">return_camera</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>    <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a><span class="p">):</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a><span class="sd">    Render the texture from the viewpoint of each camera in cameras. Note that this is a</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a><span class="sd">    generator so if you want to actually execute the computation, call list(*) on the output</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a><span class="sd">        cameras (typing.Union[PhotogrammetryCamera, PhotogrammetryCameraSet]):</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a><span class="sd">            Either a single camera or a camera set. The texture will be rendered from the</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a><span class="sd">            perspective of each one</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a><span class="sd">        batch_size (int, optional):</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a><span class="sd">            The batch size for pix2face. Defaults to 1.</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a><span class="sd">        render_img_scale (float, optional):</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a><span class="sd">            The rendered image will be this fraction of the original image corresponding to the</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a><span class="sd">            virtual camera. Defaults to 1.</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a><span class="sd">        return_camera (bool, optional):</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a><span class="sd">            Should the camera be yielded as the second value</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a><span class="sd">        TypeError: If cameras is not the correct type</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a><span class="sd">        np.ndarray:</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a><span class="sd">           The pix2face array for the next camera. The shape is</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a><span class="sd">           (int(img_h*render_img_scale), int(img_w*render_img_scale)).</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCamera</span><span class="p">):</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>        <span class="c1"># Construct a camera set of length one</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>        <span class="n">cameras</span> <span class="o">=</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">([</span><span class="n">cameras</span><span class="p">])</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cameras</span><span class="p">,</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">):</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">()</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>    <span class="c1"># Get the face texture from the mesh</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>    <span class="c1"># TODO consider whether the user should be able to pass a texture to this method. It could</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>    <span class="c1"># make the user&#39;s life easier but makes this method more complex</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>    <span class="n">face_texture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>        <span class="n">request_vertex_texture</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">try_verts_faces_conversion</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>    <span class="p">)</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>    <span class="n">texture_dim</span> <span class="o">=</span> <span class="n">face_texture</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>    <span class="c1"># Iterate over batch of the cameras</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>    <span class="n">batch_stop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cameras</span><span class="p">)</span> <span class="o">-</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>    <span class="k">for</span> <span class="n">batch_start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">batch_stop</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>        <span class="n">batch_end</span> <span class="o">=</span> <span class="n">batch_start</span> <span class="o">+</span> <span class="n">batch_size</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>        <span class="n">batch_cameras</span> <span class="o">=</span> <span class="n">cameras</span><span class="p">[</span><span class="n">batch_start</span><span class="p">:</span><span class="n">batch_end</span><span class="p">]</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>        <span class="c1"># Compute a batch of pix2face correspondences. This is likely the slowest step</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>        <span class="n">batch_pix2face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix2face</span><span class="p">(</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>            <span class="n">cameras</span><span class="o">=</span><span class="n">batch_cameras</span><span class="p">,</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>            <span class="n">render_img_scale</span><span class="o">=</span><span class="n">render_img_scale</span><span class="p">,</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>            <span class="o">**</span><span class="n">pix2face_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>        <span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>        <span class="c1"># Iterate over the batch dimension</span>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pix2face</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">batch_pix2face</span><span class="p">):</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>            <span class="c1"># Record the original shape of the image</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>            <span class="n">img_shape</span> <span class="o">=</span> <span class="n">pix2face</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>            <span class="c1"># Flatten for indexing</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>            <span class="n">pix2face</span> <span class="o">=</span> <span class="n">pix2face</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>            <span class="c1"># Compute which pixels intersected the mesh</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>            <span class="n">mesh_pixel_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pix2face</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>            <span class="c1"># Initialize and all-nan array</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>            <span class="n">rendered_flattened</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                <span class="p">(</span><span class="n">pix2face</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">texture_dim</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>            <span class="p">)</span>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>            <span class="c1"># Fill the values for which correspondences exist</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>            <span class="n">rendered_flattened</span><span class="p">[</span><span class="n">mesh_pixel_inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_texture</span><span class="p">[</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                <span class="n">pix2face</span><span class="p">[</span><span class="n">mesh_pixel_inds</span><span class="p">]</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>            <span class="p">]</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>            <span class="c1"># reshape to an image, where the last dimension is the texture dimension</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>            <span class="n">rendered_img</span> <span class="o">=</span> <span class="n">rendered_flattened</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">img_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">texture_dim</span><span class="p">,))</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>            <span class="k">if</span> <span class="n">return_camera</span><span class="p">:</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>                <span class="k">yield</span> <span class="p">(</span><span class="n">rendered_img</span><span class="p">,</span> <span class="n">batch_cameras</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>                <span class="k">yield</span> <span class="n">rendered_img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.save_IDs_to_labels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">save_IDs_to_labels</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.save_IDs_to_labels" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>saves the contents of the IDs_to_labels to the file savepath provided</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>savepath</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the file where the data must be saved</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span>
<span class="normal"><a href="#__codelineno-0-981">981</a></span>
<span class="normal"><a href="#__codelineno-0-982">982</a></span>
<span class="normal"><a href="#__codelineno-0-983">983</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_IDs_to_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">savepath</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">):</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;saves the contents of the IDs_to_labels to the file savepath provided</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a><span class="sd">        savepath (PATH_TYPE): path to the file where the data must be saved</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="c1"># Save the classes filename</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>    <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete_texture</span><span class="p">():</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;discrete texture, saving classes&quot;</span><span class="p">)</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving IDs_to_labels to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile_h</span><span class="p">:</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">(),</span> <span class="n">outfile_h</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span class="p">)</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;non-discrete texture, not saving classes&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.save_renders" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">save_renders</span><span class="p">(</span><span class="n">camera_set</span><span class="p">,</span> <span class="n">render_image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">VIS_FOLDER</span><span class="p">,</span> <span class="s1">&#39;renders&#39;</span><span class="p">),</span> <span class="n">make_composites</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_native_resolution</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cast_to_uint8</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">uint8_value_for_null_texture</span><span class="o">=</span><span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">,</span> <span class="o">**</span><span class="n">render_kwargs</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.save_renders" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Render an image from the viewpoint of each specified camera and save a composite</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>camera_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.PhotogrammetryCameraSet)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera set to use for rendering</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Multiplier on the real image scale to obtain size for rendering. Lower values
yield a lower-resolution render but the runtime is quiker. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Save images to this folder. Defaults to Path(VIS_FOLDER, "renders")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>make_composites</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should a triple pane composite with the original image be saved rather than the
raw label</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cast_to_uint8</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(bool, optional):
cast the float valued data to unit8 for saving efficiency. May dramatically increase
efficiency due to png compression</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>uint8_value_for_null_texture</code>
            </td>
            <td>
                  <code><span title="numpy.uint8">uint8</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>What value to assign for values that can't be represented as unsigned 8-bit data.
Defaults to NULL_TEXTURE_INT_VALUE</p>
              </div>
            </td>
            <td>
                  <code><span title="geograypher.constants.NULL_TEXTURE_INT_VALUE">NULL_TEXTURE_INT_VALUE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments passed to the render.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2022" name="__codelineno-0-2022"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_renders</span><span class="p">(</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>    <span class="n">camera_set</span><span class="p">:</span> <span class="n">PhotogrammetryCameraSet</span><span class="p">,</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>    <span class="n">render_image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>    <span class="n">output_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">VIS_FOLDER</span><span class="p">,</span> <span class="s2">&quot;renders&quot;</span><span class="p">),</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>    <span class="n">make_composites</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>    <span class="n">save_native_resolution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>    <span class="n">cast_to_uint8</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>    <span class="n">uint8_value_for_null_texture</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="o">=</span> <span class="n">NULL_TEXTURE_INT_VALUE</span><span class="p">,</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>    <span class="o">**</span><span class="n">render_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a><span class="p">):</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Render an image from the viewpoint of each specified camera and save a composite</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a><span class="sd">        camera_set (PhotogrammetryCameraSet):</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a><span class="sd">            Camera set to use for rendering</span>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a><span class="sd">        render_image_scale (float, optional):</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a><span class="sd">            Multiplier on the real image scale to obtain size for rendering. Lower values</span>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a><span class="sd">            yield a lower-resolution render but the runtime is quiker. Defaults to 1.0.</span>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a><span class="sd">        render_folder (PATH_TYPE, optional):</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a><span class="sd">            Save images to this folder. Defaults to Path(VIS_FOLDER, &quot;renders&quot;)</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a><span class="sd">        make_composites (bool, optional):</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a><span class="sd">            Should a triple pane composite with the original image be saved rather than the</span>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a><span class="sd">            raw label</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a><span class="sd">        cast_to_uint8: (bool, optional):</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a><span class="sd">            cast the float valued data to unit8 for saving efficiency. May dramatically increase</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a><span class="sd">            efficiency due to png compression</span>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a><span class="sd">        uint8_value_for_null_texture (np.uint8, optional):</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a><span class="sd">            What value to assign for values that can&#39;t be represented as unsigned 8-bit data.</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a><span class="sd">            Defaults to NULL_TEXTURE_INT_VALUE</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a><span class="sd">        render_kwargs:</span>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a><span class="sd">            keyword arguments passed to the render.</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>    <span class="n">ensure_folder</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving renders to </span><span class="si">{</span><span class="n">output_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>    <span class="c1"># Save the classes filename</span>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">save_IDs_to_labels</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;IDs_to_labels.json&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>    <span class="c1"># Create the generator object to render the images</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>    <span class="c1"># Since this is a generator, this will be fast</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>    <span class="n">render_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_flat</span><span class="p">(</span>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>        <span class="n">camera_set</span><span class="p">,</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>        <span class="n">render_img_scale</span><span class="o">=</span><span class="n">render_image_scale</span><span class="p">,</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>        <span class="n">return_camera</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>        <span class="o">**</span><span class="n">render_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>    <span class="p">)</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>    <span class="c1"># The computation only happens when items are requested from the generator</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>    <span class="k">for</span> <span class="n">rendered</span><span class="p">,</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>        <span class="n">render_gen</span><span class="p">,</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">camera_set</span><span class="p">),</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Computing and saving renders&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>    <span class="p">):</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>        <span class="c1">## All this is post-processing to visualize the rendered label.</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>        <span class="c1"># rendered could either be a one channel image of integer IDs,</span>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>        <span class="c1"># a one-channel image of scalars, or a three-channel image of</span>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>        <span class="c1"># RGB. It could also be multi-channel image corresponding to anything,</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a>        <span class="c1"># but we don&#39;t expect that yet</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a>        <span class="k">if</span> <span class="n">save_native_resolution</span> <span class="ow">and</span> <span class="n">render_image_scale</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>            <span class="n">native_size</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image_size</span><span class="p">()</span>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a>            <span class="c1"># Upsample using nearest neighbor interpolation for discrete labels and</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a>            <span class="c1"># bilinear for non-discrete</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a>            <span class="c1"># TODO this will need to be fixed for multi-channel images since I don&#39;t think resize works</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>            <span class="n">rendered</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                <span class="n">rendered</span><span class="p">,</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>                <span class="n">native_size</span><span class="p">,</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>                <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_discrete_texture</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>            <span class="p">)</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>        <span class="k">if</span> <span class="n">cast_to_uint8</span><span class="p">:</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>            <span class="c1"># Deterimine values that cannot be represented as uint8</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>                <span class="p">[</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>                    <span class="n">rendered</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>                    <span class="n">rendered</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">,</span>
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">rendered</span><span class="p">)),</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>                <span class="p">]</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>            <span class="p">)</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>            <span class="n">rendered</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">uint8_value_for_null_texture</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>            <span class="c1"># Cast and squeeze since you can&#39;t save a one-channel image</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>            <span class="n">rendered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>        <span class="k">if</span> <span class="n">make_composites</span><span class="p">:</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>            <span class="n">RGB_image</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>                <span class="n">image_scale</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">save_native_resolution</span> <span class="k">else</span> <span class="n">render_image_scale</span><span class="p">)</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>            <span class="p">)</span>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>            <span class="n">rendered</span> <span class="o">=</span> <span class="n">create_composite</span><span class="p">(</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>                <span class="n">RGB_image</span><span class="o">=</span><span class="n">RGB_image</span><span class="p">,</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>                <span class="n">label_image</span><span class="o">=</span><span class="n">rendered</span><span class="p">,</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>                <span class="n">IDs_to_labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">(),</span>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>            <span class="p">)</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>            <span class="c1"># Clip channels if needed</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>            <span class="k">if</span> <span class="n">rendered</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>                <span class="n">rendered</span> <span class="o">=</span> <span class="n">rendered</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>        <span class="c1"># Saving</span>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>        <span class="n">camera_filename</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_image_filename</span><span class="p">()</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>            <span class="n">camera_set</span><span class="o">.</span><span class="n">image_folder</span>
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>        <span class="p">)</span>
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="n">output_filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">camera_filename</span><span class="p">)</span>
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>        <span class="c1"># This may create nested folders in the output dir</span>
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span>
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>        <span class="k">if</span> <span class="n">rendered</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>            <span class="n">output_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>            <span class="c1"># Save the image</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>            <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">rendered</span><span class="p">,</span> <span class="n">check_contrast</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>            <span class="n">output_filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_filename</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.npy&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>            <span class="c1"># Save the image</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">rendered</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.select_mesh_ROI" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">select_mesh_ROI</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">,</span> <span class="n">buffer_meters</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">simplify_tol_meters</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">default_CRS</span><span class="o">=</span><span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span> <span class="n">return_original_IDs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.select_mesh_ROI" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a subset of the mesh based on geospatial data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>region_of_interest</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="shapely.Polygon">Polygon</span>, <span title="shapely.MultiPolygon">MultiPolygon</span>, <span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Region of interest. Can be a
* dataframe, where all columns will be colapsed
* A shapely polygon/multipolygon
* A file that can be loaded by geopandas</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>buffer_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Expand the geometry by this amount of meters. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>simplify_tol_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Simplify the geometry using this as the tolerance. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_CRS</code>
            </td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The CRS to use if one isn't provided. Defaults to pyproj.CRS.from_epsg(4326).</p>
              </div>
            </td>
            <td>
                  <code><span title="pyproj.CRS.from_epsg">from_epsg</span>(4326)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_original_IDs</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return the indices into the original mesh. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pyvista.PolyData: The subset of the mesh</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: The indices of the points in the original mesh (only if return_original_IDs set)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: The indices of the faces in the original mesh (only if return_original_IDs set)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="k">def</span><span class="w"> </span><span class="nf">select_mesh_ROI</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="n">region_of_interest</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>        <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">,</span> <span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="p">],</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="n">buffer_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="n">simplify_tol_meters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>    <span class="n">default_CRS</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span> <span class="o">=</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">),</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="n">return_original_IDs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="p">):</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a subset of the mesh based on geospatial data</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="sd">        region_of_interest (typing.Union[gpd.GeoDataFrame, Polygon, MultiPolygon, PATH_TYPE]):</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">            Region of interest. Can be a</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">            * dataframe, where all columns will be colapsed</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">            * A shapely polygon/multipolygon</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">            * A file that can be loaded by geopandas</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        buffer_meters (float, optional): Expand the geometry by this amount of meters. Defaults to 0.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        simplify_tol_meters (float, optional): Simplify the geometry using this as the tolerance. Defaults to 0.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        default_CRS (pyproj.CRS, optional): The CRS to use if one isn&#39;t provided. Defaults to pyproj.CRS.from_epsg(4326).</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a><span class="sd">        return_original_IDs (bool, optional): Return the indices into the original mesh. Defaults to False.</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a><span class="sd">        pyvista.PolyData: The subset of the mesh</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a><span class="sd">        np.ndarray: The indices of the points in the original mesh (only if return_original_IDs set)</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a><span class="sd">        np.ndarray: The indices of the faces in the original mesh (only if return_original_IDs set)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="k">if</span> <span class="n">region_of_interest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="c1"># Get the ROI into a geopandas GeoDataFrame</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Standardizing ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">region_of_interest</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">,</span> <span class="p">(</span><span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPolygon</span><span class="p">)):</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">default_CRS</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="p">[</span><span class="n">region_of_interest</span><span class="p">])</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">region_of_interest</span><span class="p">)</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dissolving ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="c1"># Disolve to ensure there is only one row</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting CRS and buffering ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="c1"># Make sure we&#39;re using a projected CRS so a buffer can be applied</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">ensure_projected_CRS</span><span class="p">(</span><span class="n">ROI_gpd</span><span class="p">)</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>    <span class="c1"># Apply the buffer, plus the tolerance, to ensure we keep at least the requested region</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="n">ROI_gpd</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer_meters</span> <span class="o">+</span> <span class="n">simplify_tol_meters</span><span class="p">)</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="c1"># Simplify the geometry to reduce the computational load</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">simplify_tol_meters</span><span class="p">)</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dissolving buffered ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="c1"># Disolve again in case</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="n">ROI_gpd</span> <span class="o">=</span> <span class="n">ROI_gpd</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting verts for dataframe&quot;</span><span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="c1"># Get the vertices as a dataframe in the same CRS</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="n">verts_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_verts_geodataframe</span><span class="p">(</span><span class="n">ROI_gpd</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking intersection of verts with ROI&quot;</span><span class="p">)</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>    <span class="c1"># Determine which vertices are within the ROI polygon</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="n">verts_in_ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">verts_df</span><span class="p">,</span> <span class="n">ROI_gpd</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;intersection&quot;</span><span class="p">)</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="c1"># Extract the IDs of the set within the polygon</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">vert_inds</span> <span class="o">=</span> <span class="n">verts_in_ROI</span><span class="p">[</span><span class="s2">&quot;vert_ID&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting points from pyvista mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="c1"># Extract a submesh using these IDs, which is returned as an UnstructuredGrid</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="n">subset_unstructured_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">extract_points</span><span class="p">(</span><span class="n">vert_inds</span><span class="p">)</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extraction surface from subset mesh&quot;</span><span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="c1"># Convert the unstructured grid to a PolyData (mesh) again</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="n">subset_mesh</span> <span class="o">=</span> <span class="n">subset_unstructured_grid</span><span class="o">.</span><span class="n">extract_surface</span><span class="p">()</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="c1"># If we need the indices into the original mesh, return those</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>    <span class="k">if</span> <span class="n">return_original_IDs</span><span class="p">:</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="n">point_IDs</span> <span class="o">=</span> <span class="n">subset_unstructured_grid</span><span class="p">[</span><span class="s2">&quot;vtkOriginalPointIds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>            <span class="n">face_IDs</span> <span class="o">=</span> <span class="n">subset_unstructured_grid</span><span class="p">[</span><span class="s2">&quot;vtkOriginalCellIds&quot;</span><span class="p">]</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="n">point_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="n">face_IDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>        <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>            <span class="n">subset_mesh</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="n">point_IDs</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>            <span class="n">face_IDs</span><span class="p">,</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="p">)</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="c1"># Else return just the mesh</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="k">return</span> <span class="n">subset_mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.set_texture" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">set_texture</span><span class="p">(</span><span class="n">texture_array</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_discrete_texture_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_vertex_texture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_derived_IDs_to_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">delete_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.set_texture" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Set the internal texture representation</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>texture_array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The array of texture values. The first dimension must be the length of faces or verts. A second dimension is optional.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping from integer IDs to string names. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_discrete_texture_values</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Are all the texture values known to be discrete, representing IDs. Computed from the data if not set. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_vertex_texture</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="bool">bool</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Are the texture values supposed to correspond to the vertices. Computed from the data if not set. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_derived_IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use IDs to labels derived from data if not explicitly provided. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delete_existing</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Delete the existing texture when the other one (face, vertex) is set. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the size of the texture doesn't match the number of either faces or vertices</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the number of faces and vertices are the same and is_vertex_texture isn't set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_texture</span><span class="p">(</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">texture_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="n">all_discrete_texture_values</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>    <span class="n">is_vertex_texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="n">use_derived_IDs_to_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="n">delete_existing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="p">):</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the internal texture representation</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        texture_array (np.ndarray):</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">            The array of texture values. The first dimension must be the length of faces or verts. A second dimension is optional.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        IDs_to_labels (typing.Union[None, dict], optional): Mapping from integer IDs to string names. Defaults to None.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        all_discrete_texture_values (typing.Union[typing.List, None], optional):</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">            Are all the texture values known to be discrete, representing IDs. Computed from the data if not set. Defaults to None.</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        is_vertex_texture (typing.Union[bool, None], optional):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">            Are the texture values supposed to correspond to the vertices. Computed from the data if not set. Defaults to None.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        use_derived_IDs_to_labels (bool, optional): Use IDs to labels derived from data if not explicitly provided. Defaults to False.</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        delete_existing (bool, optional): Delete the existing texture when the other one (face, vertex) is set. Defaults to True.</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a><span class="sd">        ValueError: If the size of the texture doesn&#39;t match the number of either faces or vertices</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a><span class="sd">        ValueError: If the number of faces and vertices are the same and is_vertex_texture isn&#39;t set</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">texture_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize_texture</span><span class="p">(</span><span class="n">texture_array</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="c1"># IDs_to_labels (typing.Union[None, dict]): Dictionary mapping from integer IDs to string class names</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="c1"># If it is not specified whether this is a vertex texture, attempt to infer it from the shape</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="c1"># TODO consider refactoring to check whether it matches the number of one of them,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="c1"># no matter whether is_vertex_texture is specified</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="k">if</span> <span class="n">is_vertex_texture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="c1"># Check that the number of matches face or verts</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">n_values</span> <span class="o">=</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>        <span class="n">n_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">n_verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="k">if</span> <span class="n">n_verts</span> <span class="o">==</span> <span class="n">n_faces</span><span class="p">:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>                <span class="s2">&quot;Cannot infer whether texture should be applied to vertices of faces because the number is the same&quot;</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>            <span class="p">)</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="k">elif</span> <span class="n">n_values</span> <span class="o">==</span> <span class="n">n_verts</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">is_vertex_texture</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="k">elif</span> <span class="n">n_values</span> <span class="o">==</span> <span class="n">n_faces</span><span class="p">:</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">is_vertex_texture</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="sa">f</span><span class="s2">&quot;The number of elements in the texture (</span><span class="si">{</span><span class="n">n_values</span><span class="si">}</span><span class="s2">) did not match the number of faces (</span><span class="si">{</span><span class="n">n_faces</span><span class="si">}</span><span class="s2">) or vertices (</span><span class="si">{</span><span class="n">n_verts</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="c1"># Ensure that the actual data type is float, and record label names</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">if</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="c1"># If it is more than one column, it&#39;s assumed to be a real-valued</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="c1"># quantity and we try to cast it to a float</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">texture_array</span> <span class="o">=</span> <span class="n">texture_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">derived_IDs_to_labels</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="n">texture_array</span><span class="p">,</span> <span class="n">derived_IDs_to_labels</span> <span class="o">=</span> <span class="n">ensure_float_labels</span><span class="p">(</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">texture_array</span><span class="p">,</span> <span class="n">full_array</span><span class="o">=</span><span class="n">all_discrete_texture_values</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>        <span class="p">)</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="c1"># If IDs to labels is explicitly provided, trust that</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="c1"># TODO should do some type checking here</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">IDs_to_labels</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="c1"># If not, but we can compute it, use that. Otherwise, we might want to force them to be set to None</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="k">elif</span> <span class="n">use_derived_IDs_to_labels</span><span class="p">:</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="n">derived_IDs_to_labels</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="c1"># Set the appropriate texture and optionally delete the other one</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="k">if</span> <span class="n">is_vertex_texture</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="o">=</span> <span class="n">texture_array</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="o">=</span> <span class="n">texture_array</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">if</span> <span class="n">delete_existing</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.transfer_texture" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">transfer_texture</span><span class="p">(</span><span class="n">downsampled_mesh</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.transfer_texture" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Transfer texture from original mesh to a downsampled version using KDTree for nearest neighbor point searches</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>downsampled_mesh</code>
            </td>
            <td>
                  <code><span title="pyvista.PolyData">PolyData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The downsampled version of the original mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pv.PolyData: The downsampled mesh with the transferred textures</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="k">def</span><span class="w"> </span><span class="nf">transfer_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">downsampled_mesh</span><span class="p">):</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transfer texture from original mesh to a downsampled version using KDTree for nearest neighbor point searches</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        downsampled_mesh (pv.PolyData): The downsampled version of the original mesh</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">        pv.PolyData: The downsampled mesh with the transferred textures</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="c1"># Only transfer textures if there are point based scalars in the original mesh</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="c1"># Store original mesh points in KDTree for nearest neighbor search</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">kdtree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="c1"># For ecah point in the downsampled mesh find the nearest neighbor point in the original mesh</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">nearest_neighbor_indices</span> <span class="o">=</span> <span class="n">kdtree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">downsampled_mesh</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="c1"># Iterate over all the point based scalars</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">for</span> <span class="n">scalar_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="c1"># Retrieve scalar data of appropriate index using the nearest neighbor indices</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">transferred_scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">][</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">nearest_neighbor_indices</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="p">]</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="c1"># Set the corresponding scalar data in the downsampled mesh</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">downsampled_mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="n">scalar_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">transferred_scalars</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="c1"># Set active mesh of downsampled mesh</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">downsampled_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="s2">&quot;Textures not transferred, active scalars data is assoicated with cell data not point data&quot;</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="k">return</span> <span class="n">downsampled_mesh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.transform_vertices" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">transform_vertices</span><span class="p">(</span><span class="n">transform_4x4</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.transform_vertices" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Apply a transform to the vertex coordinates</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>transform_4x4</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transform to be applied</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>in_place</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should the vertices be updated for all member objects</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="k">def</span><span class="w"> </span><span class="nf">transform_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform_4x4</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">in_place</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply a transform to the vertex coordinates</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        transform_4x4 (np.ndarray): Transform to be applied</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">        in_place (bool): Should the vertices be updated for all member objects</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>    <span class="n">homogenous_local_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>    <span class="n">transformed_local_points</span> <span class="o">=</span> <span class="n">transform_4x4</span> <span class="o">@</span> <span class="n">homogenous_local_points</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">transformed_local_points</span> <span class="o">=</span> <span class="n">transformed_local_points</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="c1"># Overwrite existing vertices in both pytorch3d and pyvista mesh</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>    <span class="k">if</span> <span class="n">in_place</span><span class="p">:</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">transformed_local_points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">return</span> <span class="n">transformed_local_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="geograypher.meshes.TexturedPhotogrammetryMesh.vis" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <code class="highlight language-python"><span class="n">vis</span><span class="p">(</span><span class="n">plotter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">camera_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">screenshot_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vis_scalars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interactive_jupyter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plotter_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">enable_ssao</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force_xvfb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.meshes.TexturedPhotogrammetryMesh.vis" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Show the mesh and cameras</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>plotter</code>
            </td>
            <td>
                  <code><span title="pyvista.Plotter">Plotter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plotter to use, else one will be created</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>off_screen</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show offscreen</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>camera_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            PhotogrammetryCameraSet (geograypher.cameras.PhotogrammetryCameraSet)" href="../../cameras/cameras/#geograypher.cameras.PhotogrammetryCameraSet">PhotogrammetryCameraSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cameras to visualize. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>screenshot_filename</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filepath to save to, will show interactively if None. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vis_scalars</code>
            </td>
            <td>
                  <code>(None, <span title="numpy.ndarray">ndarray</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scalars to show</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict of keyword arguments for the mesh</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interactive_jupyter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should jupyter windows be interactive. This doesn't always work, especially on VSCode.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plotter_kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict of keyword arguments for the plotter</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frustum_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Size of cameras in world units. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code>[None, <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping from IDs to human readable labels for discrete classes. Defaults to the mesh
IDs_to_labels if unset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/meshes/meshes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1875" name="__codelineno-0-1875"></a><span class="k">def</span><span class="w"> </span><span class="nf">vis</span><span class="p">(</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>    <span class="n">plotter</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>    <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>    <span class="n">camera_set</span><span class="p">:</span> <span class="n">PhotogrammetryCameraSet</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1880" name="__codelineno-0-1880"></a>    <span class="n">screenshot_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>    <span class="n">vis_scalars</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1882" name="__codelineno-0-1882"></a>    <span class="n">mesh_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a>    <span class="n">interactive_jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a>    <span class="n">plotter_kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a>    <span class="n">enable_ssao</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a>    <span class="n">force_xvfb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>    <span class="n">frustum_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a><span class="p">):</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Show the mesh and cameras</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="sd">        plotter (pyvista.Plotter, optional):</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">            Plotter to use, else one will be created</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a><span class="sd">        off_screen (bool, optional):</span>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">            Show offscreen</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><span class="sd">        camera_set (PhotogrammetryCameraSet, optional):</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="sd">            Cameras to visualize. Defaults to None.</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">        screenshot_filename (PATH_TYPE, optional):</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a><span class="sd">            Filepath to save to, will show interactively if None. Defaults to None.</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">        vis_scalars (None, np.ndarray):</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">            Scalars to show</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><span class="sd">        mesh_kwargs:</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">            dict of keyword arguments for the mesh</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="sd">        interactive_jupyter (bool):</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">            Should jupyter windows be interactive. This doesn&#39;t always work, especially on VSCode.</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">        plotter_kwargs:</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">            dict of keyword arguments for the plotter</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">        frustum_scale (float, optional):</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">            Size of cameras in world units. Defaults to None.</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">        IDs_to_labels ([None, dict], optional):</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">            Mapping from IDs to human readable labels for discrete classes. Defaults to the mesh</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="sd">            IDs_to_labels if unset.</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>    <span class="n">off_screen</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">interactive</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">screenshot_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>    <span class="c1"># If the IDs to labels is not set, use the default ones for this mesh</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>    <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>        <span class="n">IDs_to_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">()</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>    <span class="c1"># Set the mesh kwargs if not set</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>    <span class="k">if</span> <span class="n">mesh_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>        <span class="c1"># This needs to be a dict, even if it&#39;s empty</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>        <span class="n">mesh_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>        <span class="c1"># If there are discrete labels, set the colormap and limits inteligently</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>        <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>            <span class="c1"># Compute the largest ID</span>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>            <span class="n">max_ID</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>            <span class="k">if</span> <span class="n">max_ID</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>                    <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_hex</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>                        <span class="p">(</span><span class="s2">&quot;tab10&quot;</span> <span class="k">if</span> <span class="n">max_ID</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="s2">&quot;tab20&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>                    <span class="p">)</span><span class="o">.</span><span class="n">colors</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>                <span class="p">]</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>                <span class="n">mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;cmap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">max_ID</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>                <span class="n">mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;clim&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_ID</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>    <span class="c1"># Create the plotter if it&#39;s None</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>    <span class="n">plotter</span> <span class="o">=</span> <span class="n">create_pv_plotter</span><span class="p">(</span>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>        <span class="n">off_screen</span><span class="o">=</span><span class="n">off_screen</span><span class="p">,</span> <span class="n">force_xvfb</span><span class="o">=</span><span class="n">force_xvfb</span><span class="p">,</span> <span class="n">plotter</span><span class="o">=</span><span class="n">plotter</span>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>    <span class="p">)</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>    <span class="c1"># If the vis scalars are None, use the saved texture</span>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>    <span class="k">if</span> <span class="n">vis_scalars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>        <span class="n">vis_scalars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_texture</span><span class="p">(</span>
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>            <span class="c1"># Request vertex texture if both are available</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>            <span class="n">request_vertex_texture</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>                <span class="kc">True</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>                <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">vertex_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_texture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>                <span class="p">)</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>                <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>            <span class="p">)</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>        <span class="p">)</span>
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>    <span class="n">is_rgb</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="o">.</span><span class="n">active_scalars_name</span> <span class="o">==</span> <span class="s2">&quot;RGB&quot;</span>
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>        <span class="k">if</span> <span class="n">vis_scalars</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>        <span class="k">else</span> <span class="p">(</span><span class="n">vis_scalars</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">vis_scalars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>    <span class="p">)</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>    <span class="c1"># Data in the range [0, 255] must be uint8 type</span>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>    <span class="k">if</span> <span class="n">is_rgb</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vis_scalars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>        <span class="n">vis_scalars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">vis_scalars</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>    <span class="n">scalar_bar_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vertical&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>    <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;annotations&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mesh_kwargs</span><span class="p">:</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>        <span class="n">mesh_kwargs</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IDs_to_labels</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>        <span class="n">scalar_bar_args</span><span class="p">[</span><span class="s2">&quot;n_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>    <span class="c1"># Add the mesh</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>    <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyvista_mesh</span><span class="p">,</span>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>        <span class="n">scalars</span><span class="o">=</span><span class="n">vis_scalars</span><span class="p">,</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>        <span class="n">rgb</span><span class="o">=</span><span class="n">is_rgb</span><span class="p">,</span>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>        <span class="n">scalar_bar_args</span><span class="o">=</span><span class="n">scalar_bar_args</span><span class="p">,</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>        <span class="o">**</span><span class="n">mesh_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>    <span class="p">)</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>    <span class="c1"># If the camera set is provided, show this too</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>    <span class="k">if</span> <span class="n">camera_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>        <span class="c1"># Adjust the frustum scale if the mesh came from metashape</span>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>        <span class="c1"># Find the cube root of the determinant of the upper-left 3x3 submatrix to find the scaling factor</span>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>            <span class="ow">and</span> <span class="n">frustum_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>        <span class="p">):</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>            <span class="n">transform_determinant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">local_to_epgs_4978_transform</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>            <span class="p">)</span>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">transform_determinant</span><span class="p">)</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>            <span class="n">frustum_scale</span> <span class="o">=</span> <span class="n">frustum_scale</span> <span class="o">/</span> <span class="n">scale_factor</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>        <span class="n">camera_set</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span>
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>            <span class="n">plotter</span><span class="p">,</span> <span class="n">add_orientation_cube</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frustum_scale</span><span class="o">=</span><span class="n">frustum_scale</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>        <span class="p">)</span>
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>    <span class="c1"># Enable screen space shading</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>    <span class="k">if</span> <span class="n">enable_ssao</span><span class="p">:</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>        <span class="n">plotter</span><span class="o">.</span><span class="n">enable_ssao</span><span class="p">()</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>    <span class="c1"># Create parent folder if none exists</span>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>    <span class="k">if</span> <span class="n">screenshot_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">screenshot_filename</span><span class="p">)</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>    <span class="k">if</span> <span class="s2">&quot;jupyter_backend&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotter_kwargs</span><span class="p">:</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>        <span class="k">if</span> <span class="n">interactive_jupyter</span><span class="p">:</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>            <span class="n">plotter_kwargs</span><span class="p">[</span><span class="s2">&quot;jupyter_backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;trame&quot;</span>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>            <span class="n">plotter_kwargs</span><span class="p">[</span><span class="s2">&quot;jupyter_backend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;static&quot;</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>    <span class="k">if</span> <span class="s2">&quot;title&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">plotter_kwargs</span><span class="p">:</span>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>        <span class="n">plotter_kwargs</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Geograypher mesh viewer&quot;</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>    <span class="c1"># Show</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>    <span class="k">return</span> <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>        <span class="n">screenshot</span><span class="o">=</span><span class="n">screenshot_filename</span><span class="p">,</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>        <span class="o">**</span><span class="n">plotter_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 5, 2024 16:03:08 UTC">July 5, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 3, 2024 19:46:43 UTC">July 3, 2024</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/russelldj" class="md-author" title="@russelldj">
          
          <img src="https://avatars.githubusercontent.com/u/29384527?v=4&size=72" alt="russelldj">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>