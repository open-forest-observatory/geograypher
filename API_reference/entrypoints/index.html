
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../software_design/">
      
      
        <link rel="next" href="../meshes/">
      
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Entrypoints - Geograypher Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#geograypher.entrypoints.render_labels.render_labels" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Geograypher Documentation" class="md-header__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../assets/logo-shaded.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Geograypher Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Entrypoints
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://openforestobservatory.org/" class="md-tabs__link">
        
  
  
    
  
  ‚Üê OFO home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting_started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples_and_applications/examples/" class="md-tabs__link">
          
  
  
    
  
  Examples and applications

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../software_design/" class="md-tabs__link">
        
  
  
    
  
  Software design

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Geograypher Documentation" class="md-nav__button md-logo" aria-label="Geograypher Documentation" data-md-component="logo">
      
  <img src="../../assets/logo-shaded.png" alt="logo">

    </a>
    Geograypher Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/open-forest-observatory/geograypher" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    open-forest-observatory/geograypher
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://openforestobservatory.org/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ‚Üê OFO home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/conceptual_workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conceptual workflow
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples and applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples and applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples_and_applications/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples_and_applications/applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects using geograypher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software design
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Entrypoints
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Entrypoints
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.render_labels.render_labels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;render_labels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.aggregate_images.aggregate_images" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;aggregate_images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.project_detections.project_detections" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;project_detections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.label_polygons.label_polygons" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;label_polygons
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../meshes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Meshes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Meshes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meshes/derived_meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meshes/meshes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mesh Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../cameras/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cameras
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Cameras
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cameras/cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cameras/derived_cameras/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Cameras Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cameras/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor Docstrings
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../predictors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Predictors
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_4" id="__nav_6_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Predictors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../predictors/segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../predictors/derived_segmentors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Derived Segmentors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../predictors/ortho_segmentor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ortho segmentor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_5" id="__nav_6_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/numeric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Numeric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/indexing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Indexing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/geometric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geometric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/geospatial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Geospatial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/parsing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parsing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/prediction_metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prediction metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/example_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Example Data
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.render_labels.render_labels" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;render_labels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.aggregate_images.aggregate_images" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;aggregate_images
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.project_detections.project_detections" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;project_detections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#geograypher.entrypoints.label_polygons.label_polygons" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;label_polygons
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/open-forest-observatory/geograypher/edit/main/docs/API_reference/entrypoints.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


  <h1>Entrypoints</h1>

<p>Entrypoints are functions can be directly called to perform a high-level task. Each of the entrypoints listed below can be called as a command line script. These scripts accept arguments that are directly passed to these functions.</p>


<div class="doc doc-object doc-function">


<h2 id="geograypher.entrypoints.render_labels.render_labels" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">render_labels</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">,</span> <span class="n">cameras_file</span><span class="p">,</span> <span class="n">image_folder</span><span class="p">,</span> <span class="n">texture</span><span class="p">,</span> <span class="n">render_savefolder</span><span class="p">,</span> <span class="n">input_CRS</span><span class="p">,</span> <span class="n">original_image_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subset_images_savefolder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">texture_column_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">DTM_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ground_height_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_ground_class</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">textured_mesh_savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_ROI_buffer_radius_meters</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">cameras_ROI_buffer_radius_meters</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">render_image_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mesh_downsample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_render_clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mesh_vis_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels_vis_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#geograypher.entrypoints.render_labels.render_labels" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">

        <p>Renders image-based labels using geospatial ground truth data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Metashape-exported mesh file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cameras_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the MetaShape-exported .xml cameras file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder of images used to create the mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>texture</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="numpy.ndarray">ndarray</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>See TexturedPhotogrammetryMesh.load_texture</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_savefolder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save the rendered labels</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_CRS</code>
            </td>
            <td>
                  <code><span title="pyproj.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(pyproj.CRS):
The vertex coordinates of the input mesh should be interpreteted in this coordinate
references system to georeference them. Since meshes are not commonly used for
geospatial tasks, there isn't a common standard for encoding this information in the mesh.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_image_folder</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where the images were when photogrammetry was run. Metashape saves imagenames with an
absolute path which can cause issues. If this argument is provided, this path is removed
from the start of each image file name, which allows the camera set to be used with a
moved folder of images specified by <code>image_folder</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subset_images_savefolder</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save the subset of images for which labels are generated. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>texture_column_name</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column to use in vector file for texture information". Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>DTM_file</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a DTM file to use for ground thresholding. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_height_threshold</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="float">float</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set points under this height to ground. Only applicable if DTM_file is provided. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_ground_class</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Should the ground class be included in the renders or deleted.. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>textured_mesh_savefile</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save the textured and subsetted mesh, if needed in the future. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, <span title="geopandas.GeoDataFrame">GeoDataFrame</span>, <span title="shapely.MultiPolygon">MultiPolygon</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The region of interest to render labels for. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_ROI_buffer_radius_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance in meters to include around the ROI for the mesh. Defaults to 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cameras_ROI_buffer_radius_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance in meters to include around the ROI for the cameras. Defaults to 150.</p>
              </div>
            </td>
            <td>
                  <code>150</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[None, <span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping between the integer labels and string values for the classes. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>render_image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample the images to this fraction of the size for increased performance but lower quality. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_downsample</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample the mesh to this fraction of vertices for increased performance but lower quality. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_render_clusters</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, break the camera set and mesh into this many clusters before rendering. This is
useful for large meshes that are otherwise very slow. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/entrypoints/render_labels.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">render_labels</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">mesh_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">cameras_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">image_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">texture</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">render_savefolder</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">input_CRS</span><span class="p">:</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">original_image_folder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">subset_images_savefolder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">texture_column_name</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">DTM_file</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">ground_height_threshold</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">render_ground_class</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">textured_mesh_savefile</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">ROI</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">mesh_ROI_buffer_radius_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">cameras_ROI_buffer_radius_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">render_image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">mesh_downsample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">n_render_clusters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">vis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">mesh_vis_file</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">labels_vis_folder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="p">):</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders image-based labels using geospatial ground truth data</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        mesh_file (PATH_TYPE):</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            Path to the Metashape-exported mesh file</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        cameras_file (PATH_TYPE):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            Path to the MetaShape-exported .xml cameras file</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        image_folder (PATH_TYPE):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            Path to the folder of images used to create the mesh</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        texture (typing.Union[PATH_TYPE, np.ndarray, None]):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            See TexturedPhotogrammetryMesh.load_texture</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        render_savefolder (PATH_TYPE):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            Where to save the rendered labels</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        input_CRS: (pyproj.CRS):</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            The vertex coordinates of the input mesh should be interpreteted in this coordinate</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            references system to georeference them. Since meshes are not commonly used for</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            geospatial tasks, there isn&#39;t a common standard for encoding this information in the mesh.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        original_image_folder (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            Where the images were when photogrammetry was run. Metashape saves imagenames with an</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            absolute path which can cause issues. If this argument is provided, this path is removed</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            from the start of each image file name, which allows the camera set to be used with a</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            moved folder of images specified by `image_folder`. Defaults to None.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        subset_images_savefolder (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            Where to save the subset of images for which labels are generated. Defaults to None.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        texture_column_name (typing.Union[str, None], optional):</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            Column to use in vector file for texture information&quot;. Defaults to None.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        DTM_file (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            Path to a DTM file to use for ground thresholding. Defaults to None.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        ground_height_threshold (typing.Union[float, None], optional):</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            Set points under this height to ground. Only applicable if DTM_file is provided. Defaults to None.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        render_ground_class (bool, optional):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            Should the ground class be included in the renders or deleted.. Defaults to False.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        textured_mesh_savefile (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            Where to save the textured and subsetted mesh, if needed in the future. Defaults to None.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        ROI (typing.Union[PATH_TYPE, gpd.GeoDataFrame, shapely.MultiPolygon, None], optional):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            The region of interest to render labels for. Defaults to None.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        mesh_ROI_buffer_radius_meters (float, optional):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            The distance in meters to include around the ROI for the mesh. Defaults to 50.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        cameras_ROI_buffer_radius_meters (float, optional):</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            The distance in meters to include around the ROI for the cameras. Defaults to 150.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        IDs_to_labels (typing.Union[None, dict], optional):</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            Mapping between the integer labels and string values for the classes. Defaults to None.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        render_image_scale (float, optional):</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            Downsample the images to this fraction of the size for increased performance but lower quality. Defaults to 1.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        mesh_downsample (float, optional):</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            Downsample the mesh to this fraction of vertices for increased performance but lower quality. Defaults to 1.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        n_render_clusters (typing.Union[int, None]):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            If set, break the camera set and mesh into this many clusters before rendering. This is</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            useful for large meshes that are otherwise very slow. Defaults to None.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        mesh_vis (typing.Union[PATH_TYPE, None])</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            Path to save the visualized mesh instead of showing it interactively. Only applicable if vis=True. Defaults to None.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        labels_vis (typing.Union[PATH_TYPE, None])</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="c1">## Determine the ROI</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="c1"># If the ROI is unset and the texture is a geodataframe, set the ROI to that</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">if</span> <span class="n">ROI</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">):</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">texture</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="k">elif</span> <span class="n">ROI</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">ROI</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">texture</span><span class="p">)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">except</span> <span class="n">fiona</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">DriverError</span><span class="p">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="k">pass</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="c1">## Create the camera set</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># This is done first because it&#39;s often faster than mesh operations which</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="c1"># makes it a good place to check for failures</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">camera_set</span> <span class="o">=</span> <span class="n">MetashapeCameraSet</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">cameras_file</span><span class="p">,</span> <span class="n">image_folder</span><span class="p">,</span> <span class="n">original_image_folder</span><span class="o">=</span><span class="n">original_image_folder</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="n">ROI</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="c1"># Extract cameras near the training data</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">camera_set</span> <span class="o">=</span> <span class="n">camera_set</span><span class="o">.</span><span class="n">get_subset_ROI</span><span class="p">(</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span> <span class="n">buffer_radius</span><span class="o">=</span><span class="n">cameras_ROI_buffer_radius_meters</span><span class="p">,</span> <span class="n">is_geospatial</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="c1"># If requested, save out the images corresponding to this subset of cameras.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="c1"># This is useful for model training.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">if</span> <span class="n">subset_images_savefolder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">camera_set</span><span class="o">.</span><span class="n">save_images</span><span class="p">(</span><span class="n">subset_images_savefolder</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># Select whether to use a class that renders by chunks or not</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">MeshClass</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">TexturedPhotogrammetryMesh</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">if</span> <span class="n">n_render_clusters</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">else</span> <span class="n">TexturedPhotogrammetryMeshChunked</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="c1">## Create the textured mesh</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">MeshClass</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">mesh_file</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">input_CRS</span><span class="o">=</span><span class="n">input_CRS</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">downsample_target</span><span class="o">=</span><span class="n">mesh_downsample</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">texture</span><span class="o">=</span><span class="n">texture</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">texture_column_name</span><span class="o">=</span><span class="n">texture_column_name</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="n">mesh_ROI_buffer_radius_meters</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="c1">## Set the ground class if applicable</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">if</span> <span class="n">DTM_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ground_height_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="c1"># The ground ID will be set to the next value if None, or np.nan if np.nan</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">ground_ID</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">render_ground_class</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">label_ground_class</span><span class="p">(</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="n">DTM_file</span><span class="o">=</span><span class="n">DTM_file</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">height_above_ground_threshold</span><span class="o">=</span><span class="n">ground_height_threshold</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">only_label_existing_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="n">ground_class_name</span><span class="o">=</span><span class="s2">&quot;GROUND&quot;</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">ground_ID</span><span class="o">=</span><span class="n">ground_ID</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">set_mesh_texture</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="c1"># Save the textured and subsetted mesh, if applicable</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="k">if</span> <span class="n">textured_mesh_savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">(</span><span class="n">textured_mesh_savefile</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="c1"># Show the cameras and mesh if requested</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="k">if</span> <span class="n">vis</span> <span class="ow">or</span> <span class="n">mesh_vis_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">camera_set</span><span class="o">=</span><span class="n">camera_set</span><span class="p">,</span> <span class="n">screenshot_filename</span><span class="o">=</span><span class="n">mesh_vis_file</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="c1"># Include n_render_clusters as an optional keyword argument, if provided. This is only applicable</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="c1"># if this mesh is a TexturedPhotogrammetryMeshChunked object</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">render_kwargs</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="p">{}</span> <span class="k">if</span> <span class="n">n_render_clusters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;n_clusters&quot;</span><span class="p">:</span> <span class="n">n_render_clusters</span><span class="p">}</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="c1"># Render the labels and save them. This is the slow step.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">mesh</span><span class="o">.</span><span class="n">save_renders</span><span class="p">(</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">camera_set</span><span class="o">=</span><span class="n">camera_set</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">render_image_scale</span><span class="o">=</span><span class="n">render_image_scale</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">save_native_resolution</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">output_folder</span><span class="o">=</span><span class="n">render_savefolder</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">make_composites</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="o">**</span><span class="n">render_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="k">if</span> <span class="n">vis</span> <span class="ow">or</span> <span class="n">labels_vis_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="c1"># Show some examples of the rendered labels side-by-side with the real images</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">show_segmentation_labels</span><span class="p">(</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">label_folder</span><span class="o">=</span><span class="n">render_savefolder</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">image_folder</span><span class="o">=</span><span class="n">image_folder</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">savefolder</span><span class="o">=</span><span class="n">labels_vis_folder</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">num_show</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geograypher.entrypoints.aggregate_images.aggregate_images" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">aggregate_images</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">,</span> <span class="n">cameras_file</span><span class="p">,</span> <span class="n">image_folder</span><span class="p">,</span> <span class="n">label_folder</span><span class="p">,</span> <span class="n">original_image_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subset_images_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename_regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">take_every_nth_camera</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">mesh_transform_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">DTM_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_above_ground_threshold</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ROI_buffer_radius_meters</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mesh_downsample</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n_aggregation_clusters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_cameras_per_aggregation_cluster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aggregate_image_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">aggregated_face_values_savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">predicted_face_classes_savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_down_vector_projection_savefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.entrypoints.aggregate_images.aggregate_images" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">

        <p>Aggregate labels from multiple viewpoints onto the surface of the mesh</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Metashape-exported mesh file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cameras_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the MetaShape-exported .xml cameras file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder of images used to create the mesh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename_regex</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use only images with paths matching this regex</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder of labels to be aggregated onto the mesh. Must be in the same
structure as the images</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>original_image_folder</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where the images were when photogrammetry was run. Metashape saves imagenames with an
absolute path which can cause issues. If this argument is provided, this path is removed
from the start of each image file name, which allows the camera set to be used with a
moved folder of images specified by <code>image_folder</code>. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subset_images_folder</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use only images from this subset. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>take_every_nth_camera</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample the camera set to only every nth camera if set. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_transform_file</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transform from the mesh coordinates to the earth-centered, earth-fixed frame. Can be a
4x4 matrix represented as a .csv, or a Metashape cameras file containing the
information. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>DTM_file</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a digital terrain model file to remove ground points. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_above_ground_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height in meters above the DTM to consider ground. Only used if DTM_file is set.
Defaults to 2.0.</p>
              </div>
            </td>
            <td>
                  <code>2.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geofile region of interest to crop the mesh to. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI_buffer_radius_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keep points within this distance of the provided ROI object, if unset, everything will
be kept. Defaults to 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="dict">dict</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maps from integer IDs to human-readable class name labels. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_downsample</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample the mesh to this fraction of vertices for increased performance but lower
quality. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_aggregation_clusters</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, aggregate with this many clusters. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_cameras_per_aggregation_cluster</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="int">int</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If set, and n_aggregation_clusters is not, use to compute a number of clusters such that
each cluster has this many cameras. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_image_scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Downsample the labels before aggregation for faster runtime but lower quality. Defaults
to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregated_face_values_savefile</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save the aggregated image values as a numpy array. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>predicted_face_classes_savefile</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save the most common label per face texture as a numpy array. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_down_vector_projection_savefile</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to export the predicted map. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vis</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show the mesh model and predicted results. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/entrypoints/aggregate_images.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">aggregate_images</span><span class="p">(</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">mesh_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">cameras_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">image_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">label_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">original_image_folder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">subset_images_folder</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">filename_regex</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">take_every_nth_camera</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">mesh_transform_file</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">DTM_file</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">height_above_ground_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">ROI</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">ROI_buffer_radius_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">mesh_downsample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">n_aggregation_clusters</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">n_cameras_per_aggregation_cluster</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">aggregate_image_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">aggregated_face_values_savefile</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">predicted_face_classes_savefile</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">top_down_vector_projection_savefile</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">vis</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="p">):</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate labels from multiple viewpoints onto the surface of the mesh</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        mesh_file (PATH_TYPE):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            Path to the Metashape-exported mesh file</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        cameras_file (PATH_TYPE):</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            Path to the MetaShape-exported .xml cameras file</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        image_folder (PATH_TYPE):</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            Path to the folder of images used to create the mesh</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        filename_regex (str, optional):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            Use only images with paths matching this regex</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        label_folder (PATH_TYPE):</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            Path to the folder of labels to be aggregated onto the mesh. Must be in the same</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            structure as the images</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        original_image_folder (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            Where the images were when photogrammetry was run. Metashape saves imagenames with an</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            absolute path which can cause issues. If this argument is provided, this path is removed</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            from the start of each image file name, which allows the camera set to be used with a</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            moved folder of images specified by `image_folder`. Defaults to None.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        subset_images_folder (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            Use only images from this subset. Defaults to None.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        take_every_nth_camera (typing.Union[int, None], optional):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            Downsample the camera set to only every nth camera if set. Defaults to None.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        mesh_transform_file (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            Transform from the mesh coordinates to the earth-centered, earth-fixed frame. Can be a</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            4x4 matrix represented as a .csv, or a Metashape cameras file containing the</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            information. Defaults to None.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        DTM_file (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            Path to a digital terrain model file to remove ground points. Defaults to None.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        height_above_ground_threshold (float, optional):</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            Height in meters above the DTM to consider ground. Only used if DTM_file is set.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            Defaults to 2.0.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        ROI (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            Geofile region of interest to crop the mesh to. Defaults to None.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        ROI_buffer_radius_meters (float, optional):</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            Keep points within this distance of the provided ROI object, if unset, everything will</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            be kept. Defaults to 50.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        IDs_to_labels (typing.Union[dict, None], optional):</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            Maps from integer IDs to human-readable class name labels. Defaults to None.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        mesh_downsample (float, optional):</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            Downsample the mesh to this fraction of vertices for increased performance but lower</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            quality. Defaults to 1.0.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        n_aggregation_clusters (typing.Union[int, None]):</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            If set, aggregate with this many clusters. Defaults to None.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        n_cameras_per_aggregation_cluster (typing.Union[int, None]):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            If set, and n_aggregation_clusters is not, use to compute a number of clusters such that</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            each cluster has this many cameras. Defaults to None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        aggregate_image_scale (float, optional):</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            Downsample the labels before aggregation for faster runtime but lower quality. Defaults</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            to 1.0.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        aggregated_face_values_savefile (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            Where to save the aggregated image values as a numpy array. Defaults to None.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        predicted_face_classes_savefile (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            Where to save the most common label per face texture as a numpy array. Defaults to None.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        top_down_vector_projection_savefile (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            Where to export the predicted map. Defaults to None.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        vis (bool, optional):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            Show the mesh model and predicted results. Defaults to False.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="c1">## Create the camera set</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="c1"># Do the camera operations first because they are fast and good initial error checking</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">camera_set</span> <span class="o">=</span> <span class="n">MetashapeCameraSet</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">cameras_file</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">image_folder</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">original_image_folder</span><span class="o">=</span><span class="n">original_image_folder</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">validate_images</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># If the ROI is not None, subset to cameras within a buffer distance of the ROI</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="c1"># TODO let get_subset_ROI accept a None ROI and return the full camera set</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">if</span> <span class="n">subset_images_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">camera_set</span> <span class="o">=</span> <span class="n">camera_set</span><span class="o">.</span><span class="n">get_cameras_in_folder</span><span class="p">(</span><span class="n">subset_images_folder</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># Subset based on regex if requested</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">if</span> <span class="n">filename_regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">camera_set</span> <span class="o">=</span> <span class="n">camera_set</span><span class="o">.</span><span class="n">get_cameras_matching_filename_regex</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">filename_regex</span><span class="o">=</span><span class="n">filename_regex</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="c1"># If you only want to take every nth camera, helpful for initial testing</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="k">if</span> <span class="n">take_every_nth_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">camera_set</span> <span class="o">=</span> <span class="n">camera_set</span><span class="o">.</span><span class="n">get_subset_cameras</span><span class="p">(</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">camera_set</span><span class="p">),</span> <span class="n">take_every_nth_camera</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">ROI</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ROI_buffer_radius_meters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="c1"># Extract cameras near the training data</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">camera_set</span> <span class="o">=</span> <span class="n">camera_set</span><span class="o">.</span><span class="n">get_subset_ROI</span><span class="p">(</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span> <span class="n">buffer_radius</span><span class="o">=</span><span class="n">ROI_buffer_radius_meters</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">mesh_transform_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">mesh_transform_file</span> <span class="o">=</span> <span class="n">cameras_file</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="c1"># If the number of aggregation clusters is not set but the number of cameras per cluster is,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="c1"># then compute it</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">if</span> <span class="n">n_aggregation_clusters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n_cameras_per_aggregation_cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">n_aggregation_clusters</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">camera_set</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_cameras_per_aggregation_cluster</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="c1"># Choose whether to use a mesh class that aggregates by clusters of cameras and chunks of the mesh</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">MeshClass</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">TexturedPhotogrammetryMesh</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">if</span> <span class="n">n_aggregation_clusters</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">else</span> <span class="n">TexturedPhotogrammetryMeshChunked</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="c1">## Create the mesh</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">MeshClass</span><span class="p">(</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">mesh_file</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">transform_filename</span><span class="o">=</span><span class="n">mesh_transform_file</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="n">ROI_buffer_radius_meters</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">downsample_target</span><span class="o">=</span><span class="n">mesh_downsample</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="c1"># Show the mesh if requested</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">if</span> <span class="n">vis</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">camera_set</span><span class="o">=</span><span class="n">camera_set</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="c1"># Create a segmentor object to load in the predictions</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">segmentor</span> <span class="o">=</span> <span class="n">LookUpSegmentor</span><span class="p">(</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">base_folder</span><span class="o">=</span><span class="n">image_folder</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">lookup_folder</span><span class="o">=</span><span class="n">label_folder</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">num_classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_IDs_to_labels</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="c1"># Create a camera set that returns the segmented images instead of the original ones</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">segmentor_camera_set</span> <span class="o">=</span> <span class="n">SegmentorPhotogrammetryCameraSet</span><span class="p">(</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">camera_set</span><span class="p">,</span> <span class="n">segmentor</span><span class="o">=</span><span class="n">segmentor</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="c1"># Create the potentially-empty dict of kwargs to match what this class expects</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">n_clusters_kwargs</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="p">{}</span> <span class="k">if</span> <span class="n">n_aggregation_clusters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;n_clusters&quot;</span><span class="p">:</span> <span class="n">n_aggregation_clusters</span><span class="p">}</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="c1">## Perform aggregation, this is the slow step</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">aggregated_face_labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">aggregate_projected_images</span><span class="p">(</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">segmentor_camera_set</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="n">aggregate_img_scale</span><span class="o">=</span><span class="n">aggregate_image_scale</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="o">**</span><span class="n">n_clusters_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="p">)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="c1"># If requested, save this data</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">if</span> <span class="n">aggregated_face_values_savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">aggregated_face_values_savefile</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">aggregated_face_values_savefile</span><span class="p">,</span> <span class="n">aggregated_face_labels</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="c1"># Find the index of the most common class per face, with faces with no predictions set to nan</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">predicted_face_classes</span> <span class="o">=</span> <span class="n">find_argmax_nonzero_value</span><span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">aggregated_face_labels</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="p">)</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="c1"># If requested, label the ground faces</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">if</span> <span class="n">DTM_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">height_above_ground_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">predicted_face_classes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">label_ground_class</span><span class="p">(</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">labels</span><span class="o">=</span><span class="n">predicted_face_classes</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">height_above_ground_threshold</span><span class="o">=</span><span class="n">height_above_ground_threshold</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">DTM_file</span><span class="o">=</span><span class="n">DTM_file</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">ground_ID</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">set_mesh_texture</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">if</span> <span class="n">predicted_face_classes_savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">predicted_face_classes_savefile</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">predicted_face_classes_savefile</span><span class="p">,</span> <span class="n">predicted_face_classes</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">if</span> <span class="n">vis</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="c1"># Show the mesh with predicted classes</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">vis_scalars</span><span class="o">=</span><span class="n">predicted_face_classes</span><span class="p">)</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="c1"># If the vector file should be exported</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="k">if</span> <span class="n">top_down_vector_projection_savefile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="c1"># Compute the label names</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">if</span> <span class="n">IDs_to_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="c1"># This ensures that any missing keys are replaced with None so proper indexing is retained</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">label_names</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">IDs_to_labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="p">]</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">label_names</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="c1"># Export the 2D top down projection</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">export_face_labels_vector</span><span class="p">(</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">face_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">predicted_face_classes</span><span class="p">),</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">export_file</span><span class="o">=</span><span class="n">top_down_vector_projection_savefile</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">vis</span><span class="o">=</span><span class="n">vis</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">label_names</span><span class="o">=</span><span class="n">label_names</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geograypher.entrypoints.project_detections.project_detections" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">project_detections</span><span class="p">(</span><span class="n">mesh_filename</span><span class="p">,</span> <span class="n">cameras_filename</span><span class="p">,</span> <span class="n">project_to_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">convert_to_geospatial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">detections_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projections_to_mesh_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projections_to_geospatial_savefilename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_focal_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">segmentor_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">vis_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vis_geodata</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.entrypoints.project_detections.project_detections" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">

        <p>Project per-image detections to geospatial coordinates</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh_filename</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to mesh file, in local coordinates from Metashape</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cameras_filename</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to cameras file. This also contains local-to-global coordinate transform to convert
the mesh to geospatial units.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>project_to_mesh</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Execute the projection to mesh step. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_geospatial</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Execute the conversion to geospatial step. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the folder of images used to generate the detections. TODO, see if this can be
removed since none of this information is actually used. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detections_folder</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder of detections in the DeepForest format, one per image. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>projections_to_mesh_filename</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save and/or load from the data for the detections projected to the mesh faces.
Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>projections_to_geospatial_savefilename</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to export the geospatial detections. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_focal_length</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Since the focal length is not provided in many cameras files, it can be specified.
The units are in pixels. TODO, figure out where this information can be reliably obtained
from. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>segmentor_kwargs</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict of keyword arguments to pass to the segmentor. Defaults to {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vis_mesh</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show the mesh with detections projected onto it. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vis_geodata</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show the geospatial projection. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If convert_to_geospatial but no projections to mesh are available</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the projections_to_mesh_filename is set and needed but not present</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/entrypoints/project_detections.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">project_detections</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">mesh_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">cameras_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">project_to_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">convert_to_geospatial</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">image_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">detections_folder</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">projections_to_mesh_filename</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">projections_to_geospatial_savefilename</span><span class="p">:</span> <span class="n">PATH_TYPE</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">default_focal_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">image_shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">segmentor_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">vis_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">vis_geodata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Project per-image detections to geospatial coordinates</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        mesh_filename (PATH_TYPE):</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            Path to mesh file, in local coordinates from Metashape</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        cameras_filename (PATH_TYPE):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            Path to cameras file. This also contains local-to-global coordinate transform to convert</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            the mesh to geospatial units.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        project_to_mesh (bool, optional):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            Execute the projection to mesh step. Defaults to False.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        convert_to_geospatial (bool, optional):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            Execute the conversion to geospatial step. Defaults to False.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        image_folder (PATH_TYPE, optional):</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            Path to the folder of images used to generate the detections. TODO, see if this can be</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            removed since none of this information is actually used. Defaults to None.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        detections_folder (PATH_TYPE, optional):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            Folder of detections in the DeepForest format, one per image. Defaults to None.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        projections_to_mesh_filename (PATH_TYPE, optional):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            Where to save and/or load from the data for the detections projected to the mesh faces.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        projections_to_geospatial_savefilename (PATH_TYPE, optional):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            Where to export the geospatial detections. Defaults to None.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        default_focal_length (float, optional):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            Since the focal length is not provided in many cameras files, it can be specified.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            The units are in pixels. TODO, figure out where this information can be reliably obtained</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            from. Defaults to None.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        segmentor_kwargs (dict, optional):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            Dict of keyword arguments to pass to the segmentor. Defaults to {}.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        vis_mesh (bool, optional):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            Show the mesh with detections projected onto it. Defaults to False.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        vis_geodata (bool, optional):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            Show the geospatial projection. Defaults to False.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        ValueError: If convert_to_geospatial but no projections to mesh are available</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        FileNotFoundError: If the projections_to_mesh_filename is set and needed but not present</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="c1"># Create the mesh object, which will be used for either workflow</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">TexturedPhotogrammetryMeshIndexPredictions</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">mesh_filename</span><span class="p">,</span> <span class="n">transform_filename</span><span class="o">=</span><span class="n">cameras_filename</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># Project per-image detections to the mesh</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">if</span> <span class="n">project_to_mesh</span><span class="p">:</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="c1"># Create a camera set associated with the images that have detections</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">camera_set</span> <span class="o">=</span> <span class="n">MetashapeCameraSet</span><span class="p">(</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">cameras_filename</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">image_folder</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">default_sensor_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="n">default_focal_length</span><span class="p">,</span> <span class="s2">&quot;cx&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;cy&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="c1"># Infer the image shape from the first image in the folder</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">if</span> <span class="n">image_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">image_filename_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">image_folder</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.*&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_filename_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="n">first_file</span> <span class="o">=</span> <span class="n">image_filename_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;loading image shape from </span><span class="si">{</span><span class="n">first_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">first_image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">first_file</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">image_shape</span> <span class="o">=</span> <span class="n">first_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="sa">f</span><span class="s2">&quot;No image_shape provided and folder of images </span><span class="si">{</span><span class="n">image_folder</span><span class="si">}</span><span class="s2"> was empty&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="c1"># Create an object that looks up the detections from a folder of CSVs or one individual one.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="c1"># Using this, it can generate &quot;predictions&quot; for a given image.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">detections_predictor</span> <span class="o">=</span> <span class="n">TabularRectangleSegmentor</span><span class="p">(</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">detection_file_or_folder</span><span class="o">=</span><span class="n">detections_folder</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">image_folder</span><span class="o">=</span><span class="n">image_folder</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">image_shape</span><span class="o">=</span><span class="n">image_shape</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="o">**</span><span class="n">segmentor_kwargs</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># If a file is provided for the projections, save the detection info alongside it</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="n">projections_to_mesh_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="c1"># Export the per-image detection information as one standardized file</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">detection_info_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="n">projections_to_mesh_filename</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">projections_to_mesh_filename</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_detection_info.csv&quot;</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving detection info to </span><span class="si">{</span><span class="n">detection_info_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">detections_predictor</span><span class="o">.</span><span class="n">save_detection_data</span><span class="p">(</span><span class="n">detection_info_file</span><span class="p">)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="c1"># Wrap the camera set so that it returns the detections rather than the original images</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">detections_camera_set</span> <span class="o">=</span> <span class="n">SegmentorPhotogrammetryCameraSet</span><span class="p">(</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="n">camera_set</span><span class="p">,</span> <span class="n">segmentor</span><span class="o">=</span><span class="n">detections_predictor</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="c1"># Project the detections to the mesh</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">aggregated_prejected_images_returns</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">aggregate_projected_images</span><span class="p">(</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">cameras</span><span class="o">=</span><span class="n">detections_camera_set</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">detections_predictor</span><span class="o">.</span><span class="n">num_classes</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="c1"># Get the summed (not averaged) projections</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">aggregated_projections</span> <span class="o">=</span> <span class="n">aggregated_prejected_images_returns</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="s2">&quot;summed_projections&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="p">]</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="k">if</span> <span class="n">projections_to_mesh_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="c1"># Export the per-face texture to an npz file, since it&#39;s a sparse array</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">projections_to_mesh_filename</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">save_npz</span><span class="p">(</span><span class="n">projections_to_mesh_filename</span><span class="p">,</span> <span class="n">aggregated_projections</span><span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">if</span> <span class="n">vis_mesh</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="c1"># Determine which detection is predicted for each face, if any. In cases where multiple</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="c1"># detections project to the same face, the one with the lower index will be reported</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">detection_ID_per_face</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">aggregated_projections</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="nb">float</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="c1"># Mask out locations for which there are no predictions</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">detection_ID_per_face</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aggregated_projections</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="c1"># Show the mesh</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">mesh</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">vis_scalars</span><span class="o">=</span><span class="n">detection_ID_per_face</span><span class="p">)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="c1"># Convert per-face projections to geospatial ones</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">if</span> <span class="n">convert_to_geospatial</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="c1"># Determine if the mesh texture was computed in the last step or otherwise if it can be loaded</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_to_mesh</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">if</span> <span class="n">projections_to_mesh_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No projections_to_mesh_savefilename provided&quot;</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">projections_to_mesh_filename</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">aggregated_projections</span> <span class="o">=</span> <span class="n">load_npz</span><span class="p">(</span><span class="n">projections_to_mesh_filename</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">detection_info_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="n">projections_to_mesh_filename</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span class="n">projections_to_mesh_filename</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s2">&quot;_detection_info.csv&quot;</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>                <span class="n">detection_info</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">detection_info_file</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>                    <span class="sa">f</span><span class="s2">&quot;projections_to_mesh_filename </span><span class="si">{</span><span class="n">projections_to_mesh_filename</span><span class="si">}</span><span class="s2"> not found&quot;</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">detection_info</span> <span class="o">=</span> <span class="n">detections_predictor</span><span class="o">.</span><span class="n">get_all_detections</span><span class="p">()</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="c1"># Convert the per-face labels to geospatial coordinates. Optionally vis and/or export</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">export_face_labels_vector</span><span class="p">(</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">face_labels</span><span class="o">=</span><span class="n">aggregated_projections</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">export_file</span><span class="o">=</span><span class="n">projections_to_geospatial_savefilename</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">vis</span><span class="o">=</span><span class="n">vis_geodata</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">projected_geo_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">projections_to_geospatial_savefilename</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="c1"># Merge the two dataframes so the left df&#39;s &quot;class_ID&quot; field aligns with the right df&#39;s</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="c1"># &quot;instance_ID&quot;. This will add back the original data assocaited with each per-image detection</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="c1"># to the projected data.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="c1"># Add the &quot;_right&quot; suffix to any of the original fields that share a name with the ones in the</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="c1"># projected data</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">merged</span> <span class="o">=</span> <span class="n">projected_geo_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">detection_info</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="n">left_on</span><span class="o">=</span><span class="n">CLASS_ID_KEY</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">right_on</span><span class="o">=</span><span class="n">INSTANCE_ID_KEY</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;_right&quot;</span><span class="p">),</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="p">)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="c1"># Drop the columns that are just an integer ID, except for &quot;instance_ID&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="c1"># TODO determine why &quot;Unnamed: 0&quot; appears</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">CLASS_ID_KEY</span><span class="p">,</span> <span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="c1"># Save the data back out with the updated information</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">merged</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">projections_to_geospatial_savefilename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="geograypher.entrypoints.label_polygons.label_polygons" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">label_polygons</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">,</span> <span class="n">mesh_transform_file</span><span class="p">,</span> <span class="n">aggregated_face_values_file</span><span class="p">,</span> <span class="n">geospatial_polygons_to_label</span><span class="p">,</span> <span class="n">geospatial_polygons_labeled_savefile</span><span class="p">,</span> <span class="n">mesh_downsample</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">DTM_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height_above_ground_threshold</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">ground_voting_weight</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ROI</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ROI_buffer_radius_meters</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_polygons_per_cluster</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">IDs_to_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vis_mesh</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#geograypher.entrypoints.label_polygons.label_polygons" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">

        <p>Label each polygon with the most commonly predicted class as computed by the weighted sum of 3D
face areas</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Metashape-exported mesh file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_transform_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Transform from the mesh coordinates to the earth-centered, earth-fixed frame. Can be a
4x4 matrix represented as a .csv, or a Metashape cameras file containing the information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregated_face_values_file</code>
            </td>
            <td>
                  <code><span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a (n_faces, n_classes) numpy array containing the frequency of each class
prediction for each face</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geospatial_polygons_to_label</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Each polygon/multipolygon will be labeled independently. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geospatial_polygons_labeled_savefile</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Where to save the labeled results.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_downsample</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction to downsample mesh. Should match what was used to generate the
aggregated_face_values_file. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>DTM_file</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a digital terrain model file to remove ground points. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_above_ground_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height in meters above the DTM to consider ground. Only used if DTM_file is set.
Defaults to 2.0.</p>
              </div>
            </td>
            <td>
                  <code>2.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_voting_weight</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Faces identified as ground are given this weight during voting. Defaults to 0.01.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="geograypher.constants.PATH_TYPE">PATH_TYPE</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geofile region of interest to crop the mesh to. Should match what was used to generate
aggregated_face_values_file. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ROI_buffer_radius_meters</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keep points within this distance of the provided ROI object, if unset, everything will
be kept. Should match what was used to generate aggregated_face_values_file. Defaults to 50.</p>
              </div>
            </td>
            <td>
                  <code>50</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_polygons_per_cluster</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of polygons to use in each cluster, when computing labeling by chunks.
Defaults to 1000.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>IDs_to_labels</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="dict">dict</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping from integer IDs to human readable labels. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>geograypher/entrypoints/label_polygons.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">label_polygons</span><span class="p">(</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="n">mesh_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">mesh_transform_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">aggregated_face_values_file</span><span class="p">:</span> <span class="n">PATH_TYPE</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">geospatial_polygons_to_label</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">geospatial_polygons_labeled_savefile</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">mesh_downsample</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">DTM_file</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">height_above_ground_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">ground_voting_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">ROI</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">PATH_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">ROI_buffer_radius_meters</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">n_polygons_per_cluster</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">IDs_to_labels</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">vis_mesh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="p">):</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Label each polygon with the most commonly predicted class as computed by the weighted sum of 3D</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    face areas</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        mesh_file (PATH_TYPE):</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            Path to the Metashape-exported mesh file</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        mesh_transform_file (PATH_TYPE):</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            Transform from the mesh coordinates to the earth-centered, earth-fixed frame. Can be a</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            4x4 matrix represented as a .csv, or a Metashape cameras file containing the information.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        aggregated_face_values_file (PATH_TYPE):</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            Path to a (n_faces, n_classes) numpy array containing the frequency of each class</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            prediction for each face</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        geospatial_polygons_to_label (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            Each polygon/multipolygon will be labeled independently. Defaults to None.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        geospatial_polygons_labeled_savefile (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            Where to save the labeled results.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        mesh_downsample (float, optional):</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            Fraction to downsample mesh. Should match what was used to generate the</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            aggregated_face_values_file. Defaults to 1.0.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        DTM_file (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            Path to a digital terrain model file to remove ground points. Defaults to None.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        height_above_ground_threshold (float, optional):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            Height in meters above the DTM to consider ground. Only used if DTM_file is set.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            Defaults to 2.0.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        ground_voting_weight (float, optional):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            Faces identified as ground are given this weight during voting. Defaults to 0.01.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        ROI (typing.Union[PATH_TYPE, None], optional):</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            Geofile region of interest to crop the mesh to. Should match what was used to generate</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            aggregated_face_values_file. Defaults to None.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        ROI_buffer_radius_meters (float, optional):</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            Keep points within this distance of the provided ROI object, if unset, everything will</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            be kept. Should match what was used to generate aggregated_face_values_file. Defaults to 50.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        n_polygons_per_cluster (int, optional):</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            The number of polygons to use in each cluster, when computing labeling by chunks.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            Defaults to 1000.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        IDs_to_labels (typing.Union[dict, None], optional):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Mapping from integer IDs to human readable labels. Defaults to None.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="c1"># Load this first because it&#39;s quick</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">aggregated_face_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">aggregated_face_values_file</span><span class="p">)</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">predicted_face_classes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">aggregated_face_values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">no_preds_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">aggregated_face_values</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">predicted_face_classes</span><span class="p">[</span><span class="n">no_preds_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="c1">## Create the mesh</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">TexturedPhotogrammetryMeshChunked</span><span class="p">(</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">mesh_file</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">transform_filename</span><span class="o">=</span><span class="n">mesh_transform_file</span><span class="p">,</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">ROI</span><span class="o">=</span><span class="n">ROI</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">ROI_buffer_meters</span><span class="o">=</span><span class="n">ROI_buffer_radius_meters</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">IDs_to_labels</span><span class="o">=</span><span class="n">IDs_to_labels</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">downsample_target</span><span class="o">=</span><span class="n">mesh_downsample</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="n">vis_mesh</span><span class="p">:</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">vis_scalars</span><span class="o">=</span><span class="n">predicted_face_classes</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="c1"># Extract which vertices are labeled as ground</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="c1"># TODO check that the types are correct here</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">ground_mask_verts</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_height_above_ground</span><span class="p">(</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">DTM_file</span><span class="o">=</span><span class="n">DTM_file</span><span class="p">,</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">threshold</span><span class="o">=</span><span class="n">height_above_ground_threshold</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="c1"># Convert that vertex labels into face labels</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="n">ground_mask_faces</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vert_to_face_texture</span><span class="p">(</span><span class="n">ground_mask_verts</span><span class="p">)</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="c1"># Ground points get a weighting of ground_voting_weight, others get 1</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">ground_weighting</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ground_voting_weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">ground_mask_faces</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">if</span> <span class="n">vis_mesh</span><span class="p">:</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">ground_masked_predicted_face_classes</span> <span class="o">=</span> <span class="n">predicted_face_classes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">ground_masked_predicted_face_classes</span><span class="p">[</span><span class="n">ground_mask_faces</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">mesh</span><span class="o">.</span><span class="n">vis</span><span class="p">(</span><span class="n">vis_scalars</span><span class="o">=</span><span class="n">ground_masked_predicted_face_classes</span><span class="p">)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="c1"># Perform per-polygon labeling</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">polygon_labels</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">label_polygons</span><span class="p">(</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">face_labels</span><span class="o">=</span><span class="n">predicted_face_classes</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">polygons</span><span class="o">=</span><span class="n">geospatial_polygons_to_label</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">face_weighting</span><span class="o">=</span><span class="n">ground_weighting</span><span class="p">,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">n_polygons_per_cluster</span><span class="o">=</span><span class="n">n_polygons_per_cluster</span><span class="p">,</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="c1"># Save out the predicted classes into a copy of the original file</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">geospatial_polygons</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geospatial_polygons_to_label</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">geospatial_polygons</span><span class="p">[</span><span class="n">PRED_CLASS_ID_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">polygon_labels</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">ensure_containing_folder</span><span class="p">(</span><span class="n">geospatial_polygons_labeled_savefile</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">geospatial_polygons</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">geospatial_polygons_labeled_savefile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 8, 2024 14:58:33 UTC">July 8, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="July 5, 2024 22:17:53 UTC">July 5, 2024</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="Contributors">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/russelldj" class="md-author" title="@russelldj">
          
          <img src="https://avatars.githubusercontent.com/u/29384527?v=4&size=72" alt="russelldj">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.action.edit"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>